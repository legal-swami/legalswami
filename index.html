<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LegalSwami | AI-Powered Legal Assistant & Document Generator</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Google Client ID -->
    <meta name="google-client-id" 
          content="166511615962-bohur5q8d4i5hud6icr4185kcte9enk8.apps.googleusercontent.com">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚖️</text></svg>">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#0f172a">
    
    <!-- Apple Mobile Web App Capable -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="LegalSwami - AI Legal Assistant">
    <meta property="og:description" content="Get instant legal advice, generate documents, and understand laws with AI">
    <meta property="og:image" content="https://legalswami.com/og-image.jpg">
    <meta property="og:url" content="https://legalswami.com">
  <style>  
    /* ============================================= */
/* LEGALSWAMI - COMPLETE STYLES WITHOUT CONFLICTS */
/* ============================================= */

:root {
    /* Primary Colors */
    --primary: #10a37f;
    --primary-dark: #0d8c6d;
    --primary-light: #12b886;
    --secondary: #7e57c2;
    --accent: #ec4899;
    
    /* Dark Mode */
    --dark-bg: #343541;
    --dark-surface: #40414f;
    --dark-surface-light: #444654;
    --dark-border: #565869;
    --dark-text: #ececf1;
    --dark-text-secondary: #8e8ea0;
    --dark-text-tertiary: #6e6e80;
    
    /* Light Mode */
    --light-bg: #ffffff;
    --light-surface: #f7f7f8;
    --light-surface-light: #f0f0f0;
    --light-border: #e5e5e5;
    --light-text: #000000;
    --light-text-secondary: #6e6e80;
    --light-text-tertiary: #8e8ea0;
    
    /* Status Colors */
    --success: #10b981;
    --warning: #f59e0b;
    --error: #ef4444;
    --info: #3b82f6;
}

/* ============================================= */
/* RESET & BASE STYLES */
/* ============================================= */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    background: var(--dark-bg);
    color: var(--dark-text);
    line-height: 1.5;
    min-height: 100vh;
    overflow-x: hidden;
}

body.light-mode {
    background: var(--light-bg);
    color: var(--light-text);
}

/* FIX FOR CHAT BLACK SCREEN */
body.chat-active {
    overflow: hidden !important;
    height: 100vh !important;
    position: fixed !important;
    width: 100% !important;
}

#chatInterface {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: var(--dark-bg);
    z-index: 99999;
    flex-direction: column;
}

#chatInterface.active {
    display: flex;
}

/* EMERGENCY FIX - Direct style override */
body.chat-active #chatInterface {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
}

body:not(.chat-active) #chatInterface {
    display: none !important;
}

body.chat-active .main-container {
    display: block !important;
}

/* ============================================= */
/* MAIN CONTAINERS */
/* ============================================= */

.main-container {
    display: block;
    width: 100%;
    min-height: 100vh;
}

.container {
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
}

/* ============================================= */
/* CHAT INTERFACE STYLES - FIXED */
/* ============================================= */

/* Chat Container Structure */
#chatInterface .container {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
    background: var(--dark-bg);
}

#chatInterface .chat-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
}

/* Chat Header */
#chatInterface header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1rem;
    background: var(--dark-surface);
    border-bottom: 1px solid var(--dark-border);
    flex-shrink: 0;
}

#chatInterface .logo {
    display: flex;
    align-items: center;
    gap: 10px;
}

#chatInterface .logo-icon {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1rem;
}

#chatInterface .logo h1 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--dark-text);
}

#chatInterface .header-actions {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

.header-btn {
    background: var(--dark-surface-light);
    color: var(--dark-text);
    border: 1px solid var(--dark-border);
    border-radius: 6px;
    padding: 0.5rem 0.75rem;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
    min-height: 36px;
    font-weight: 500;
    border: none;
}

.header-btn:hover {
    background: var(--dark-border);
}

.status-indicator {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 0.4rem 0.75rem;
    background: rgba(16, 163, 127, 0.1);
    border: 1px solid rgba(16, 163, 127, 0.3);
    border-radius: 6px;
    font-size: 0.85rem;
    min-height: 36px;
    font-weight: 500;
}

.status-dot {
    width: 8px;
    height: 8px;
    background-color: var(--success);
    border-radius: 50%;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.theme-toggle {
    background: var(--dark-surface-light);
    border: 1px solid var(--dark-border);
    border-radius: 6px;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
}

.theme-toggle:hover {
    transform: rotate(15deg);
}

/* Chat Main Content */
#chatInterface .main-content {
    display: flex;
    flex: 1;
    overflow: hidden;
}

/* Chat Sidebar */
#chatInterface .sidebar {
    width: 260px;
    background: var(--dark-surface);
    border-right: 1px solid var(--dark-border);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
}

#chatInterface .sidebar-tabs {
    display: flex;
    border-bottom: 1px solid var(--dark-border);
    background: var(--dark-surface);
}

.sidebar-tab {
    flex: 1;
    padding: 0.875rem 0.5rem;
    background: transparent;
    border: none;
    color: var(--dark-text-secondary);
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
}

.sidebar-tab:hover {
    color: var(--dark-text);
    background: var(--dark-surface-light);
}

.sidebar-tab.active {
    color: var(--primary);
    background: var(--dark-surface-light);
}

.tab-content {
    flex: 1;
    overflow-y: auto;
    display: none;
}

.tab-content.active {
    display: block;
}

.sidebar-header {
    padding: 0.875rem 1rem;
    border-bottom: 1px solid var(--dark-border);
    position: sticky;
    top: 0;
    background: var(--dark-surface);
    z-index: 10;
}

.sidebar-header h2 {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--dark-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.sidebar-section {
    padding: 0.875rem 1rem;
}

.sidebar-section h3 {
    font-size: 0.85rem;
    margin-bottom: 0.75rem;
    color: var(--dark-text-secondary);
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
}

.topic-list, .quick-actions {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.topic-item, .action-item {
    padding: 0.75rem;
    background: transparent;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--dark-text);
    min-height: 40px;
    text-align: left;
    width: 100%;
    font-size: 0.875rem;
    font-weight: 500;
}

.topic-item:hover, .action-item:hover {
    background: var(--dark-surface-light);
}

.topic-item.active-tab {
    background: var(--primary);
    color: white !important;
}

.topic-item.active-tab i {
    color: white !important;
}

/* Chat Messages Area */
#chatInterface .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 1.25rem 1rem;
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
    background: var(--dark-bg);
}

.message {
    display: flex;
    gap: 0.75rem;
    max-width: 100%;
    padding: 0 0.75rem;
}

.user-message {
    background: var(--dark-surface);
    border-radius: 8px;
    padding: 1rem;
    max-width: 100%;
}

.ai-message {
    background: transparent;
}

.avatar {
    width: 32px;
    height: 32px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.85rem;
    flex-shrink: 0;
    margin-top: 4px;
}

.user-message .avatar {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
}

.ai-message .avatar {
    background: linear-gradient(135deg, var(--secondary) 0%, #5e35b1 100%);
}

.message-content {
    flex: 1;
    position: relative;
    width: 100%;
    min-width: 0;
}

.message-text {
    padding: 0;
    border-radius: 0;
    font-size: 0.9375rem;
    line-height: 1.6;
    word-wrap: break-word;
    overflow-wrap: break-word;
    overflow: hidden;
    color: var(--dark-text);
}

.user-message .message-text {
    color: white;
}

.message-actions {
    display: flex;
    gap: 8px;
    margin-top: 0.75rem;
    flex-wrap: wrap;
}

.action-btn {
    background: var(--dark-surface-light);
    color: var(--dark-text-secondary);
    border: 1px solid var(--dark-border);
    border-radius: 6px;
    padding: 0.375rem 0.75rem;
    cursor: pointer;
    font-size: 0.8125rem;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
    min-height: 32px;
    font-weight: 500;
    border: none;
}

.action-btn:hover {
    background: var(--dark-border);
    color: var(--dark-text);
}

.action-btn.copy:hover {
    background: var(--success);
    border-color: var(--success);
    color: white;
}

/* Welcome Message */
.welcome-message {
    text-align: center;
    max-width: 600px;
    margin: 1.5rem auto;
    padding: 1.25rem;
    background: linear-gradient(135deg, rgba(16, 163, 127, 0.1) 0%, rgba(30, 64, 175, 0.1) 100%);
    border: 1px solid var(--dark-border);
    border-radius: 12px;
    width: 90%;
}

.welcome-message h2 {
    font-size: 1.5rem;
    margin-bottom: 0.75rem;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 600;
}

.welcome-message p {
    color: var(--dark-text-secondary);
    font-size: 0.9375rem;
    margin-bottom: 1rem;
    line-height: 1.5;
}

.welcome-features {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.875rem;
    margin-top: 1.25rem;
}

.welcome-features .feature {
    background: var(--dark-surface);
    padding: 0.875rem;
    border-radius: 8px;
    border: 1px solid var(--dark-border);
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.welcome-features .feature i {
    font-size: 1.375rem;
    color: var(--primary);
    margin-bottom: 0.5rem;
}

.welcome-features .feature h4 {
    font-size: 0.875rem;
    margin-bottom: 0.25rem;
    color: var(--dark-text);
    font-weight: 600;
}

.welcome-features .feature p {
    font-size: 0.8125rem;
    color: var(--dark-text-secondary);
}

/* Chat Input Area */
.input-container {
    padding: 0.875rem;
    background: var(--dark-bg);
    border-top: 1px solid var(--dark-border);
    flex-shrink: 0;
}

.input-area {
    max-width: 800px;
    margin: 0 auto;
    position: relative;
    width: 100%;
}

.input-area textarea {
    width: 100%;
    padding: 0.875rem 6.5rem 0.875rem 1rem;
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    border-radius: 12px;
    color: var(--dark-text);
    font-size: 0.9375rem;
    resize: none;
    min-height: 52px;
    max-height: 150px;
    transition: all 0.2s;
    line-height: 1.5;
    font-family: inherit;
    border: none;
    outline: none;
}

.input-area textarea:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(16, 163, 127, 0.1);
}

.input-buttons {
    position: absolute;
    right: 0.75rem;
    bottom: 0.75rem;
    display: flex;
    gap: 6px;
    align-items: center;
}

.attachment-btn, .input-microphone-btn, .emoji-picker-btn {
    background: transparent;
    border: none;
    color: var(--dark-text-secondary);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 8px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
}

.attachment-btn:hover, .input-microphone-btn:hover, .emoji-picker-btn:hover {
    background: var(--dark-surface-light);
    color: var(--dark-text);
}

.send-button {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.5rem 0.875rem;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
    min-height: 40px;
    font-size: 0.875rem;
}

.send-button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 163, 127, 0.3);
}

.send-button:disabled {
    background: var(--dark-border);
    cursor: not-allowed;
    opacity: 0.5;
}

/* Scroll to Bottom Button */
.scroll-to-bottom-btn {
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 40px;
    height: 40px;
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    border-radius: 50%;
    color: var(--dark-text);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    z-index: 900;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    opacity: 0;
    transform: translateY(20px);
    border: none;
}

.scroll-to-bottom-btn.visible {
    opacity: 1;
    transform: translateY(0);
}

.scroll-to-bottom-btn:hover {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(16, 163, 127, 0.3);
}

/* Modals */
.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    padding: 16px;
}

.modal-overlay.active {
    display: flex;
}

.modal {
    background: var(--dark-surface);
    border-radius: 12px;
    border: 1px solid var(--dark-border);
    width: 100%;
    max-width: 480px;
    max-height: 90vh;
    overflow: hidden;
}

.modal-header {
    padding: 1.25rem;
    border-bottom: 1px solid var(--dark-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--dark-text);
}

.modal-close {
    background: transparent;
    border: none;
    color: var(--dark-text-secondary);
    cursor: pointer;
    font-size: 1.125rem;
    padding: 4px;
    border-radius: 6px;
    transition: all 0.2s;
    border: none;
}

.modal-close:hover {
    background: var(--dark-surface-light);
    color: var(--dark-text);
}

.modal-content {
    padding: 1.25rem;
}

/* Toast Notifications */
.toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--dark-surface);
    color: var(--dark-text);
    padding: 0.875rem 1rem;
    border-radius: 8px;
    border: 1px solid var(--dark-border);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    gap: 8px;
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.2s ease;
    z-index: 1000;
    max-width: 300px;
}

.toast.show {
    transform: translateY(0);
    opacity: 1;
}

.toast.success {
    border-left: 4px solid var(--success);
}

.toast.error {
    border-left: 4px solid var(--error);
}

.toast.warning {
    border-left: 4px solid var(--warning);
}

.toast.info {
    border-left: 4px solid var(--primary);
}

/* ============================================= */
/* HOMEPAGE STYLES - CONFLICT FIXED */
/* ============================================= */

/* Premium Navigation */
.premium-navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(52, 53, 65, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--dark-border);
    z-index: 1000;
}

.nav-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 2rem;
    max-width: 1400px;
    margin: 0 auto;
}

.nav-logo {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo-icon {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    width: 42px;
    height: 42px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
}

.logo-text {
    display: flex;
    flex-direction: column;
}

.logo-title {
    font-size: 1.5rem;
    font-weight: 700;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

.logo-subtitle {
    font-size: 0.75rem;
    color: var(--dark-text-secondary);
    letter-spacing: 1px;
}

.nav-menu {
    display: flex;
    gap: 2rem;
    align-items: center;
}

.nav-link {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--dark-text);
    text-decoration: none;
    font-weight: 500;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    padding: 8px 12px;
    border-radius: 8px;
}

.nav-link:hover, .nav-link.active {
    background: var(--dark-surface);
    color: var(--primary);
}

.nav-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.btn-login {
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    color: var(--dark-text);
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    border: none;
}

.btn-login:hover {
    background: var(--dark-surface-light);
    transform: translateY(-2px);
}

.user-profile {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    background: var(--dark-surface);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.user-profile:hover {
    background: var(--dark-surface-light);
}

.profile-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 500;
}

.profile-info {
    display: flex;
    flex-direction: column;
}

.profile-name {
    font-size: 0.9rem;
    font-weight: 500;
}

.profile-email {
    font-size: 0.75rem;
    color: var(--dark-text-secondary);
}

.btn-logout {
    background: transparent;
    border: none;
    color: var(--dark-text-secondary);
    cursor: pointer;
    padding: 8px;
    border-radius: 6px;
    transition: all 0.3s ease;
}

.btn-logout:hover {
    background: rgba(239, 68, 68, 0.1);
    color: var(--error);
}

.mobile-toggle {
    display: none;
    background: transparent;
    border: none;
    color: var(--dark-text);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 8px;
}

/* Hero Section */
.hero-section {
    padding-top: 100px;
    min-height: 100vh;
    display: flex;
    align-items: center;
    position: relative;
    overflow: hidden;
}

.hero-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 4rem;
}

.hero-content {
    flex: 1;
    max-width: 600px;
}

.hero-badge {
    display: inline-block;
    background: rgba(16, 163, 127, 0.1);
    border: 1px solid rgba(16, 163, 127, 0.3);
    border-radius: 20px;
    padding: 8px 16px;
    margin-bottom: 2rem;
}

.badge-text {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 6px;
}

.hero-title {
    font-size: 3.5rem;
    font-weight: 800;
    line-height: 1.2;
    margin-bottom: 1.5rem;
}

.hero-subtitle {
    font-size: 1.1rem;
    color: var(--dark-text-secondary);
    line-height: 1.6;
    margin-bottom: 2rem;
}

.hero-stats {
    display: flex;
    gap: 3rem;
    margin-bottom: 2rem;
}

.stat-item {
    display: flex;
    flex-direction: column;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

.stat-label {
    font-size: 0.9rem;
    color: var(--dark-text-secondary);
    margin-top: 4px;
}

.hero-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
}

.btn-hero-primary {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color: white;
    border: none;
    padding: 16px 32px;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.btn-hero-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 20px 40px rgba(16, 163, 127, 0.3);
}

.btn-hero-secondary {
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    color: var(--dark-text);
    padding: 16px 32px;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: all 0.3s ease;
}

.btn-hero-secondary:hover {
    background: var(--dark-surface-light);
    transform: translateY(-2px);
}

.hero-trust {
    margin-top: 2rem;
}

.trust-label {
    font-size: 0.9rem;
    color: var(--dark-text-secondary);
    margin-bottom: 1rem;
}

.trust-badges {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.trust-badge {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--dark-surface);
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 0.9rem;
}

.hero-illustration {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
}

.ai-assistant-card {
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    border-radius: 20px;
    padding: 2rem;
    width: 100%;
    max-width: 400px;
    text-align: center;
}

.assistant-avatar {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    color: white;
    font-size: 2rem;
}

.assistant-title {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.assistant-subtitle {
    color: var(--dark-text-secondary);
    margin-bottom: 1.5rem;
}

.assistant-features {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    margin-bottom: 1.5rem;
}

.feature {
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: flex-start;
    background: transparent;
    border: none;
    padding: 0;
}

.btn-assistant {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: center;
    width: 100%;
    transition: all 0.3s ease;
}

.btn-assistant:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(16, 163, 127, 0.3);
}

/* Common Section Styles */
.features-section,
.database-section,
.documents-section,
.lawyer-section,
.guides-section,
.testimonials-section,
.pricing-section,
.cta-section {
    padding: 80px 0;
}

.section-header {
    text-align: center;
    margin-bottom: 60px;
}

.section-title {
    font-size: 2.5rem;
    margin-bottom: 1rem;
}

.section-subtitle {
    color: var(--dark-text-secondary);
    font-size: 1.1rem;
}

/* Premium Card Base */
.premium-card {
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    border-radius: 12px;
    padding: 1.5rem;
    transition: all 0.3s ease;
}

.premium-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

/* Features Grid */
.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
}

.feature-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1.5rem;
    color: white;
    font-size: 1.5rem;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
}

.feature-title {
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

.feature-description {
    color: var(--dark-text-secondary);
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.feature-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.tag {
    background: rgba(16, 163, 127, 0.1);
    color: var(--primary);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

/* Database Grid */
.database-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
}

.database-icon {
    font-size: 2.5rem;
    color: var(--primary);
    margin-bottom: 1.5rem;
}

.database-title {
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
}

.database-list {
    list-style: none;
    margin-bottom: 2rem;
}

.database-list li {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
    color: var(--dark-text-secondary);
}

.database-list li i {
    color: var(--primary);
}

.btn-database {
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    color: var(--dark-text);
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    width: 100%;
    justify-content: center;
}

.btn-database:hover {
    background: var(--dark-surface-light);
    transform: translateY(-2px);
}

/* Documents Grid */
.documents-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
}

.category-icon {
    font-size: 2.5rem;
    color: var(--primary);
    margin-bottom: 1.5rem;
}

.category-title {
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
}

.document-list {
    list-style: none;
    margin-bottom: 2rem;
}

.document-list li {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
    color: var(--dark-text-secondary);
}

.document-list li i {
    color: var(--primary);
}

.btn-generate {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    width: 100%;
    justify-content: center;
}

.btn-generate:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(16, 163, 127, 0.3);
}

/* Lawyer Search */
.lawyer-search {
    max-width: 800px;
    margin: 0 auto 3rem;
}

.search-container {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.search-container input {
    flex: 1;
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    border-radius: 12px;
    padding: 1rem 1.5rem;
    color: var(--dark-text);
    font-size: 1rem;
    border: none;
    outline: none;
}

.search-container input:focus {
    border-color: var(--primary);
}

.btn-search {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
}

.btn-search:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(16, 163, 127, 0.3);
}

.specialization-filters {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.filter-btn {
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    color: var(--dark-text);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
}

.filter-btn:hover, .filter-btn.active {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
}

.lawyers-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
}

.lawyer-card {
    padding: 1.5rem;
    text-align: center;
}

.lawyer-avatar {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    color: white;
    font-size: 2rem;
}

.lawyer-name {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.lawyer-specialization {
    color: var(--primary);
    font-weight: 500;
    margin-bottom: 0.5rem;
}

.lawyer-experience {
    color: var(--dark-text-secondary);
    font-size: 0.9rem;
    margin-bottom: 1.5rem;
}

.btn-consult {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: center;
    width: 100%;
    transition: all 0.3s ease;
}

.btn-consult:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(16, 163, 127, 0.3);
}

/* Guides Grid */
.guides-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
}

.guide-icon {
    font-size: 2.5rem;
    color: var(--primary);
    margin-bottom: 1.5rem;
}

.guide-title {
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

.guide-description {
    color: var(--dark-text-secondary);
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.guide-steps {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 2rem;
}

.step {
    background: rgba(16, 163, 127, 0.1);
    color: var(--primary);
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
}

.btn-guide {
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    color: var(--dark-text);
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    width: 100%;
    justify-content: center;
}

.btn-guide:hover {
    background: var(--dark-surface-light);
    transform: translateY(-2px);
}

/* Testimonials Carousel */
.testimonials-carousel {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
}

.testimonial-rating {
    color: #f59e0b;
    margin-bottom: 1.5rem;
}

.testimonial-text {
    font-style: italic;
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.testimonial-author {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.author-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    overflow: hidden;
}

.author-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.author-info {
    flex: 1;
}

.author-name {
    font-weight: 600;
    margin-bottom: 2px;
}

.author-title {
    color: var(--dark-text-secondary);
    font-size: 0.9rem;
}

/* Pricing Cards */
.pricing-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
}

.pricing-badge {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--primary);
    color: white;
    padding: 6px 20px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

.pricing-badge.popular {
    background: var(--accent);
}

.pricing-title {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
    text-align: center;
}

.pricing-price {
    text-align: center;
    margin-bottom: 1rem;
}

.pricing-price .currency {
    font-size: 1.2rem;
    vertical-align: top;
}

.pricing-price .amount {
    font-size: 3rem;
    font-weight: 700;
    line-height: 1;
}

.pricing-price .period {
    font-size: 1rem;
    color: var(--dark-text-secondary);
}

.pricing-card.premium-plan .pricing-price .period {
    color: rgba(255, 255, 255, 0.8);
}

.pricing-description {
    text-align: center;
    color: var(--dark-text-secondary);
    margin-bottom: 2rem;
}

.pricing-features {
    list-style: none;
    margin-bottom: 2rem;
}

.pricing-features li {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
}

.pricing-features li i.fa-check-circle {
    color: var(--success);
}

.pricing-features li i.fa-times-circle {
    color: var(--dark-text-secondary);
}

.pricing-card.premium-plan .pricing-features li i {
    color: white;
}

.btn-pricing {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    width: 100%;
    justify-content: center;
}

.pricing-card.premium-plan .btn-pricing {
    background: white;
    color: var(--primary);
}

.btn-pricing:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(16, 163, 127, 0.3);
}

.pricing-card.premium-plan .btn-pricing:hover {
    box-shadow: 0 10px 20px rgba(255, 255, 255, 0.3);
}

/* CTA Section */
.cta-content {
    text-align: center;
    max-width: 800px;
    margin: 0 auto;
}

.cta-title {
    font-size: 3rem;
    font-weight: 800;
    line-height: 1.2;
    margin-bottom: 1.5rem;
}

.cta-description {
    font-size: 1.2rem;
    color: var(--dark-text-secondary);
    line-height: 1.6;
    margin-bottom: 2rem;
}

.cta-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-bottom: 2rem;
}

.btn-cta-primary {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color: white;
    border: none;
    padding: 16px 32px;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: all 0.3s ease;
}

.btn-cta-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 20px 40px rgba(16, 163, 127, 0.3);
}

.btn-cta-secondary {
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    color: var(--dark-text);
    padding: 16px 32px;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: all 0.3s ease;
}

.btn-cta-secondary:hover {
    background: var(--dark-surface-light);
    transform: translateY(-2px);
}

.cta-guarantee {
    display: flex;
    gap: 2rem;
    justify-content: center;
    flex-wrap: wrap;
}

.guarantee-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--dark-text-secondary);
}

/* Footer */
.premium-footer {
    background: var(--dark-surface);
    border-top: 1px solid var(--dark-border);
    padding: 4rem 0 2rem;
}

.footer-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 3rem;
}

.footer-logo {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 1.5rem;
}

.footer-description {
    color: var(--dark-text-secondary);
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.social-links {
    display: flex;
    gap: 1rem;
}

.social-link {
    width: 40px;
    height: 40px;
    background: var(--dark-surface-light);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--dark-text);
    transition: all 0.3s ease;
}

.social-link:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-2px);
}

.footer-heading {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
}

.footer-links {
    list-style: none;
}

.footer-links li {
    margin-bottom: 0.8rem;
}

.footer-links a {
    color: var(--dark-text-secondary);
    text-decoration: none;
    transition: all 0.3s ease;
}

.footer-links a:hover {
    color: var(--primary);
    padding-left: 5px;
}

.footer-contact {
    list-style: none;
}

.footer-contact li {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 1rem;
    color: var(--dark-text-secondary);
}

.footer-contact a {
    color: var(--dark-text-secondary);
    text-decoration: none;
    transition: all 0.3s ease;
}

.footer-contact a:hover {
    color: var(--primary);
}

.footer-bottom {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid var(--dark-border);
    text-align: center;
}

.copyright {
    color: var(--dark-text-secondary);
    margin-bottom: 1rem;
}

.disclaimer {
    background: rgba(245, 158, 11, 0.1);
    border: 1px solid rgba(245, 158, 11, 0.3);
    border-radius: 8px;
    padding: 1rem;
    color: var(--warning);
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: center;
}

.back-to-top {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 50px;
    height: 50px;
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    border-radius: 50%;
    color: var(--dark-text);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    z-index: 1000;
    border: none;
}

.back-to-top:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-5px);
}

/* Loading Screen */
.loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--dark-bg);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.loading-content {
    text-align: center;
}

.loading-spinner {
    width: 80px;
    height: 80px;
    border: 3px solid var(--dark-border);
    border-top: 3px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ============================================= */
/* RESPONSIVE STYLES */
/* ============================================= */

@media (max-width: 768px) {
    /* Navigation */
    .nav-menu {
        display: none;
    }
    
    .mobile-toggle {
        display: block;
    }
    
    /* Hero Section */
    .hero-container {
        flex-direction: column;
        text-align: center;
    }
    
    .hero-title {
        font-size: 2.5rem;
    }
    
    .hero-stats {
        flex-direction: column;
        gap: 1.5rem;
    }
    
    .hero-actions {
        flex-direction: column;
    }
    
    /* Section Titles */
    .section-title {
        font-size: 2rem;
    }
    
    /* CTA Section */
    .cta-title {
        font-size: 2.5rem;
    }
    
    .cta-actions {
        flex-direction: column;
    }
    
    /* Footer */
    .footer-content {
        grid-template-columns: 1fr;
        text-align: center;
    }
    
    .footer-logo {
        justify-content: center;
    }
    
    .social-links {
        justify-content: center;
    }
    
    /* Chat Interface Mobile */
    #chatInterface .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        width: 85vw;
        max-width: 280px;
        z-index: 100;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    
    #chatInterface .sidebar.active {
        transform: translateX(0);
    }
    
    .sidebar-toggle {
        display: flex;
    }
    
    .sidebar-close {
        display: block;
    }
    
    .sidebar-overlay {
        display: block;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 99;
    }
    
    /* Chat Header Mobile */
    #chatInterface header {
        padding: 0.625rem 0.75rem;
        min-height: 56px;
    }
    
    .header-btn span, .status-indicator span {
        display: none;
    }
    
    .header-btn i {
        margin: 0;
    }
    
    /* Chat Messages Mobile */
    .chat-messages {
        padding: 0.75rem 0.5rem;
        gap: 1rem;
    }
    
    .message {
        padding: 0 0.5rem;
        gap: 0.625rem;
    }
    
    .avatar {
        width: 28px;
        height: 28px;
        font-size: 0.75rem;
    }
    
    .message-text {
        font-size: 0.875rem;
    }
    
    /* Input Area Mobile */
    .input-container {
        padding: 0.75rem;
    }
    
    .input-area textarea {
        padding: 0.75rem 5.5rem 0.75rem 0.875rem;
        font-size: 0.875rem;
        min-height: 48px;
    }
    
    .input-buttons {
        right: 0.5rem;
        bottom: 0.5rem;
        gap: 4px;
    }
    
    .send-button {
        padding: 0.5rem 0.75rem;
        min-height: 36px;
        font-size: 0.8125rem;
    }
    
    .attachment-btn,
    .input-microphone-btn,
    .emoji-picker-btn {
        width: 28px;
        height: 28px;
        padding: 0.375rem;
    }
}

@media (min-width: 769px) and (max-width: 1024px) {
    .hero-title {
        font-size: 3rem;
    }
    
    .features-grid,
    .database-grid,
    .documents-grid,
    .guides-grid,
    .testimonials-carousel,
    .pricing-cards {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (min-width: 1025px) {
    .sidebar-toggle,
    .sidebar-close,
    .sidebar-overlay {
        display: none;
    }
    
    #chatInterface .sidebar {
        position: relative;
        transform: translateX(0);
    }
}

/* ============================================= */
/* UTILITY CLASSES */
/* ============================================= */

.hide-on-mobile {
    display: none;
}

.show-on-mobile {
    display: flex;
}

@media (min-width: 769px) {
    .hide-on-mobile {
        display: flex;
    }
    
    .show-on-mobile {
        display: none;
    }
}

/* Scrollbar Styles */
::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

::-webkit-scrollbar-track {
    background: var(--dark-bg);
}

::-webkit-scrollbar-thumb {
    background: var(--dark-border);
    border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--dark-surface-light);
}

/* Light Mode Adjustments */
.light-mode {
    /* Chat Interface */
    #chatInterface {
        background: var(--light-bg);
    }
    
    #chatInterface .container {
        background: var(--light-bg);
    }
    
    #chatInterface .chat-messages {
        background: var(--light-bg);
    }
    
    #chatInterface .chat-container {
        background: var(--light-bg);
    }
    
    #chatInterface header {
        background: var(--light-surface);
        border-bottom-color: var(--light-border);
    }
    
    #chatInterface .logo h1 {
        color: var(--light-text);
    }
    
    .header-btn {
        background: var(--light-surface-light);
        color: var(--light-text);
        border-color: var(--light-border);
    }
    
    .header-btn:hover {
        background: var(--light-border);
    }
    
    .status-indicator {
        background: rgba(16, 163, 127, 0.08);
        border-color: rgba(16, 163, 127, 0.2);
    }
    
    .theme-toggle {
        background: var(--light-surface-light);
        border-color: var(--light-border);
    }
    
    .theme-toggle i {
        color: var(--light-text);
    }
    
    #chatInterface .sidebar {
        background: var(--light-surface);
        border-right-color: var(--light-border);
    }
    
    .sidebar-tab {
        color: var(--light-text-secondary);
    }
    
    .sidebar-tab:hover {
        color: var(--light-text);
        background: var(--light-surface-light);
    }
    
    .sidebar-tab.active {
        color: var(--primary);
        background: var(--light-surface-light);
    }
    
    .sidebar-header {
        background: var(--light-surface);
        border-bottom-color: var(--light-border);
    }
    
    .sidebar-header h2 {
        color: var(--light-text-secondary);
    }
    
    .sidebar-section h3 {
        color: var(--light-text-secondary);
    }
    
    .topic-item, .action-item {
        color: var(--light-text);
    }
    
    .topic-item:hover, .action-item:hover {
        background: var(--light-surface-light);
    }
    
    .message-text {
        color: var(--light-text);
    }
    
    .user-message {
        background: var(--light-surface);
    }
    
    .action-btn {
        background: var(--light-surface-light);
        color: var(--light-text-secondary);
        border-color: var(--light-border);
    }
    
    .action-btn:hover {
        background: var(--light-border);
        color: var(--light-text);
    }
    
    .welcome-message {
        background: linear-gradient(135deg, rgba(16, 163, 127, 0.08) 0%, rgba(30, 64, 175, 0.08) 100%);
        border-color: var(--light-border);
    }
    
    .welcome-message p {
        color: var(--light-text-secondary);
    }
    
    .welcome-features .feature {
        background: var(--light-surface);
        border-color: var(--light-border);
    }
    
    .welcome-features .feature h4 {
        color: var(--light-text);
    }
    
    .welcome-features .feature p {
        color: var(--light-text-secondary);
    }
    
    .input-container {
        background: var(--light-bg);
        border-top-color: var(--light-border);
    }
    
    .input-area textarea {
        background: var(--light-surface);
        color: var(--light-text);
        border-color: var(--light-border);
    }
    
    .attachment-btn,
    .input-microphone-btn,
    .emoji-picker-btn {
        color: var(--light-text-secondary);
    }
    
    .attachment-btn:hover,
    .input-microphone-btn:hover,
    .emoji-picker-btn:hover {
        background: var(--light-surface-light);
        color: var(--light-text);
    }
    
    .send-button:disabled {
        background: var(--light-border);
    }
    
    .scroll-to-bottom-btn {
        background: var(--light-surface);
        border-color: var(--light-border);
        color: var(--light-text);
    }
    
    .scroll-to-bottom-btn:hover {
        background: var(--primary);
        border-color: var(--primary);
        color: white;
    }
    
    .modal {
        background: var(--light-surface);
        border-color: var(--light-border);
    }
    
    .modal-header {
        border-bottom-color: var(--light-border);
    }
    
    .modal-header h2 {
        color: var(--light-text);
    }
    
    .modal-close {
        color: var(--light-text-secondary);
    }
    
    .modal-close:hover {
        background: var(--light-surface-light);
        color: var(--light-text);
    }
    
    .toast {
        background: var(--light-surface);
        color: var(--light-text);
        border-color: var(--light-border);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    
    /* Homepage Light Mode */
    .premium-navbar {
        background: rgba(247, 247, 248, 0.95);
    }
    
    .nav-link {
        color: var(--light-text);
    }
    
    .nav-link:hover, .nav-link.active {
        background: var(--light-surface);
        color: var(--primary);
    }
    
    .btn-login {
        background: var(--light-surface);
        border-color: var(--light-border);
        color: var(--light-text);
    }
    
    .user-profile {
        background: var(--light-surface);
    }
    
    .hero-subtitle {
        color: var(--light-text-secondary);
    }
    
    .trust-label {
        color: var(--light-text-secondary);
    }
    
    .trust-badge {
        background: var(--light-surface);
    }
    
    .ai-assistant-card {
        background: var(--light-surface);
        border-color: var(--light-border);
    }
    
    .assistant-subtitle {
        color: var(--light-text-secondary);
    }
    
    /* Scrollbar Light Mode */
    ::-webkit-scrollbar-track {
        background: var(--light-bg);
    }
    
    ::-webkit-scrollbar-thumb {
        background: var(--light-border);
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: var(--light-surface-light);
    }
}

/* Animation Classes */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes shimmer {
    to { background-position: 200% center; }
}

.shimmer-text {
    background: linear-gradient(90deg, var(--primary), var(--secondary), var(--primary));
    background-size: 200% auto;
    color: transparent;
    -webkit-background-clip: text;
    background-clip: text;
    animation: shimmer 2s linear infinite;
}

.legal-seal {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
}

.pulse-glow {
    animation: pulseGlow 2s ease-in-out infinite;
}

@keyframes pulseGlow {
    0%, 100% { box-shadow: 0 0 20px rgba(16, 163, 127, 0.3); }
    50% { box-shadow: 0 0 40px rgba(16, 163, 127, 0.5); }
}

.gavel-animation {
    animation: gavelSwing 3s ease-in-out infinite;
}

@keyframes gavelSwing {
    0%, 100% { transform: rotate(0deg); }
    25% { transform: rotate(-10deg); }
    75% { transform: rotate(10deg); }
}

.text-reveal {
    animation: textReveal 1s ease-out;
}

@keyframes textReveal {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Ensure all buttons have proper cursor */
button:not(:disabled),
.btn-hero-primary,
.btn-hero-secondary,
.btn-assistant,
.btn-database,
.btn-generate,
.btn-search,
.btn-consult,
.btn-guide,
.btn-pricing,
.btn-cta-primary,
.btn-cta-secondary,
.header-btn,
.action-btn,
.send-button {
    cursor: pointer;
}

/* Ensure all disabled buttons look disabled */
button:disabled,
.btn-hero-primary:disabled,
.btn-hero-secondary:disabled,
.send-button:disabled {
    cursor: not-allowed;
    opacity: 0.5;
}

/* Remove default button focus outlines and add custom */
button:focus,
input:focus,
textarea:focus,
select:focus {
    outline: none;
}

button:focus-visible,
input:focus-visible,
textarea:focus-visible,
select:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
}

/* Image and media defaults */
img {
    max-width: 100%;
    height: auto;
    display: block;
}

/* Additional Chat Styles */
.stream-controls {
    display: flex;
    gap: 8px;
    margin-top: 12px;
}

.stream-control-btn {
    background: var(--dark-surface-light);
    color: var(--dark-text-secondary);
    border: 1px solid var(--dark-border);
    border-radius: 6px;
    padding: 6px 12px;
    font-size: 0.8125rem;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
}

.stream-control-btn:hover {
    background: var(--dark-border);
    color: var(--dark-text);
}

.streaming-cursor {
    display: inline-block;
    width: 4px;
    height: 20px;
    background: var(--primary);
    margin-left: 2px;
    animation: blink 1s infinite;
    vertical-align: middle;
}

@keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
}

.paused-indicator {
    display: inline-block;
    background: var(--warning);
    color: white;
    font-size: 0.75rem;
    padding: 2px 6px;
    border-radius: 4px;
    margin-left: 8px;
    vertical-align: middle;
}

.document-template {
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    border-radius: 8px;
    padding: 1.5rem;
    margin-top: 1rem;
}

.document-header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--primary);
}

.document-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 0.5rem;
}

.document-subtitle {
    color: var(--dark-text-secondary);
    font-size: 0.875rem;
}

.document-section {
    margin: 1.5rem 0;
}

.document-section-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--dark-text);
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--dark-border);
}

.document-clause {
    margin: 1rem 0;
    padding-left: 1rem;
    border-left: 3px solid var(--primary-light);
}

.clause-title {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--primary);
}

.clause-content {
    color: var(--dark-text);
    line-height: 1.6;
    margin-bottom: 0.5rem;
}

.signature-section {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 2px solid var(--dark-border);
}

.signature-line {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
}

.signature-block {
    text-align: center;
    width: 45%;
}

.signature-name {
    border-bottom: 1px solid var(--dark-border);
    padding-bottom: 4px;
    margin-bottom: 4px;
    min-height: 24px;
}

.signature-label {
    color: var(--dark-text-secondary);
    font-size: 0.875rem;
}

.legal-note {
    background: rgba(245, 158, 11, 0.1);
    border: 1px solid rgba(245, 158, 11, 0.3);
    border-radius: 6px;
    padding: 1rem;
    margin-top: 2rem;
    color: var(--warning);
    font-size: 0.875rem;
}

.document-download-btn {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border: none;
    border-radius: 6px;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 1.5rem;
    transition: all 0.2s;
}

.document-download-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(16, 163, 127, 0.3);
}

.sources-container {
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
}

.sources-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 0.75rem;
    color: var(--primary);
    font-weight: 600;
}

.sources-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 0.75rem;
}

.source-tag {
    background: rgba(16, 163, 127, 0.1);
    border: 1px solid rgba(16, 163, 127, 0.3);
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 0.75rem;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    transition: all 0.2s;
}

.source-tag:hover {
    background: rgba(16, 163, 127, 0.2);
}

.sources-info {
    color: var(--dark-text-secondary);
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    gap: 6px;
}

/* Mobile Menu */
.mobile-menu-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1001;
}

.mobile-menu-container {
    position: fixed;
    top: 0;
    right: 0;
    width: 300px;
    height: 100%;
    background: var(--dark-surface);
    border-left: 1px solid var(--dark-border);
    display: flex;
    flex-direction: column;
}

.mobile-menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid var(--dark-border);
}

.mobile-close {
    background: transparent;
    border: none;
    color: var(--dark-text);
    font-size: 1.5rem;
    cursor: pointer;
}

.mobile-menu-links {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.mobile-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 1rem;
    color: var(--dark-text);
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.mobile-link:hover, .mobile-link.active {
    background: var(--dark-surface-light);
    color: var(--primary);
}

/* Draft Templates */
.draft-templates {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    margin-top: 1.5rem;
}

.draft-template {
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    border-radius: 8px;
    padding: 1rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.draft-template:hover {
    background: var(--dark-surface-light);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.draft-template i {
    font-size: 1.5rem;
    color: var(--primary);
    margin-bottom: 0.5rem;
}

.draft-template h4 {
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
    color: var(--dark-text);
}

.draft-template p {
    font-size: 0.75rem;
    color: var(--dark-text-secondary);
}

/* Section Divider */
.section-divider {
    height: 1px;
    background: var(--dark-border);
    margin: 1.5rem 0;
}

/* User Dropdown */
.user-dropdown {
    position: absolute;
    top: 60px;
    right: 20px;
    width: 240px;
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    border-radius: 8px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    z-index: 1001;
    display: none;
}

.user-dropdown.active {
    display: block;
}

.dropdown-header {
    padding: 1rem;
    border-bottom: 1px solid var(--dark-border);
    display: flex;
    align-items: center;
    gap: 12px;
}

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 6px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
}

.dropdown-items {
    padding: 0.5rem 0;
}

.dropdown-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 0.75rem 1rem;
    width: 100%;
    background: transparent;
    border: none;
    color: var(--dark-text);
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
    font-size: 0.875rem;
}

.dropdown-item:hover {
    background: var(--dark-surface-light);
}

.dropdown-footer {
    border-top: 1px solid var(--dark-border);
    margin-top: 0.5rem;
    padding-top: 0.5rem;
}

.dropdown-item.logout {
    color: var(--error);
}

/* Progress Indicator */
.progress-indicator {
    display: none;
    align-items: center;
    gap: 12px;
    padding: 1rem;
    background: var(--dark-surface);
    border-radius: 8px;
    margin-top: 1rem;
}

.progress-indicator.active {
    display: flex;
}

.progress-spinner {
    width: 20px;
    height: 20px;
    border: 2px solid var(--dark-border);
    border-top: 2px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

/* Download Notification */
.download-notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    border-radius: 8px;
    padding: 0.875rem 1rem;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s ease;
    z-index: 1001;
    max-width: 320px;
}

.download-notification.show {
    transform: translateY(0);
    opacity: 1;
}

.download-notification-content {
    flex: 1;
}

.download-notification-title {
    font-weight: 600;
    margin-bottom: 2px;
    color: var(--dark-text);
}

.download-notification-message {
    font-size: 0.8125rem;
    color: var(--dark-text-secondary);
}

.download-notification-close {
    background: transparent;
    border: none;
    color: var(--dark-text-secondary);
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
}

.download-notification-close:hover {
    background: var(--dark-surface-light);
    color: var(--dark-text);
}

/* File Upload Styles */
.upload-area {
    border: 2px dashed var(--dark-border);
    border-radius: 12px;
    padding: 3rem 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: var(--dark-surface);
}

.upload-area.dragover {
    border-color: var(--primary);
    background: rgba(16, 163, 127, 0.05);
}

.upload-icon {
    font-size: 3rem;
    color: var(--primary);
    margin-bottom: 1rem;
}

.upload-text h3 {
    font-size: 1.2rem;
    margin-bottom: 0.5rem;
    color: var(--dark-text);
}

.upload-text p {
    color: var(--dark-text-secondary);
    margin-bottom: 1.5rem;
}

.upload-btn {
    background: var(--dark-surface-light);
    border: 1px solid var(--dark-border);
    color: var(--dark-text);
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
}

.upload-btn:hover {
    background: var(--dark-border);
}

.uploaded-images {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 1rem;
    margin-top: 1.5rem;
}

.uploaded-image-item {
    position: relative;
    border: 1px solid var(--dark-border);
    border-radius: 8px;
    overflow: hidden;
}

.uploaded-image-preview {
    width: 100%;
    height: 100px;
    object-fit: cover;
}

.remove-uploaded-image {
    position: absolute;
    top: 5px;
    right: 5px;
    width: 24px;
    height: 24px;
    background: var(--error);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
}

/* Attachment Preview */
.attachments-preview {
    display: flex;
    gap: 8px;
    margin-bottom: 8px;
    flex-wrap: wrap;
}

.attachment-preview-item {
    position: relative;
    width: 70px;
    height: 70px;
    border: 1px solid var(--dark-border);
    border-radius: 6px;
    overflow: hidden;
}

.attachment-preview-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.attachment-preview-name {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    font-size: 0.6rem;
    padding: 2px 4px;
    text-align: center;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.remove-attachment {
    position: absolute;
    top: 2px;
    right: 2px;
    width: 18px;
    height: 18px;
    background: var(--error);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.6rem;
    line-height: 1;
}

/* Voice Input */
.voice-input-status {
    display: none;
    align-items: center;
    gap: 12px;
    padding: 8px 12px;
    background: rgba(16, 163, 127, 0.1);
    border: 1px solid rgba(16, 163, 127, 0.3);
    border-radius: 6px;
    margin-bottom: 8px;
}

.voice-input-status.active {
    display: flex;
}

.voice-animation {
    display: flex;
    align-items: center;
    gap: 2px;
    height: 20px;
}

.voice-bar {
    width: 3px;
    background: var(--primary);
    border-radius: 2px;
    animation: voiceAnimation 1s infinite ease-in-out;
}

.voice-bar:nth-child(1) { animation-delay: 0s; height: 8px; }
.voice-bar:nth-child(2) { animation-delay: 0.1s; height: 12px; }
.voice-bar:nth-child(3) { animation-delay: 0.2s; height: 16px; }
.voice-bar:nth-child(4) { animation-delay: 0.3s; height: 12px; }
.voice-bar:nth-child(5) { animation-delay: 0.4s; height: 8px; }

@keyframes voiceAnimation {
    0%, 100% { height: 8px; }
    50% { height: 16px; }
}

.voice-input-text {
    display: none;
    background: var(--dark-surface-light);
    border: 1px solid var(--dark-border);
    border-radius: 6px;
    padding: 8px 12px;
    margin-top: 8px;
    font-size: 0.875rem;
    color: var(--dark-text);
}

/* History Styles */
.history-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border-bottom: 1px solid var(--dark-border);
}

.new-chat-btn {
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    font-size: 0.8125rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
}

.history-list {
    padding: 0.5rem;
}

.history-item {
    padding: 0.75rem;
    border-radius: 6px;
    margin-bottom: 4px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
}

.history-item:hover {
    background: var(--dark-surface-light);
}

.history-item.active {
    background: var(--primary);
    color: white;
}

.history-title {
    font-weight: 500;
    font-size: 0.875rem;
    margin-bottom: 2px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.history-preview {
    font-size: 0.75rem;
    color: var(--dark-text-secondary);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.history-item.active .history-preview {
    color: rgba(255, 255, 255, 0.8);
}

.history-date {
    font-size: 0.7rem;
    color: var(--dark-text-tertiary);
    margin-top: 4px;
}

.history-item.active .history-date {
    color: rgba(255, 255, 255, 0.6);
}

.history-item-actions {
    position: absolute;
    top: 8px;
    right: 8px;
    display: none;
    gap: 4px;
}

.history-item:hover .history-item-actions {
    display: flex;
}

.history-item-btn {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    border: none;
    background: var(--dark-surface);
    color: var(--dark-text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
}

.history-item-btn:hover {
    background: var(--dark-border);
    color: var(--dark-text);
}

.empty-history {
    text-align: center;
    padding: 2rem 1rem;
    color: var(--dark-text-secondary);
}

.empty-history i {
    font-size: 2rem;
    margin-bottom: 1rem;
    color: var(--dark-text-tertiary);
}

/* Language Hint */
.language-hint {
    position: absolute;
    top: -28px;
    left: 10px;
    font-size: 0.75rem;
    color: var(--primary);
    background: rgba(16, 163, 127, 0.1);
    padding: 2px 8px;
    border-radius: 4px;
    display: none;
}

/* Confirmation Modal */
.confirmation-modal {
    max-width: 400px;
}

.confirmation-text {
    text-align: center;
    margin-bottom: 1.5rem;
}

.confirmation-text i {
    font-size: 3rem;
    color: var(--warning);
    margin-bottom: 1rem;
}

.confirmation-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
}

.confirmation-btn {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: all 0.3s ease;
    min-width: 120px;
}

.confirmation-btn.cancel {
    background: var(--dark-surface);
    color: var(--dark-text);
    border: 1px solid var(--dark-border);
}

.confirmation-btn.cancel:hover {
    background: var(--dark-surface-light);
}

.confirmation-btn.delete {
    background: var(--error);
    color: white;
}

.confirmation-btn.delete:hover {
    background: #dc2626;
    transform: translateY(-2px);
}

/* Download Options */
.download-options {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin: 1.5rem 0;
}

.download-option {
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    border-radius: 8px;
    padding: 1.5rem 1rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.download-option:hover {
    background: var(--dark-surface-light);
    transform: translateY(-2px);
    border-color: var(--primary);
}

.download-option i {
    font-size: 2rem;
    color: var(--primary);
    margin-bottom: 0.75rem;
}

.download-option h3 {
    font-size: 1rem;
    margin-bottom: 0.25rem;
    color: var(--dark-text);
}

.download-option p {
    font-size: 0.75rem;
    color: var(--dark-text-secondary);
}

.modal-footer {
    padding: 1rem 1.25rem;
    border-top: 1px solid var(--dark-border);
    text-align: center;
    font-size: 0.875rem;
    color: var(--dark-text-secondary);
}

/* File Content Display */
.file-content-display {
    background: var(--dark-surface);
    border: 1px solid var(--dark-border);
    border-radius: 8px;
    margin: 1rem 0;
    overflow: hidden;
}

.file-content-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1rem;
    background: var(--dark-surface-light);
    border-bottom: 1px solid var(--dark-border);
}

.file-content-title {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--dark-text);
    font-weight: 500;
}

.file-content-close {
    background: transparent;
    border: none;
    color: var(--dark-text-secondary);
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
}

.file-content-close:hover {
    background: var(--dark-border);
    color: var(--dark-text);
}

/* User Message Controls */
.user-message-controls {
    display: flex;
    gap: 4px;
    margin-top: 8px;
}

.user-message-btn {
    background: var(--dark-surface-light);
    color: var(--dark-text-secondary);
    border: 1px solid var(--dark-border);
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 0.75rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 4px;
    transition: all 0.2s;
}

.user-message-btn:hover {
    background: var(--dark-border);
    color: var(--dark-text);
}

/* Scroll Position Indicator */
.scroll-position-indicator {
    position: absolute;
    bottom: 120px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: var(--dark-surface);
    color: var(--dark-text);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    opacity: 0;
    transition: all 0.3s ease;
    border: 1px solid var(--dark-border);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    pointer-events: none;
    z-index: 10;
}

.scroll-position-indicator.visible {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}

/* Image Upload Modal */
.image-upload-content {
    background: var(--dark-surface);
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow: hidden;
}

/* Animation for smooth transitions */
.main-container, #chatInterface {
    transition: opacity 0.3s ease, transform 0.3s ease;
}


/* Ensure chat interface is properly positioned */
#chatInterface {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--dark-bg);
    z-index: 99999;
    display: none; /* Start hidden */
    flex-direction: column;
}

#chatInterface.active {
    display: flex; /* When active class is added */
}


/* EMERGENCY FIX FOR BLACK SCREEN */
#chatInterface {
    display: none !important;
    opacity: 0;
    transition: opacity 0.3s ease;
}

body.chat-active #chatInterface {
    display: flex !important;
    opacity: 1 !important;
    visibility: visible !important;
}

body.chat-active .main-container {
    display: block !important;
}

/* Force chat interface to show */
.chat-interface.active {
    display: flex !important;
    opacity: 1 !important;
    visibility: visible !important;
}

/* Fix for black screen */
#chatInterface .container,
#chatInterface .chat-container {
    display: flex !important;
    flex-direction: column;
    height: 100vh !important;
    width: 100% !important;
    background: var(--dark-bg) !important;
}

#chatInterface .chat-messages {
    flex: 1 !important;
    overflow-y: auto !important;
}
	  </style>
</head>
<body>
    <!-- Premium Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner legal-seal">
                <i class="fas fa-gavel"></i>
            </div>
            <h2 class="shimmer-text mt-4">LegalSwami</h2>
            <p class="text-light">Initializing AI Legal Assistant...</p>
            <div class="progress-bar mt-4">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Premium Navigation Bar -->
        <nav class="premium-navbar">
            <div class="nav-container">
                <!-- Logo with Animation -->
                <div class="nav-logo">
                    <div class="logo-icon legal-seal">
                        <i class="fas fa-gavel gavel-animation"></i>
                    </div>
                    <div class="logo-text">
                        <h1 class="logo-title shimmer-text">LegalSwami</h1>
                        <p class="logo-subtitle">AI Legal Assistant</p>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="nav-menu">
                    <a href="#home" class="nav-link active" data-scroll="home">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="#features" class="nav-link" data-scroll="features">
                        <i class="fas fa-star"></i>
                        <span>Features</span>
                    </a>
                    <a href="#documents" class="nav-link" data-scroll="documents">
                        <i class="fas fa-file-contract"></i>
                        <span>Documents</span>
                    </a>
                    <a href="#legalDatabase" class="nav-link" data-scroll="legalDatabase">
                        <i class="fas fa-database"></i>
                        <span>Legal Database</span>
                    </a>
                    <a href="#lawyerDirectory" class="nav-link" data-scroll="lawyerDirectory">
                        <i class="fas fa-user-tie"></i>
                        <span>Find Lawyers</span>
                    </a>
                    <a href="#pricing" class="nav-link" data-scroll="pricing">
                        <i class="fas fa-tag"></i>
                        <span>Pricing</span>
                    </a>
                </div>

                <!-- User Actions -->
                <div class="nav-actions">
                    <button id="headerLoginBtn" class="btn-login">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Login</span>
                    </button>
                    
                    <!-- User Profile (Hidden by default) -->
                    <div id="homeUserProfile" class="user-profile" style="display: none;">
                        <div class="profile-avatar">
                            <div id="homeUserAvatar"></div>
                        </div>
                        <div class="profile-info">
                            <span id="homeUserName" class="profile-name"></span>
                            <span id="homeUserEmail" class="profile-email"></span>
                        </div>
                        <button id="homeLogoutBtn" class="btn-logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>

                <!-- Mobile Menu Toggle -->
                <button class="mobile-toggle" id="mobileToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </nav>

        <!-- Mobile Menu -->
        <div class="mobile-menu-overlay" id="mobileMenu">
            <div class="mobile-menu-container">
                <div class="mobile-menu-header">
                    <div class="logo-icon legal-seal">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <button class="mobile-close" id="mobileClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mobile-menu-links">
                    <a href="#home" class="mobile-link active">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="#features" class="mobile-link">
                        <i class="fas fa-star"></i>
                        <span>Features</span>
                    </a>
                    <a href="#documents" class="mobile-link">
                        <i class="fas fa-file-contract"></i>
                        <span>Documents</span>
                    </a>
                    <a href="#legalDatabase" class="mobile-link">
                        <i class="fas fa-database"></i>
                        <span>Legal Database</span>
                    </a>
                    <a href="#lawyerDirectory" class="mobile-link">
                        <i class="fas fa-user-tie"></i>
                        <span>Find Lawyers</span>
                    </a>
                    <a href="#legalGuides" class="mobile-link">
                        <i class="fas fa-book"></i>
                        <span>Legal Guides</span>
                    </a>
                    <a href="#pricing" class="mobile-link">
                        <i class="fas fa-tag"></i>
                        <span>Pricing</span>
                    </a>
                    <a href="#chat" class="mobile-link" id="mobileStartChat">
                        <i class="fas fa-comments"></i>
                        <span>Start Chat</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Hero Section -->
        <section id="home" class="hero-section">
            <div class="hero-container container">
                <!-- Animated Background Elements -->
                <div class="hero-bg-elements">
                    <div class="floating-element floating-icon-1">
                        <i class="fas fa-balance-scale floating"></i>
                    </div>
                    <div class="floating-element floating-icon-2">
                        <i class="fas fa-gavel floating"></i>
                    </div>
                    <div class="floating-element floating-icon-3">
                        <i class="fas fa-scale-balanced floating"></i>
                    </div>
                </div>
                
                <div class="hero-content">
                    <div class="hero-badge">
                        <span class="badge-text">
                            <i class="fas fa-bolt"></i>
                            AI-POWERED LEGAL ASSISTANT
                        </span>
                    </div>
                    
                    <h1 class="hero-title text-reveal">
                        Get <span class="shimmer-text">Instant Legal Help</span><br>
                        From Your AI Assistant
                    </h1>
                    
                    <p class="hero-subtitle">
                        LegalSwami provides 24/7 AI-powered legal guidance, document generation, 
                        and legal research assistance. Get instant answers to your legal questions 
                        in simple, understandable language.
                    </p>
                    
                    <div class="hero-stats">
                        <div class="stat-item">
                            <div class="stat-number shimmer-text">10,000+</div>
                            <div class="stat-label">Legal Documents Generated</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number shimmer-text">50,000+</div>
                            <div class="stat-label">Legal Questions Answered</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number shimmer-text">99.8%</div>
                            <div class="stat-label">User Satisfaction Rate</div>
                        </div>
                    </div>
                    
                    <div class="hero-actions">
                        <!-- Fixed: Safe onclick handler -->
                        <button id="startChatBtn" class="btn-hero-primary btn-premium">
                            <i class="fas fa-comments"></i>
                            <span>Start Free Chat Now</span>
                            <div class="btn-sparkle">
                                <i class="fas fa-sparkle"></i>
                            </div>
                        </button>
                        
                        <button id="watchDemo" class="btn-hero-secondary">
                            <i class="fas fa-play-circle"></i>
                            <span>Watch Demo Video</span>
                        </button>
                    </div>
                    
                    <div class="hero-trust">
                        <div class="trust-label">Trusted by</div>
                        <div class="trust-badges">
                            <div class="trust-badge">
                                <i class="fas fa-university"></i>
                                <span>Law Firms</span>
                            </div>
                            <div class="trust-badge">
                                <i class="fas fa-graduation-cap"></i>
                                <span>Law Students</span>
                            </div>
                            <div class="trust-badge">
                                <i class="fas fa-briefcase"></i>
                                <span>Businesses</span>
                            </div>
                            <div class="trust-badge">
                                <i class="fas fa-users"></i>
                                <span>Individuals</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="hero-illustration">
                    <div class="ai-assistant-card premium-card pulse-glow">
                        <div class="assistant-avatar legal-seal">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h3 class="assistant-title">AI Legal Assistant</h3>
                        <p class="assistant-subtitle">Available 24/7</p>
                        
                        <div class="assistant-features">
                            <div class="feature">
                                <i class="fas fa-check-circle"></i>
                                <span>Instant Responses</span>
                            </div>
                            <div class="feature">
                                <i class="fas fa-check-circle"></i>
                                <span>Multi-Language</span>
                            </div>
                            <div class="feature">
                                <i class="fas fa-check-circle"></i>
                                <span>Document Generation</span>
                            </div>
                        </div>
                        
                        <button class="btn-assistant">
                            <i class="fas fa-comment-alt"></i>
                            Ask Legal Question
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Scroll Indicator -->
            <div class="scroll-indicator">
                <div class="mouse">
                    <div class="wheel"></div>
                </div>
                <div class="arrow">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="features-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="shimmer-text">Powerful Features</span> for All Your Legal Needs
                    </h2>
                    <p class="section-subtitle">
                        Everything you need in one comprehensive legal assistant
                    </p>
                </div>
                
                <div class="features-grid">
                    <!-- Feature 1 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-comments"></i>
                        </div>
                        <h3 class="feature-title">AI Chat Assistant</h3>
                        <p class="feature-description">
                            Ask legal questions in natural language and get instant, accurate responses powered by advanced AI.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">24/7 Available</span>
                            <span class="tag">Multi-Language</span>
                        </div>
                    </div>
                    
                    <!-- Feature 2 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <h3 class="feature-title">Smart Document Generation</h3>
                        <p class="feature-description">
                            Generate legal documents instantly in PDF, DOC, and TXT formats with customizable templates.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">100+ Templates</span>
                            <span class="tag">Customizable</span>
                        </div>
                    </div>
                    
                    <!-- Feature 3 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3 class="feature-title">Bank-Level Security</h3>
                        <p class="feature-description">
                            End-to-end encryption and secure authentication to protect your sensitive legal data.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">AES-256</span>
                            <span class="tag">GDPR Compliant</span>
                        </div>
                    </div>
                    
                    <!-- Feature 4 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-history"></i>
                        </div>
                        <h3 class="feature-title">Complete Chat History</h3>
                        <p class="feature-description">
                            Access your complete chat history anytime. Export conversations as documents for record keeping.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">Unlimited History</span>
                            <span class="tag">Export Options</span>
                        </div>
                    </div>
                    
                    <!-- Feature 5 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3 class="feature-title">Mobile Responsive</h3>
                        <p class="feature-description">
                            Access LegalSwami from any device - desktop, tablet, or mobile phone with native-like experience.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">PWA Support</span>
                            <span class="tag">Offline Mode</span>
                        </div>
                    </div>
                    
                    <!-- Feature 6 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-language"></i>
                        </div>
                        <h3 class="feature-title">Multi-Language Support</h3>
                        <p class="feature-description">
                            Get legal advice in multiple languages including Hindi, English, Marathi, Gujarati, and more.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">10+ Languages</span>
                            <span class="tag">Real-time Translation</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Legal Database Section -->
        <section id="legalDatabase" class="database-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="shimmer-text">Legal Database</span> & Research Tools
                    </h2>
                    <p class="section-subtitle">
                        Access comprehensive legal resources and research materials
                    </p>
                </div>
                
                <div class="database-grid">
                    <!-- Legal Acts Database -->
                    <div class="database-card premium-card">
                        <div class="database-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <h3 class="database-title">Acts & Statutes</h3>
                        <ul class="database-list">
                            <li><i class="fas fa-search"></i> IPC (Indian Penal Code)</li>
                            <li><i class="fas fa-search"></i> CrPC (Criminal Procedure Code)</li>
                            <li><i class="fas fa-search"></i> CPC (Civil Procedure Code)</li>
                            <li><i class="fas fa-search"></i> Constitution of India</li>
                            <li><i class="fas fa-search"></i> Consumer Protection Act</li>
                        </ul>
                        <button class="btn-database">
                            <i class="fas fa-search"></i>
                            Search Acts
                        </button>
                    </div>
                    
                    <!-- Case Laws Database -->
                    <div class="database-card premium-card">
                        <div class="database-icon">
                            <i class="fas fa-gavel"></i>
                        </div>
                        <h3 class="database-title">Case Laws Database</h3>
                        <ul class="database-list">
                            <li><i class="fas fa-balance-scale"></i> Supreme Court Judgments</li>
                            <li><i class="fas fa-balance-scale"></i> High Court Judgments</li>
                            <li><i class="fas fa-balance-scale"></i> Landmark Cases</li>
                            <li><i class="fas fa-balance-scale"></i> Recent Judgments</li>
                            <li><i class="fas fa-balance-scale"></i> Case Citations</li>
                        </ul>
                        <button class="btn-database">
                            <i class="fas fa-gavel"></i>
                            Search Case Laws
                        </button>
                    </div>
                    
                    <!-- Legal Calculator -->
                    <div class="database-card premium-card">
                        <div class="database-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <h3 class="database-title">Legal Calculators</h3>
                        <ul class="database-list">
                            <li><i class="fas fa-calculator"></i> Court Fee Calculator</li>
                            <li><i class="fas fa-calculator"></i> Stamp Duty Calculator</li>
                            <li><i class="fas fa-calculator"></i> Compensation Calculator</li>
                            <li><i class="fas fa-calculator"></i> Interest Calculator</li>
                            <li><i class="fas fa-calculator"></i> Tax Calculator</li>
                        </ul>
                        <button class="btn-database">
                            <i class="fas fa-calculator"></i>
                            Open Calculator
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Document Types Section -->
        <section id="documents" class="documents-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Generate <span class="shimmer-text">Legal Documents</span> Instantly
                    </h2>
                    <p class="section-subtitle">
                        Professional legal documents at your fingertips
                    </p>
                </div>
                
                <div class="documents-grid">
                    <!-- Document Category 1 -->
                    <div class="document-category premium-card">
                        <div class="category-icon">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <h3 class="category-title">Agreements & Contracts</h3>
                        <ul class="document-list">
                            <li><i class="fas fa-check-circle"></i> Rental Agreement</li>
                            <li><i class="fas fa-check-circle"></i> Non-Disclosure Agreement</li>
                            <li><i class="fas fa-check-circle"></i> Employment Contract</li>
                            <li><i class="fas fa-check-circle"></i> Service Agreement</li>
                            <li><i class="fas fa-check-circle"></i> Partnership Agreement</li>
                        </ul>
                        <button class="btn-generate">
                            <i class="fas fa-magic"></i>
                            Generate Now
                        </button>
                    </div>
                    
                    <!-- Document Category 2 -->
                    <div class="document-category premium-card">
                        <div class="category-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <h3 class="category-title">Legal Notices & Letters</h3>
                        <ul class="document-list">
                            <li><i class="fas fa-check-circle"></i> Legal Notice</li>
                            <li><i class="fas fa-check-circle"></i> Cease & Desist Notice</li>
                            <li><i class="fas fa-check-circle"></i> Demand Letter</li>
                            <li><i class="fas fa-check-circle"></i> Notice to Quit</li>
                            <li><i class="fas fa-check-circle"></i> Consumer Complaint</li>
                        </ul>
                        <button class="btn-generate">
                            <i class="fas fa-magic"></i>
                            Generate Now
                        </button>
                    </div>
                    
                    <!-- Document Category 3 -->
                    <div class="document-category premium-card">
                        <div class="category-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <h3 class="category-title">Personal & Family</h3>
                        <ul class="document-list">
                            <li><i class="fas fa-check-circle"></i> Will & Testament</li>
                            <li><i class="fas fa-check-circle"></i> Power of Attorney</li>
                            <li><i class="fas fa-check-circle"></i> Affidavit</li>
                            <li><i class="fas fa-check-circle"></i> Gift Deed</li>
                            <li><i class="fas fa-check-circle"></i> Divorce Papers</li>
                        </ul>
                        <button class="btn-generate">
                            <i class="fas fa-magic"></i>
                            Generate Now
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lawyer Directory Section -->
        <section id="lawyerDirectory" class="lawyer-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Find <span class="shimmer-text">Qualified Lawyers</span>
                    </h2>
                    <p class="section-subtitle">
                        Connect with experienced legal professionals
                    </p>
                </div>
                
                <div class="lawyer-search">
                    <div class="search-container">
                        <i class="fas fa-search"></i>
                        <input type="text" id="lawyerSearch" placeholder="Search by specialization, location, or name...">
                        <button class="btn-search">
                            <i class="fas fa-search"></i>
                            Search
                        </button>
                    </div>
                    
                    <div class="specialization-filters">
                        <button class="filter-btn active" data-specialization="all">All</button>
                        <button class="filter-btn" data-specialization="criminal">Criminal</button>
                        <button class="filter-btn" data-specialization="civil">Civil</button>
                        <button class="filter-btn" data-specialization="corporate">Corporate</button>
                        <button class="filter-btn" data-specialization="family">Family</button>
                        <button class="filter-btn" data-specialization="property">Property</button>
                    </div>
                </div>
                
                <div class="lawyers-grid" id="lawyersGrid">
                    <!-- Lawyers will be dynamically loaded here -->
                    <div class="lawyer-card premium-card">
                        <div class="lawyer-avatar">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <h3 class="lawyer-name">Adv. Rajesh Kumar</h3>
                        <p class="lawyer-specialization">Criminal Law Expert</p>
                        <p class="lawyer-experience">15+ Years Experience</p>
                        <button class="btn-consult">
                            <i class="fas fa-comments"></i> Consult Now
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Legal Procedure Guides Section -->
        <section id="legalGuides" class="guides-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="shimmer-text">Step-by-Step</span> Legal Guides
                    </h2>
                    <p class="section-subtitle">
                        Understand legal procedures with easy-to-follow guides
                    </p>
                </div>
                
                <div class="guides-grid">
                    <div class="guide-card premium-card">
                        <div class="guide-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <h3 class="guide-title">How to File a Case</h3>
                        <p class="guide-description">
                            Complete step-by-step guide for filing different types of cases in Indian courts.
                        </p>
                        <div class="guide-steps">
                            <span class="step">1. Document Preparation</span>
                            <span class="step">2. Court Selection</span>
                            <span class="step">3. Fee Payment</span>
                            <span class="step">4. Case Number</span>
                        </div>
                        <button class="btn-guide">
                            <i class="fas fa-book-open"></i>
                            View Guide
                        </button>
                    </div>
                    
                    <div class="guide-card premium-card">
                        <div class="guide-icon">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <h3 class="guide-title">Document Registration Process</h3>
                        <p class="guide-description">
                            Learn how to register legal documents with proper procedures and fees.
                        </p>
                        <div class="guide-steps">
                            <span class="step">1. Stamp Duty</span>
                            <span class="step">2. Witness Arrangement</span>
                            <span class="step">3. Registration Office</span>
                            <span class="step">4. Final Registration</span>
                        </div>
                        <button class="btn-guide">
                            <i class="fas fa-book-open"></i>
                            View Guide
                        </button>
                    </div>
                    
                    <div class="guide-card premium-card">
                        <div class="guide-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <h3 class="guide-title">Consumer Complaint Process</h3>
                        <p class="guide-description">
                            Guide to filing consumer complaints with proper documentation and procedures.
                        </p>
                        <div class="guide-steps">
                            <span class="step">1. Complaint Drafting</span>
                            <span class="step">2. Evidence Collection</span>
                            <span class="step">3. Forum Selection</span>
                            <span class="step">4. Hearing Process</span>
                        </div>
                        <button class="btn-guide">
                            <i class="fas fa-book-open"></i>
                            View Guide
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section id="testimonials" class="testimonials-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Trusted by <span class="shimmer-text">Thousands</span> of Users
                    </h2>
                    <p class="section-subtitle">
                        See what our users have to say about LegalSwami
                    </p>
                </div>
                
                <div class="testimonials-carousel">
                    <!-- Testimonial 1 -->
                    <div class="testimonial-card premium-card">
                        <div class="testimonial-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p class="testimonial-text">
                            "LegalSwami helped me draft a professional rental agreement in minutes. The AI understood exactly what I needed and generated a perfect document. Saved me ₹5000 in lawyer fees!"
                        </p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Rahul Sharma">
                            </div>
                            <div class="author-info">
                                <h4 class="author-name">Rahul Sharma</h4>
                                <p class="author-title">Small Business Owner</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Testimonial 2 -->
                    <div class="testimonial-card premium-card">
                        <div class="testimonial-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                        </div>
                        <p class="testimonial-text">
                            "As a law student, LegalSwami is a game-changer! It helps me understand complex legal concepts and provides excellent research assistance. Like having a personal tutor 24/7."
                        </p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Priya Patel">
                            </div>
                            <div class="author-info">
                                <h4 class="author-name">Priya Patel</h4>
                                <p class="author-title">Law Student, NLU Delhi</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Testimonial 3 -->
                    <div class="testimonial-card premium-card">
                        <div class="testimonial-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p class="testimonial-text">
                            "The document generation feature saved our startup thousands! We needed multiple NDAs and service agreements. LegalSwami generated perfect documents in minutes. Incredible tool!"
                        </p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <img src="https://randomuser.me/api/portraits/men/67.jpg" alt="Ankit Verma">
                            </div>
                            <div class="author-info">
                                <h4 class="author-name">Ankit Verma</h4>
                                <p class="author-title">Tech Entrepreneur</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pricing Section -->
        <section id="pricing" class="pricing-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Simple, <span class="shimmer-text">Transparent</span> Pricing
                    </h2>
                    <p class="section-subtitle">
                        Choose the perfect plan for your legal needs
                    </p>
                </div>
                
                <div class="pricing-cards">
                    <!-- Free Plan -->
                    <div class="pricing-card premium-card">
                        <div class="pricing-badge">FREE</div>
                        <h3 class="pricing-title">Basic</h3>
                        <div class="pricing-price">
                            <span class="currency">₹</span>
                            <span class="amount">0</span>
                            <span class="period">/month</span>
                        </div>
                        <p class="pricing-description">Perfect for trying out LegalSwami</p>
                        
                        <ul class="pricing-features">
                            <li><i class="fas fa-check-circle"></i> 10 AI Chat Messages/Day</li>
                            <li><i class="fas fa-check-circle"></i> 3 Document Generations/Month</li>
                            <li><i class="fas fa-check-circle"></i> Basic Legal Questions</li>
                            <li><i class="fas fa-times-circle"></i> No Priority Support</li>
                            <li><i class="fas fa-times-circle"></i> No Document History</li>
                        </ul>
                        
                        <button class="btn-pricing">
                            Get Started Free
                        </button>
                    </div>
                    
                    <!-- Pro Plan -->
                    <div class="pricing-card premium-card premium-plan">
                        <div class="pricing-badge popular">POPULAR</div>
                        <h3 class="pricing-title">Professional</h3>
                        <div class="pricing-price">
                            <span class="currency">₹</span>
                            <span class="amount">499</span>
                            <span class="period">/month</span>
                        </div>
                        <p class="pricing-description">Perfect for professionals & businesses</p>
                        
                        <ul class="pricing-features">
                            <li><i class="fas fa-check-circle"></i> Unlimited AI Chat Messages</li>
                            <li><i class="fas fa-check-circle"></i> 50 Document Generations/Month</li>
                            <li><i class="fas fa-check-circle"></i> All Document Templates</li>
                            <li><i class="fas fa-check-circle"></i> Priority Support</li>
                            <li><i class="fas fa-check-circle"></i> Complete Chat History</li>
                        </ul>
                        
                        <button class="btn-pricing btn-premium">
                            <i class="fas fa-crown"></i>
                            Get Professional
                        </button>
                    </div>
                    
                    <!-- Business Plan -->
                    <div class="pricing-card premium-card">
                        <div class="pricing-badge">BUSINESS</div>
                        <h3 class="pricing-title">Enterprise</h3>
                        <div class="pricing-price">
                            <span class="currency">₹</span>
                            <span class="amount">1,499</span>
                            <span class="period">/month</span>
                        </div>
                        <p class="pricing-description">For law firms & large organizations</p>
                        
                        <ul class="pricing-features">
                            <li><i class="fas fa-check-circle"></i> Everything in Professional</li>
                            <li><i class="fas fa-check-circle"></i> Unlimited Document Generation</li>
                            <li><i class="fas fa-check-circle"></i> Team Collaboration</li>
                            <li><i class="fas fa-check-circle"></i> Custom Templates</li>
                            <li><i class="fas fa-check-circle"></i> Dedicated Account Manager</li>
                        </ul>
                        
                        <button class="btn-pricing">
                            Contact Sales
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="cta-section">
            <div class="container">
                <div class="cta-content">
                    <h2 class="cta-title">
                        Ready to Experience <br>
                        AI-Powered Legal Assistance?
                    </h2>
                    <p class="cta-description">
                        Join thousands of satisfied users who trust LegalSwami for their legal needs. 
                        No credit card required to get started.
                    </p>
                    
                    <div class="cta-actions">
                        <button id="ctaStartChat" class="btn-cta-primary btn-premium">
                            <i class="fas fa-rocket"></i>
                            Start Free Chat Now
                        </button>
                        
                        <button id="ctaScheduleDemo" class="btn-cta-secondary">
                            <i class="fas fa-calendar"></i>
                            Schedule Demo
                        </button>
                    </div>
                    
                    <div class="cta-guarantee">
                        <div class="guarantee-item">
                            <i class="fas fa-shield-alt"></i>
                            <span>100% Secure & Private</span>
                        </div>
                        <div class="guarantee-item">
                            <i class="fas fa-clock"></i>
                            <span>Available 24/7</span>
                        </div>
                        <div class="guarantee-item">
                            <i class="fas fa-headset"></i>
                            <span>Priority Support</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CHATGPT-LIKE CHAT INTERFACE -->
        <div id="chatInterface" class="chat-interface">
            <div class="container">
                <div class="chat-container">
                    <header>
                        <div class="logo">
                            <button class="sidebar-toggle" id="sidebarToggle">
                                <i class="fas fa-bars"></i>
                            </button>
                            <div class="logo-icon">
                                <i class="fas fa-scale-balanced"></i>
                            </div>
                            <h1>LegalSwami</h1>
                        </div>
                        
                        <div class="header-actions">
                            <button id="backToHomeBtn" class="header-btn">
                                <i class="fas fa-home"></i>
                                <span class="hide-on-mobile">Back to Home</span>
                            </button>
                            
                            <div class="status-indicator">
                                <div class="status-dot"></div>
                                <span class="hide-on-mobile">AI Assistant Ready</span>
                            </div>
                            
                            <!-- Search Counter Display -->
                            <div class="search-counter" id="searchCounter">
                                <i class="fas fa-search"></i>
                                <span class="hide-on-mobile">Free searches: 500/500</span>
                            </div>
                            
                            <!-- Login Button -->
                            <button class="login-btn" id="chatHeaderLoginBtn">
                                <i class="fas fa-sign-in-alt"></i>
                                <span class="hide-on-mobile">Login</span>
                            </button>
                            
                            <button class="header-btn voice-search-btn" id="voiceSearchBtn" title="Voice Search">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button class="header-btn theme-toggle" id="themeToggle" title="Toggle Theme">
                                <i class="fas fa-sun"></i>
                            </button>
                            <button class="header-btn" id="clearChatBtn">
                                <i class="fas fa-broom"></i>
                                <span class="hide-on-mobile">Clear Chat</span>
                            </button>
                            <button class="header-btn" id="downloadCurrentBtn">
                                <i class="fas fa-download"></i>
                                <span class="hide-on-mobile">Download Chat</span>
                            </button>
                            <button class="header-btn" id="suggestionsBtn">
                                <i class="fas fa-lightbulb"></i>
                                <span class="hide-on-mobile">Suggestions</span>
                            </button>
                            
                            <!-- User Profile (Hidden by default) -->
                            <div class="user-profile" id="chatUserProfile" style="display: none;">
                                <div class="user-avatar" id="chatUserAvatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="user-info">
                                    <div class="user-name" id="chatUserName">Guest User</div>
                                    <div class="user-email" id="chatUserEmail">Local Browser Mode</div>
                                </div>
                                <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                            </div>
                        </div>
                    </header>
                    
                    <!-- User Dropdown Menu -->
                    <div class="user-dropdown" id="chatUserDropdown">
                        <div class="dropdown-header">
                            <div class="user-avatar" id="chatDropdownAvatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="user-info">
                                <div class="user-name" id="chatDropdownName">Guest User</div>
                                <div class="user-email" id="chatDropdownEmail">Local Browser Mode</div>
                            </div>
                        </div>
                        
                        <div class="dropdown-items">
                            <button class="dropdown-item" id="chatProfileBtn">
                                <i class="fas fa-user-circle"></i>
                                <span>My Profile</span>
                            </button>
                            <button class="dropdown-item" id="chatSettingsBtn">
                                <i class="fas fa-cog"></i>
                                <span>Settings</span>
                            </button>
                            <button class="dropdown-item" id="chatHistoryBtn">
                                <i class="fas fa-history"></i>
                                <span>Chat History</span>
                            </button>
                            <button class="dropdown-item" id="chatHelpBtn">
                                <i class="fas fa-question-circle"></i>
                                <span>Help & Support</span>
                            </button>
                            <div class="dropdown-footer">
                                <button class="dropdown-item logout" id="chatLogoutBtn">
                                    <i class="fas fa-sign-out-alt"></i>
                                    <span>Clear Local Data</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="main-content">
                        <!-- Down Arrow Button (Scroll to Bottom) -->
                        <button class="scroll-to-bottom-btn" id="scrollToBottomBtn" title="Scroll to bottom">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        
                        <div class="sidebar-overlay" id="sidebarOverlay"></div>
                        
                        <aside class="sidebar" id="sidebar">
                            <!-- Sidebar Close Button -->
                            <button class="sidebar-close" id="sidebarClose">
                                <i class="fas fa-times"></i>
                            </button>
                            
                            <!-- Sidebar Tabs -->
                            <div class="sidebar-tabs">
                                <button class="sidebar-tab active" data-tab="legal-topics">
                                    <i class="fas fa-book"></i>
                                    <span class="hide-on-mobile">Legal Topics</span>
                                </button>
                                <button class="sidebar-tab" data-tab="chat-history">
                                    <i class="fas fa-history"></i>
                                    <span class="hide-on-mobile">Chat History</span>
                                </button>
                            </div>
                            
                            <!-- Legal Topics Tab Content -->
                            <div class="tab-content active" id="legal-topics-content">
                                <div class="sidebar-header">
                                    <h2><i class="fas fa-book"></i> Legal Topics</h2>
                                </div>
                                
                                <div class="sidebar-section">
                                    <h3><i class="fas fa-gavel"></i> Common Legal Areas</h3>
                                    <div class="topic-list">
                                        <button class="topic-item" data-topic="contract">
                                            <i class="fas fa-file-contract"></i>
                                            <span>Contract Law</span>
                                        </button>
                                        <button class="topic-item" data-topic="employment">
                                            <i class="fas fa-briefcase"></i>
                                            <span>Employment Law</span>
                                        </button>
                                        <button class="topic-item" data-topic="intellectual">
                                            <i class="fas fa-lightbulb"></i>
                                            <span>Intellectual Property</span>
                                        </button>
                                        <button class="topic-item" data-topic="realestate">
                                            <i class="fas fa-house"></i>
                                            <span>Real Estate Law</span>
                                        </button>
                                        <button class="topic-item" data-topic="family">
                                            <i class="fas fa-heart"></i>
                                            <span>Family Law</span>
                                        </button>
                                        <button class="topic-item" data-topic="criminal">
                                            <i class="fas fa-gavel"></i>
                                            <span>Criminal Law</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Active Topics Tabs Section -->
                                <div class="sidebar-section" id="activeTopicsSection" style="display: none;">
                                    <h3><i class="fas fa-folder-open"></i> Active Topics</h3>
                                    <div class="topic-list" id="activeTopicsList">
                                        <!-- Active topics will be added here dynamically -->
                                    </div>
                                </div>
                                
                                <div class="sidebar-section">
                                    <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                                    <div class="quick-actions">
                                        <button class="action-item" data-action="document-drafts">
                                            <i class="fas fa-file-alt"></i>
                                            <span>Document Drafts</span>
                                        </button>
                                        <button class="action-item" data-action="legal-research">
                                            <i class="fas fa-search"></i>
                                            <span>Legal Research</span>
                                        </button>
                                        <button class="action-item" data-action="case-analysis">
                                            <i class="fas fa-chart-bar"></i>
                                            <span>Case Analysis</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Chat History Tab Content -->
                            <div class="tab-content" id="chat-history-content">
                                <div class="history-header">
                                    <h2><i class="fas fa-history"></i> Chat History</h2>
                                    <button class="new-chat-btn" id="newChatBtn">
                                        <i class="fas fa-plus"></i>
                                        <span class="hide-on-mobile">New Chat</span>
                                    </button>
                                </div>
                                
                                <div class="history-list" id="historyList">
                                    <!-- History items will be loaded here -->
                                    <div class="empty-history">
                                        <i class="fas fa-comments"></i>
                                        <p>No chat history yet</p>
                                        <p style="font-size: 0.8125rem; margin-top: 0.5rem;">Start a conversation to see it here</p>
                                    </div>
                                </div>
                            </div>
                        </aside>
                        
                       <main id="chatContent">
                            <div class="chat-messages" id="chatMessages">
                                <!-- Welcome Message will be added dynamically -->
                            </div>
                            
                            <!-- Scroll Position Indicator -->
                            <div class="scroll-position-indicator" id="scrollPositionIndicator">
                                Scroll to see more messages
                            </div>
                            
                            <div class="input-container">
                                <div class="input-area">
                                    <!-- Attachments Preview -->
                                    <div class="attachments-preview" id="attachmentsPreview" style="display: none;"></div>
                                    
                                    <div class="voice-input-status" id="voiceInputStatus">
                                        <div class="voice-animation">
                                            <div class="voice-bar"></div>
                                            <div class="voice-bar"></div>
                                            <div class="voice-bar"></div>
                                            <div class="voice-bar"></div>
                                            <div class="voice-bar"></div>
                                        </div>
                                        <span>Listening... Speak now</span>
                                    </div>
                                    
                                    <textarea 
                                        id="userInput" 
                                        placeholder="Ask any legal question or attach files (images, PDF, TXT)... (Press Enter for new line, Ctrl+Enter to send)"
                                        rows="1"
                                    ></textarea>
                                    
                                    <div class="voice-input-text" id="voiceInputText"></div>
                                    
                                    <div class="input-buttons">
                                        <!-- Emoji Picker Button -->
                                        <button class="emoji-picker-btn" id="emojiPickerBtn" title="Insert emoji">
                                            <i class="far fa-smile"></i>
                                        </button>
                                        
                                        <!-- Attachment Button -->
                                        <button class="attachment-btn" id="attachmentBtn" title="Attach files (images, PDF, TXT)">
                                            <i class="fas fa-paperclip"></i>
                                        </button>
                                        
                                        <!-- Voice Input Button -->
                                        <button class="input-microphone-btn" id="inputMicrophoneBtn" title="Voice input">
                                            <i class="fas fa-microphone"></i>
                                        </button>
                                        
                                        <!-- Send/Stop Button -->
                                        <button class="send-button" id="sendButton">
                                            <i class="fas fa-paper-plane"></i> <span class="hide-on-mobile">Send</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </main>
                    </div>
                    
                    <!-- Download Modal (for full chat) -->
                    <div class="modal-overlay" id="downloadModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h2><i class="fas fa-download"></i> Download Chat</h2>
                                <button class="modal-close" id="closeDownloadModal">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-content">
                                <p>Select the format you want to download your chat in:</p>
                                
                                <div class="download-options">
                                    <div class="download-option" data-format="doc">
                                        <i class="fas fa-file-word"></i>
                                        <h3>Word Document</h3>
                                        <p>.doc format</p>
                                    </div>
                                    <div class="download-option" data-format="pdf">
                                        <i class="fas fa-file-pdf"></i>
                                        <h3>PDF Document</h3>
                                        <p>.pdf format</p>
                                    </div>
                                    <div class="download-option" data-format="txt">
                                        <i class="fas fa-file-alt"></i>
                                        <h3>Text File</h3>
                                        <p>.txt format</p>
                                    </div>
                                </div>
                                
                                <div class="progress-indicator" id="progressIndicator">
                                    <div class="progress-spinner"></div>
                                    <p>Preparing your document...</p>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <p>The document will include the complete chat conversation with timestamps.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Delete Confirmation Modal -->
                    <div class="modal-overlay" id="deleteModal">
                        <div class="modal confirmation-modal">
                            <div class="modal-header">
                                <h2><i class="fas fa-trash"></i> Delete Chat</h2>
                                <button class="modal-close" id="closeDeleteModal">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-content">
                                <div class="confirmation-text">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <h3>Are you sure you want to delete this chat?</h3>
                                    <p id="deleteChatTitle">This action cannot be undone and the chat will be permanently deleted.</p>
                                </div>
                                
                                <div class="confirmation-buttons">
                                    <button class="confirmation-btn cancel" id="cancelDelete">Cancel</button>
                                    <button class="confirmation-btn delete" id="confirmDelete">Delete Permanently</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Individual Message Download Modal -->
                    <div class="modal-overlay" id="messageDownloadModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h2><i class="fas fa-file-download"></i> Download Document</h2>
                                <button class="modal-close" id="closeMessageDownloadModal">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-content">
                                <p>Select the format for this specific response:</p>
                                
                                <div class="download-options">
                                    <div class="download-option" data-format="doc">
                                        <i class="fas fa-file-word"></i>
                                        <h3>Word Document</h3>
                                        <p>.doc format</p>
                                    </div>
                                    <div class="download-option" data-format="pdf">
                                        <i class="fas fa-file-pdf"></i>
                                        <h3>PDF Document</h3>
                                        <p>.pdf format</p>
                                    </div>
                                    <div class="download-option" data-format="txt">
                                        <i class="fas fa-file-alt"></i>
                                        <h3>Text File</h3>
                                        <p>.txt format</p>
                                    </div>
                                </div>
                                
                                <div class="progress-indicator" id="messageProgressIndicator">
                                    <div class="progress-spinner"></div>
                                    <p>Preparing your document...</p>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <p>The document will include only this specific AI response.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- File Upload Modal -->
                    <div class="modal-overlay image-upload-modal" id="fileUploadModal">
                        <div class="image-upload-content">
                            <div class="modal-header">
                                <h2><i class="fas fa-paperclip"></i> Attach Files</h2>
                                <button class="modal-close" id="closeFileUploadModal">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-content">
                                <div class="upload-area" id="uploadArea">
                                    <div class="upload-icon">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                    </div>
                                    <div class="upload-text">
                                        <h3>Drag & Drop Files Here</h3>
                                        <p>or click to browse files</p>
                                        <p style="font-size: 0.8125rem; color: var(--dark-text-secondary);">
                                            Supported formats: Images (JPG, PNG, GIF), PDF, TXT, DOC
                                        </p>
                                        <button class="upload-btn" id="browseFilesBtn">
                                            <i class="fas fa-folder-open"></i> Browse Files
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="uploaded-images" id="uploadedFiles">
                                    <!-- Uploaded files will appear here -->
                                </div>
                                
                                <div class="confirmation-buttons" style="margin-top: 1.25rem;">
                                    <button class="confirmation-btn cancel" id="cancelFileUpload">
                                        Cancel
                                    </button>
                                    <button class="confirmation-btn" id="confirmFileUpload" style="background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white;">
                                        <i class="fas fa-paperclip"></i> Attach Selected Files
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Download Notification -->
                    <div class="download-notification" id="downloadNotification">
                        <i class="fas fa-file-download"></i>
                        <div class="download-notification-content">
                            <div class="download-notification-title" id="downloadNotificationTitle">Document Downloaded</div>
                            <div class="download-notification-message" id="downloadNotificationMessage">Click to open the file</div>
                        </div>
                        <button class="download-notification-close" id="closeDownloadNotification">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="toast" id="toast">
                        <i class="fas fa-check-circle"></i>
                        <span id="toast-message">Message sent successfully</span>
                    </div>
                </div>
            </div>
        </div>
		
		<!-- Legal Tools Modal -->
        <div id="legalToolsModal" class="modal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button id="closeLegalTools" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
                
                <div class="modal-header">
                    <div class="modal-icon legal-seal">
                        <i class="fas fa-tools"></i>
                    </div>
                    <h3>Legal Tools & Calculators</h3>
                    <p>Access various legal utilities</p>
                </div>
                
                <div class="modal-body">
                    <div class="tools-grid">
                        <button class="tool-card">
                            <i class="fas fa-calculator"></i>
                            <h4>Court Fee Calculator</h4>
                            <p>Calculate court fees for different cases</p>
                        </button>
                        
                        <button class="tool-card">
                            <i class="fas fa-file-invoice-dollar"></i>
                            <h4>Stamp Duty Calculator</h4>
                            <p>Calculate stamp duty for documents</p>
                        </button>
                        
                        <button class="tool-card">
                            <i class="fas fa-money-check-alt"></i>
                            <h4>Compensation Calculator</h4>
                            <p>Calculate compensation amounts</p>
                        </button>
                        
                        <button class="tool-card">
                            <i class="fas fa-search"></i>
                            <h4>Act & Statute Search</h4>
                            <p>Search legal acts and statutes</p>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modern Login Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button id="closeLoginModal" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
                
                <div class="modal-header">
                    <div class="modal-icon legal-seal">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <h3>Welcome to LegalSwami</h3>
                    <p>Secure login to access all features</p>
                </div>
                
                <div class="modal-body">
                    <!-- Google Sign-In Container -->
                    <div id="googleSignInContainer"></div>
                    
                    <!-- Custom Google Button -->
                    <button id="customGoogleBtn" class="google-signin-btn">
                        <i class="fab fa-google"></i>
                        Continue with Google
                    </button>
                    
                    <div class="divider">
                        <span>or</span>
                    </div>
                    
                    <!-- Demo Login Button -->
                    <button id="demoLoginBtn" class="demo-login-btn">
                        <i class="fas fa-user"></i> Try Demo Version
                    </button>
                    
                    <div class="login-info">
                        <p><i class="fas fa-lock"></i> Your data is encrypted and secure</p>
                        <p><i class="fas fa-shield-alt"></i> We never share your personal information</p>
                        <p><i class="fas fa-bolt"></i> No credit card required</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="premium-footer">
            <div class="container">
                <div class="footer-content">
                    <!-- Company Info -->
                    <div class="footer-section">
                        <div class="footer-logo">
                            <div class="logo-icon legal-seal">
                                <i class="fas fa-gavel"></i>
                            </div>
                            <div class="logo-text">
                                <h3 class="logo-title shimmer-text">LegalSwami</h3>
                                <p class="logo-subtitle">AI Legal Assistant</p>
                            </div>
                        </div>
                        <p class="footer-description">
                            Making legal assistance accessible to everyone with AI-powered technology.
                        </p>
                        <div class="social-links">
                            <a href="#" class="social-link">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-linkedin"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-github"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-youtube"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Quick Links -->
                    <div class="footer-section">
                        <h4 class="footer-heading">Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="#home">Home</a></li>
                            <li><a href="#features">Features</a></li>
                            <li><a href="#documents">Documents</a></li>
                            <li><a href="#legalDatabase">Legal Database</a></li>
                            <li><a href="#lawyerDirectory">Find Lawyers</a></li>
                            <li><a href="#legalGuides">Legal Guides</a></li>
                            <li><a href="#testimonials">Testimonials</a></li>
                            <li><a href="#pricing">Pricing</a></li>
                        </ul>
                    </div>
                    
                    <!-- Legal -->
                    <div class="footer-section">
                        <h4 class="footer-heading">Legal</h4>
                        <ul class="footer-links">
                            <li><a href="#" id="termsLink">Terms of Service</a></li>
                            <li><a href="#" id="privacyLink">Privacy Policy</a></li>
                            <li><a href="#" id="disclaimerLink">Legal Disclaimer</a></li>
                            <li><a href="#" id="cookieLink">Cookie Policy</a></li>
                        </ul>
                    </div>
                    
                    <!-- Contact -->
                    <div class="footer-section">
                        <h4 class="footer-heading">Contact Us</h4>
                        <ul class="footer-contact">
                            <li>
                                <i class="fas fa-envelope"></i>
                                <a href="mailto:support@legalswami.com">support@legalswami.com</a>
                            </li>
                            <li>
                                <i class="fas fa-phone"></i>
                                <a href="tel:+919876543210">+91 9876543210</a>
                            </li>
                            <li>
                                <i class="fas fa-map-marker-alt"></i>
                                <span>Mumbai, India</span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p class="copyright">
                        &copy; 2024 LegalSwami. All rights reserved.
                    </p>
                    <div class="disclaimer">
                        <i class="fas fa-exclamation-triangle"></i>
                        LegalSwami provides AI-powered legal assistance. It is not a substitute for professional legal advice.
                    </div>
                </div>
            </div>
        </footer>

        <!-- Back to Top -->
        <button id="backToTop" class="back-to-top">
            <i class="fas fa-chevron-up"></i>
        </button>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
	
    <!-- Main App Script -->
<script>
// =============================================
// LEGALSWAMI - COMPLETE UPDATED SCRIPT
// =============================================

// Global variables
let chatHistory = [];
let currentChatId = null;
let conversationHistory = [];
let messageContentForDownload = "";
let isListening = false;
let recognition = null;
let isInputMicrophoneActive = false;
let isLightMode = false;
let currentStreamingMessageId = null;
let currentStreamingContent = '';
let currentStreamingBuffer = '';
let streamingTextChunks = [];
let streamingTextIndex = 0;
let streamingWordDelay = 20;
let streamingPunctuationDelay = 100;
let attachedFiles = [];
let selectedFiles = [];
let activeLegalTopics = [];
let isStreamingPaused = false;
let isStreamingActive = false;
let stopStreamingRequested = false;
let currentUser = null;
let isLoggedIn = false;
let userToken = null;
let searchCount = 0;
const MAX_FREE_SEARCHES = 500;
let scrollPosition = 0;
let lastDownloadedFileUrl = null;
let lastDownloadedFileName = '';
let isProcessing = false;
let isMobileMenuOpen = false;
let isChatOpen = false;
let isLoginModalOpen = false;
let selectedLanguage = 'en';
let chatInitialized = false;

// Check device type
const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
const isTablet = window.innerWidth <= 1024 && window.innerWidth > 480;

// Welcome message HTML
const WELCOME_MESSAGE_HTML = `
    <div class="welcome-message">
        <h2>Welcome to LegalSwami</h2>
        <p>Your AI-powered legal assistant for accurate, comprehensive legal information and guidance.</p>
        <p style="color: var(--primary); margin-top: 10px; font-size: 0.875rem;">
            <i class="fas fa-language"></i> Supports multiple Indian languages including Marathi, Hindi, and more!
        </p>
        <div style="margin-top: 1.5rem;">
            <h3 style="color: var(--primary); margin-bottom: 0.875rem; font-size: 1rem;">Ready-to-Use Legal Documents:</h3>
            <div class="draft-templates">
                <div class="draft-template" data-template="nda">
                    <i class="fas fa-file-signature"></i>
                    <h4>Non-Disclosure Agreement</h4>
                    <p>Confidentiality agreement template</p>
                </div>
                <div class="draft-template" data-template="employment">
                    <i class="fas fa-briefcase"></i>
                    <h4>Employment Contract</h4>
                    <p>Employee agreement template</p>
                </div>
                <div class="draft-template" data-template="rental">
                    <i class="fas fa-house"></i>
                    <h4>Rental Agreement</h4>
                    <p>Tenancy agreement template</p>
                </div>
                <div class="draft-template" data-template="loan">
                    <i class="fas fa-money-bill-wave"></i>
                    <h4>Loan Agreement</h4>
                    <p>Money lending agreement</p>
                </div>
            </div>
        </div>
        <div class="section-divider"></div>
        <div class="welcome-features">
            <div class="feature">
                <i class="fas fa-bolt"></i>
                <h4>Instant Responses</h4>
                <p>Get immediate legal insights powered by advanced AI</p>
            </div>
            <div class="feature">
                <i class="fas fa-shield-alt"></i>
                <h4>Confidential & Secure</h4>
                <p>Your conversations are private and encrypted</p>
            </div>
            <div class="feature">
                <i class="fas fa-language"></i>
                <h4>Multi-Language</h4>
                <p>Responds in same language as your query</p>
            </div>
            <div class="feature">
                <i class="fas fa-microphone"></i>
                <h4>Voice Search</h4>
                <p>Speak your queries in natural language</p>
            </div>
            <div class="feature">
                <i class="fas fa-file-upload"></i>
                <h4>File Analysis</h4>
                <p>Upload and analyze documents, images</p>
            </div>
        </div>
    </div>
`;

// =============================================
// SIMPLE CHAT OPEN/CLOSE FUNCTIONS
// =============================================

// REPLACE THIS FUNCTION - Line ~135 ke paas
function openChat() {
    console.log("🚀 Opening chat with EMERGENCY fix...");
    
    // Emergency fix: Direct DOM manipulation
    const mainContainer = document.querySelector('.main-container');
    const chatInterface = document.getElementById('chatInterface');
    
    if (mainContainer) {
        mainContainer.style.display = 'none';
        mainContainer.style.visibility = 'hidden';
        mainContainer.style.opacity = '0';
    }
    
    if (chatInterface) {
        // Force remove any conflicting styles
        chatInterface.style.display = 'flex';
        chatInterface.style.visibility = 'visible';
        chatInterface.style.opacity = '1';
        chatInterface.style.position = 'fixed';
        chatInterface.style.top = '0';
        chatInterface.style.left = '0';
        chatInterface.style.width = '100%';
        chatInterface.style.height = '100vh';
        chatInterface.style.zIndex = '99999';
        chatInterface.style.background = 'var(--dark-bg)';
        chatInterface.classList.add('active', 'chat-interface');
        
        // Add class to body
        document.body.classList.add('chat-active');
        
        // Remove any conflicting classes
        document.body.classList.remove('light-mode');
    }
    
    // Initialize chat
    if (!chatInitialized) {
        setTimeout(() => {
            try {
                initializeChatApp();
                chatInitialized = true;
                console.log("✅ Chat initialized successfully");
            } catch (error) {
                console.error("❌ Chat initialization error:", error);
                // Emergency fallback - create basic chat
                createEmergencyChat();
            }
        }, 100);
    }
    
    // Force focus on input
    setTimeout(() => {
        const userInput = document.getElementById('userInput');
        if (userInput) {
            userInput.focus();
            userInput.style.opacity = '1';
        }
    }, 300);
    
    // Emergency scroll fix
    setTimeout(() => {
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    }, 500);
}

// Emergency fallback function
function createEmergencyChat() {
    console.log("🆘 Creating emergency chat interface...");
    
    const chatMessages = document.getElementById('chatMessages');
    if (chatMessages && chatMessages.innerHTML.trim() === '') {
        chatMessages.innerHTML = WELCOME_MESSAGE_HTML;
    }
    
    // Force show input area
    const inputArea = document.querySelector('.input-area');
    if (inputArea) {
        inputArea.style.display = 'block';
        inputArea.style.visibility = 'visible';
        inputArea.style.opacity = '1';
    }
    
    // Force show chat content
    const chatContent = document.getElementById('chatContent');
    if (chatContent) {
        chatContent.style.display = 'block';
        chatContent.style.visibility = 'visible';
        chatContent.style.opacity = '1';
    }
}

function closeChat() {
    console.log("🔙 Closing chat...");
    
    // Show main content
    const mainContainer = document.querySelector('.main-container');
    if (mainContainer) {
        mainContainer.style.display = 'block';
        mainContainer.style.visibility = 'visible';
        mainContainer.style.opacity = '1';
    }
    
    // Hide chat interface
    const chatInterface = document.getElementById('chatInterface');
    if (chatInterface) {
        chatInterface.style.display = 'none';
        chatInterface.style.visibility = 'hidden';
        chatInterface.style.opacity = '0';
        chatInterface.classList.remove('active', 'chat-interface');
    }
    
    // Remove class from body
    document.body.classList.remove('chat-active');
    
    // Restore theme if needed
    const isLightMode = localStorage.getItem('legalSwamiTheme') === 'light';
    if (isLightMode) {
        document.body.classList.add('light-mode');
    }
}

// =============================================
// INITIALIZATION FUNCTIONS
// =============================================

function initializeAppForGuest() {
    console.log("👤 Initializing in guest mode...");
    currentUser = {
        id: 'guest_' + Date.now(),
        name: 'Guest User',
        email: 'Local Browser Mode',
        isGuest: true,
        picture: null
    };
    isLoggedIn = false;
    updateUserUI();
    loadUserChatHistory();
    showToast('Welcome to LegalSwami! You have 500 free searches per day.', 'info');
}

function updateUserUI() {
    // Update homepage UI
    if (isLoggedIn && currentUser) {
        const headerLoginBtn = document.getElementById('headerLoginBtn');
        const homeUserProfile = document.getElementById('homeUserProfile');
        const homeUserName = document.getElementById('homeUserName');
        const homeUserEmail = document.getElementById('homeUserEmail');
        const homeUserAvatar = document.getElementById('homeUserAvatar');
        
        if (headerLoginBtn) headerLoginBtn.style.display = 'none';
        if (homeUserProfile) homeUserProfile.style.display = 'flex';
        if (homeUserName) homeUserName.textContent = currentUser.name;
        if (homeUserEmail) homeUserEmail.textContent = currentUser.email;
        
        if (homeUserAvatar) {
            if (currentUser.picture) {
                homeUserAvatar.innerHTML = `<img src="${currentUser.picture}" alt="${currentUser.name}" style="width: 100%; height: 100%; border-radius: 8px;">`;
            } else {
                homeUserAvatar.innerHTML = '<i class="fas fa-user"></i>';
            }
        }
    } else {
        const headerLoginBtn = document.getElementById('headerLoginBtn');
        const homeUserProfile = document.getElementById('homeUserProfile');
        if (headerLoginBtn) headerLoginBtn.style.display = 'flex';
        if (homeUserProfile) homeUserProfile.style.display = 'none';
    }
    
    // Update chat UI if chat interface is visible
    const chatInterface = document.getElementById('chatInterface');
    if (chatInterface && chatInterface.classList.contains('active')) {
        if (isLoggedIn && currentUser) {
            const chatUserProfile = document.getElementById('chatUserProfile');
            const chatUserName = document.getElementById('chatUserName');
            const chatUserEmail = document.getElementById('chatUserEmail');
            const chatUserAvatar = document.getElementById('chatUserAvatar');
            const chatDropdownName = document.getElementById('chatDropdownName');
            const chatDropdownEmail = document.getElementById('chatDropdownEmail');
            const chatDropdownAvatar = document.getElementById('chatDropdownAvatar');
            const chatHeaderLoginBtn = document.getElementById('chatHeaderLoginBtn');
            
            if (chatUserProfile) chatUserProfile.style.display = 'flex';
            if (chatUserName) chatUserName.textContent = currentUser.name;
            if (chatUserEmail) chatUserEmail.textContent = currentUser.email;
            if (chatDropdownName) chatDropdownName.textContent = currentUser.name;
            if (chatDropdownEmail) chatDropdownEmail.textContent = currentUser.email;
            
            if (chatUserAvatar && currentUser.picture) {
                chatUserAvatar.innerHTML = `<img src="${currentUser.picture}" alt="${currentUser.name}" style="width: 100%; height: 100%; border-radius: 6px;">`;
            }
            if (chatDropdownAvatar && currentUser.picture) {
                chatDropdownAvatar.innerHTML = `<img src="${currentUser.picture}" alt="${currentUser.name}" style="width: 100%; height: 100%; border-radius: 6px;">`;
            }
            if (chatHeaderLoginBtn) chatHeaderLoginBtn.style.display = 'none';
        } else {
            const chatUserProfile = document.getElementById('chatUserProfile');
            const chatHeaderLoginBtn = document.getElementById('chatHeaderLoginBtn');
            if (chatUserProfile) chatUserProfile.style.display = 'none';
            if (chatHeaderLoginBtn) chatHeaderLoginBtn.style.display = 'flex';
        }
    }
    
    updateSearchCounterDisplay();
}

function toggleUserDropdown() {
    const dropdown = document.getElementById('chatUserDropdown');
    if (dropdown) {
        dropdown.classList.toggle('active');
    }
}

function handleLogout() {
    if (currentUser && currentUser.isGuest) {
        if (confirm('Are you sure you want to clear all local data? This will delete all chat history and settings.')) {
            localStorage.clear();
            chatHistory = [];
            conversationHistory = [];
            currentChatId = null;
            searchCount = 0;
            currentUser = null;
            isLoggedIn = false;
            const loginModal = document.getElementById('loginModal');
            if (loginModal) loginModal.classList.add('active');
            updateUserUI();
            showToast('Local data cleared', 'success');
        }
    } else {
        if (confirm('Are you sure you want to logout?')) {
            localStorage.removeItem('legalSwamiUser');
            localStorage.removeItem('legalSwamiToken');
            currentUser = null;
            userToken = null;
            isLoggedIn = false;
            const loginModal = document.getElementById('loginModal');
            if (loginModal) loginModal.classList.add('active');
            updateUserUI();
            showToast('Logged out successfully', 'success');
        }
    }
}

// =============================================
// CHAT HISTORY FUNCTIONS
// =============================================

function loadUserChatHistory() {
    const userId = currentUser ? currentUser.id : 'guest';
    const storageKey = `legalSwamiChatHistory_${userId}`;
    try {
        const savedHistory = localStorage.getItem(storageKey);
        if (savedHistory) {
            chatHistory = JSON.parse(savedHistory);
        }
        const savedChatId = localStorage.getItem(`legalSwamiCurrentChatId_${userId}`);
        if (savedChatId) {
            currentChatId = savedChatId;
            const currentChat = chatHistory.find(chat => chat.id === currentChatId);
            if (currentChat) {
                conversationHistory = [...currentChat.messages];
            }
        }
    } catch (error) {
        console.error('Error loading chat history:', error);
        chatHistory = [];
    }
}

function saveUserChatHistory() {
    const userId = currentUser ? currentUser.id : 'guest';
    const storageKey = `legalSwamiChatHistory_${userId}`;
    try {
        localStorage.setItem(storageKey, JSON.stringify(chatHistory));
        localStorage.setItem(`legalSwamiCurrentChatId_${userId}`, currentChatId);
    } catch (error) {
        console.error('Error saving chat history:', error);
    }
}

// =============================================
// SEARCH COUNTER FUNCTIONS
// =============================================

function initializeSearchCounter() {
    try {
        const savedCount = localStorage.getItem('legalSwamiSearchCount');
        if (savedCount) {
            searchCount = parseInt(savedCount);
        }
        const savedDate = localStorage.getItem('legalSwamiSearchDate');
        if (savedDate) {
            const lastDate = new Date(savedDate);
            const today = new Date();
            if (lastDate.getDate() !== today.getDate() || 
                lastDate.getMonth() !== today.getMonth() || 
                lastDate.getFullYear() !== today.getFullYear()) {
                searchCount = 0;
                saveSearchCounter();
            }
        }
        updateSearchCounterDisplay();
    } catch (error) {
        console.error('Error loading search counter:', error);
    }
}

function saveSearchCounter() {
    try {
        localStorage.setItem('legalSwamiSearchCount', searchCount.toString());
        localStorage.setItem('legalSwamiSearchDate', new Date().toISOString());
    } catch (error) {
        console.error('Error saving search counter:', error);
    }
}

function updateSearchCounterDisplay() {
    const searchCounterElement = document.getElementById('searchCounter');
    if (searchCounterElement) {
        const maxSearches = MAX_FREE_SEARCHES;
        const remaining = maxSearches - searchCount;
        searchCounterElement.innerHTML = `<i class="fas fa-search"></i><span class="hide-on-mobile">Free searches: ${remaining}/${maxSearches}</span>`;
        if (remaining <= 50) {
            searchCounterElement.style.color = 'var(--warning)';
        } else if (remaining <= 10) {
            searchCounterElement.style.color = 'var(--error)';
        } else {
            searchCounterElement.style.color = 'var(--dark-text-secondary)';
        }
    }
}

// =============================================
// MAIN CHAT APP INITIALIZATION
// =============================================

function initializeChatApp() {
    console.log("🤖 Initializing chat app...");
    
    try {
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebarClose = document.getElementById('sidebarClose');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const clearChatBtn = document.getElementById('clearChatBtn');
        const downloadCurrentBtn = document.getElementById('downloadCurrentBtn');
        const suggestionsBtn = document.getElementById('suggestionsBtn');
        const voiceSearchBtn = document.getElementById('voiceSearchBtn');
        const inputMicrophoneBtn = document.getElementById('inputMicrophoneBtn');
        const themeToggle = document.getElementById('themeToggle');
        const topicItems = document.querySelectorAll('.topic-item');
        const actionItems = document.querySelectorAll('.action-item');
        const sidebarTabs = document.querySelectorAll('.sidebar-tab');
        const newChatBtn = document.getElementById('newChatBtn');
        const attachmentBtn = document.getElementById('attachmentBtn');
        const headerLoginBtn = document.getElementById('chatHeaderLoginBtn');
        const logoutBtn = document.getElementById('chatLogoutBtn');
        const userProfile = document.getElementById('chatUserProfile');
        const emojiPickerBtn = document.getElementById('emojiPickerBtn');
        const backToHomeBtn = document.getElementById('backToHomeBtn');

        // Initialize for desktop
        const isDesktop = window.innerWidth >= 1025;
        if (isDesktop && sidebar) {
            sidebar.classList.add('active');
        }
        
        // Load preferences
        loadThemePreference();
        initializeSearchCounter();
        
        // Load or create chat
        if (!currentChatId || conversationHistory.length === 0) {
            createNewChat();
        } else {
            loadCurrentChatMessages();
        }

        // Send button click
        if (sendButton) {
            sendButton.addEventListener('click', function() {
                if (isStreamingActive) {
                    stopStreaming();
                } else {
                    sendMessage();
                }
            });
        }
        
        // User input keydown
        if (userInput) {
            userInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    e.preventDefault();
                    if (isStreamingActive) {
                        stopStreaming();
                    } else {
                        sendMessage();
                    }
                }
                if (e.key === 'Enter' && !e.ctrlKey) {
                    setTimeout(() => {
                        this.style.height = 'auto';
                        this.style.height = Math.min(this.scrollHeight, 150) + 'px';
                    }, 10);
                }
            });
            
            userInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 150) + 'px';
                if (isStreamingActive && sendButton) {
                    sendButton.disabled = false;
                    sendButton.classList.add('stop-button');
                    sendButton.innerHTML = '<i class="fas fa-stop"></i> <span class="hide-on-mobile">Stop</span>';
                } else if (sendButton) {
                    sendButton.disabled = this.value.trim() === '' && attachedFiles.length === 0;
                    sendButton.classList.remove('stop-button');
                    sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> <span class="hide-on-mobile">Send</span>';
                }
                const text = this.value.trim();
                if (text.length > 0) {
                    const lang = detectLanguage(text);
                    showLanguageHint(lang);
                } else {
                    hideLanguageHint();
                }
            });
        }

        // Voice recognition setup
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-IN,hi-IN,mr-IN,ta-IN,te-IN';
            
            recognition.onstart = function() {
                isListening = true;
                if (isInputMicrophoneActive && inputMicrophoneBtn) {
                    inputMicrophoneBtn.classList.add('listening');
                } else if (voiceSearchBtn) {
                    voiceSearchBtn.classList.add('listening');
                }
                const voiceInputStatus = document.getElementById('voiceInputStatus');
                if (voiceInputStatus) voiceInputStatus.classList.add('active');
                showToast('Listening... Speak now 🎤', 'info');
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                const voiceInputText = document.getElementById('voiceInputText');
                if (event.results[0].isFinal && userInput) {
                    userInput.value = transcript;
                    userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
                    if (voiceInputText) voiceInputText.style.display = 'none';
                    const lang = detectLanguage(transcript);
                    showLanguageHint(lang);
                    if (sendButton) sendButton.disabled = false;
                    if (transcript.split(' ').length <= 10) {
                        setTimeout(() => {
                            sendMessage();
                        }, 1000);
                    }
                } else if (voiceInputText) {
                    voiceInputText.textContent = transcript;
                    voiceInputText.style.display = 'block';
                }
            };
            
            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                isListening = false;
                isInputMicrophoneActive = false;
                if (inputMicrophoneBtn) inputMicrophoneBtn.classList.remove('listening');
                if (voiceSearchBtn) voiceSearchBtn.classList.remove('listening');
                const voiceInputStatus = document.getElementById('voiceInputStatus');
                if (voiceInputStatus) voiceInputStatus.classList.remove('active');
                if (event.error === 'not-allowed') {
                    showToast('Microphone access denied. Please allow microphone access. 🎤', 'error');
                } else {
                    showToast('Voice recognition failed. Please try again. ❌', 'error');
                }
            };
            
            recognition.onend = function() {
                isListening = false;
                isInputMicrophoneActive = false;
                if (inputMicrophoneBtn) inputMicrophoneBtn.classList.remove('listening');
                if (voiceSearchBtn) voiceSearchBtn.classList.remove('listening');
                const voiceInputStatus = document.getElementById('voiceInputStatus');
                if (voiceInputStatus) voiceInputStatus.classList.remove('active');
                const voiceInputText = document.getElementById('voiceInputText');
                if (voiceInputText) voiceInputText.style.display = 'none';
            };
            
            if (voiceSearchBtn) {
                voiceSearchBtn.addEventListener('click', toggleVoiceRecognition);
            }
            if (inputMicrophoneBtn) {
                inputMicrophoneBtn.addEventListener('click', toggleInputVoiceRecognition);
            }
        } else {
            if (voiceSearchBtn) voiceSearchBtn.style.display = 'none';
            if (inputMicrophoneBtn) inputMicrophoneBtn.style.display = 'none';
            showToast('Voice search not supported in your browser 🎤', 'warning');
        }

        // Theme toggle
        if (themeToggle) {
            themeToggle.addEventListener('click', toggleTheme);
        }
        
        // Sidebar toggle buttons
        if (sidebarToggle && sidebar && sidebarOverlay) {
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.add('active');
                sidebarOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            });
            
            if (sidebarClose) {
                sidebarClose.addEventListener('click', function() {
                    sidebar.classList.remove('active');
                    sidebarOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                });
            }
            
            sidebarOverlay.addEventListener('click', function() {
                sidebar.classList.remove('active');
                this.classList.remove('active');
                document.body.style.overflow = '';
            });
        }
        
        // Sidebar tab switching
        sidebarTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.dataset.tab;
                sidebarTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                const tabContent = document.getElementById(`${tabId}-content`);
                if (tabContent) tabContent.classList.add('active');
                if (tabId === 'chat-history') {
                    loadHistoryList();
                }
            });
        });
        
        // New chat button
        if (newChatBtn) newChatBtn.addEventListener('click', createNewChat);
        if (clearChatBtn) clearChatBtn.addEventListener('click', clearCurrentChat);
        
        if (downloadCurrentBtn) {
            downloadCurrentBtn.addEventListener('click', () => {
                if (conversationHistory.length === 0) {
                    showToast('No chat content to download 📄', 'warning');
                    return;
                }
                openDownloadModal();
            });
        }
        
        if (suggestionsBtn) suggestionsBtn.addEventListener('click', showSuggestions);
        
        // Topic click handlers
        topicItems.forEach(item => {
            item.addEventListener('click', function() {
                const topic = this.dataset.topic;
                const topicName = this.querySelector('span').textContent;
                const isActive = this.classList.contains('active-tab');
                if (isActive) {
                    this.classList.remove('active-tab');
                    removeActiveTopic(topic);
                    clearTopicFileContent(topic);
                    showToast(`${topicName} tab closed ✖️`, 'info');
                } else {
                    this.classList.add('active-tab');
                    addActiveTopic(topic, topicName);
                    const questions = {
                        'contract': 'What are the essential elements of a valid contract under Indian law? ⚖️',
                        'employment': 'What are the rights of employees regarding workplace harassment in India? 💼',
                        'intellectual': 'How does copyright protection work for software in India? 🧠',
                        'realestate': 'What documents are required for property registration in India? 🏠',
                        'family': 'What are the grounds for divorce under Hindu Marriage Act? 👨‍👩‍👧',
                        'criminal': 'What is the difference between bailable and non-bailable offenses? ⚖️'
                    };
                    if (userInput) {
                        userInput.value = questions[topic] || `Tell me about ${topicName.toLowerCase()} in Indian law. ⚖️`;
                        userInput.focus();
                        userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
                    }
                    if (sendButton) sendButton.disabled = false;
                    showToast(`${topicName} tab opened 📂`, 'success');
                }
                if (window.innerWidth < 1024 && sidebar) {
                    sidebar.classList.remove('active');
                    if (sidebarOverlay) sidebarOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        });
        
        // Action click handlers
        actionItems.forEach(item => {
            item.addEventListener('click', function() {
                const action = this.dataset.action;
                let inputText = '';
                
                if (action === 'document-drafts') {
                    inputText = 'Create a non-disclosure agreement draft for me 📝';
                } else if (action === 'legal-research') {
                    inputText = 'Can you help me research case laws related to breach of contract? 🔍';
                } else if (action === 'case-analysis') {
                    inputText = 'Can you analyze the legal principles in landmark privacy law cases? 📊';
                }
                
                if (userInput && inputText) {
                    userInput.value = inputText;
                    userInput.focus();
                    userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
                }
                if (sendButton) sendButton.disabled = false;
                if (window.innerWidth < 1024 && sidebar) {
                    sidebar.classList.remove('active');
                    if (sidebarOverlay) sidebarOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        });
        
        // Header login button click
        if (headerLoginBtn) {
            headerLoginBtn.addEventListener('click', function() {
                const loginModal = document.getElementById('loginModal');
                if (loginModal) loginModal.classList.add('active');
            });
        }
        
        // Back to home button - Use simple close function
        if (backToHomeBtn) backToHomeBtn.addEventListener('click', closeChat);
        
        // User profile click
        if (userProfile) userProfile.addEventListener('click', toggleUserDropdown);
        
        // Logout button
        if (logoutBtn) logoutBtn.addEventListener('click', handleLogout);
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('chatUserDropdown');
            const profile = document.getElementById('chatUserProfile');
            if (dropdown && dropdown.classList.contains('active') && 
                !dropdown.contains(event.target) && 
                profile && !profile.contains(event.target)) {
                dropdown.classList.remove('active');
            }
            const isMobile = window.innerWidth < 1024;
            if (isMobile && sidebar && sidebar.classList.contains('active') && 
                !sidebar.contains(event.target) && 
                sidebarToggle && !sidebarToggle.contains(event.target)) {
                sidebar.classList.remove('active');
                if (sidebarOverlay) sidebarOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
        
        // Focus input on load
        setTimeout(() => {
            if (userInput) userInput.focus();
        }, 300);
        
        // Adjust textarea height on page load
        setTimeout(() => {
            if (userInput) {
                userInput.style.height = 'auto';
                userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
            }
        }, 100);
        
        // Initialize scroll to bottom button
        const scrollToBottomBtn = document.getElementById('scrollToBottomBtn');
        if (scrollToBottomBtn) {
            scrollToBottomBtn.addEventListener('click', scrollToBottom);
        }
        
        // Monitor scroll position
        if (chatMessages) {
            chatMessages.addEventListener('scroll', checkScrollPosition);
            setTimeout(checkScrollPosition, 500);
            const observer = new MutationObserver(checkScrollPosition);
            observer.observe(chatMessages, { childList: true, subtree: true });
        }
        
        // Initialize send button state
        if (sendButton && userInput) {
            sendButton.disabled = userInput.value.trim() === '' && attachedFiles.length === 0;
        }
        
        // Adjust chat layout
        setTimeout(adjustChatLayout, 100);
        
        // File upload functionality
        if (attachmentBtn) attachmentBtn.addEventListener('click', openFileUploadModal);
        
        // Download notification close
        const closeDownloadNotification = document.getElementById('closeDownloadNotification');
        if (closeDownloadNotification) {
            closeDownloadNotification.addEventListener('click', function() {
                const downloadNotification = document.getElementById('downloadNotification');
                if (downloadNotification) downloadNotification.classList.remove('show');
            });
        }
        
        // Download notification click to open file
        const downloadNotification = document.getElementById('downloadNotification');
        if (downloadNotification) {
            downloadNotification.addEventListener('click', function() {
                if (lastDownloadedFileUrl) {
                    window.open(lastDownloadedFileUrl, '_blank');
                    this.classList.remove('show');
                }
            });
        }
        
        console.log("✅ Chat app initialized successfully");
        chatInitialized = true;
        
    } catch (error) {
        console.error("❌ Error initializing chat app:", error);
    }
}

// =============================================
// CHAT MESSAGE FUNCTIONS
// =============================================

function checkScrollPosition() {
    const chatMessages = document.getElementById('chatMessages');
    const scrollBtn = document.getElementById('scrollToBottomBtn');
    const indicator = document.getElementById('scrollPositionIndicator');
    
    if (!chatMessages || !scrollBtn || !indicator) return;
    
    const scrollBottom = chatMessages.scrollHeight - chatMessages.clientHeight;
    const currentScroll = chatMessages.scrollTop;
    const isAtBottom = Math.abs(scrollBottom - currentScroll) < 10;
    
    if (!isAtBottom) {
        scrollBtn.classList.add('visible');
        if (currentScroll < scrollPosition) {
            indicator.classList.add('visible');
            setTimeout(() => {
                indicator.classList.remove('visible');
            }, 2000);
        }
    } else {
        scrollBtn.classList.remove('visible');
        indicator.classList.remove('visible');
    }
    scrollPosition = currentScroll;
}

function showDownloadNotification(fileName, fileType) {
    const notification = document.getElementById('downloadNotification');
    if (!notification) return;
    
    const title = document.getElementById('downloadNotificationTitle');
    const message = document.getElementById('downloadNotificationMessage');
    
    if (title) title.textContent = `${fileType} Downloaded 📥`;
    if (message) message.textContent = `Click to open ${fileName}`;
    
    notification.classList.add('show');
    setTimeout(() => {
        notification.classList.remove('show');
    }, 5000);
}

// =============================================
// TOPICS MANAGEMENT
// =============================================

function addActiveTopic(topicId, topicName) {
    const existingIndex = activeLegalTopics.findIndex(t => t.id === topicId);
    if (existingIndex !== -1) return;
    
    activeLegalTopics.push({
        id: topicId,
        name: topicName,
        timestamp: new Date().toISOString()
    });
    
    updateActiveTopicsUI();
}

function removeActiveTopic(topicId) {
    activeLegalTopics = activeLegalTopics.filter(t => t.id !== topicId);
    updateActiveTopicsUI();
}

function updateActiveTopicsUI() {
    const activeTopicsSection = document.getElementById('activeTopicsSection');
    const activeTopicsList = document.getElementById('activeTopicsList');
    
    if (!activeTopicsSection || !activeTopicsList) return;
    
    if (activeLegalTopics.length === 0) {
        activeTopicsSection.style.display = 'none';
        return;
    }
    
    activeTopicsSection.style.display = 'block';
    activeTopicsList.innerHTML = '';
    
    activeLegalTopics.forEach(topic => {
        const topicItem = document.createElement('div');
        topicItem.className = 'topic-item active-tab';
        topicItem.innerHTML = `
            <i class="fas fa-folder-open"></i>
            <span>${topic.name}</span>
        `;
        
        topicItem.addEventListener('click', function(e) {
            e.stopPropagation();
            const originalTopic = document.querySelector(`.topic-item[data-topic="${topic.id}"]`);
            if (originalTopic) {
                originalTopic.click();
            }
        });
        
        activeTopicsList.appendChild(topicItem);
    });
}

function clearTopicFileContent(topicId) {
    const fileContents = document.querySelectorAll(`.file-content-display[data-topic="${topicId}"]`);
    fileContents.forEach(content => {
        content.remove();
    });
}

// =============================================
// CHAT HISTORY LOADING
// =============================================

function loadCurrentChatMessages() {
    const chatMessages = document.getElementById('chatMessages');
    if (!chatMessages) return;
    
    chatMessages.innerHTML = '';
    
    if (conversationHistory.length === 0) {
        const welcomeContainer = document.createElement('div');
        welcomeContainer.innerHTML = WELCOME_MESSAGE_HTML;
        chatMessages.appendChild(welcomeContainer);
        addDraftTemplateListeners();
        return;
    }
    
    conversationHistory.forEach(msg => {
        const isDocument = msg.isDocument || false;
        const hasSources = msg.sources && msg.sources.length > 0;
        addMessageToChat(msg.content, msg.role === 'user', true, isDocument, msg.attachments || [], hasSources ? msg.sources : null);
    });
    
    setTimeout(addCopyEditButtonsToUserMessages, 100);
}

function addDraftTemplateListeners() {
    const draftTemplates = document.querySelectorAll('.draft-template');
    draftTemplates.forEach(template => {
        template.addEventListener('click', function() {
            const templateType = this.dataset.template;
            let requestText = '';
            
            switch(templateType) {
                case 'nda':
                    requestText = 'Create a comprehensive non-disclosure agreement for Indian business use 🤝';
                    break;
                case 'employment':
                    requestText = 'Draft an employment contract template for Indian companies 💼';
                    break;
                case 'rental':
                    requestText = 'Create a rental/tenancy agreement for residential property in India 🏠';
                    break;
                case 'loan':
                    requestText = 'Draft a loan agreement template for personal lending in India 💰';
                    break;
            }
            
            const userInput = document.getElementById('userInput');
            if (userInput) {
                userInput.value = requestText;
                userInput.focus();
                userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
                
                const sendButton = document.getElementById('sendButton');
                if (sendButton) {
                    sendButton.disabled = false;
                }
                
                setTimeout(() => {
                    sendMessage();
                }, 1000);
            }
        });
    });
}

// =============================================
// SEND MESSAGE FUNCTION
// =============================================

async function sendMessage() {
    const userInput = document.getElementById('userInput');
    const sendButton = document.getElementById('sendButton');
    
    if (!userInput || !sendButton) return;
    
    const message = userInput.value.trim();
    
    if (!message && attachedFiles.length === 0) {
        showToast('Please enter a message or attach a file 📝', 'warning');
        return;
    }
    
    if (!isLoggedIn && searchCount >= MAX_FREE_SEARCHES) {
        showToast(`You've used ${MAX_FREE_SEARCHES} free searches today. Please wait until tomorrow or clear local data to reset counter. ⏰`, 'warning');
        return;
    }
    
    if (isListening && recognition) {
        recognition.stop();
    }
    
    let detectedLanguage = 'english';
    if (message) {
        detectedLanguage = detectLanguage(message);
        hideLanguageHint();
    }
    
    const messageId = addMessageToChat(message, true, false, false, attachedFiles);
    userInput.value = '';
    userInput.style.height = '52px';
    
    sendButton.disabled = false;
    sendButton.classList.add('stop-button');
    sendButton.innerHTML = '<i class="fas fa-stop"></i> <span class="hide-on-mobile">Stop</span>';
    
    isStreamingActive = true;
    stopStreamingRequested = false;
    clearAttachments();
    
    try {
        const userMessage = {
            role: 'user',
            content: message,
            language: detectedLanguage,
            attachments: [...attachedFiles],
            timestamp: new Date().toISOString()
        };
        
        conversationHistory.push(userMessage);
        
        if (!isLoggedIn) {
            searchCount++;
            saveSearchCounter();
            updateSearchCounterDisplay();
            
            const remaining = MAX_FREE_SEARCHES - searchCount;
            if (remaining === 50) {
                showToast(`You have ${remaining} free searches remaining. ⚠️`, 'warning');
            } else if (remaining === 10) {
                showToast(`Only ${remaining} free searches left! ⚠️`, 'warning');
            } else if (remaining === 0) {
                showToast(`Daily limit reached! You've used ${MAX_FREE_SEARCHES} searches today. ⏰`, 'warning');
            }
        }
        
        let fileContents = '';
        if (attachedFiles.length > 0) {
            for (const file of attachedFiles) {
                const content = await readFileContent(file);
                if (content) {
                    fileContents += `\n\n[Content from ${file.name}]:\n${content.substring(0, 2000)}${content.length > 2000 ? '... (truncated)' : ''}`;
                }
            }
        }
        
        const fullMessage = message + fileContents;
        
        // Backend API call
        const backendUrl = 'https://legal-swami-backend.onrender.com';
        const userId = currentUser ? currentUser.id : 'guest_' + Date.now();
        
        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 10000);
            
            const response = await fetch(backendUrl + '/api/v1/chat/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-user-id': userId,
                    'x-request-id': 'req_' + Date.now(),
                    'x-language': detectedLanguage
                },
                body: JSON.stringify({
                    message: fullMessage,
                    generateDocument: isDocumentRequest(message),
                    language: detectedLanguage
                }),
                signal: controller.signal
            }).finally(() => clearTimeout(timeoutId));
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${await response.text()}`);
            }
            
            const data = await response.json();
            
            if (stopStreamingRequested) {
                console.log('Streaming was stopped, not processing response');
                return;
            }
            
            const sourcesData = extractSourcesFromResponse(data.response || data.content || '');
            const aiMessage = {
                role: 'assistant',
                content: data.response || data.content || '',
                language: detectedLanguage,
                isDocument: isDocumentRequest(message),
                sources: sourcesData.sources,
                timestamp: new Date().toISOString()
            };
            
            conversationHistory.push(aiMessage);
            const aiMessageId = createStreamingMessage();
            startStreamingResponse(aiMessageId, aiMessage.content, isDocumentRequest(message));
            
            setTimeout(() => {
                if (sourcesData && sourcesData.hasSources) {
                    addResponseSources(aiMessageId, sourcesData);
                }
            }, 500);
            
        } catch (error) {
            console.error('Backend API failed, using mock response:', error);
            // Use mock response
            const mockResponse = await generateMockResponse(fullMessage);
            const sourcesData = extractSourcesFromResponse(mockResponse.response || mockResponse.content || '');
            const aiMessage = {
                role: 'assistant',
                content: mockResponse.response || mockResponse.content || '',
                language: detectedLanguage,
                isDocument: mockResponse.isDocument,
                sources: sourcesData.sources,
                timestamp: new Date().toISOString()
            };
            
            conversationHistory.push(aiMessage);
            const aiMessageId = createStreamingMessage();
            startStreamingResponse(aiMessageId, aiMessage.content, mockResponse.isDocument);
        }
        
        // Save chat to backend if logged in
        if (isLoggedIn && currentUser) {
            try {
                await fetch(backendUrl + '/api/v1/chat/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-user-id': currentUser.id,
                        'x-token': userToken || ''
                    },
                    body: JSON.stringify({
                        chatId: currentChatId,
                        messages: conversationHistory,
                        title: conversationHistory[0]?.content?.substring(0, 30) || 'New Chat'
                    })
                });
            } catch (error) {
                console.error('Failed to save chat to backend:', error);
            }
        }
        
    } catch (error) {
        console.error('AI Service Error:', error);
        const errorMessage = "I apologize for the inconvenience. I'm currently experiencing technical difficulties. Please try again in a moment. ⚠️";
        addMessageToChat(errorMessage, false);
        conversationHistory.push({
            role: 'assistant',
            content: errorMessage,
            language: 'english',
            timestamp: new Date().toISOString()
        });
        showToast('Service temporarily unavailable ⚠️', 'warning');
    } finally {
        if (sendButton) {
            sendButton.disabled = userInput.value.trim() === '' && attachedFiles.length === 0;
            sendButton.classList.remove('stop-button');
            sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> <span class="hide-on-mobile">Send</span>';
        }
        
        isStreamingActive = false;
        
        if (userInput) {
            userInput.focus();
        }
        
        setTimeout(adjustChatLayout, 100);
        setTimeout(addCopyEditButtonsToUserMessages, 100);
        saveCurrentChat();
    }
}

// =============================================
// FILE HANDLING FUNCTIONS
// =============================================

async function readFileContent(file) {
    return new Promise((resolve, reject) => {
        if (file.type.startsWith('image/')) {
            resolve(`[Image file: ${file.name}. Size: ${(file.size / 1024).toFixed(2)} KB]`);
        } else if (file.type === 'application/pdf') {
            resolve(`[PDF file: ${file.name}. Size: ${(file.size / 1024).toFixed(2)} KB. Content preview not available in browser.]`);
        } else if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                resolve(e.target.result);
            };
            reader.onerror = reject;
            reader.readAsText(file.file);
        } else if (file.type.includes('document') || file.name.endsWith('.doc') || file.name.endsWith('.docx')) {
            resolve(`[Document file: ${file.name}. Size: ${(file.size / 1024).toFixed(2)} KB. Content preview not available in browser.]`);
        } else {
            resolve(`[File: ${file.name}. Type: ${file.type}. Size: ${(file.size / 1024).toFixed(2)} KB]`);
        }
    });
}

// =============================================
// SOURCE EXTRACTION
// =============================================

function extractSourcesFromResponse(response) {
    const sources = [];
    const indianActsPatterns = [
        /(Indian Contract Act,?\s*1872)/gi,
        /(Indian Penal Code,?\s*1860)/gi,
        /(Code of Civil Procedure,?\s*1908)/gi,
        /(Code of Criminal Procedure,?\s*1973)/gi,
        /(Constitution of India)/gi,
        /(Evidence Act,?\s*1872)/gi,
        /(Specific Relief Act,?\s*1963)/gi,
        /(Transfer of Property Act,?\s*1882)/gi,
        /(Hindu Marriage Act,?\s*1955)/gi,
        /(Hindu Succession Act,?\s*1956)/gi,
        /(Companies Act,?\s*2013)/gi,
        /(Consumer Protection Act,?\s*2019)/gi,
        /(Information Technology Act,?\s*2000)/gi,
        /(Right to Information Act,?\s*2005)/gi,
        /(Arbitration and Conciliation Act,?\s*1996)/gi,
        /(Protection of Children from Sexual Offences Act,?\s*2012)/gi,
        /(Motor Vehicles Act,?\s*1988)/gi,
        /(Negotiable Instruments Act,?\s*1881)/gi,
        /(Sale of Goods Act,?\s*1930)/gi,
        /(Partnership Act,?\s*1932)/gi
    ];
    
    const caseLawPatterns = [
        /([A-Z][a-z]+\s+v\.\s+[A-Z][a-z]+)/g,
        /(AIR\s+\d{4}\s+(?:SC|Bom|Del|Cal|Mad|Ker|Guj|Raj|All|Pat|Ori|MP|AP|HP|P&H|J&K|Kar)\s+\d+)/gi,
        /(SCC\s+\d+)/gi,
        /((\d+)\s+SCC\s+\d+)/gi,
        /(SCR\s+\d+)/gi,
        /((\d+)\s+SCR\s+\d+)/gi,
        /(JT\s+\d+)/gi,
        /((\d+)\s+JT\s+\d+)/gi
    ];
    
    const sectionPatterns = [
        /(Section\s+\d+[A-Z]?)/gi,
        /(Article\s+\d+)/gi,
        /(Rule\s+\d+)/gi,
        /(Regulation\s+\d+)/gi,
        /(Clause\s+\d+)/gi,
        /(Schedule\s+[IVXLCDM]+)/gi
    ];
    
    indianActsPatterns.forEach(pattern => {
        const matches = response.match(pattern);
        if (matches) {
            matches.forEach(match => {
                const formatted = match.replace(/,?\s*(\d{4})/, ', $1');
                if (!sources.some(s => s.toLowerCase() === formatted.toLowerCase())) {
                    sources.push(formatted);
                }
            });
        }
    });
    
    caseLawPatterns.forEach(pattern => {
        const matches = response.match(pattern);
        if (matches) {
            matches.forEach(match => {
                if (!sources.some(s => s.toLowerCase() === match.toLowerCase())) {
                    sources.push(match);
                }
            });
        }
    });
    
    sectionPatterns.forEach(pattern => {
        const matches = response.match(pattern);
        if (matches) {
            matches.forEach(match => {
                if (!sources.some(s => s.toLowerCase() === match.toLowerCase())) {
                    sources.push(match);
                }
            });
        }
    });
    
    const uniqueSources = [];
    const seen = new Set();
    sources.forEach(source => {
        const lower = source.toLowerCase();
        if (!seen.has(lower)) {
            seen.add(lower);
            uniqueSources.push(source);
        }
    });
    
    return {
        sources: uniqueSources.slice(0, 8),
        hasSources: uniqueSources.length > 0
    };
}

function addResponseSources(messageId, sourcesData) {
    const messageDiv = document.getElementById(messageId);
    if (!messageDiv || !sourcesData || !sourcesData.hasSources) return;
    
    const checkStreaming = setInterval(() => {
        const isStillStreaming = currentStreamingMessageId === messageId;
        const messageText = messageDiv.querySelector('.message-text');
        const hasStreamingCursor = messageText && messageText.querySelector('.streaming-cursor');
        
        if (!isStillStreaming && !hasStreamingCursor) {
            clearInterval(checkStreaming);
            
            const sourcesContainer = document.createElement('div');
            sourcesContainer.className = 'sources-container';
            
            let sourcesHTML = '';
            if (sourcesData.sources && sourcesData.sources.length > 0) {
                sourcesHTML = `
                    <div class="sources-header">
                        <i class="fas fa-gavel"></i>
                        <span>Legal Sources & References ⚖️</span>
                    </div>
                    <div class="sources-list">
                        ${sourcesData.sources.map(source => `
                            <div class="source-tag" title="${source}">
                                <i class="fas fa-bookmark"></i>
                                <span>${source.length > 40 ? source.substring(0, 40) + '...' : source}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="sources-info">
                        <i class="fas fa-info-circle"></i>
                        Sources extracted from the AI response above 📚
                    </div>
                `;
                sourcesContainer.innerHTML = sourcesHTML;
                messageDiv.parentNode.insertBefore(sourcesContainer, messageDiv.nextSibling);
                setTimeout(() => {
                    sourcesContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 300);
                const aiMessageIndex = conversationHistory.findIndex(msg => 
                    msg.role === 'assistant' && msg.content && msg.content.includes(messageDiv.querySelector('.message-text').textContent.substring(0, 100))
                );
                if (aiMessageIndex !== -1) {
                    conversationHistory[aiMessageIndex].sources = sourcesData.sources;
                    saveCurrentChat();
                }
            }
        }
    }, 100);
    setTimeout(() => clearInterval(checkStreaming), 10000);
}

// =============================================
// CHAT HISTORY MANAGEMENT
// =============================================

function saveCurrentChat() {
    if (!currentChatId || conversationHistory.length === 0) return;
    const chatIndex = chatHistory.findIndex(chat => chat.id === currentChatId);
    let title = 'New Chat';
    let preview = 'No messages yet';
    if (conversationHistory.length > 0) {
        const firstUserMessage = conversationHistory.find(msg => msg.role === 'user');
        if (firstUserMessage) {
            title = firstUserMessage.content.substring(0, 30);
            if (firstUserMessage.content.length > 30) {
                title += '...';
            }
        }
        const lastMessage = conversationHistory[conversationHistory.length - 1];
        if (lastMessage) {
            preview = lastMessage.content.substring(0, 50);
            if (lastMessage.content.length > 50) {
                preview += '...';
            }
        }
    }
    const chatData = {
        id: currentChatId,
        title: title,
        preview: preview,
        date: new Date().toISOString(),
        messages: [...conversationHistory],
        userId: 'guest'
    };
    if (chatIndex !== -1) {
        chatHistory[chatIndex] = chatData;
    } else {
        chatHistory.unshift(chatData);
    }
    saveUserChatHistory();
}

function isDocumentRequest(message) {
    if (!message) return false;
    const docKeywords = [
        'draft', 'template', 'format', 'document', 'agreement', 
        'contract', 'nda', 'non disclosure', 'employment', 
        'rental', 'loan', 'will', 'testament', 'legal document',
        'ready made', 'sample', 'example', 'form', 'प्रारूप',
        'मसौदा', 'दस्तावेज़', 'समझौता', 'अनुबंध', 'करार',
        'ड्राफ्ट', 'टेम्पलेट', 'फॉर्मेट', 'सैंपल', 'create',
        'generate', 'make', 'prepare', 'write'
    ];
    const lowerMessage = message.toLowerCase();
    return docKeywords.some(keyword => lowerMessage.includes(keyword));
}

function detectLanguage(text) {
    if (!text) return 'english';
    const hasNonEnglishScript = /[\u0900-\u097F\u0B80-\u0BFF\u0C00-\u0C7F\u0C80-\u0CFF\u0A00-\u0A7F\u0A80-\u0AFF\u0980-\u09FF]/.test(text);
    if (!hasNonEnglishScript) {
        const hindiMarathiWords = [
            /\bmujhe\b/i, /\btumhe\b/i, /\bhindi\b/i, /\bmarathi\b/i,
            /\bkya\b/i, /\bkyu\b/i, /\bkaise\b/i, /\bkab\b/i,
            /\bmala\b/i, /\bmahiti\b/i, /\bsahayata\b/i, /\bkich\b/i
        ];
        let hindiMarathiScore = 0;
        hindiMarathiWords.forEach(pattern => {
            if (pattern.test(text)) hindiMarathiScore++;
        });
        if (hindiMarathiScore >= 2) {
            if (/\bmala\b/i.test(text) || /\bmahiti\b/i.test(text) || /\bsahayata\b/i.test(text)) {
                return 'marathi';
            }
            if (/\bmujhe\b/i.test(text) || /\bkya\b/i.test(text) || /\bkyu\b/i.test(text)) {
                return 'hindi';
            }
        }
        return 'english';
    }
    if (/[\u0900-\u097F]/.test(text)) {
        let marathiScore = 0;
        let hindiScore = 0;
        const marathiWords = ['आहे', 'मी', 'तू', 'आपण', 'होय', 'नाही', 'मला', 'पाहिजे', 'कृपया', 'धन्यवाद', 'महाराष्ट्र', 'मराठी'];
        marathiWords.forEach(word => {
            if (text.includes(word)) marathiScore++;
        });
        const hindiWords = ['क्या', 'क्यों', 'कैसे', 'मुझे', 'तुम्हें', 'आप', 'है', 'हैं', 'हिन्दी', 'भारत'];
        hindiWords.forEach(word => {
            if (text.includes(word)) hindiScore++;
        });
        if (marathiScore > hindiScore) {
            return 'marathi';
        } else if (hindiScore > 0) {
            return 'hindi';
        }
        return 'hindi';
    }
    if (/[\u0B80-\u0BFF]/.test(text)) return 'tamil';
    if (/[\u0C00-\u0C7F]/.test(text)) return 'telugu';
    if (/[\u0C80-\u0CFF]/.test(text)) return 'kannada';
    if (/[\u0A00-\u0A7F]/.test(text)) return 'punjabi';
    if (/[\u0A80-\u0AFF]/.test(text)) return 'gujarati';
    if (/[\u0980-\u09FF]/.test(text)) return 'bengali';
    return 'english';
}

// =============================================
// MESSAGE DISPLAY FUNCTIONS
// =============================================

function addMessageToChat(content, isUser, fromHistory = false, isDocument = false, attachments = [], sources = null) {
    const chatMessages = document.getElementById('chatMessages');
    if (!fromHistory && isUser && chatMessages) {
        const welcomeMessage = document.querySelector('.welcome-message');
        if (welcomeMessage) {
            welcomeMessage.remove();
        }
    }
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
    const messageId = 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    messageDiv.id = messageId;
    const avatar = document.createElement('div');
    avatar.className = 'avatar';
    if (isUser) {
        if (currentUser && currentUser.picture) {
            avatar.innerHTML = `<img src="${currentUser.picture}" alt="${currentUser.name}" style="width: 100%; height: 100%; border-radius: 8px;">`;
        } else {
            avatar.innerHTML = '<i class="fas fa-user"></i>';
        }
    } else {
        avatar.innerHTML = '<i class="fas fa-scale-balanced"></i>';
        avatar.style.background = 'linear-gradient(135deg, var(--secondary) 0%, #5e35b1 100%)';
    }
    const messageContent = document.createElement('div');
    messageContent.className = 'message-content';
    const messageText = document.createElement('div');
    messageText.className = 'message-text';
    if (isUser) {
        if (content) {
            messageText.innerHTML = content.replace(/\n/g, '<br>');
        }
        if (attachments && attachments.length > 0) {
            messageDiv.dataset.attachments = JSON.stringify(attachments.map(file => ({
                name: file.name,
                data: file.data,
                type: file.type
            })));
        }
        if (!fromHistory) {
            const controlsContainer = document.createElement('div');
            controlsContainer.className = 'user-message-controls';
            controlsContainer.innerHTML = `
                <button class="user-message-btn copy-btn" onclick="copyUserMessage('${messageId}')" title="Copy question">
                    <i class="fas fa-copy"></i>
                    <span class="hide-on-mobile">Copy</span>
                </button>
                <button class="user-message-btn edit-btn" onclick="editUserMessage('${messageId}')" title="Edit question">
                    <i class="fas fa-pencil-alt"></i>
                    <span class="hide-on-mobile">Edit</span>
                </button>
            `;
            messageContent.appendChild(controlsContainer);
        }
    } else {
        if (isDocument) {
            messageText.innerHTML = formatDocumentResponse(content);
        } else {
            messageText.innerHTML = formatLegalResponse(content);
        }
        if (sources && sources.length > 0 && !fromHistory) {
            setTimeout(() => {
                addResponseSources(messageId, { sources: sources, hasSources: true });
            }, 100);
        }
    }
    messageContent.appendChild(messageText);
    if (!isUser && !fromHistory) {
        const messageActions = document.createElement('div');
        messageActions.className = 'message-actions';
        messageActions.innerHTML = `
            <button class="action-btn copy" onclick="copyMessage(this)" title="Copy response">
                <i class="fas fa-copy"></i> Copy
            </button>
            <button class="action-btn regenerate" onclick="regenerateResponse('${messageId}')" title="Regenerate response">
                <i class="fas fa-sync-alt"></i> Regenerate
            </button>
            <button class="action-btn like" onclick="likeMessage(this)" title="Mark as helpful">
                <i class="far fa-thumbs-up"></i> Helpful
            </button>
            <button class="action-btn dislike" onclick="dislikeMessage(this)" title="Mark as not helpful">
                <i class="far fa-thumbs-down"></i> Not Helpful
            </button>
            <button class="action-btn share" onclick="shareResponse('${messageId}')" title="Share response">
                <i class="fas fa-share"></i> Share
            </button>
            <button class="action-btn document" onclick="downloadThisMessage('${messageId}')" title="Download document">
                <i class="fas fa-file-download"></i> Download
            </button>
        `;
        messageContent.appendChild(messageActions);
    }
    messageDiv.appendChild(avatar);
    messageDiv.appendChild(messageContent);
    if (chatMessages) chatMessages.appendChild(messageDiv);
    if (isUser && attachments && attachments.length > 0) {
        showAttachedFilesBelowUserMessage(messageId, attachments);
    }
    setTimeout(checkScrollPosition, 100);
    return messageId;
}

function showAttachedFilesBelowUserMessage(messageId, attachments) {
    const messageDiv = document.getElementById(messageId);
    if (!messageDiv || !attachments || attachments.length === 0) return;
    const messageContent = messageDiv.querySelector('.message-content');
    attachments.forEach((attachment, index) => {
        const fileContainer = document.createElement('div');
        fileContainer.className = 'attachment-item';
        fileContainer.style.maxWidth = '280px';
        fileContainer.style.marginTop = '8px';
        if (attachment.type.startsWith('image/')) {
            fileContainer.innerHTML = `
                <img src="${attachment.data}" alt="${attachment.name}" class="attachment-image" style="max-height: 130px;">
                <div class="attachment-name">${attachment.name}</div>
            `;
        } else if (attachment.type === 'application/pdf' || attachment.name.endsWith('.pdf')) {
            fileContainer.innerHTML = `
                <div style="padding: 15px; text-align: center; background: var(--dark-surface-light);">
                    <i class="fas fa-file-pdf" style="font-size: 1.8rem; color: var(--error);"></i>
                    <div class="attachment-name">${attachment.name}</div>
                    <div style="font-size: 0.65rem; color: var(--dark-text-secondary);">PDF Document</div>
                </div>
            `;
        } else if (attachment.type === 'text/plain' || attachment.name.endsWith('.txt')) {
            fileContainer.innerHTML = `
                <div style="padding: 12px; background: var(--dark-surface-light); border-radius: 8px;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <i class="fas fa-file-alt" style="font-size: 1.3rem; color: var(--primary);"></i>
                        <div style="flex: 1;">
                            <div class="attachment-name">${attachment.name}</div>
                            <div style="font-size: 0.65rem; color: var(--dark-text-secondary);">Text Document</div>
                        </div>
                    </div>
                    <button class="action-btn" style="width: 100%; padding: 6px;" onclick="showFileContent('${attachment.data}', '${attachment.name.replace(/'/g, "\\'")}')">
                        <i class="fas fa-eye"></i> Preview Content
                    </button>
                </div>
            `;
        } else {
            fileContainer.innerHTML = `
                <div style="padding: 15px; text-align: center; background: var(--dark-surface-light);">
                    <i class="fas fa-file" style="font-size: 1.8rem; color: var(--dark-text-secondary);"></i>
                    <div class="attachment-name">${attachment.name}</div>
                    <div style="font-size: 0.65rem; color: var(--dark-text-secondary);">${attachment.type || 'File'}</div>
                </div>
            `;
        }
        const messageText = messageContent.querySelector('.message-text');
        messageContent.insertBefore(fileContainer, messageText.nextSibling);
    });
}

// Make function globally accessible
window.showFileContent = async function(dataUrl, fileName) {
    try {
        const response = await fetch(dataUrl);
        const text = await response.text();
        const contentDiv = document.createElement('div');
        contentDiv.className = 'file-content-display';
        contentDiv.innerHTML = `
            <div class="file-content-header">
                <div class="file-content-title">
                    <i class="fas fa-file-alt"></i>
                    <span>${fileName}</span>
                </div>
                <button class="file-content-close" onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div style="max-height: 180px; overflow-y: auto; font-family: monospace; font-size: 0.75rem;">
                ${text.substring(0, 4000)}
                ${text.length > 4000 ? '<div style="color: var(--dark-text-secondary); margin-top: 8px;">... (content truncated)</div>' : ''}
            </div>
        `;
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
            chatMessages.appendChild(contentDiv);
            setTimeout(() => {
                contentDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }
    } catch (error) {
        console.error('Error reading file content:', error);
        showToast('Could not read file content 📄', 'error');
    }
};

window.regenerateResponse = function(messageId) {
    const messageDiv = document.getElementById(messageId);
    if (!messageDiv) return;
    const allMessages = document.querySelectorAll('.message');
    let userMessageContent = '';
    let userMessageId = '';
    for (let i = 0; i < allMessages.length; i++) {
        if (allMessages[i].id === messageId) {
            for (let j = i - 1; j >= 0; j--) {
                if (allMessages[j].classList.contains('user-message')) {
                    const userMessageText = allMessages[j].querySelector('.message-text');
                    if (userMessageText) {
                        userMessageContent = userMessageText.textContent;
                        userMessageId = allMessages[j].id;
                    }
                    break;
                }
            }
            break;
        }
    }
    if (userMessageContent) {
        const aiMessageIndex = conversationHistory.findIndex((msg, idx) => 
            msg.role === 'assistant' && idx > 0 && conversationHistory[idx-1].content === userMessageContent
        );
        if (aiMessageIndex !== -1) {
            conversationHistory.splice(aiMessageIndex, 1);
        }
        messageDiv.remove();
        const userInput = document.getElementById('userInput');
        if (userInput) {
            userInput.value = userMessageContent;
            userInput.focus();
            userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
            setTimeout(() => {
                sendMessage();
            }, 500);
            showToast('Regenerating response... 🔄', 'info');
        }
    }
};

window.dislikeMessage = function(button) {
    if (button) {
        button.innerHTML = '<i class="fas fa-thumbs-down"></i> Feedback Sent';
        button.style.background = 'var(--error)';
        button.style.borderColor = 'var(--error)';
        button.style.color = 'white';
        button.disabled = true;
        showToast('Thank you for your feedback! 👍', 'info');
    }
};

window.shareResponse = function(messageId) {
    const messageDiv = document.getElementById(messageId);
    if (!messageDiv) return;
    const messageText = messageDiv.querySelector('.message-text');
    const textToShare = messageText.textContent;
    if (navigator.share) {
        navigator.share({
            title: 'LegalSwami AI Response ⚖️',
            text: textToShare.substring(0, 100) + '...',
            url: window.location.href
        }).then(() => {
            showToast('Response shared successfully! 📤', 'success');
        }).catch(err => {
            console.error('Share failed:', err);
            copyToClipboard(textToShare);
        });
    } else {
        copyToClipboard(textToShare);
    }
};

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        showToast('Response copied to clipboard! 📋', 'success');
    }).catch(err => {
        console.error('Copy failed:', err);
        showToast('Failed to copy response ❌', 'error');
    });
}

window.copyUserMessage = function(messageId) {
    const messageDiv = document.getElementById(messageId);
    if (!messageDiv) return;
    const messageText = messageDiv.querySelector('.message-text');
    const textToCopy = messageText.textContent;
    navigator.clipboard.writeText(textToCopy).then(() => {
        showToast('Question copied to clipboard! 📋', 'success');
    }).catch(err => {
        console.error('Copy failed:', err);
        showToast('Failed to copy question ❌', 'error');
    });
};

window.editUserMessage = function(messageId) {
    const messageDiv = document.getElementById(messageId);
    if (!messageDiv) return;
    const messageText = messageDiv.querySelector('.message-text');
    const content = messageText.textContent;
    const userInput = document.getElementById('userInput');
    if (userInput) {
        userInput.value = content;
        userInput.focus();
        userInput.style.height = 'auto';
        userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
        const sendButton = document.getElementById('sendButton');
        if (sendButton) sendButton.disabled = false;
        showToast('Question loaded for editing. Press Ctrl+Enter to send. ✏️', 'info');
    }
};

// =============================================
// DOCUMENT AND RESPONSE FORMATTING
// =============================================

function formatDocumentResponse(text) {
    const documentContainer = document.createElement('div');
    documentContainer.className = 'document-template';
    const lines = text.split('\n');
    let htmlContent = '';
    lines.forEach(line => {
        if (line.trim() === '') return;
        if (line.toUpperCase() === line && line.length > 10 && !line.includes(':')) {
            htmlContent += `<div class="document-header">
                <h2 class="document-title">${line}</h2>
                <div class="document-subtitle">Legal Document Template ⚖️</div>
            </div>`;
        }
        else if (line.match(/^\d+\.\s+.+/) || line.match(/^[A-Z\s]+:$/)) {
            htmlContent += `<div class="document-section">
                <h3 class="document-section-title">${line}</h3>`;
        }
        else if (line.match(/^[a-z]\)\s+.+/)) {
            htmlContent += `<div class="document-clause">
                <div class="clause-title">${line}</div>`;
        }
        else {
            if (line.includes('___________________') || line.includes('________________')) {
                htmlContent += `<div class="clause-content" style="border-bottom: 1px solid var(--dark-border); padding-bottom: 4px; margin-bottom: 8px;">${line}</div>`;
            } else {
                htmlContent += `<div class="clause-content">${line}</div>`;
            }
        }
    });
    if (!text.includes('Signature') && !text.includes('Witness')) {
        htmlContent += `
            <div class="signature-section">
                <div class="signature-line">
                    <div class="signature-block">
                        <div class="signature-name"></div>
                        <div class="signature-label">Signature ✍️</div>
                    </div>
                    <div class="signature-block">
                        <div class="signature-name"></div>
                        <div class="signature-label">Date 📅</div>
                    </div>
                </div>
            </div>`;
    }
    htmlContent += `<div class="legal-note">
        <strong>Disclaimer:</strong> This template is for educational purposes only. Consult a qualified attorney before use. ⚖️
    </div>`;
    documentContainer.innerHTML = htmlContent;
    return documentContainer.outerHTML;
}

function formatLegalResponse(text) {
    let formatted = text
        .replace(/## (.*?)\n/g, '<h3>$1</h3>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/- (.*?)\n/g, '<li>$1</li>')
        .replace(/\n/g, '<br>');
    formatted = formatted.replace(/(<li>.*?<\/li>)/gs, function(match) {
        return '<ul>' + match + '</ul>';
    });
    if (formatted.includes('Disclaimer') || formatted.includes('अस्वीकरण') || formatted.includes('सूचना')) {
        formatted = formatted.replace(/(Disclaimer:.*?|अस्वीकरण:.*?|सूचना:.*?)(?=<br><br>|$)/is, 
            '<div class="legal-note">$1</div>');
    }
    const container = document.createElement('div');
    container.className = 'legal-content';
    container.innerHTML = formatted;
    return container.outerHTML;
}

function formatStreamingText(text) {
    const container = document.createElement('div');
    container.innerHTML = text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\n/g, '<br>');
    return container.innerHTML;
}

// =============================================
// STREAMING FUNCTIONS
// =============================================

function createStreamingMessage() {
    const chatMessages = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message ai-message';
    const messageId = 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    messageDiv.id = messageId;
    const avatar = document.createElement('div');
    avatar.className = 'avatar';
    avatar.innerHTML = '<i class="fas fa-scale-balanced"></i>';
    avatar.style.background = 'linear-gradient(135deg, var(--secondary) 0%, #5e35b1 100%)';
    const messageContent = document.createElement('div');
    messageContent.className = 'message-content';
    const messageText = document.createElement('div');
    messageText.className = 'message-text streaming-content';
    messageText.innerHTML = '<span class="streaming-cursor"></span>';
    messageContent.appendChild(messageText);
    messageDiv.appendChild(avatar);
    messageDiv.appendChild(messageContent);
    if (chatMessages) chatMessages.appendChild(messageDiv);
    currentStreamingMessageId = messageId;
    currentStreamingContent = '';
    currentStreamingBuffer = '';
    streamingTextChunks = [];
    streamingTextIndex = 0;
    const streamControls = document.createElement('div');
    streamControls.className = 'stream-controls';
    streamControls.innerHTML = `
        <button class="stream-control-btn pause-btn" id="pause-${messageId}" onclick="toggleStreamPause('${messageId}')">
            <i class="fas fa-pause"></i> Pause
        </button>
        <button class="stream-control-btn copy-btn" onclick="copyStreamedContent('${messageId}')">
            <i class="fas fa-copy"></i> Copy
        </button>
    `;
    messageContent.appendChild(streamControls);
    setTimeout(checkScrollPosition, 100);
    return messageId;
}

function startStreamingResponse(messageId, response, isDocument = false) {
    const messageDiv = document.getElementById(messageId);
    if (!messageDiv) return;
    let textToStream = response;
    streamingTextChunks = splitTextIntoChunks(textToStream);
    streamingTextIndex = 0;
    streamNextChunk(messageId, isDocument);
}

function splitTextIntoChunks(text) {
    const chunks = [];
    const regex = /[\s.,;!?।।॥]+|\S+/g;
    let match;
    while ((match = regex.exec(text)) !== null) {
        chunks.push(match[0]);
    }
    return chunks;
}

function streamNextChunk(messageId, isDocument = false) {
    if (stopStreamingRequested || streamingTextIndex >= streamingTextChunks.length) {
        if (stopStreamingRequested) {
            console.log('Streaming stopped by user');
        } else {
            finalizeStreamingMessage(messageId, isDocument);
        }
        return;
    }
    const chunk = streamingTextChunks[streamingTextIndex];
    streamingTextIndex++;
    updateStreamingMessage(messageId, chunk, isDocument);
    let delay = streamingWordDelay;
    if (chunk.match(/[.,;!?।।॥]/)) {
        delay += streamingPunctuationDelay;
    }
    if (chunk.match(/[.!?।।॥]/)) {
        delay += 150;
    }
    setTimeout(() => {
        if (!isStreamingPaused && !stopStreamingRequested) {
            streamNextChunk(messageId, isDocument);
        }
    }, delay);
}

window.toggleStreamPause = function(messageId) {
    isStreamingPaused = !isStreamingPaused;
    const pauseBtn = document.getElementById(`pause-${messageId}`);
    const messageDiv = document.getElementById(messageId);
    if (isStreamingPaused && pauseBtn) {
        pauseBtn.innerHTML = '<i class="fas fa-play"></i> Continue';
        pauseBtn.style.background = 'var(--success)';
        pauseBtn.style.borderColor = 'var(--success)';
        pauseBtn.style.color = 'white';
        const messageText = messageDiv.querySelector('.message-text');
        const existingIndicator = messageText.querySelector('.paused-indicator');
        if (!existingIndicator) {
            const indicator = document.createElement('span');
            indicator.className = 'paused-indicator';
            indicator.textContent = 'Paused';
            messageText.appendChild(indicator);
        }
        showToast('Response paused ⏸️', 'info');
    } else if (pauseBtn) {
        pauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
        pauseBtn.style.background = '';
        pauseBtn.style.borderColor = '';
        pauseBtn.style.color = '';
        const messageText = messageDiv.querySelector('.message-text');
        const existingIndicator = messageText.querySelector('.paused-indicator');
        if (existingIndicator) {
            existingIndicator.remove();
        }
        setTimeout(() => {
            streamNextChunk(messageId, isDocumentRequest(currentStreamingContent));
        }, 100);
        showToast('Response continued ▶️', 'success');
    }
};

window.copyStreamedContent = function(messageId) {
    const messageDiv = document.getElementById(messageId);
    if (!messageDiv) return;
    const messageText = messageDiv.querySelector('.message-text');
    const textToCopy = messageText.textContent.replace('Paused', '').trim();
    navigator.clipboard.writeText(textToCopy).then(() => {
        showToast('Copied to clipboard! 📋', 'success');
    }).catch(err => {
        console.error('Copy failed:', err);
        showToast('Failed to copy ❌', 'error');
    });
};

function updateStreamingMessage(messageId, newContent, isDocument = false) {
    const messageDiv = document.getElementById(messageId);
    if (!messageDiv) return;
    const messageText = messageDiv.querySelector('.message-text');
    currentStreamingBuffer += newContent;
    currentStreamingContent += newContent;
    if (isDocument) {
        messageText.innerHTML = formatDocumentResponse(currentStreamingContent) + '<span class="streaming-cursor"></span>';
    } else {
        messageText.innerHTML = formatStreamingText(currentStreamingBuffer) + '<span class="streaming-cursor"></span>';
    }
    checkScrollPosition();
}

function finalizeStreamingMessage(messageId, isDocument = false) {
    const messageDiv = document.getElementById(messageId);
    if (!messageDiv) return;
    const messageText = messageDiv.querySelector('.message-text');
    const cursor = messageText.querySelector('.streaming-cursor');
    if (cursor) cursor.remove();
    const pausedIndicator = messageText.querySelector('.paused-indicator');
    if (pausedIndicator) pausedIndicator.remove();
    if (isDocument) {
        messageText.innerHTML = formatDocumentResponse(currentStreamingContent);
        addDocumentDownloadButton(messageId, currentStreamingContent);
    } else {
        messageText.innerHTML = formatLegalResponse(currentStreamingContent);
    }
    const messageActions = document.createElement('div');
    messageActions.className = 'message-actions';
    messageActions.innerHTML = `
        <button class="action-btn copy" onclick="copyMessage(this)" title="Copy response">
            <i class="fas fa-copy"></i> Copy
        </button>
        <button class="action-btn regenerate" onclick="regenerateResponse('${messageId}')" title="Regenerate response">
            <i class="fas fa-sync-alt"></i> Regenerate
        </button>
        <button class="action-btn like" onclick="likeMessage(this)" title="Mark as helpful">
            <i class="far fa-thumbs-up"></i> Helpful
        </button>
        <button class="action-btn dislike" onclick="dislikeMessage(this)" title="Mark as not helpful">
            <i class="far fa-thumbs-down"></i> Not Helpful
        </button>
        <button class="action-btn share" onclick="shareResponse('${messageId}')" title="Share response">
            <i class="fas fa-share"></i> Share
        </button>
        <button class="action-btn document" onclick="downloadThisMessage('${messageId}')" title="Download document">
            <i class="fas fa-file-download"></i> Download
        </button>
    `;
    if (messageText && messageText.parentElement) {
        messageText.parentElement.appendChild(messageActions);
    }
    const streamControls = messageDiv.querySelector('.stream-controls');
    if (streamControls) {
        streamControls.remove();
    }
    if (attachedFiles.length > 0) {
        showAttachedFilesBelowResponse(messageId);
    }
    currentStreamingMessageId = null;
    currentStreamingContent = '';
    currentStreamingBuffer = '';
    streamingTextChunks = [];
    streamingTextIndex = 0;
    isStreamingPaused = false;
    isStreamingActive = false;
    stopStreamingRequested = false;
    const sendButton = document.getElementById('sendButton');
    const userInput = document.getElementById('userInput');
    if (sendButton && userInput) {
        sendButton.disabled = userInput.value.trim() === '' && attachedFiles.length === 0;
        sendButton.classList.remove('stop-button');
        sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> <span class="hide-on-mobile">Send</span>';
    }
}

function showAttachedFilesBelowResponse(messageId) {
    const messageDiv = document.getElementById(messageId);
    if (!messageDiv || attachedFiles.length === 0) return;
    const messageContent = messageDiv.querySelector('.message-content');
    const attachmentsContainer = document.createElement('div');
    attachmentsContainer.className = 'message-attachments';
    attachedFiles.forEach((attachment, index) => {
        const attachmentItem = document.createElement('div');
        attachmentItem.className = 'attachment-item';
        attachmentItem.innerHTML = `
            <img src="${attachment.data}" alt="${attachment.name}" class="attachment-image">
            <div class="attachment-name">${attachment.name}</div>
        `;
        attachmentsContainer.appendChild(attachmentItem);
    });
    const messageText = messageContent.querySelector('.message-text');
    messageContent.insertBefore(attachmentsContainer, messageText.nextSibling);
    clearAttachments();
}

function addDocumentDownloadButton(messageId, content) {
    const messageDiv = document.getElementById(messageId);
    if (!messageDiv) return;
    const messageContent = messageDiv.querySelector('.message-content');
    const existingBtn = messageContent.querySelector('.document-download-btn');
    if (existingBtn) return;
    const downloadBtn = document.createElement('button');
    downloadBtn.className = 'document-download-btn';
    downloadBtn.innerHTML = '<i class="fas fa-file-download"></i> Download Document';
    downloadBtn.title = 'Download this document template';
    downloadBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        openMessageDownloadModal(content);
    });
    messageContent.appendChild(downloadBtn);
}

window.copyMessage = function(button) {
    const messageText = button.closest('.message-content').querySelector('.message-text');
    let textToCopy = messageText.innerText || messageText.textContent;
    const textarea = document.createElement('textarea');
    textarea.value = textToCopy;
    textarea.style.position = 'fixed';
    textarea.style.opacity = '0';
    document.body.appendChild(textarea);
    textarea.select();
    textarea.setSelectionRange(0, 99999);
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showToast('Document copied to clipboard! 📋', 'success');
        } else {
            showToast('Failed to copy text ❌', 'error');
        }
    } catch (err) {
        console.error('Copy failed:', err);
        showToast('Failed to copy: ' + err, 'error');
    }
    document.body.removeChild(textarea);
};

window.likeMessage = function(button) {
    if (button) {
        button.innerHTML = '<i class="fas fa-thumbs-up"></i> Thank you!';
        button.style.background = 'var(--success)';
        button.style.borderColor = 'var(--success)';
        button.style.color = 'white';
        button.disabled = true;
        showToast('Thank you for your feedback! 👍', 'success');
    }
};

window.downloadThisMessage = function(messageId) {
    const messageDiv = document.getElementById(messageId);
    if (!messageDiv) return;
    const messageText = messageDiv.querySelector('.message-text');
    const content = messageText.innerText || messageText.textContent;
    openMessageDownloadModal(content);
};

// =============================================
// CHAT MANAGEMENT FUNCTIONS
// =============================================

function clearCurrentChat() {
    if (conversationHistory.length === 0 && attachedFiles.length === 0) {
        showToast('Chat is already empty 🗑️', 'warning');
        return;
    }
    if (confirm('Are you sure you want to clear the current chat?')) {
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) chatMessages.innerHTML = '';
        conversationHistory = [];
        clearAttachments();
        createNewChat();
        showToast('Current chat cleared 🗑️', 'success');
    }
}

function showSuggestions() {
    const suggestions = [
        "Create a non-disclosure agreement draft 📝",
        "I need an employment contract template 💼",
        "Generate a rental agreement for me 🏠",
        "Draft a loan agreement document 💰",
        "What are the essential elements of a valid contract? ⚖️"
    ];
    addMessageToChat(
        `<h3>Suggested Questions:</h3>
        <ul>
            ${suggestions.map(q => `<li style="cursor: pointer; padding: 6px; border-radius: 6px; transition: background 0.3s;" 
                onmouseover="this.style.background='var(--dark-surface-light)'" 
                onmouseout="this.style.background='transparent'"
                onclick="document.getElementById('userInput').value = '${q}'; document.getElementById('userInput').focus(); document.getElementById('userInput').style.height = Math.min(document.getElementById('userInput').scrollHeight, 180) + 'px'; document.getElementById('sendButton').disabled = false;">
                ${q}
            </li>`).join('')}
        </ul>
        <p>Click any question to add it to the input field. 👆</p>`,
        false
    );
}

function scrollToBottom() {
    const chatMessages = document.getElementById('chatMessages');
    if (chatMessages) {
        chatMessages.scrollTo({
            top: chatMessages.scrollHeight,
            behavior: 'smooth'
        });
        const scrollBtn = document.getElementById('scrollToBottomBtn');
        if (scrollBtn) scrollBtn.classList.remove('visible');
    }
}

function addCopyEditButtonsToUserMessages() {
    const userMessages = document.querySelectorAll('.user-message:not(.from-history) .message-content');
    userMessages.forEach((messageContent, index) => {
        if (!messageContent.querySelector('.user-message-controls')) {
            const messageDiv = messageContent.closest('.message');
            const messageId = messageDiv.id;
            const messageText = messageContent.querySelector('.message-text');
            if (messageText && messageText.textContent.trim()) {
                const controlsContainer = document.createElement('div');
                controlsContainer.className = 'user-message-controls';
                const copyBtn = document.createElement('button');
                copyBtn.className = 'user-message-btn copy-btn';
                copyBtn.title = 'Copy question';
                copyBtn.innerHTML = '<i class="fas fa-copy"></i><span class="hide-on-mobile">Copy</span>';
                copyBtn.addEventListener('click', () => copyUserMessage(messageId));
                const editBtn = document.createElement('button');
                editBtn.className = 'user-message-btn edit-btn';
                editBtn.title = 'Edit question';
                editBtn.innerHTML = '<i class="fas fa-pencil-alt"></i><span class="hide-on-mobile">Edit</span>';
                editBtn.addEventListener('click', () => editUserMessage(messageId));
                controlsContainer.appendChild(copyBtn);
                controlsContainer.appendChild(editBtn);
                messageContent.appendChild(controlsContainer);
            }
        }
    });
}

// =============================================
// THEME AND PREFERENCE FUNCTIONS
// =============================================

function loadThemePreference() {
    const savedTheme = localStorage.getItem('legalSwamiTheme');
    if (savedTheme === 'light') {
        document.body.classList.add('light-mode');
        const themeIcon = document.querySelector('.theme-toggle i');
        if (themeIcon) themeIcon.className = 'fas fa-moon';
        isLightMode = true;
    }
}

function toggleTheme() {
    const themeIcon = document.querySelector('.theme-toggle i');
    if (isLightMode) {
        document.body.classList.remove('light-mode');
        if (themeIcon) themeIcon.className = 'fas fa-sun';
        localStorage.setItem('legalSwamiTheme', 'dark');
        isLightMode = false;
    } else {
        document.body.classList.add('light-mode');
        if (themeIcon) themeIcon.className = 'fas fa-moon';
        localStorage.setItem('legalSwamiTheme', 'light');
        isLightMode = true;
    }
}

function createNewChat() {
    currentChatId = 'chat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    conversationHistory = [];
    const chatMessages = document.getElementById('chatMessages');
    if (chatMessages) {
        const welcomeContainer = document.createElement('div');
        welcomeContainer.innerHTML = WELCOME_MESSAGE_HTML;
        chatMessages.innerHTML = '';
        chatMessages.appendChild(welcomeContainer);
        addDraftTemplateListeners();
    }
    clearAttachments();
    loadHistoryList();
    showToast('New chat started 💬', 'success');
}

function toggleVoiceRecognition() {
    if (!recognition) return;
    if (isListening && !isInputMicrophoneActive) {
        recognition.stop();
    } else {
        isInputMicrophoneActive = false;
        recognition.start();
    }
}

function toggleInputVoiceRecognition() {
    if (!recognition) return;
    if (isListening && isInputMicrophoneActive) {
        recognition.stop();
    } else {
        isInputMicrophoneActive = true;
        recognition.start();
    }
}

function showLanguageHint(language) {
    const languageNames = {
        'english': 'English 🇬🇧',
        'hindi': 'Hindi 🇮🇳',
        'marathi': 'Marathi 🇮🇳',
        'tamil': 'Tamil 🇮🇳',
        'telugu': 'Telugu 🇮🇳',
        'kannada': 'Kannada 🇮🇳',
        'punjabi': 'Punjabi 🇮🇳',
        'gujarati': 'Gujarati 🇮🇳',
        'bengali': 'Bengali 🇮🇳'
    };
    let hintElement = document.querySelector('.language-hint');
    if (!hintElement) {
        hintElement = document.createElement('div');
        hintElement.className = 'language-hint';
        const inputArea = document.querySelector('.input-area');
        if (inputArea) inputArea.appendChild(hintElement);
    }
    hintElement.textContent = `Detected: ${languageNames[language] || 'English 🇬🇧'}`;
    hintElement.style.display = 'block';
}

function hideLanguageHint() {
    const hintElement = document.querySelector('.language-hint');
    if (hintElement) {
        hintElement.style.display = 'none';
    }
}

function adjustChatLayout() {
    const chatMessages = document.getElementById('chatMessages');
    if (chatMessages) {
        setTimeout(() => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }, 100);
    }
}

function clearAttachments() {
    attachedFiles = [];
    const preview = document.getElementById('attachmentsPreview');
    if (preview) {
        preview.innerHTML = '';
        preview.style.display = 'none';
    }
}

// =============================================
// FILE UPLOAD FUNCTIONS
// =============================================

function openFileUploadModal() {
    const fileUploadModal = document.getElementById('fileUploadModal');
    if (fileUploadModal) fileUploadModal.classList.add('active');
    selectedFiles = [];
    updateUploadedFilesDisplay();
}

function updateUploadedFilesDisplay() {
    const container = document.getElementById('uploadedFiles');
    if (!container) return;
    container.innerHTML = '';
    selectedFiles.forEach((file, index) => {
        const item = document.createElement('div');
        item.className = 'uploaded-image-item';
        if (file.type.startsWith('image/')) {
            item.innerHTML = `
                <img src="${file.data}" alt="${file.name}" class="uploaded-image-preview">
                <button class="remove-uploaded-image" onclick="removeUploadedFile(${index})">
                    <i class="fas fa-times"></i>
                </button>
            `;
        } else if (file.type === 'application/pdf' || file.name.endsWith('.pdf')) {
            item.innerHTML = `
                <div style="padding: 12px; text-align: center; background: var(--dark-surface-light); height: 90px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <i class="fas fa-file-pdf" style="font-size: 1.8rem; color: var(--error); margin-bottom: 6px;"></i>
                    <div style="font-size: 0.65rem; color: var(--dark-text-secondary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 100%;">${file.name}</div>
                </div>
                <button class="remove-uploaded-image" onclick="removeUploadedFile(${index})">
                    <i class="fas fa-times"></i>
                </button>
            `;
        } else if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
            item.innerHTML = `
                <div style="padding: 12px; text-align: center; background: var(--dark-surface-light); height: 90px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <i class="fas fa-file-alt" style="font-size: 1.8rem; color: var(--primary); margin-bottom: 6px;"></i>
                    <div style="font-size: 0.65rem; color: var(--dark-text-secondary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 100%;">${file.name}</div>
                </div>
                <button class="remove-uploaded-image" onclick="removeUploadedFile(${index})">
                    <i class="fas fa-times"></i>
                </button>
            `;
        } else {
            item.innerHTML = `
                <div style="padding: 12px; text-align: center; background: var(--dark-surface-light); height: 90px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <i class="fas fa-file" style="font-size: 1.8rem; color: var(--dark-text-secondary); margin-bottom: 6px;"></i>
                    <div style="font-size: 0.65rem; color: var(--dark-text-secondary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 100%;">${file.name}</div>
                </div>
                <button class="remove-uploaded-image" onclick="removeUploadedFile(${index})">
                    <i class="fas fa-times"></i>
                </button>
            `;
        }
        container.appendChild(item);
    });
}

window.removeUploadedFile = function(index) {
    selectedFiles.splice(index, 1);
    updateUploadedFilesDisplay();
};

// =============================================
// HISTORY LIST FUNCTIONS
// =============================================

function loadHistoryList() {
    const historyList = document.getElementById('historyList');
    if (!historyList) return;
    if (chatHistory.length === 0) {
        historyList.innerHTML = `
            <div class="empty-history">
                <i class="fas fa-comments"></i>
                <p>No chat history yet</p>
                <p style="font-size: 0.75rem; margin-top: 0.4rem;">Start a conversation to see it here</p>
            </div>
        `;
        return;
    }
    let html = '';
    chatHistory.forEach(chat => {
        const isActive = chat.id === currentChatId;
        const date = new Date(chat.date);
        const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        html += `
            <div class="history-item ${isActive ? 'active' : ''}" data-chat-id="${chat.id}">
                <div class="history-title">${chat.title}</div>
                <div class="history-preview">${chat.preview}</div>
                <div class="history-date">${formattedDate}</div>
                <div class="history-item-actions">
                    <button class="history-item-btn download" onclick="downloadChatHistory('${chat.id}')" title="Download chat">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="history-item-btn delete" onclick="confirmDeleteChat('${chat.id}')" title="Delete chat">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `;
    });
    historyList.innerHTML = html;
    document.querySelectorAll('.history-item').forEach(item => {
        item.addEventListener('click', function(e) {
            if (!e.target.closest('.history-item-actions')) {
                const chatId = this.dataset.chatId;
                loadChatFromHistory(chatId);
            }
        });
    });
}

function loadChatFromHistory(chatId) {
    const chat = chatHistory.find(c => c.id === chatId);
    if (!chat) return;
    currentChatId = chatId;
    conversationHistory = [...chat.messages];
    const chatMessages = document.getElementById('chatMessages');
    if (chatMessages) {
        chatMessages.innerHTML = '';
        chat.messages.forEach(msg => {
            const isDocument = msg.isDocument || false;
            const hasSources = msg.sources && msg.sources.length > 0;
            addMessageToChat(msg.content, msg.role === 'user', true, isDocument, msg.attachments || [], hasSources ? msg.sources : null);
        });
    }
    loadHistoryList();
    if (window.innerWidth < 1024) {
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        if (sidebar) sidebar.classList.remove('active');
        if (sidebarOverlay) sidebarOverlay.classList.remove('active');
        document.body.style.overflow = '';
    }
    showToast('Chat loaded from history 📚', 'success');
}

window.downloadChatHistory = function(chatId) {
    const chat = chatHistory.find(c => c.id === chatId);
    if (!chat) return;
    let content = `LegalSwami Chat History - ${chat.title}\n`;
    content += `Date: ${new Date(chat.date).toLocaleString()}\n\n`;
    content += '='.repeat(50) + '\n\n';
    chat.messages.forEach((msg, index) => {
        const role = msg.role === 'user' ? 'You' : 'LegalSwami';
        const time = msg.timestamp ? new Date(msg.timestamp).toLocaleTimeString() : new Date().toLocaleTimeString();
        content += `${role} (${time}):\n`;
        content += msg.content + '\n\n';
        content += '-'.repeat(30) + '\n\n';
    });
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `legalswami-chat-${chatId}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showDownloadNotification(`legalswami-chat-${chatId}.txt`, 'Text File');
    showToast('Chat history downloaded 📥', 'success');
};

window.confirmDeleteChat = function(chatId) {
    const chat = chatHistory.find(c => c.id === chatId);
    if (!chat) return;
    const deleteChatTitle = document.getElementById('deleteChatTitle');
    if (deleteChatTitle) deleteChatTitle.textContent = `Delete "${chat.title}"?`;
    const deleteModal = document.getElementById('deleteModal');
    if (deleteModal) {
        deleteModal.dataset.chatId = chatId;
        deleteModal.classList.add('active');
    }
};

// =============================================
// MODAL FUNCTIONS
// =============================================

function openDownloadModal() {
    const downloadModal = document.getElementById('downloadModal');
    if (downloadModal) downloadModal.classList.add('active');
}

function openMessageDownloadModal(content) {
    messageContentForDownload = content;
    const messageDownloadModal = document.getElementById('messageDownloadModal');
    if (messageDownloadModal) messageDownloadModal.classList.add('active');
}

// =============================================
// DOWNLOAD FUNCTIONS
// =============================================

function downloadMessage(format, content) {
    const indicator = document.getElementById('messageProgressIndicator');
    if (indicator) indicator.classList.add('active');
    setTimeout(() => {
        const fileName = `LegalSwami-Document-${formatDateForFilename(new Date())}`;
        switch(format) {
            case 'pdf':
                downloadAsPDF(content, fileName);
                break;
            case 'doc':
                downloadAsDOC(content, fileName);
                break;
            case 'txt':
                downloadAsTXT(content, fileName);
                break;
        }
        if (indicator) indicator.classList.remove('active');
        const messageDownloadModal = document.getElementById('messageDownloadModal');
        if (messageDownloadModal) messageDownloadModal.classList.remove('active');
    }, 500);
}

function downloadChat(format) {
    const indicator = document.getElementById('progressIndicator');
    if (indicator) indicator.classList.add('active');
    setTimeout(() => {
        let content = '';
        conversationHistory.forEach((msg, index) => {
            const role = msg.role === 'user' ? 'You' : 'LegalSwami';
            const time = msg.timestamp ? new Date(msg.timestamp).toLocaleTimeString() : new Date().toLocaleTimeString();
            content += `${role} (${time}):\n${msg.content}\n\n`;
        });
        const fileName = `LegalSwami-Chat-${formatDateForFilename(new Date())}`;
        switch(format) {
            case 'pdf':
                downloadAsPDF(content, fileName);
                break;
            case 'doc':
                downloadAsDOC(content, fileName);
                break;
            case 'txt':
                downloadAsTXT(content, fileName);
                break;
        }
        if (indicator) indicator.classList.remove('active');
        const downloadModal = document.getElementById('downloadModal');
        if (downloadModal) downloadModal.classList.remove('active');
    }, 500);
}

function downloadAsPDF(content, filename) {
    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const lines = doc.splitTextToSize(content, 180);
        doc.setFontSize(12);
        doc.text(lines, 10, 20);
        doc.setFontSize(10);
        doc.text('Generated by LegalSwami AI Assistant ⚖️', 10, 280);
        const blob = doc.output('blob');
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${filename}.pdf`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        lastDownloadedFileUrl = url;
        lastDownloadedFileName = `${filename}.pdf`;
        showDownloadNotification(`${filename}.pdf`, 'PDF Document');
        showToast('PDF downloaded successfully 📥', 'success');
    } catch (error) {
        console.error('PDF generation error:', error);
        showToast('PDF download failed. Using fallback. 📄', 'warning');
        downloadAsTXT(content, filename);
    }
}

function downloadAsDOC(content, filename) {
    const htmlContent = `
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>${filename}</title>
            <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; margin: 40px; }
                h1 { color: #10a37f; }
                .timestamp { color: #666; font-size: 0.9em; }
                .user { color: #10a37f; font-weight: bold; }
                .ai { color: #7e57c2; font-weight: bold; }
                .disclaimer { 
                    background-color: #f8f9fa; 
                    border-left: 4px solid #f59e0b;
                    padding: 10px;
                    margin-top: 20px;
                    font-size: 0.9em;
                }
            </style>
        </head>
        <body>
            <h1>${filename} ⚖️</h1>
            <p class="timestamp">Generated on: ${new Date().toLocaleString()}</p>
            <hr>
            <pre style="white-space: pre-wrap; font-family: inherit;">${content}</pre>
            <div class="disclaimer">
                <strong>Disclaimer:</strong> This document is generated by LegalSwami AI Assistant for informational purposes only and does not constitute legal advice. ⚖️
            </div>
        </body>
        </html>
    `;
    const blob = new Blob([htmlContent], { type: 'application/msword' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${filename}.doc`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    lastDownloadedFileUrl = url;
    lastDownloadedFileName = `${filename}.doc`;
    showDownloadNotification(`${filename}.doc`, 'Word Document');
    showToast('Word document downloaded 📥', 'success');
}

function downloadAsTXT(content, filename) {
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${filename}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    lastDownloadedFileUrl = url;
    lastDownloadedFileName = `${filename}.txt`;
    showDownloadNotification(`${filename}.txt`, 'Text File');
    showToast('Text file downloaded 📥', 'success');
}

function formatDateForFilename(date) {
    return date.toISOString()
        .replace(/[:\-]/g, '')
        .replace('T', '_')
        .split('.')[0];
}

// =============================================
// TOAST NOTIFICATION
// =============================================

function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toast-message');
    if (toast && toastMessage) {
        toastMessage.textContent = message;
        toast.className = `toast ${type} show`;
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }
}

// =============================================
// MOCK RESPONSE GENERATOR
// =============================================

async function generateMockResponse(message) {
    const isDoc = isDocumentRequest(message);
    
    if (isDoc) {
        const templates = {
            nda: `NON-DISCLOSURE AGREEMENT

This Non-Disclosure Agreement is entered into on [DATE]

BETWEEN:
Party A: [NAME]
Party B: [NAME]

1. CONFIDENTIAL INFORMATION
   - All information disclosed shall remain confidential
   
2. OBLIGATIONS
   - Not to disclose to third parties
   - Use only for stated purposes

3. TERM
   - Valid for [X] years

___________________                    ___________________
Party A Signature                      Party B Signature

Disclaimer: Template for reference only. Consult a lawyer. ⚖️`,
            
            rental: `RENTAL AGREEMENT

Date: [DATE]

LANDLORD: [NAME]
TENANT: [NAME]
PROPERTY: [ADDRESS]

TERMS:
- Monthly Rent: ₹[AMOUNT]
- Security Deposit: ₹[AMOUNT]
- Duration: [X] months

___________________                    ___________________
Landlord                               Tenant

Disclaimer: Get this reviewed by a lawyer before signing. ⚖️`,
            
            default: `LEGAL DOCUMENT TEMPLATE

[TITLE]

PARTIES:
1. [NAME]
2. [NAME]

TERMS:
1. [TERM 1]
2. [TERM 2]

___________________
Signatures

Disclaimer: Consult a qualified attorney before use. ⚖️`
        };
        
        let template = templates.default;
        if (message.toLowerCase().includes('nda')) template = templates.nda;
        if (message.toLowerCase().includes('rental')) template = templates.rental;
        
        return {
            response: template,
            content: template,
            isDocument: true
        };
    }
    
    const response = `**Legal Information**

Based on your query: "${message.substring(0, 100)}..."

In India, legal matters require proper understanding of:

1. **Applicable Laws**: Identify relevant statutes
2. **Jurisdiction**: Determine appropriate authority
3. **Documentation**: Maintain proper records
4. **Time Limits**: Be aware of limitation periods
5. **Professional Advice**: Consult a qualified lawyer

**Disclaimer**: This is AI-generated general information, not legal advice. Always consult a licensed attorney. ⚖️`;
    
    return {
        response: response,
        content: response,
        isDocument: false
    };
}

// =============================================
// STOP STREAMING FUNCTION
// =============================================

function stopStreaming() {
    stopStreamingRequested = true;
    isStreamingActive = false;
    isStreamingPaused = false;
    
    const sendButton = document.getElementById('sendButton');
    const userInput = document.getElementById('userInput');
    
    if (sendButton && userInput) {
        sendButton.disabled = userInput.value.trim() === '' && attachedFiles.length === 0;
        sendButton.classList.remove('stop-button');
        sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> <span class="hide-on-mobile">Send</span>';
    }
    
    if (currentStreamingMessageId) {
        const messageDiv = document.getElementById(currentStreamingMessageId);
        if (messageDiv) {
            const messageText = messageDiv.querySelector('.message-text');
            const streamControls = messageDiv.querySelector('.stream-controls');
            
            if (streamControls) {
                streamControls.remove();
            }
            
            const messageActions = document.createElement('div');
            messageActions.className = 'message-actions';
            messageActions.innerHTML = `
                <button class="action-btn copy" onclick="copyMessage(this)" title="Copy response">
                    <i class="fas fa-copy"></i> Copy
                </button>
                <button class="action-btn regenerate" onclick="regenerateResponse('${currentStreamingMessageId}')" title="Regenerate response">
                    <i class="fas fa-sync-alt"></i> Regenerate
                </button>
                <button class="action-btn like" onclick="likeMessage(this)" title="Mark as helpful">
                    <i class="far fa-thumbs-up"></i> Helpful
                </button>
                <button class="action-btn dislike" onclick="dislikeMessage(this)" title="Mark as not helpful">
                    <i class="far fa-thumbs-down"></i> Not Helpful
                </button>
                <button class="action-btn share" onclick="shareResponse('${currentStreamingMessageId}')" title="Share response">
                    <i class="fas fa-share"></i> Share
                </button>
                <button class="action-btn document" onclick="downloadThisMessage('${currentStreamingMessageId}')" title="Download document">
                    <i class="fas fa-file-download"></i> Download
                </button>
            `;
            
            if (messageText && messageText.parentElement) {
                messageText.parentElement.appendChild(messageActions);
            }
            
            const cursor = messageText ? messageText.querySelector('.streaming-cursor') : null;
            if (cursor) cursor.remove();
            
            const pausedIndicator = messageText ? messageText.querySelector('.paused-indicator') : null;
            if (pausedIndicator) pausedIndicator.remove();
            
            if (messageText) {
                if (isDocumentRequest(currentStreamingContent)) {
                    messageText.innerHTML = formatDocumentResponse(currentStreamingContent);
                    addDocumentDownloadButton(currentStreamingMessageId, currentStreamingContent);
                } else {
                    messageText.innerHTML = formatLegalResponse(currentStreamingContent);
                }
            }
        }
        
        currentStreamingMessageId = null;
        currentStreamingContent = '';
        currentStreamingBuffer = '';
        streamingTextChunks = [];
        streamingTextIndex = 0;
    }
    
    showToast('Response stopped ⏹️', 'info');
}

// =============================================
// SETUP EVENT LISTENERS
// =============================================




// Setup file upload modal event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Close file upload modal
    const closeFileUploadModal = document.getElementById('closeFileUploadModal');
    if (closeFileUploadModal) {
        closeFileUploadModal.addEventListener('click', function() {
            const fileUploadModal = document.getElementById('fileUploadModal');
            if (fileUploadModal) fileUploadModal.classList.remove('active');
        });
    }

    // Cancel file upload
    const cancelFileUpload = document.getElementById('cancelFileUpload');
    if (cancelFileUpload) {
        cancelFileUpload.addEventListener('click', function() {
            const fileUploadModal = document.getElementById('fileUploadModal');
            if (fileUploadModal) fileUploadModal.classList.remove('active');
            selectedFiles = [];
        });
    }

    // Browse files button
    const browseFilesBtn = document.getElementById('browseFilesBtn');
    if (browseFilesBtn) {
        browseFilesBtn.addEventListener('click', function() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.multiple = true;
            fileInput.accept = 'image/*,.pdf,.txt,.doc,.docx';
            
            fileInput.addEventListener('change', function(e) {
                if (e.target.files) {
                    Array.from(e.target.files).forEach(file => {
                        if (file.size > 10 * 1024 * 1024) { // 10MB limit
                            showToast(`File ${file.name} is too large (max 10MB) ❌`, 'warning');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            selectedFiles.push({
                                name: file.name,
                                type: file.type,
                                size: file.size,
                                data: event.target.result,
                                file: file
                            });
                            updateUploadedFilesDisplay();
                        };
                        
                        if (file.type.startsWith('image/')) {
                            reader.readAsDataURL(file);
                        } else if (file.type === 'application/pdf' || 
                                   file.name.endsWith('.pdf') ||
                                   file.type === 'text/plain' || 
                                   file.name.endsWith('.txt') ||
                                   file.type.includes('document')) {
                            reader.readAsDataURL(file);
                        } else {
                            showToast(`File type ${file.type} not supported ❌`, 'warning');
                        }
                    });
                }
            });
            
            fileInput.click();
        });
    }

    // Drag and drop file upload
    const uploadArea = document.getElementById('uploadArea');
    if (uploadArea) {
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            if (e.dataTransfer.files) {
                Array.from(e.dataTransfer.files).forEach(file => {
                    if (file.size > 10 * 1024 * 1024) { // 10MB limit
                        showToast(`File ${file.name} is too large (max 10MB) ❌`, 'warning');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        selectedFiles.push({
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            data: event.target.result,
                            file: file
                        });
                        updateUploadedFilesDisplay();
                    };
                    
                    if (file.type.startsWith('image/')) {
                        reader.readAsDataURL(file);
                    } else if (file.type === 'application/pdf' || 
                               file.name.endsWith('.pdf') ||
                               file.type === 'text/plain' || 
                               file.name.endsWith('.txt') ||
                               file.type.includes('document')) {
                        reader.readAsDataURL(file);
                    } else {
                        showToast(`File type ${file.type} not supported ❌`, 'warning');
                    }
                });
            }
        });
        
        // Click to upload
        uploadArea.addEventListener('click', function() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.multiple = true;
            fileInput.accept = 'image/*,.pdf,.txt,.doc,.docx';
            
            fileInput.addEventListener('change', function(e) {
                if (e.target.files) {
                    Array.from(e.target.files).forEach(file => {
                        if (file.size > 10 * 1024 * 1024) { // 10MB limit
                            showToast(`File ${file.name} is too large (max 10MB) ❌`, 'warning');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            selectedFiles.push({
                                name: file.name,
                                type: file.type,
                                size: file.size,
                                data: event.target.result,
                                file: file
                            });
                            updateUploadedFilesDisplay();
                        };
                        
                        if (file.type.startsWith('image/')) {
                            reader.readAsDataURL(file);
                        } else if (file.type === 'application/pdf' || 
                                   file.name.endsWith('.pdf') ||
                                   file.type === 'text/plain' || 
                                   file.name.endsWith('.txt') ||
                                   file.type.includes('document')) {
                            reader.readAsDataURL(file);
                        } else {
                            showToast(`File type ${file.type} not supported ❌`, 'warning');
                        }
                    });
                }
            });
            
            fileInput.click();
        });
    }

    // Confirm file upload
    const confirmFileUpload = document.getElementById('confirmFileUpload');
    if (confirmFileUpload) {
        confirmFileUpload.addEventListener('click', function() {
            if (selectedFiles.length === 0) {
                showToast('No files selected 📁', 'warning');
                return;
            }
            
            attachedFiles = [...selectedFiles];
            selectedFiles = [];
            
            // Update attachments preview
            const preview = document.getElementById('attachmentsPreview');
            if (preview) {
                preview.innerHTML = '';
                attachedFiles.forEach((file, index) => {
                    const item = document.createElement('div');
                    item.className = 'attachment-preview-item';
                    
                    if (file.type.startsWith('image/')) {
                        item.innerHTML = `
                            <img src="${file.data}" alt="${file.name}" class="attachment-preview-image">
                            <div class="attachment-preview-name">${file.name}</div>
                            <button class="remove-attachment" onclick="removeAttachedFile(${index})">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    } else if (file.type === 'application/pdf' || file.name.endsWith('.pdf')) {
                        item.innerHTML = `
                            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: var(--error); padding: 5px;">
                                <i class="fas fa-file-pdf" style="font-size: 1.2rem; color: white; margin-bottom: 3px;"></i>
                                <div class="attachment-preview-name" style="color: white; font-size: 0.55rem;">PDF</div>
                            </div>
                            <div class="attachment-preview-name">${file.name.substring(0, 8)}...</div>
                            <button class="remove-attachment" onclick="removeAttachedFile(${index})">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    } else if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                        item.innerHTML = `
                            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: var(--primary); padding: 5px;">
                                <i class="fas fa-file-alt" style="font-size: 1.2rem; color: white; margin-bottom: 3px;"></i>
                                <div class="attachment-preview-name" style="color: white; font-size: 0.55rem;">TXT</div>
                            </div>
                            <div class="attachment-preview-name">${file.name.substring(0, 8)}...</div>
                            <button class="remove-attachment" onclick="removeAttachedFile(${index})">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    } else {
                        item.innerHTML = `
                            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: var(--dark-surface-light); padding: 5px;">
                                <i class="fas fa-file" style="font-size: 1.2rem; color: var(--dark-text-secondary); margin-bottom: 3px;"></i>
                                <div class="attachment-preview-name" style="color: var(--dark-text-secondary); font-size: 0.55rem;">FILE</div>
                            </div>
                            <div class="attachment-preview-name">${file.name.substring(0, 8)}...</div>
                            <button class="remove-attachment" onclick="removeAttachedFile(${index})">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    }
                    
                    preview.appendChild(item);
                });
                preview.style.display = 'flex';
            }
            
            const fileUploadModal = document.getElementById('fileUploadModal');
            if (fileUploadModal) fileUploadModal.classList.remove('active');
            
            const userInput = document.getElementById('userInput');
            const sendButton = document.getElementById('sendButton');
            if (userInput && sendButton) {
                sendButton.disabled = userInput.value.trim() === '' && attachedFiles.length === 0;
            }
            
            showToast(`${attachedFiles.length} file(s) attached 📎`, 'success');
        });
    }

    // Download modal options
    const downloadOptions = document.querySelectorAll('.download-option');
    downloadOptions.forEach(option => {
        option.addEventListener('click', function() {
            const format = this.dataset.format;
            if (this.closest('#downloadModal')) {
                downloadChat(format);
            } else if (this.closest('#messageDownloadModal')) {
                downloadMessage(format, messageContentForDownload);
            }
        });
    });

    // Close download modal
    const closeDownloadModal = document.getElementById('closeDownloadModal');
    if (closeDownloadModal) {
        closeDownloadModal.addEventListener('click', function() {
            const downloadModal = document.getElementById('downloadModal');
            if (downloadModal) downloadModal.classList.remove('active');
        });
    }

    // Close message download modal
    const closeMessageDownloadModal = document.getElementById('closeMessageDownloadModal');
    if (closeMessageDownloadModal) {
        closeMessageDownloadModal.addEventListener('click', function() {
            const messageDownloadModal = document.getElementById('messageDownloadModal');
            if (messageDownloadModal) messageDownloadModal.classList.remove('active');
        });
    }

    // Delete modal buttons
    const closeDeleteModal = document.getElementById('closeDeleteModal');
    if (closeDeleteModal) {
        closeDeleteModal.addEventListener('click', function() {
            const deleteModal = document.getElementById('deleteModal');
            if (deleteModal) deleteModal.classList.remove('active');
        });
    }

    const cancelDelete = document.getElementById('cancelDelete');
    if (cancelDelete) {
        cancelDelete.addEventListener('click', function() {
            const deleteModal = document.getElementById('deleteModal');
            if (deleteModal) deleteModal.classList.remove('active');
        });
    }

    const confirmDelete = document.getElementById('confirmDelete');
    if (confirmDelete) {
        confirmDelete.addEventListener('click', function() {
            const deleteModal = document.getElementById('deleteModal');
            const chatId = deleteModal ? deleteModal.dataset.chatId : null;
            
            if (chatId) {
                const index = chatHistory.findIndex(chat => chat.id === chatId);
                if (index !== -1) {
                    // If deleting current chat, create new one
                    if (currentChatId === chatId) {
                        createNewChat();
                    }
                    
                    chatHistory.splice(index, 1);
                    saveUserChatHistory();
                    loadHistoryList();
                    showToast('Chat deleted permanently 🗑️', 'success');
                }
            }
            
            if (deleteModal) deleteModal.classList.remove('active');
        });
    }

    // Emoji picker button
    const emojiPickerBtn = document.getElementById('emojiPickerBtn');
    if (emojiPickerBtn) {
        emojiPickerBtn.addEventListener('click', function() {
            const userInput = document.getElementById('userInput');
            if (userInput) {
                const emojis = ['⚖️', '📝', '🔍', '💼', '🏠', '💰', '👨‍👩‍👧', '⚡', '📚', '🔐'];
                const emoji = emojis[Math.floor(Math.random() * emojis.length)];
                const cursorPos = userInput.selectionStart;
                const textBefore = userInput.value.substring(0, cursorPos);
                const textAfter = userInput.value.substring(cursorPos);
                userInput.value = textBefore + emoji + textAfter;
                userInput.focus();
                userInput.selectionStart = cursorPos + emoji.length;
                userInput.selectionEnd = cursorPos + emoji.length;
                userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
                
                const sendButton = document.getElementById('sendButton');
                if (sendButton) sendButton.disabled = false;
            }
        });
    }

    // Initialize app for guest
    setTimeout(() => {
        initializeAppForGuest();
        
        // Show loading screen briefly
        const loadingScreen = document.getElementById('loadingScreen');
        if (loadingScreen) {
            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 1500);
        }
    }, 500);

    // Back to top button
    const backToTopBtn = document.getElementById('backToTop');
    if (backToTopBtn) {
        backToTopBtn.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                backToTopBtn.style.display = 'flex';
            } else {
                backToTopBtn.style.display = 'none';
            }
        });
    }

    // Smooth scrolling for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            if (this.getAttribute('href') === '#') return;
            
            e.preventDefault();
            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            
            if (targetElement) {
                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                this.classList.add('active');
                
                // Scroll to target
                window.scrollTo({
                    top: targetElement.offsetTop - 80,
                    behavior: 'smooth'
                });
                
                // Close mobile menu if open
                if (isMobileMenuOpen) {
                    const mobileMenu = document.getElementById('mobileMenu');
                    if (mobileMenu) mobileMenu.style.display = 'none';
                    isMobileMenuOpen = false;
                }
            }
        });
    });

    // Mobile menu toggle
    const mobileToggle = document.getElementById('mobileToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    const mobileClose = document.getElementById('mobileClose');
    const mobileStartChat = document.getElementById('mobileStartChat');
    
    if (mobileToggle && mobileMenu) {
        mobileToggle.addEventListener('click', function() {
            mobileMenu.style.display = 'block';
            isMobileMenuOpen = true;
        });
    }
    
    if (mobileClose && mobileMenu) {
        mobileClose.addEventListener('click', function() {
            mobileMenu.style.display = 'none';
            isMobileMenuOpen = false;
        });
    }
    
    if (mobileStartChat) {
        mobileStartChat.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            openChat();
            
            // Close mobile menu
            const mobileMenu = document.getElementById('mobileMenu');
            if (mobileMenu) {
                mobileMenu.style.display = 'none';
            }
        });
    }

    // Start chat buttons - नए function का उपयोग करें
	const startChatBtn = document.getElementById('startChatBtn');
    if (startChatBtn) {
        startChatBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log("Start Chat button clicked");
            openChat();
        });
    }

const ctaStartChat = document.getElementById('ctaStartChat');
    if (ctaStartChat) {
        ctaStartChat.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log("CTA Start Chat button clicked");
            openChat();
        });
    }

// Back to home button - नए function का उपयोग करें
const backToHomeBtn = document.getElementById('backToHomeBtn');
if (backToHomeBtn) {
        backToHomeBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            closeChat();
        });
    }
    // Login buttons
    const headerLoginBtn = document.getElementById('headerLoginBtn');
    if (headerLoginBtn) {
        headerLoginBtn.addEventListener('click', function() {
            const loginModal = document.getElementById('loginModal');
            if (loginModal) loginModal.classList.add('active');
            isLoginModalOpen = true;
        });
    }

    // Close login modal
    const closeLoginModal = document.getElementById('closeLoginModal');
    if (closeLoginModal) {
        closeLoginModal.addEventListener('click', function() {
            const loginModal = document.getElementById('loginModal');
            if (loginModal) loginModal.classList.remove('active');
            isLoginModalOpen = false;
        });
    }

    // Demo login
    const demoLoginBtn = document.getElementById('demoLoginBtn');
    if (demoLoginBtn) {
        demoLoginBtn.addEventListener('click', function() {
            currentUser = {
                id: 'demo_' + Date.now(),
                name: 'Demo User',
                email: 'demo@legalswami.com',
                isGuest: true,
                picture: null
            };
            isLoggedIn = true;
            updateUserUI();
            
            const loginModal = document.getElementById('loginModal');
            if (loginModal) loginModal.classList.remove('active');
            isLoginModalOpen = false;
            
            showToast('Welcome to Demo Mode! You have full access. 🎉', 'success');
        });
    }

    // Custom Google login button
    const customGoogleBtn = document.getElementById('customGoogleBtn');
    if (customGoogleBtn) {
        customGoogleBtn.addEventListener('click', function() {
            showToast('Google login coming soon! 👨‍💻', 'info');
        });
    }

    // Home logout button
    const homeLogoutBtn = document.getElementById('homeLogoutBtn');
    if (homeLogoutBtn) {
        homeLogoutBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('legalSwamiUser');
                localStorage.removeItem('legalSwamiToken');
                currentUser = null;
                userToken = null;
                isLoggedIn = false;
                updateUserUI();
                showToast('Logged out successfully 👋', 'success');
            }
        });
    }

    // Watch demo button
    const watchDemoBtn = document.getElementById('watchDemo');
    if (watchDemoBtn) {
        watchDemoBtn.addEventListener('click', function() {
            showToast('Demo video coming soon! 🎬', 'info');
        });
    }

    // Schedule demo button
    const ctaScheduleDemo = document.getElementById('ctaScheduleDemo');
    if (ctaScheduleDemo) {
        ctaScheduleDemo.addEventListener('click', function() {
            showToast('Schedule demo feature coming soon! 📅', 'info');
        });
    }

    // Document generation buttons
    document.querySelectorAll('.btn-generate').forEach(button => {
        button.addEventListener('click', function() {
            openChat();
            setTimeout(() => {
                const userInput = document.getElementById('userInput');
                const sendButton = document.getElementById('sendButton');
                
                const documentType = this.closest('.document-category').querySelector('.category-title').textContent;
                
                if (userInput && sendButton) {
                    userInput.value = `Create a ${documentType.toLowerCase()} template for me 📝`;
                    userInput.focus();
                    userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
                    sendButton.disabled = false;
                    
                    setTimeout(() => {
                        sendMessage();
                    }, 1000);
                }
            }, 500);
        });
    });

    // Lawyer consultation buttons
    document.querySelectorAll('.btn-consult').forEach(button => {
        button.addEventListener('click', function() {
            showToast('Lawyer consultation feature coming soon! 👨‍⚖️', 'info');
        });
    });

    // Pricing plan buttons
    document.querySelectorAll('.btn-pricing').forEach(button => {
        button.addEventListener('click', function() {
            if (this.textContent.includes('Contact Sales')) {
                showToast('Contact sales feature coming soon! 📞', 'info');
            } else if (this.textContent.includes('Get Started Free')) {
                openChat();
            } else {
                showToast('Premium features coming soon! ⭐', 'info');
            }
        });
    });

    // Database search buttons
    document.querySelectorAll('.btn-database').forEach(button => {
        button.addEventListener('click', function() {
            openChat();
            setTimeout(() => {
                const userInput = document.getElementById('userInput');
                const sendButton = document.getElementById('sendButton');
                
                const databaseType = this.closest('.database-card').querySelector('.database-title').textContent;
                
                if (userInput && sendButton) {
                    userInput.value = `Search ${databaseType.toLowerCase()} in Indian law 🔍`;
                    userInput.focus();
                    userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
                    sendButton.disabled = false;
                    
                    setTimeout(() => {
                        sendMessage();
                    }, 1000);
                }
            }, 500);
        });
    });

    // Guide view buttons
    document.querySelectorAll('.btn-guide').forEach(button => {
        button.addEventListener('click', function() {
            openChat();
            setTimeout(() => {
                const userInput = document.getElementById('userInput');
                const sendButton = document.getElementById('sendButton');
                
                const guideTitle = this.closest('.guide-card').querySelector('.guide-title').textContent;
                
                if (userInput && sendButton) {
                    userInput.value = `Explain ${guideTitle.toLowerCase()} in simple terms 📚`;
                    userInput.focus();
                    userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
                    sendButton.disabled = false;
                    
                    setTimeout(() => {
                        sendMessage();
                    }, 1000);
                }
            }, 500);
        });
    });

    // Lawyer search button
    const btnSearch = document.querySelector('.btn-search');
    if (btnSearch) {
        btnSearch.addEventListener('click', function() {
            const searchInput = document.getElementById('lawyerSearch');
            if (searchInput && searchInput.value.trim()) {
                showToast(`Searching for lawyers specializing in: ${searchInput.value} 👨‍⚖️`, 'info');
            } else {
                showToast('Please enter a search term 🔍', 'warning');
            }
        });
    }

    // Lawyer specialization filters
    document.querySelectorAll('.filter-btn').forEach(button => {
        button.addEventListener('click', function() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            this.classList.add('active');
            
            const specialization = this.dataset.specialization;
            showToast(`Showing ${specialization === 'all' ? 'all' : specialization} lawyers 👨‍⚖️`, 'info');
        });
    });

    // Assistant chat button
    const btnAssistant = document.querySelector('.btn-assistant');
    if (btnAssistant) {
        btnAssistant.addEventListener('click', openChat);
    }

    // Feature card chat buttons
    document.querySelectorAll('.feature-card').forEach(card => {
        card.addEventListener('click', function(e) {
            if (!e.target.closest('button') && !e.target.closest('a')) {
                const featureTitle = this.querySelector('.feature-title').textContent;
                openChat();
                setTimeout(() => {
                    const userInput = document.getElementById('userInput');
                    const sendButton = document.getElementById('sendButton');
                    
                    if (userInput && sendButton) {
                        userInput.value = `Tell me about ${featureTitle.toLowerCase()} ⚖️`;
                        userInput.focus();
                        userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
                        sendButton.disabled = false;
                        
                        setTimeout(() => {
                            sendMessage();
                        }, 1000);
                    }
                }, 500);
            }
        });
    });

    // Testimonial card click
    document.querySelectorAll('.testimonial-card').forEach(card => {
        card.addEventListener('click', function() {
            const testimonialText = this.querySelector('.testimonial-text').textContent;
            openChat();
            setTimeout(() => {
                const userInput = document.getElementById('userInput');
                const sendButton = document.getElementById('sendButton');
                
                if (userInput && sendButton) {
                    userInput.value = `I need help with a legal matter similar to what was mentioned in testimonials. Can you assist? ⚖️`;
                    userInput.focus();
                    userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
                    sendButton.disabled = false;
                    
                    setTimeout(() => {
                        sendMessage();
                    }, 1000);
                }
            }, 500);
        });
    });

    // Footer links
    document.querySelectorAll('#termsLink, #privacyLink, #disclaimerLink, #cookieLink').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const linkType = this.id.replace('Link', '');
            const messages = {
                'terms': 'Terms of Service',
                'privacy': 'Privacy Policy',
                'disclaimer': 'Legal Disclaimer',
                'cookie': 'Cookie Policy'
            };
            showToast(`${messages[linkType]} page coming soon! 📄`, 'info');
        });
    });

    // Handle escape key to close modals
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            // Close login modal
            if (isLoginModalOpen) {
                const loginModal = document.getElementById('loginModal');
                if (loginModal) loginModal.classList.remove('active');
                isLoginModalOpen = false;
            }
            
            // Close mobile menu
            if (isMobileMenuOpen) {
                const mobileMenu = document.getElementById('mobileMenu');
                if (mobileMenu) mobileMenu.style.display = 'none';
                isMobileMenuOpen = false;
            }
            
            // Close sidebar on mobile
            if (window.innerWidth < 1024) {
                const sidebar = document.getElementById('sidebar');
                const sidebarOverlay = document.getElementById('sidebarOverlay');
                if (sidebar && sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    if (sidebarOverlay) sidebarOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }
            
            // Stop streaming if active
            if (isStreamingActive) {
                stopStreaming();
            }
        }
        
        // Ctrl+/ to focus chat input
        if (e.key === '/' && e.ctrlKey) {
            e.preventDefault();
            if (document.getElementById('chatInterface').classList.contains('active')) {
                const userInput = document.getElementById('userInput');
                if (userInput) userInput.focus();
            }
        }
    });

    // Handle click outside of modals to close them
    document.addEventListener('click', function(e) {
        // Close login modal
        const loginModal = document.getElementById('loginModal');
        if (loginModal && loginModal.classList.contains('active')) {
            const modalContent = loginModal.querySelector('.modal-content');
            if (!modalContent.contains(e.target) && !e.target.closest('#headerLoginBtn') && !e.target.closest('#chatHeaderLoginBtn')) {
                loginModal.classList.remove('active');
                isLoginModalOpen = false;
            }
        }
        
        // Close mobile menu
        const mobileMenu = document.getElementById('mobileMenu');
        if (mobileMenu && mobileMenu.style.display === 'block') {
            const mobileMenuContainer = mobileMenu.querySelector('.mobile-menu-container');
            if (!mobileMenuContainer.contains(e.target) && !e.target.closest('#mobileToggle')) {
                mobileMenu.style.display = 'none';
                isMobileMenuOpen = false;
            }
        }
    });

    // Initialize Google Sign-In
    function initializeGoogleSignIn() {
        try {
            if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
                google.accounts.id.initialize({
                    client_id: '166511615962-bohur5q8d4i5hud6icr4185kcte9enk8.apps.googleusercontent.com',
                    callback: handleCredentialResponse,
                    auto_select: false,
                    cancel_on_tap_outside: true
                });
                
                google.accounts.id.renderButton(
                    document.getElementById('googleSignInContainer'),
                    { 
                        theme: 'outline', 
                        size: 'large',
                        width: 280,
                        text: 'continue_with',
                        shape: 'rectangular',
                        logo_alignment: 'center'
                    }
                );
                
                google.accounts.id.prompt();
            }
        } catch (error) {
            console.error('Google Sign-In initialization error:', error);
        }
    }
    
    // Handle Google Sign-In response
    function handleCredentialResponse(response) {
        try {
            const responsePayload = JSON.parse(atob(response.credential.split('.')[1]));
            
            currentUser = {
                id: responsePayload.sub,
                name: responsePayload.name,
                email: responsePayload.email,
                picture: responsePayload.picture,
                isGuest: false
            };
            
            userToken = response.credential;
            isLoggedIn = true;
            
            // Save user data
            localStorage.setItem('legalSwamiUser', JSON.stringify(currentUser));
            localStorage.setItem('legalSwamiToken', userToken);
            
            updateUserUI();
            
            const loginModal = document.getElementById('loginModal');
            if (loginModal) loginModal.classList.remove('active');
            isLoginModalOpen = false;
            
            showToast(`Welcome ${currentUser.name}! 👋`, 'success');
            
            // Load user's chat history
            loadUserChatHistory();
            
        } catch (error) {
            console.error('Google Sign-In error:', error);
            showToast('Google login failed. Please try again. ❌', 'error');
        }
    }
    
    // Initialize Google Sign-In when DOM is loaded
    setTimeout(initializeGoogleSignIn, 1000);
});

// Global function to remove attached files
window.removeAttachedFile = function(index) {
    attachedFiles.splice(index, 1);
    
    // Update preview
    const preview = document.getElementById('attachmentsPreview');
    if (preview) {
        if (attachedFiles.length === 0) {
            preview.style.display = 'none';
            preview.innerHTML = '';
        } else {
            preview.innerHTML = '';
            attachedFiles.forEach((file, newIndex) => {
                const item = document.createElement('div');
                item.className = 'attachment-preview-item';
                
                if (file.type.startsWith('image/')) {
                    item.innerHTML = `
                        <img src="${file.data}" alt="${file.name}" class="attachment-preview-image">
                        <div class="attachment-preview-name">${file.name}</div>
                        <button class="remove-attachment" onclick="removeAttachedFile(${newIndex})">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                } else if (file.type === 'application/pdf' || file.name.endsWith('.pdf')) {
                    item.innerHTML = `
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: var(--error); padding: 5px;">
                            <i class="fas fa-file-pdf" style="font-size: 1.2rem; color: white; margin-bottom: 3px;"></i>
                            <div class="attachment-preview-name" style="color: white; font-size: 0.55rem;">PDF</div>
                        </div>
                        <div class="attachment-preview-name">${file.name.substring(0, 8)}...</div>
                        <button class="remove-attachment" onclick="removeAttachedFile(${newIndex})">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                } else if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                    item.innerHTML = `
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: var(--primary); padding: 5px;">
                            <i class="fas fa-file-alt" style="font-size: 1.2rem; color: white; margin-bottom: 3px;"></i>
                            <div class="attachment-preview-name" style="color: white; font-size: 0.55rem;">TXT</div>
                        </div>
                        <div class="attachment-preview-name">${file.name.substring(0, 8)}...</div>
                        <button class="remove-attachment" onclick="removeAttachedFile(${newIndex})">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                } else {
                    item.innerHTML = `
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: var(--dark-surface-light); padding: 5px;">
                            <i class="fas fa-file" style="font-size: 1.2rem; color: var(--dark-text-secondary); margin-bottom: 3px;"></i>
                            <div class="attachment-preview-name" style="color: var(--dark-text-secondary); font-size: 0.55rem;">FILE</div>
                        </div>
                        <div class="attachment-preview-name">${file.name.substring(0, 8)}...</div>
                        <button class="remove-attachment" onclick="removeAttachedFile(${newIndex})">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                }
                
                preview.appendChild(item);
            });
        }
    }
    
    const userInput = document.getElementById('userInput');
    const sendButton = document.getElementById('sendButton');
    if (userInput && sendButton) {
        sendButton.disabled = userInput.value.trim() === '' && attachedFiles.length === 0;
    }
    
    showToast('File removed 📎', 'info');
};

// Handle window resize
window.addEventListener('resize', function() {
    adjustChatLayout();
    
    // Close sidebar on mobile when resizing to desktop
    if (window.innerWidth >= 1025) {
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        if (sidebar && sidebarOverlay) {
            sidebar.classList.add('active');
            sidebarOverlay.classList.remove('active');
            document.body.style.overflow = '';
        }
    }
});

// Handle page visibility change
document.addEventListener('visibilitychange', function() {
    if (document.visibilityState === 'visible') {
        // Check if search counter needs reset
        initializeSearchCounter();
    }
});

// Handle beforeunload to save data
window.addEventListener('beforeunload', function() {
    saveCurrentChat();
    saveSearchCounter();
});

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    console.log('🚀 LegalSwami AI Legal Assistant Initialized');
    
    // Show welcome message
    setTimeout(() => {
        console.log('✅ App ready to use');
        console.log('📱 Device:', isMobile ? 'Mobile' : isTablet ? 'Tablet' : 'Desktop');
        console.log('👤 User mode:', isLoggedIn ? 'Logged In' : 'Guest');
    }, 1000);
});

</script>
</body>
</html>
