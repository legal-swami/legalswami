<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LegalSwami | AI-Powered Legal Assistant</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Google Client ID -->
    <meta name="google-client-id" 
          content="166511615962-bohur5q8d4i5hud6icr4185kcte9enk8.apps.googleusercontent.com">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öñÔ∏è</text></svg>">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#1a237e">
    
    <!-- Apple Mobile Web App -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Open Graph -->
    <meta property="og:title" content="LegalSwami - AI Legal Assistant">
    <meta property="og:description" content="Get instant legal advice, generate documents, and understand laws with AI">
    <meta property="og:image" content="https://legalswami.com/og-image.jpg">
    <meta property="og:url" content="https://legalswami.com">

    <style>
        /* Loading Animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* ChatGPT-style animations */
        .chat-typing {
            display: inline-flex;
            align-items: center;
        }
        
        .chat-typing span {
            height: 8px;
            width: 8px;
            margin: 0 1px;
            background-color: #6b7280;
            border-radius: 50%;
            display: inline-block;
            animation: typing 1.4s infinite ease-in-out both;
        }
        
        .chat-typing span:nth-child(1) { animation-delay: -0.32s; }
        .chat-typing span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); opacity: 0.3; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        /* Smooth transitions */
        .message {
            transition: all 0.3s ease;
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .chat-input-area {
                padding-bottom: env(safe-area-inset-bottom, 20px);
            }
            
            #messageInput {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner legal-seal">
                <i class="fas fa-gavel"></i>
            </div>
            <h2 class="shimmer-text mt-4">LegalSwami</h2>
            <p class="text-light">Initializing AI Legal Assistant...</p>
            <div class="progress-bar mt-4">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Navigation Bar -->
        <nav class="premium-navbar">
            <div class="nav-container">
                <!-- Logo -->
                <div class="nav-logo">
                    <div class="logo-icon legal-seal">
                        <i class="fas fa-gavel gavel-animation"></i>
                    </div>
                    <div class="logo-text">
                        <h1 class="logo-title shimmer-text">LegalSwami</h1>
                        <p class="logo-subtitle">AI Legal Assistant</p>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="nav-menu">
                    <a href="#home" class="nav-link active" data-scroll="home">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="#features" class="nav-link" data-scroll="features">
                        <i class="fas fa-star"></i>
                        <span>Features</span>
                    </a>
                    <a href="#documents" class="nav-link" data-scroll="documents">
                        <i class="fas fa-file-contract"></i>
                        <span>Documents</span>
                    </a>
                    <a href="#testimonials" class="nav-link" data-scroll="testimonials">
                        <i class="fas fa-comment-dots"></i>
                        <span>Testimonials</span>
                    </a>
                    <a href="#pricing" class="nav-link" data-scroll="pricing">
                        <i class="fas fa-tag"></i>
                        <span>Pricing</span>
                    </a>
                </div>

                <!-- User Actions -->
                <div class="nav-actions">
                    <button id="headerLoginBtn" class="btn-login">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Login</span>
                    </button>
                    
                    <div id="userProfile" class="user-profile" style="display: none;">
                        <div class="profile-avatar">
                            <div id="userAvatar"></div>
                        </div>
                        <div class="profile-info">
                            <span id="userName" class="profile-name"></span>
                            <span id="userEmail" class="profile-email"></span>
                        </div>
                        <button id="logoutBtn" class="btn-logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>

                <!-- Mobile Menu Toggle -->
                <button class="mobile-toggle" id="mobileToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </nav>

        <!-- Mobile Menu -->
        <div class="mobile-menu-overlay" id="mobileMenu">
            <div class="mobile-menu-container">
                <div class="mobile-menu-header">
                    <div class="logo-icon legal-seal">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <button class="mobile-close" id="mobileClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mobile-menu-links">
                    <a href="#home" class="mobile-link active">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="#features" class="mobile-link">
                        <i class="fas fa-star"></i>
                        <span>Features</span>
                    </a>
                    <a href="#documents" class="mobile-link">
                        <i class="fas fa-file-contract"></i>
                        <span>Documents</span>
                    </a>
                    <a href="#testimonials" class="mobile-link">
                        <i class="fas fa-comment-dots"></i>
                        <span>Testimonials</span>
                    </a>
                    <a href="#pricing" class="mobile-link">
                        <i class="fas fa-tag"></i>
                        <span>Pricing</span>
                    </a>
                    <a href="#chat" class="mobile-link" id="mobileStartChat">
                        <i class="fas fa-comments"></i>
                        <span>Start Chat</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Hero Section -->
        <section id="home" class="hero-section">
            <div class="hero-container container">
                <div class="hero-content">
                    <div class="hero-badge">
                        <span class="badge-text">
                            <i class="fas fa-bolt"></i>
                            AI-POWERED LEGAL ASSISTANT
                        </span>
                    </div>
                    
                    <h1 class="hero-title text-reveal">
                        Get <span class="shimmer-text">Instant Legal Help</span><br>
                        From Your AI Assistant
                    </h1>
                    
                    <p class="hero-subtitle">
                        LegalSwami provides 24/7 AI-powered legal guidance, document generation, 
                        and legal research assistance. Get instant answers to your legal questions 
                        in simple, understandable language.
                    </p>
                    
                    <div class="hero-actions">
                        <button id="startChatBtn" class="btn-hero-primary btn-premium">
                            <i class="fas fa-comments"></i>
                            <span>Start Free Chat Now</span>
                            <div class="btn-sparkle">
                                <i class="fas fa-sparkle"></i>
                            </div>
                        </button>
                        
                        <button id="watchDemo" class="btn-hero-secondary">
                            <i class="fas fa-play-circle"></i>
                            <span>Watch Demo Video</span>
                        </button>
                    </div>
                </div>
                
                <div class="hero-illustration">
                    <div class="ai-assistant-card premium-card pulse-glow">
                        <div class="assistant-avatar legal-seal">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h3 class="assistant-title">AI Legal Assistant</h3>
                        <p class="assistant-subtitle">Available 24/7</p>
                        
                        <div class="assistant-features">
                            <div class="feature">
                                <i class="fas fa-check-circle"></i>
                                <span>Instant Responses</span>
                            </div>
                            <div class="feature">
                                <i class="fas fa-check-circle"></i>
                                <span>Multi-Language</span>
                            </div>
                            <div class="feature">
                                <i class="fas fa-check-circle"></i>
                                <span>Document Generation</span>
                            </div>
                        </div>
                        
                        <button class="btn-assistant" id="heroAssistantBtn">
                            <i class="fas fa-comment-alt"></i>
                            Ask Legal Question
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="features-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="shimmer-text">Powerful Features</span> for All Your Legal Needs
                    </h2>
                    <p class="section-subtitle">
                        Everything you need in one comprehensive legal assistant
                    </p>
                </div>
                
                <div class="features-grid">
                    <!-- Feature cards will be here -->
                </div>
            </div>
        </section>

        <!-- Documents Section -->
        <section id="documents" class="documents-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Generate <span class="shimmer-text">Legal Documents</span> Instantly
                    </h2>
                    <p class="section-subtitle">
                        Professional legal documents at your fingertips
                    </p>
                </div>
                
                <div class="documents-grid">
                    <!-- Document categories will be here -->
                </div>
            </div>
        </section>

        <!-- Pricing Section -->
        <section id="pricing" class="pricing-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Simple, <span class="shimmer-text">Transparent</span> Pricing
                    </h2>
                    <p class="section-subtitle">
                        Choose the perfect plan for your legal needs
                    </p>
                </div>
                
                <div class="pricing-cards">
                    <!-- Pricing cards will be here -->
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="cta-section">
            <div class="container">
                <div class="cta-content">
                    <h2 class="cta-title">
                        Ready to Experience <br>
                        AI-Powered Legal Assistance?
                    </h2>
                    <p class="cta-description">
                        Join thousands of satisfied users who trust LegalSwami for their legal needs. 
                        No credit card required to get started.
                    </p>
                    
                    <div class="cta-actions">
                        <button id="ctaStartChat" class="btn-cta-primary btn-premium">
                            <i class="fas fa-rocket"></i>
                            Start Free Chat Now
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ChatGPT-Style Chat Interface -->
        <div id="chatInterface" class="chat-interface">
            <div class="chat-container">
                <!-- Chat Header -->
                <div class="chat-header">
                    <div class="chat-header-left">
                        <button id="backToHome" class="chat-back-btn" title="Back to Home">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div class="chat-title">
                            <div class="chat-title-icon">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="chat-title-text">
                                <h3>LegalSwami AI</h3>
                                <p class="chat-subtitle">Your AI Legal Assistant</p>
                            </div>
                        </div>
                    </div>
                    <div class="chat-header-right">
                        <button id="newChatBtn" class="chat-action-btn" title="New Chat">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button id="clearChat" class="chat-action-btn" title="Clear Chat">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                        <button id="exportChat" class="chat-action-btn" title="Export Chat">
                            <i class="fas fa-download"></i>
                        </button>
                        <button id="historyToggle" class="chat-action-btn" title="Chat History">
                            <i class="fas fa-history"></i>
                        </button>
                    </div>
                </div>

                <!-- Main Chat Area -->
                <div class="chat-main">
                    <!-- Chat History Sidebar -->
                    <div id="historySidebar" class="chat-history-sidebar">
                        <div class="history-header">
                            <h4><i class="fas fa-history"></i> Chat History</h4>
                            <button id="closeHistory" class="history-close">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="history-content">
                            <div class="history-search">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Search chat history..." id="historySearch">
                            </div>
                            <div class="history-list" id="historyList">
                                <!-- History items will be added here -->
                            </div>
                        </div>
                    </div>

                    <!-- Chat Messages Area -->
                    <div class="chat-messages-area">
                        <!-- Welcome Screen -->
                        <div class="chat-welcome" id="chatWelcome">
                            <div class="welcome-illustration">
                                <div class="ai-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                            </div>
                            <div class="welcome-content">
                                <h1>How can I help you today?</h1>
                                <p>I'm LegalSwami, your AI legal assistant. I can help you with legal advice, document generation, and understanding complex legal concepts.</p>
                                
                                <div class="quick-suggestions">
                                    <div class="suggestion-grid">
                                        <button class="suggestion-card" data-question="What are the essential elements of a valid contract?">
                                            <div class="suggestion-icon">
                                                <i class="fas fa-file-contract"></i>
                                            </div>
                                            <div class="suggestion-content">
                                                <h4>Contract Requirements</h4>
                                                <p>Learn about valid contract elements</p>
                                            </div>
                                        </button>
                                        <button class="suggestion-card" data-question="How to draft a rental agreement?">
                                            <div class="suggestion-icon">
                                                <i class="fas fa-home"></i>
                                            </div>
                                            <div class="suggestion-content">
                                                <h4>Rental Agreement</h4>
                                                <p>Create a professional rental contract</p>
                                            </div>
                                        </button>
                                        <button class="suggestion-card" data-question="Explain consumer protection laws in India">
                                            <div class="suggestion-icon">
                                                <i class="fas fa-shield-alt"></i>
                                            </div>
                                            <div class="suggestion-content">
                                                <h4>Consumer Rights</h4>
                                                <p>Understand your consumer protection rights</p>
                                            </div>
                                        </button>
                                        <button class="suggestion-card" data-question="How to file a legal notice for recovery of money?">
                                            <div class="suggestion-icon">
                                                <i class="fas fa-gavel"></i>
                                            </div>
                                            <div class="suggestion-content">
                                                <h4>Legal Notice</h4>
                                                <p>Send a formal legal notice</p>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Messages Container -->
                        <div class="chat-messages-container" id="chatMessagesContainer">
                            <div class="chat-messages" id="chatMessages">
                                <!-- Messages will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Input Area -->
                <div class="chat-input-area">
                    <div class="input-container">
                        <div class="input-actions-left">
                            <button id="attachFile" class="input-action-btn" title="Attach File">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <button id="voiceInput" class="input-action-btn" title="Voice Input">
                                <i class="fas fa-microphone"></i>
                            </button>
                        </div>
                        
                        <div class="input-wrapper">
                            <textarea 
                                id="messageInput" 
                                placeholder="Message LegalSwami..."
                                rows="1"
                                maxlength="5000"
                            ></textarea>
                            <div class="input-bottom">
                                <span class="char-counter" id="charCounter">0/5000</span>
                                <button id="sendMessage" class="btn-send" title="Send Message">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-footer">
                        <div class="disclaimer">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>LegalSwami can make mistakes. Consider checking important information.</span>
                        </div>
                    </div>
                </div>

                <!-- Typing Indicator -->
                <div class="typing-indicator" id="typingIndicator">
                    <div class="typing-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="typing-content">
                        <div class="chat-typing">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <span class="typing-text">LegalSwami is thinking...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button id="closeLoginModal" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
                
                <div class="modal-header">
                    <div class="modal-icon legal-seal">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <h3>Welcome to LegalSwami</h3>
                    <p>Secure login to access all features</p>
                </div>
                
                <div class="modal-body">
                    <button id="demoLoginBtn" class="demo-login-btn">
                        <i class="fas fa-user"></i> Try Demo Version
                    </button>
                    
                    <div class="login-info">
                        <p><i class="fas fa-lock"></i> Your data is encrypted and secure</p>
                        <p><i class="fas fa-shield-alt"></i> We never share your personal information</p>
                        <p><i class="fas fa-bolt"></i> No credit card required</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="premium-footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <div class="footer-logo">
                            <div class="logo-icon legal-seal">
                                <i class="fas fa-gavel"></i>
                            </div>
                            <div class="logo-text">
                                <h3 class="logo-title shimmer-text">LegalSwami</h3>
                                <p class="logo-subtitle">AI Legal Assistant</p>
                            </div>
                        </div>
                        <p class="footer-description">
                            Making legal assistance accessible to everyone with AI-powered technology.
                        </p>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p class="copyright">
                        &copy; 2024 LegalSwami. All rights reserved.
                    </p>
                    <div class="disclaimer">
                        <i class="fas fa-exclamation-triangle"></i>
                        LegalSwami provides AI-powered legal assistance. It is not a substitute for professional legal advice.
                    </div>
                </div>
            </div>
        </footer>

        <!-- Back to Top -->
        <button id="backToTop" class="back-to-top">
            <i class="fas fa-chevron-up"></i>
        </button>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Main App Script -->
    <script>
        // Global variables
        let currentChatId = null;
        let isProcessing = false;
        let isMobileMenuOpen = false;
        let isChatOpen = false;
        let isLoginModalOpen = false;
        let chatHistory = [];
        
        // DOM Content Loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ LegalSwami Premium Frontend Initialized');
            
            // Hide loading screen
            setTimeout(function() {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(function() {
                        loadingScreen.style.display = 'none';
                        console.log('‚úÖ Loading screen hidden');
                    }, 300);
                }
            }, 1000);
            
            // Initialize app
            initializeApp();
            
            // Setup event listeners
            setupEventListeners();
            
            // Check for existing user
            checkExistingUser();
            
            // Initialize chat
            initializeChat();
            
            console.log('‚úÖ All initialization complete');
        });
        
        // Initialize App
        function initializeApp() {
            // Load chat history from localStorage
            const savedHistory = localStorage.getItem('legalSwamiChatHistory');
            if (savedHistory) {
                try {
                    chatHistory = JSON.parse(savedHistory);
                    updateHistoryList();
                } catch (e) {
                    console.error('Error loading chat history:', e);
                }
            }
            
            // Generate unique chat ID
            currentChatId = 'chat_' + Date.now();
            
            // Initialize backend connection
            initializeBackendConnection();
        }
        
        // Initialize Backend Connection
        async function initializeBackendConnection() {
            try {
                const backendUrl = 'https://legal-swami-backend.onrender.com';
                
                // Test backend health
                const healthResponse = await fetch(backendUrl + '/api/v1/public/health');
                if (healthResponse.ok) {
                    const healthData = await healthResponse.json();
                    console.log('‚úÖ Backend health check passed:', healthData);
                    showToast('Backend connected successfully!', 'success');
                } else {
                    console.warn('‚ö†Ô∏è Backend health check failed:', healthResponse.status);
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Backend health check failed:', error.message);
            }
        }
        
        // Setup Event Listeners
        function setupEventListeners() {
            console.log('üîß Setting up event listeners');
            
            // Start chat buttons
            document.querySelectorAll('#startChatBtn, #heroAssistantBtn, #ctaStartChat, #mobileStartChat').forEach(btn => {
                btn.addEventListener('click', startChat);
            });
            
            // Login button
            const headerLoginBtn = document.getElementById('headerLoginBtn');
            if (headerLoginBtn) {
                headerLoginBtn.addEventListener('click', showLoginModal);
            }
            
            // Logout button
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
            
            // Demo login button
            const demoLoginBtn = document.getElementById('demoLoginBtn');
            if (demoLoginBtn) {
                demoLoginBtn.addEventListener('click', handleDemoLogin);
            }
            
            // Close login modal
            const closeLoginModal = document.getElementById('closeLoginModal');
            if (closeLoginModal) {
                closeLoginModal.addEventListener('click', hideLoginModal);
            }
            
            // Modal overlay
            const loginModal = document.getElementById('loginModal');
            if (loginModal) {
                loginModal.addEventListener('click', function(e) {
                    if (e.target === this || e.target.classList.contains('modal-overlay')) {
                        hideLoginModal();
                    }
                });
            }
            
            // Chat interface buttons
            document.getElementById('backToHome').addEventListener('click', goBackToHome);
            document.getElementById('newChatBtn').addEventListener('click', startNewChat);
            document.getElementById('clearChat').addEventListener('click', clearChatHandler);
            document.getElementById('exportChat').addEventListener('click', exportChatHandler);
            document.getElementById('historyToggle').addEventListener('click', toggleHistory);
            document.getElementById('closeHistory').addEventListener('click', toggleHistory);
            document.getElementById('sendMessage').addEventListener('click', sendMessageHandler);
            
            // Message input
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.addEventListener('keydown', handleInputKeydown);
                messageInput.addEventListener('input', handleInputChange);
                messageInput.addEventListener('input', autoResizeTextarea);
            }
            
            // Quick suggestions
            document.querySelectorAll('.suggestion-card').forEach(card => {
                card.addEventListener('click', function() {
                    const question = this.getAttribute('data-question');
                    document.getElementById('messageInput').value = question;
                    sendMessageHandler();
                });
            });
            
            // Mobile menu
            document.getElementById('mobileToggle').addEventListener('click', toggleMobileMenu);
            document.getElementById('mobileClose').addEventListener('click', toggleMobileMenu);
            
            // Watch demo button
            const watchDemo = document.getElementById('watchDemo');
            if (watchDemo) {
                watchDemo.addEventListener('click', showDemo);
            }
            
            console.log('‚úÖ All event listeners set up');
        }
        
        // Initialize Chat
        function initializeChat() {
            // Hide typing indicator
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.style.display = 'none';
            }
            
            // Hide chat messages container
            const chatMessagesContainer = document.getElementById('chatMessagesContainer');
            if (chatMessagesContainer) {
                chatMessagesContainer.style.display = 'none';
            }
        }
        
        // Start Chat
        function startChat() {
            console.log('üí¨ Starting chat...');
            
            // Check if user is logged in
            const user = localStorage.getItem('legal_swami_user');
            if (!user) {
                showLoginModal();
                showToast('Please login to start chatting', 'warning');
                return;
            }
            
            // Show chat interface
            const chatInterface = document.getElementById('chatInterface');
            if (chatInterface) {
                chatInterface.style.display = 'flex';
                isChatOpen = true;
                
                // Add animation
                chatInterface.style.opacity = '0';
                setTimeout(() => {
                    chatInterface.style.opacity = '1';
                    chatInterface.style.transition = 'opacity 0.3s ease';
                }, 10);
                
                console.log('‚úÖ Chat interface shown');
            }
            
            // Hide welcome screen, show messages
            const chatWelcome = document.getElementById('chatWelcome');
            const chatMessagesContainer = document.getElementById('chatMessagesContainer');
            
            if (chatWelcome) {
                chatWelcome.style.display = 'none';
            }
            
            if (chatMessagesContainer) {
                chatMessagesContainer.style.display = 'flex';
            }
            
            // Focus input
            setTimeout(() => {
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                    messageInput.focus();
                    console.log('‚úÖ Message input focused');
                }
            }, 300);
            
            // Disable body scroll
            document.body.style.overflow = 'hidden';
        }
        
        // Start New Chat
        function startNewChat() {
            if (confirm('Start a new chat? Your current chat will be saved.')) {
                // Save current chat
                saveCurrentChat();
                
                // Clear messages
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    chatMessages.innerHTML = '';
                }
                
                // Generate new chat ID
                currentChatId = 'chat_' + Date.now();
                
                // Show welcome screen
                const chatWelcome = document.getElementById('chatWelcome');
                const chatMessagesContainer = document.getElementById('chatMessagesContainer');
                
                if (chatWelcome) {
                    chatWelcome.style.display = 'flex';
                }
                
                if (chatMessagesContainer) {
                    chatMessagesContainer.style.display = 'none';
                }
                
                // Reset input
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                    messageInput.value = '';
                    messageInput.style.height = 'auto';
                    updateCharCounter();
                }
                
                showToast('New chat started', 'success');
                console.log('üÜï New chat started');
            }
        }
        
        // Go Back to Home
        function goBackToHome() {
            // Save current chat
            saveCurrentChat();
            
            // Hide chat interface
            const chatInterface = document.getElementById('chatInterface');
            if (chatInterface) {
                chatInterface.style.opacity = '1';
                setTimeout(() => {
                    chatInterface.style.opacity = '0';
                    setTimeout(() => {
                        chatInterface.style.display = 'none';
                        isChatOpen = false;
                    }, 300);
                }, 10);
                console.log('‚úÖ Chat interface hidden');
            }
            
            // Show welcome screen
            const chatWelcome = document.getElementById('chatWelcome');
            const chatMessagesContainer = document.getElementById('chatMessagesContainer');
            
            if (chatWelcome) {
                chatWelcome.style.display = 'flex';
            }
            
            if (chatMessagesContainer) {
                chatMessagesContainer.style.display = 'none';
            }
            
            // Clear messages
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                chatMessages.innerHTML = '';
            }
            
            // Reset input
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.value = '';
                messageInput.style.height = 'auto';
                updateCharCounter();
            }
            
            // Enable body scroll
            document.body.style.overflow = '';
            
            console.log('üè† Returned to home');
        }
        
        // Save Current Chat
        function saveCurrentChat() {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;
            
            const messages = chatMessages.querySelectorAll('.message');
            if (messages.length === 0) return;
            
            // Extract conversation
            const conversation = [];
            messages.forEach(message => {
                const isUser = message.classList.contains('user-message');
                const text = message.querySelector('.message-text')?.textContent || '';
                const time = message.querySelector('.message-time')?.textContent || '';
                
                if (text.trim()) {
                    conversation.push({
                        role: isUser ? 'user' : 'assistant',
                        content: text,
                        timestamp: time
                    });
                }
            });
            
            // Save to history if we have messages
            if (conversation.length > 0) {
                const chatTitle = conversation[0]?.content?.substring(0, 50) || 'Legal Chat';
                
                const chatItem = {
                    id: currentChatId,
                    title: chatTitle,
                    timestamp: new Date().toISOString(),
                    messages: conversation
                };
                
                // Add to history
                chatHistory.unshift(chatItem);
                
                // Keep only last 50 chats
                if (chatHistory.length > 50) {
                    chatHistory = chatHistory.slice(0, 50);
                }
                
                // Save to localStorage
                localStorage.setItem('legalSwamiChatHistory', JSON.stringify(chatHistory));
                
                // Update history list
                updateHistoryList();
                
                console.log('üíæ Chat saved to history:', chatItem.title);
            }
        }
        
        // Clear Chat Handler
        function clearChatHandler() {
            if (confirm('Are you sure you want to clear the chat? This action cannot be undone.')) {
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    chatMessages.innerHTML = '';
                }
                
                showToast('Chat cleared successfully', 'success');
                console.log('üóëÔ∏è Chat cleared');
            }
        }
        
        // Export Chat Handler
        function exportChatHandler() {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;
            
            const messages = chatMessages.querySelectorAll('.message');
            
            let exportText = '================================\n';
            exportText += 'LEGALSWAMI CHAT EXPORT\n';
            exportText += 'Generated on: ' + new Date().toLocaleString() + '\n';
            exportText += '================================\n\n';
            
            messages.forEach(function(message) {
                const isAI = message.classList.contains('ai-message');
                const text = message.querySelector('.message-text') ? message.querySelector('.message-text').textContent : '';
                const time = message.querySelector('.message-time') ? message.querySelector('.message-time').textContent : '';
                
                exportText += (isAI ? 'ü§ñ LegalSwami AI' : 'üë§ You') + ' (' + time + '):\n';
                exportText += text + '\n\n';
                exportText += '‚îÄ'.repeat(50) + '\n\n';
            });
            
            exportText += '\n================================\n';
            exportText += 'END OF CHAT\n';
            exportText += '================================\n\n';
            exportText += 'Disclaimer: This chat is for informational purposes only.\n';
            exportText += 'Please consult a qualified attorney for legal advice.\n';
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'LegalSwami_Chat_' + new Date().toISOString().split('T')[0] + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Chat exported successfully!', 'success');
            console.log('üì• Chat exported');
        }
        
        // Toggle History Sidebar
        function toggleHistory() {
            const sidebar = document.getElementById('historySidebar');
            if (sidebar) {
                sidebar.classList.toggle('active');
                console.log('üìú History sidebar toggled');
            }
        }
        
        // Update History List
        function updateHistoryList() {
            const historyList = document.getElementById('historyList');
            if (!historyList) return;
            
            historyList.innerHTML = '';
            
            if (chatHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="history-empty">
                        <i class="fas fa-history"></i>
                        <p>No chat history yet</p>
                        <small>Start chatting to see your history here</small>
                    </div>
                `;
                return;
            }
            
            chatHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-item-header">
                        <div class="history-item-title">${item.title}</div>
                        <span class="history-item-time">${formatTime(item.timestamp)}</span>
                    </div>
                    <div class="history-item-preview">${item.messages[0]?.content?.substring(0, 80) || 'No preview'}...</div>
                `;
                
                historyItem.addEventListener('click', () => loadChatFromHistory(item.id));
                historyList.appendChild(historyItem);
            });
        }
        
        // Load Chat from History
        function loadChatFromHistory(chatId) {
            const chat = chatHistory.find(item => item.id === chatId);
            if (!chat) return;
            
            // Clear current messages
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                chatMessages.innerHTML = '';
            }
            
            // Load messages
            chat.messages.forEach(msg => {
                addMessageToChat(msg.content, msg.role === 'user', false, 'PDF');
            });
            
            // Hide welcome screen
            const chatWelcome = document.getElementById('chatWelcome');
            const chatMessagesContainer = document.getElementById('chatMessagesContainer');
            
            if (chatWelcome) {
                chatWelcome.style.display = 'none';
            }
            
            if (chatMessagesContainer) {
                chatMessagesContainer.style.display = 'flex';
            }
            
            // Set current chat ID
            currentChatId = chatId;
            
            // Close history sidebar
            toggleHistory();
            
            showToast('Chat loaded from history', 'success');
            console.log('üìú Chat loaded from history:', chat.title);
        }
        
        // Send Message Handler
        async function sendMessageHandler() {
            if (isProcessing) {
                console.warn('‚ö†Ô∏è Message already being processed');
                return;
            }
            
            const input = document.getElementById('messageInput');
            if (!input) return;
            
            const message = input.value.trim();
            
            if (!message) {
                showToast('Please enter a message', 'warning');
                return;
            }
            
            // Get user ID
            let userId = 'guest';
            const userStr = localStorage.getItem('legal_swami_user');
            if (userStr) {
                try {
                    const user = JSON.parse(userStr);
                    userId = user.id;
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
            
            isProcessing = true;
            
            try {
                console.log('üí¨ Sending message:', message.substring(0, 100));
                
                // Add user message to chat
                addMessageToChat(message, true);
                input.value = '';
                input.style.height = 'auto';
                updateCharCounter();
                
                // Show typing indicator
                showTypingIndicator(true);
                
                // Send to backend
                const backendUrl = 'https://legal-swami-backend.onrender.com';
                const response = await fetch(backendUrl + '/api/v1/chat/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-user-id': userId,
                        'x-request-id': 'req_' + Date.now()
                    },
                    body: JSON.stringify({
                        message: message,
                        chatId: currentChatId,
                        generateDocument: false
                    })
                });
                
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status + ': ' + await response.text());
                }
                
                const data = await response.json();
                console.log('‚úÖ Received response:', data.id);
                
                // Add AI response to chat
                addMessageToChat(data.response || 'I apologize, but I encountered an error processing your request. Please try again.', false);
                
            } catch (error) {
                console.error('‚ùå Failed to send message:', error);
                
                // Add error message
                addMessageToChat('Sorry, I encountered an error while processing your request. Please try again in a moment. If the problem persists, please check your internet connection.', false);
                
                showToast('Failed to send message: ' + error.message, 'error');
            } finally {
                isProcessing = false;
                showTypingIndicator(false);
            }
        }
        
        // Add Message to Chat
        function addMessageToChat(content, isUser, isDocument, documentType) {
            isUser = isUser || false;
            isDocument = isDocument || false;
            documentType = documentType || 'PDF';
            
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;
            
            // Create message element
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + (isUser ? 'user-message' : 'ai-message');
            
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Format content with markdown-like syntax
            const formattedContent = formatMessageText(content);
            
            // Create message HTML
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    ${isUser ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>'}
                </div>
                <div class="message-content">
                    <div class="message-header">
                        <div class="message-sender">
                            ${isUser ? 'You' : 'LegalSwami AI'}
                            ${!isUser ? '<span class="message-sender-badge">AI</span>' : ''}
                        </div>
                        <div class="message-time">${time}</div>
                    </div>
                    <div class="message-text">${formattedContent}</div>
                    <div class="message-actions">
                        <button class="message-action-btn" title="Copy">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="message-action-btn" title="Like">
                            <i class="far fa-thumbs-up"></i>
                        </button>
                        <button class="message-action-btn" title="Dislike">
                            <i class="far fa-thumbs-down"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Add to chat
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
            
            // Add copy functionality
            const copyBtn = messageDiv.querySelector('.message-action-btn');
            if (copyBtn) {
                copyBtn.addEventListener('click', function() {
                    const text = messageDiv.querySelector('.message-text').textContent;
                    navigator.clipboard.writeText(text).then(function() {
                        showToast('Message copied to clipboard!', 'success');
                    });
                });
            }
            
            console.log('üí¨ Message added to chat:', isUser ? 'User' : 'AI');
        }
        
        // Format Message Text
        function formatMessageText(text) {
            if (!text) return '';
            
            // Replace newlines with breaks
            text = text.replace(/\n/g, '<br>');
            
            // Replace **bold** with <strong>
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Replace *italic* with <em>
            text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Replace `code` with <code>
            text = text.replace(/`(.*?)`/g, '<code>$1</code>');
            
            // Replace bullet points
            text = text.replace(/^\s*[-‚Ä¢*]\s+(.*)$/gm, '<li>$1</li>');
            
            // Wrap lists in ul
            const lines = text.split('<br>');
            let inList = false;
            let result = '';
            
            for (let line of lines) {
                if (line.startsWith('<li>')) {
                    if (!inList) {
                        result += '<ul>';
                        inList = true;
                    }
                } else {
                    if (inList) {
                        result += '</ul>';
                        inList = false;
                    }
                }
                result += line + '<br>';
            }
            
            if (inList) {
                result += '</ul>';
            }
            
            return result;
        }
        
        // Show Typing Indicator
        function showTypingIndicator(show) {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.style.display = show ? 'flex' : 'none';
                
                if (show) {
                    const chatMessages = document.getElementById('chatMessages');
                    if (chatMessages) {
                        setTimeout(() => {
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                        }, 100);
                    }
                }
            }
        }
        
        // Handle Input Keydown
        function handleInputKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessageHandler();
            }
        }
        
        // Handle Input Change
        function handleInputChange() {
            updateCharCounter();
        }
        
        // Update Character Counter
        function updateCharCounter() {
            const input = document.getElementById('messageInput');
            const counter = document.getElementById('charCounter');
            if (!input || !counter) return;
            
            const length = input.value.length;
            counter.textContent = `${length}/5000`;
            
            // Change color if near limit
            if (length > 4500) {
                counter.style.color = '#ef4444';
            } else if (length > 4000) {
                counter.style.color = '#f59e0b';
            } else {
                counter.style.color = '#6b7280';
            }
        }
        
        // Auto Resize Textarea
        function autoResizeTextarea() {
            const textarea = this;
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
            
            // Limit height
            if (textarea.scrollHeight > 200) {
                textarea.style.height = '200px';
                textarea.style.overflowY = 'auto';
            }
        }
        
        // Show Login Modal
        function showLoginModal() {
            console.log('üîê Showing login modal...');
            
            const modal = document.getElementById('loginModal');
            if (!modal) {
                console.error('‚ùå Login modal not found!');
                return;
            }
            
            isLoginModalOpen = true;
            modal.style.display = 'flex';
            document.body.classList.add('modal-open');
            
            // Prevent background scrolling on mobile
            document.body.style.overflow = 'hidden';
            
            console.log('‚úÖ Login modal shown');
        }
        
        // Hide Login Modal
        function hideLoginModal() {
            console.log('üîê Hiding login modal...');
            
            const modal = document.getElementById('loginModal');
            if (!modal) {
                console.error('‚ùå Login modal not found!');
                return;
            }
            
            isLoginModalOpen = false;
            modal.style.display = 'none';
            document.body.classList.remove('modal-open');
            
            // Restore scrolling
            document.body.style.overflow = '';
            
            console.log('‚úÖ Login modal hidden');
        }
        
        // Handle Demo Login
        function handleDemoLogin() {
            console.log('üë§ Demo login triggered');
            
            const demoUser = {
                id: 'demo_user_' + Date.now(),
                name: 'Demo User',
                email: 'demo@legalswami.com',
                role: 'client',
                picture: 'https://ui-avatars.com/api/?name=Demo+User&background=1a56db&color=fff&size=128',
                provider: 'demo',
                isDemo: true
            };
            
            localStorage.setItem('legal_swami_user', JSON.stringify(demoUser));
            localStorage.setItem('legal_swami_token', 'demo_token_' + Date.now());
            
            updateUserUI();
            hideLoginModal();
            showToast('Welcome Demo User! You can now start chatting.', 'success');
            
            // Start chat automatically
            setTimeout(() => startChat(), 500);
        }
        
        // Handle Logout
        function handleLogout() {
            console.log('üö™ Logging out...');
            
            // Clear user data
            localStorage.removeItem('legal_swami_token');
            localStorage.removeItem('legal_swami_user');
            
            updateUserUI();
            showToast('Logged out successfully', 'success');
            
            // Go back to home if in chat interface
            if (isChatOpen) {
                goBackToHome();
            }
        }
        
        // Check Existing User
        function checkExistingUser() {
            console.log('üë§ Checking for existing user...');
            
            const userStr = localStorage.getItem('legal_swami_user');
            if (userStr) {
                try {
                    const user = JSON.parse(userStr);
                    console.log('‚úÖ Found existing user:', user.name);
                    updateUserUI();
                    return;
                } catch (e) {
                    console.error('Error parsing user data:', e);
                    localStorage.removeItem('legal_swami_user');
                    localStorage.removeItem('legal_swami_token');
                }
            }
            
            updateUserUI();
        }
        
        // Update User UI
        function updateUserUI() {
            console.log('üë§ Updating user UI...');
            
            const userProfile = document.getElementById('userProfile');
            const headerLoginBtn = document.getElementById('headerLoginBtn');
            
            if (!userProfile || !headerLoginBtn) {
                console.warn('‚ö†Ô∏è User UI elements not found');
                return;
            }
            
            let user = null;
            const userStr = localStorage.getItem('legal_swami_user');
            
            if (userStr) {
                try {
                    user = JSON.parse(userStr);
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
            
            if (user && user.id) {
                console.log('‚úÖ User logged in:', user.name);
                
                headerLoginBtn.style.display = 'none';
                userProfile.style.display = 'flex';
                
                const userName = document.getElementById('userName');
                const userEmail = document.getElementById('userEmail');
                const userAvatar = document.getElementById('userAvatar');
                
                if (userName) userName.textContent = user.name || 'User';
                if (userEmail) userEmail.textContent = user.email || '';
                
                if (userAvatar) {
                    userAvatar.innerHTML = '';
                    if (user.picture) {
                        const img = document.createElement('img');
                        img.src = user.picture;
                        img.alt = user.name;
                        img.style.width = '100%';
                        img.style.height = '100%';
                        img.style.borderRadius = '8px';
                        img.style.objectFit = 'cover';
                        userAvatar.appendChild(img);
                    } else {
                        const initials = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                        const span = document.createElement('span');
                        span.textContent = initials;
                        span.style.fontSize = '14px';
                        span.style.fontWeight = '600';
                        userAvatar.appendChild(span);
                    }
                }
                
            } else {
                console.log('üë§ No user logged in, showing login button');
                
                headerLoginBtn.style.display = 'flex';
                userProfile.style.display = 'none';
            }
        }
        
        // Toggle Mobile Menu
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileToggle = document.getElementById('mobileToggle');
            
            if (!mobileMenu || !mobileToggle) return;
            
            isMobileMenuOpen = !isMobileMenuOpen;
            
            if (isMobileMenuOpen) {
                mobileMenu.style.display = 'block';
                setTimeout(() => {
                    mobileMenu.style.opacity = '1';
                }, 10);
                document.body.style.overflow = 'hidden';
                mobileToggle.innerHTML = '<i class="fas fa-times"></i>';
            } else {
                mobileMenu.style.opacity = '0';
                setTimeout(() => {
                    mobileMenu.style.display = 'none';
                }, 300);
                document.body.style.overflow = '';
                mobileToggle.innerHTML = '<i class="fas fa-bars"></i>';
            }
        }
        
        // Show Demo
        function showDemo() {
            showToast('Demo video feature coming soon!', 'info');
            console.log('üé¨ Demo opened');
        }
        
        // Format Time
        function formatTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
            if (diff < 604800000) return Math.floor(diff / 86400000) + 'd ago';
            return date.toLocaleDateString();
        }
        
        // Show Toast Notification
        function showToast(message, type) {
            type = type || 'info';
            const container = document.getElementById('toastContainer');
            if (!container) return;
            
            const toast = document.createElement('div');
            toast.className = 'toast toast-' + type;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            toast.innerHTML = `<i class="${icons[type] || icons.info}"></i><span>${message}</span>`;
            
            container.appendChild(toast);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('fade-out');
                setTimeout(() => {
                    if (toast.parentNode === container) {
                        container.removeChild(toast);
                    }
                }, 300);
            }, 3000);
            
            console.log('üì¢ Toast (' + type + '):', message);
        }
        
        console.log('‚úÖ LegalSwami Premium App Initialization Complete!');
    </script>
</body>
</html>
