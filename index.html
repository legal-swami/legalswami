<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LegalSwami | AI-Powered Legal Assistant & Document Generator</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Google Client ID -->
    <meta name="google-client-id" 
          content="166511615962-bohur5q8d4i5hud6icr4185kcte9enk8.apps.googleusercontent.com">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚖️</text></svg>">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#0f172a">
    
    <!-- Apple Mobile Web App Capable -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="LegalSwami - AI Legal Assistant">
    <meta property="og:description" content="Get instant legal advice, generate documents, and understand laws with AI">
    <meta property="og:image" content="https://legalswami.com/og-image.jpg">
    <meta property="og:url" content="https://legalswami.com">

    
</head>
<body>
    <!-- Premium Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner legal-seal">
                <i class="fas fa-gavel"></i>
            </div>
            <h2 class="shimmer-text mt-4">LegalSwami</h2>
            <p class="text-light">Initializing AI Legal Assistant...</p>
            <div class="progress-bar mt-4">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Premium Navigation Bar -->
        <nav class="premium-navbar">
            <div class="nav-container">
                <!-- Logo with Animation -->
                <div class="nav-logo">
                    <div class="logo-icon legal-seal">
                        <i class="fas fa-gavel gavel-animation"></i>
                    </div>
                    <div class="logo-text">
                        <h1 class="logo-title shimmer-text">LegalSwami</h1>
                        <p class="logo-subtitle">AI Legal Assistant</p>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="nav-menu">
                    <a href="#home" class="nav-link active" data-scroll="home">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="#features" class="nav-link" data-scroll="features">
                        <i class="fas fa-star"></i>
                        <span>Features</span>
                    </a>
                    <a href="#documents" class="nav-link" data-scroll="documents">
                        <i class="fas fa-file-contract"></i>
                        <span>Documents</span>
                    </a>
                    <a href="#legalDatabase" class="nav-link" data-scroll="legalDatabase">
                        <i class="fas fa-database"></i>
                        <span>Legal Database</span>
                    </a>
                    <a href="#lawyerDirectory" class="nav-link" data-scroll="lawyerDirectory">
                        <i class="fas fa-user-tie"></i>
                        <span>Find Lawyers</span>
                    </a>
                    <a href="#pricing" class="nav-link" data-scroll="pricing">
                        <i class="fas fa-tag"></i>
                        <span>Pricing</span>
                    </a>
                </div>

                <!-- User Actions -->
                <div class="nav-actions">
                    <button id="headerLoginBtn" class="btn-login">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Login</span>
                    </button>
                    
                    <div id="userProfile" class="user-profile" style="display: none;">
                        <div class="profile-avatar">
                            <div id="userAvatar"></div>
                        </div>
                        <div class="profile-info">
                            <span id="userName" class="profile-name"></span>
                            <span id="userEmail" class="profile-email"></span>
                        </div>
                        <button id="logoutBtn" class="btn-logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>

                <!-- Mobile Menu Toggle -->
                <button class="mobile-toggle" id="mobileToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </nav>

        <!-- Mobile Menu -->
        <div class="mobile-menu-overlay" id="mobileMenu">
            <div class="mobile-menu-container">
                <div class="mobile-menu-header">
                    <div class="logo-icon legal-seal">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <button class="mobile-close" id="mobileClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mobile-menu-links">
                    <a href="#home" class="mobile-link active">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="#features" class="mobile-link">
                        <i class="fas fa-star"></i>
                        <span>Features</span>
                    </a>
                    <a href="#documents" class="mobile-link">
                        <i class="fas fa-file-contract"></i>
                        <span>Documents</span>
                    </a>
                    <a href="#legalDatabase" class="mobile-link">
                        <i class="fas fa-database"></i>
                        <span>Legal Database</span>
                    </a>
                    <a href="#lawyerDirectory" class="mobile-link">
                        <i class="fas fa-user-tie"></i>
                        <span>Find Lawyers</span>
                    </a>
                    <a href="#legalGuides" class="mobile-link">
                        <i class="fas fa-book"></i>
                        <span>Legal Guides</span>
                    </a>
                    <a href="#pricing" class="mobile-link">
                        <i class="fas fa-tag"></i>
                        <span>Pricing</span>
                    </a>
                    <a href="#chat" class="mobile-link" id="mobileStartChat">
                        <i class="fas fa-comments"></i>
                        <span>Start Chat</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Hero Section -->
        <section id="home" class="hero-section">
            <div class="hero-container container">
                <!-- Animated Background Elements -->
                <div class="hero-bg-elements">
                    <div class="floating-element floating-icon-1">
                        <i class="fas fa-balance-scale floating"></i>
                    </div>
                    <div class="floating-element floating-icon-2">
                        <i class="fas fa-gavel floating"></i>
                    </div>
                    <div class="floating-element floating-icon-3">
                        <i class="fas fa-scale-balanced floating"></i>
                    </div>
                </div>
                
                <div class="hero-content">
                    <div class="hero-badge">
                        <span class="badge-text">
                            <i class="fas fa-bolt"></i>
                            AI-POWERED LEGAL ASSISTANT
                        </span>
                    </div>
                    
                    <h1 class="hero-title text-reveal">
                        Get <span class="shimmer-text">Instant Legal Help</span><br>
                        From Your AI Assistant
                    </h1>
                    
                    <p class="hero-subtitle">
                        LegalSwami provides 24/7 AI-powered legal guidance, document generation, 
                        and legal research assistance. Get instant answers to your legal questions 
                        in simple, understandable language.
                    </p>
                    
                    <div class="hero-stats">
                        <div class="stat-item">
                            <div class="stat-number shimmer-text">10,000+</div>
                            <div class="stat-label">Legal Documents Generated</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number shimmer-text">50,000+</div>
                            <div class="stat-label">Legal Questions Answered</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number shimmer-text">99.8%</div>
                            <div class="stat-label">User Satisfaction Rate</div>
                        </div>
                    </div>
                    
                    <div class="hero-actions">
                        <button id="startChatBtn" class="btn-hero-primary btn-premium">
                            <i class="fas fa-comments"></i>
                            <span>Start Free Chat Now</span>
                            <div class="btn-sparkle">
                                <i class="fas fa-sparkle"></i>
                            </div>
                        </button>
                        
                        <button id="watchDemo" class="btn-hero-secondary">
                            <i class="fas fa-play-circle"></i>
                            <span>Watch Demo Video</span>
                        </button>
                    </div>
                    
                    <div class="hero-trust">
                        <div class="trust-label">Trusted by</div>
                        <div class="trust-badges">
                            <div class="trust-badge">
                                <i class="fas fa-university"></i>
                                <span>Law Firms</span>
                            </div>
                            <div class="trust-badge">
                                <i class="fas fa-graduation-cap"></i>
                                <span>Law Students</span>
                            </div>
                            <div class="trust-badge">
                                <i class="fas fa-briefcase"></i>
                                <span>Businesses</span>
                            </div>
                            <div class="trust-badge">
                                <i class="fas fa-users"></i>
                                <span>Individuals</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="hero-illustration">
                    <div class="ai-assistant-card premium-card pulse-glow">
                        <div class="assistant-avatar legal-seal">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h3 class="assistant-title">AI Legal Assistant</h3>
                        <p class="assistant-subtitle">Available 24/7</p>
                        
                        <div class="assistant-features">
                            <div class="feature">
                                <i class="fas fa-check-circle"></i>
                                <span>Instant Responses</span>
                            </div>
                            <div class="feature">
                                <i class="fas fa-check-circle"></i>
                                <span>Multi-Language</span>
                            </div>
                            <div class="feature">
                                <i class="fas fa-check-circle"></i>
                                <span>Document Generation</span>
                            </div>
                        </div>
                        
                        <button class="btn-assistant" id="heroAssistantBtn">
                            <i class="fas fa-comment-alt"></i>
                            Ask Legal Question
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Scroll Indicator -->
            <div class="scroll-indicator">
                <div class="mouse">
                    <div class="wheel"></div>
                </div>
                <div class="arrow">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="features-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="shimmer-text">Powerful Features</span> for All Your Legal Needs
                    </h2>
                    <p class="section-subtitle">
                        Everything you need in one comprehensive legal assistant
                    </p>
                </div>
                
                <div class="features-grid">
                    <!-- Feature 1 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-comments"></i>
                        </div>
                        <h3 class="feature-title">AI Chat Assistant</h3>
                        <p class="feature-description">
                            Ask legal questions in natural language and get instant, accurate responses powered by advanced AI.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">24/7 Available</span>
                            <span class="tag">Multi-Language</span>
                        </div>
                    </div>
                    
                    <!-- Feature 2 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <h3 class="feature-title">Smart Document Generation</h3>
                        <p class="feature-description">
                            Generate legal documents instantly in PDF, DOC, and TXT formats with customizable templates.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">100+ Templates</span>
                            <span class="tag">Customizable</span>
                        </div>
                    </div>
                    
                    <!-- Feature 3 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3 class="feature-title">Bank-Level Security</h3>
                        <p class="feature-description">
                            End-to-end encryption and secure authentication to protect your sensitive legal data.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">AES-256</span>
                            <span class="tag">GDPR Compliant</span>
                        </div>
                    </div>
                    
                    <!-- Feature 4 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-history"></i>
                        </div>
                        <h3 class="feature-title">Complete Chat History</h3>
                        <p class="feature-description">
                            Access your complete chat history anytime. Export conversations as documents for record keeping.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">Unlimited History</span>
                            <span class="tag">Export Options</span>
                        </div>
                    </div>
                    
                    <!-- Feature 5 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3 class="feature-title">Mobile Responsive</h3>
                        <p class="feature-description">
                            Access LegalSwami from any device - desktop, tablet, or mobile phone with native-like experience.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">PWA Support</span>
                            <span class="tag">Offline Mode</span>
                        </div>
                    </div>
                    
                    <!-- Feature 6 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-language"></i>
                        </div>
                        <h3 class="feature-title">Multi-Language Support</h3>
                        <p class="feature-description">
                            Get legal advice in multiple languages including Hindi, English, Marathi, Gujarati, and more.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">10+ Languages</span>
                            <span class="tag">Real-time Translation</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Legal Database Section -->
        <section id="legalDatabase" class="database-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="shimmer-text">Legal Database</span> & Research Tools
                    </h2>
                    <p class="section-subtitle">
                        Access comprehensive legal resources and research materials
                    </p>
                </div>
                
                <div class="database-grid">
                    <!-- Legal Acts Database -->
                    <div class="database-card premium-card">
                        <div class="database-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <h3 class="database-title">Acts & Statutes</h3>
                        <ul class="database-list">
                            <li><i class="fas fa-search"></i> IPC (Indian Penal Code)</li>
                            <li><i class="fas fa-search"></i> CrPC (Criminal Procedure Code)</li>
                            <li><i class="fas fa-search"></i> CPC (Civil Procedure Code)</li>
                            <li><i class="fas fa-search"></i> Constitution of India</li>
                            <li><i class="fas fa-search"></i> Consumer Protection Act</li>
                        </ul>
                        <button class="btn-database" onclick="searchActs()">
                            <i class="fas fa-search"></i>
                            Search Acts
                        </button>
                    </div>
                    
                    <!-- Case Laws Database -->
                    <div class="database-card premium-card">
                        <div class="database-icon">
                            <i class="fas fa-gavel"></i>
                        </div>
                        <h3 class="database-title">Case Laws Database</h3>
                        <ul class="database-list">
                            <li><i class="fas fa-balance-scale"></i> Supreme Court Judgments</li>
                            <li><i class="fas fa-balance-scale"></i> High Court Judgments</li>
                            <li><i class="fas fa-balance-scale"></i> Landmark Cases</li>
                            <li><i class="fas fa-balance-scale"></i> Recent Judgments</li>
                            <li><i class="fas fa-balance-scale"></i> Case Citations</li>
                        </ul>
                        <button class="btn-database" onclick="searchCaseLaws()">
                            <i class="fas fa-gavel"></i>
                            Search Case Laws
                        </button>
                    </div>
                    
                    <!-- Legal Calculator -->
                    <div class="database-card premium-card">
                        <div class="database-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <h3 class="database-title">Legal Calculators</h3>
                        <ul class="database-list">
                            <li><i class="fas fa-calculator"></i> Court Fee Calculator</li>
                            <li><i class="fas fa-calculator"></i> Stamp Duty Calculator</li>
                            <li><i class="fas fa-calculator"></i> Compensation Calculator</li>
                            <li><i class="fas fa-calculator"></i> Interest Calculator</li>
                            <li><i class="fas fa-calculator"></i> Tax Calculator</li>
                        </ul>
                        <button class="btn-database" onclick="openLegalCalculator()">
                            <i class="fas fa-calculator"></i>
                            Open Calculator
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Document Types Section -->
        <section id="documents" class="documents-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Generate <span class="shimmer-text">Legal Documents</span> Instantly
                    </h2>
                    <p class="section-subtitle">
                        Professional legal documents at your fingertips
                    </p>
                </div>
                
                <div class="documents-grid">
                    <!-- Document Category 1 -->
                    <div class="document-category premium-card">
                        <div class="category-icon">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <h3 class="category-title">Agreements & Contracts</h3>
                        <ul class="document-list">
                            <li><i class="fas fa-check-circle"></i> Rental Agreement</li>
                            <li><i class="fas fa-check-circle"></i> Non-Disclosure Agreement</li>
                            <li><i class="fas fa-check-circle"></i> Employment Contract</li>
                            <li><i class="fas fa-check-circle"></i> Service Agreement</li>
                            <li><i class="fas fa-check-circle"></i> Partnership Agreement</li>
                        </ul>
                        <button class="btn-generate" onclick="generateDocument('rental-agreement')">
                            <i class="fas fa-magic"></i>
                            Generate Now
                        </button>
                    </div>
                    
                    <!-- Document Category 2 -->
                    <div class="document-category premium-card">
                        <div class="category-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <h3 class="category-title">Legal Notices & Letters</h3>
                        <ul class="document-list">
                            <li><i class="fas fa-check-circle"></i> Legal Notice</li>
                            <li><i class="fas fa-check-circle"></i> Cease & Desist Notice</li>
                            <li><i class="fas fa-check-circle"></i> Demand Letter</li>
                            <li><i class="fas fa-check-circle"></i> Notice to Quit</li>
                            <li><i class="fas fa-check-circle"></i> Consumer Complaint</li>
                        </ul>
                        <button class="btn-generate" onclick="generateDocument('legal-notice')">
                            <i class="fas fa-magic"></i>
                            Generate Now
                        </button>
                    </div>
                    
                    <!-- Document Category 3 -->
                    <div class="document-category premium-card">
                        <div class="category-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <h3 class="category-title">Personal & Family</h3>
                        <ul class="document-list">
                            <li><i class="fas fa-check-circle"></i> Will & Testament</li>
                            <li><i class="fas fa-check-circle"></i> Power of Attorney</li>
                            <li><i class="fas fa-check-circle"></i> Affidavit</li>
                            <li><i class="fas fa-check-circle"></i> Gift Deed</li>
                            <li><i class="fas fa-check-circle"></i> Divorce Papers</li>
                        </ul>
                        <button class="btn-generate" onclick="generateDocument('will-testament')">
                            <i class="fas fa-magic"></i>
                            Generate Now
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lawyer Directory Section -->
        <section id="lawyerDirectory" class="lawyer-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Find <span class="shimmer-text">Qualified Lawyers</span>
                    </h2>
                    <p class="section-subtitle">
                        Connect with experienced legal professionals
                    </p>
                </div>
                
                <div class="lawyer-search">
                    <div class="search-container">
                        <i class="fas fa-search"></i>
                        <input type="text" id="lawyerSearch" placeholder="Search by specialization, location, or name...">
                        <button class="btn-search" onclick="searchLawyers()">
                            <i class="fas fa-search"></i>
                            Search
                        </button>
                    </div>
                    
                    <div class="specialization-filters">
                        <button class="filter-btn active" data-specialization="all">All</button>
                        <button class="filter-btn" data-specialization="criminal">Criminal</button>
                        <button class="filter-btn" data-specialization="civil">Civil</button>
                        <button class="filter-btn" data-specialization="corporate">Corporate</button>
                        <button class="filter-btn" data-specialization="family">Family</button>
                        <button class="filter-btn" data-specialization="property">Property</button>
                    </div>
                </div>
                
                <div class="lawyers-grid" id="lawyersGrid">
                    <!-- Lawyers will be dynamically loaded here -->
                </div>
            </div>
        </section>

        <!-- Legal Procedure Guides Section -->
        <section id="legalGuides" class="guides-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="shimmer-text">Step-by-Step</span> Legal Guides
                    </h2>
                    <p class="section-subtitle">
                        Understand legal procedures with easy-to-follow guides
                    </p>
                </div>
                
                <div class="guides-grid">
                    <div class="guide-card premium-card">
                        <div class="guide-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <h3 class="guide-title">How to File a Case</h3>
                        <p class="guide-description">
                            Complete step-by-step guide for filing different types of cases in Indian courts.
                        </p>
                        <div class="guide-steps">
                            <span class="step">1. Document Preparation</span>
                            <span class="step">2. Court Selection</span>
                            <span class="step">3. Fee Payment</span>
                            <span class="step">4. Case Number</span>
                        </div>
                        <button class="btn-guide" onclick="openGuide('file-case')">
                            <i class="fas fa-book-open"></i>
                            View Guide
                        </button>
                    </div>
                    
                    <div class="guide-card premium-card">
                        <div class="guide-icon">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <h3 class="guide-title">Document Registration Process</h3>
                        <p class="guide-description">
                            Learn how to register legal documents with proper procedures and fees.
                        </p>
                        <div class="guide-steps">
                            <span class="step">1. Stamp Duty</span>
                            <span class="step">2. Witness Arrangement</span>
                            <span class="step">3. Registration Office</span>
                            <span class="step">4. Final Registration</span>
                        </div>
                        <button class="btn-guide" onclick="openGuide('registration')">
                            <i class="fas fa-book-open"></i>
                            View Guide
                        </button>
                    </div>
                    
                    <div class="guide-card premium-card">
                        <div class="guide-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <h3 class="guide-title">Consumer Complaint Process</h3>
                        <p class="guide-description">
                            Guide to filing consumer complaints with proper documentation and procedures.
                        </p>
                        <div class="guide-steps">
                            <span class="step">1. Complaint Drafting</span>
                            <span class="step">2. Evidence Collection</span>
                            <span class="step">3. Forum Selection</span>
                            <span class="step">4. Hearing Process</span>
                        </div>
                        <button class="btn-guide" onclick="openGuide('consumer-complaint')">
                            <i class="fas fa-book-open"></i>
                            View Guide
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section id="testimonials" class="testimonials-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Trusted by <span class="shimmer-text">Thousands</span> of Users
                    </h2>
                    <p class="section-subtitle">
                        See what our users have to say about LegalSwami
                    </p>
                </div>
                
                <div class="testimonials-carousel">
                    <!-- Testimonial 1 -->
                    <div class="testimonial-card premium-card">
                        <div class="testimonial-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p class="testimonial-text">
                            "LegalSwami helped me draft a professional rental agreement in minutes. The AI understood exactly what I needed and generated a perfect document. Saved me ₹5000 in lawyer fees!"
                        </p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Rahul Sharma">
                            </div>
                            <div class="author-info">
                                <h4 class="author-name">Rahul Sharma</h4>
                                <p class="author-title">Small Business Owner</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Testimonial 2 -->
                    <div class="testimonial-card premium-card">
                        <div class="testimonial-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                        </div>
                        <p class="testimonial-text">
                            "As a law student, LegalSwami is a game-changer! It helps me understand complex legal concepts and provides excellent research assistance. Like having a personal tutor 24/7."
                        </p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Priya Patel">
                            </div>
                            <div class="author-info">
                                <h4 class="author-name">Priya Patel</h4>
                                <p class="author-title">Law Student, NLU Delhi</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Testimonial 3 -->
                    <div class="testimonial-card premium-card">
                        <div class="testimonial-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p class="testimonial-text">
                            "The document generation feature saved our startup thousands! We needed multiple NDAs and service agreements. LegalSwami generated perfect documents in minutes. Incredible tool!"
                        </p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <img src="https://randomuser.me/api/portraits/men/67.jpg" alt="Ankit Verma">
                            </div>
                            <div class="author-info">
                                <h4 class="author-name">Ankit Verma</h4>
                                <p class="author-title">Tech Entrepreneur</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pricing Section -->
        <section id="pricing" class="pricing-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Simple, <span class="shimmer-text">Transparent</span> Pricing
                    </h2>
                    <p class="section-subtitle">
                        Choose the perfect plan for your legal needs
                    </p>
                </div>
                
                <div class="pricing-cards">
                    <!-- Free Plan -->
                    <div class="pricing-card premium-card">
                        <div class="pricing-badge">FREE</div>
                        <h3 class="pricing-title">Basic</h3>
                        <div class="pricing-price">
                            <span class="currency">₹</span>
                            <span class="amount">0</span>
                            <span class="period">/month</span>
                        </div>
                        <p class="pricing-description">Perfect for trying out LegalSwami</p>
                        
                        <ul class="pricing-features">
                            <li><i class="fas fa-check-circle"></i> 10 AI Chat Messages/Day</li>
                            <li><i class="fas fa-check-circle"></i> 3 Document Generations/Month</li>
                            <li><i class="fas fa-check-circle"></i> Basic Legal Questions</li>
                            <li><i class="fas fa-times-circle"></i> No Priority Support</li>
                            <li><i class="fas fa-times-circle"></i> No Document History</li>
                        </ul>
                        
                        <button class="btn-pricing" id="freePlanBtn">
                            Get Started Free
                        </button>
                    </div>
                    
                    <!-- Pro Plan -->
                    <div class="pricing-card premium-card premium-plan">
                        <div class="pricing-badge popular">POPULAR</div>
                        <h3 class="pricing-title">Professional</h3>
                        <div class="pricing-price">
                            <span class="currency">₹</span>
                            <span class="amount">499</span>
                            <span class="period">/month</span>
                        </div>
                        <p class="pricing-description">Perfect for professionals & businesses</p>
                        
                        <ul class="pricing-features">
                            <li><i class="fas fa-check-circle"></i> Unlimited AI Chat Messages</li>
                            <li><i class="fas fa-check-circle"></i> 50 Document Generations/Month</li>
                            <li><i class="fas fa-check-circle"></i> All Document Templates</li>
                            <li><i class="fas fa-check-circle"></i> Priority Support</li>
                            <li><i class="fas fa-check-circle"></i> Complete Chat History</li>
                        </ul>
                        
                        <button class="btn-pricing btn-premium" id="proPlanBtn">
                            <i class="fas fa-crown"></i>
                            Get Professional
                        </button>
                    </div>
                    
                    <!-- Business Plan -->
                    <div class="pricing-card premium-card">
                        <div class="pricing-badge">BUSINESS</div>
                        <h3 class="pricing-title">Enterprise</h3>
                        <div class="pricing-price">
                            <span class="currency">₹</span>
                            <span class="amount">1,499</span>
                            <span class="period">/month</span>
                        </div>
                        <p class="pricing-description">For law firms & large organizations</p>
                        
                        <ul class="pricing-features">
                            <li><i class="fas fa-check-circle"></i> Everything in Professional</li>
                            <li><i class="fas fa-check-circle"></i> Unlimited Document Generation</li>
                            <li><i class="fas fa-check-circle"></i> Team Collaboration</li>
                            <li><i class="fas fa-check-circle"></i> Custom Templates</li>
                            <li><i class="fas fa-check-circle"></i> Dedicated Account Manager</li>
                        </ul>
                        
                        <button class="btn-pricing" id="businessPlanBtn">
                            Contact Sales
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="cta-section">
            <div class="container">
                <div class="cta-content">
                    <h2 class="cta-title">
                        Ready to Experience <br>
                        AI-Powered Legal Assistance?
                    </h2>
                    <p class="cta-description">
                        Join thousands of satisfied users who trust LegalSwami for their legal needs. 
                        No credit card required to get started.
                    </p>
                    
                    <div class="cta-actions">
                        <button id="ctaStartChat" class="btn-cta-primary btn-premium">
                            <i class="fas fa-rocket"></i>
                            Start Free Chat Now
                        </button>
                        
                        <button id="ctaScheduleDemo" class="btn-cta-secondary">
                            <i class="fas fa-calendar"></i>
                            Schedule Demo
                        </button>
                    </div>
                    
                    <div class="cta-guarantee">
                        <div class="guarantee-item">
                            <i class="fas fa-shield-alt"></i>
                            <span>100% Secure & Private</span>
                        </div>
                        <div class="guarantee-item">
                            <i class="fas fa-clock"></i>
                            <span>Available 24/7</span>
                        </div>
                        <div class="guarantee-item">
                            <i class="fas fa-headset"></i>
                            <span>Priority Support</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CHATGPT-LIKE CHAT INTERFACE -->
        <div id="chatInterface" class="chat-interface" style="display: none;">
            <!-- ChatGPT-like Chat Container -->
            <div class="chat-container" style="background: #343541; height: 100vh; display: flex; flex-direction: column;">
                <!-- ChatGPT-like Header -->
                <header style="background: #40414f; padding: 0.75rem 1rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #565869; position: sticky; top: 0; z-index: 1000;">
                    <div class="logo" style="display: flex; align-items: center; gap: 10px;">
                        <button class="sidebar-toggle" id="chatSidebarToggle" style="background: transparent; border: none; color: #ececf1; font-size: 1.375rem; cursor: pointer; padding: 0.5rem; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div class="logo-icon" style="font-size: 1.1rem; background: linear-gradient(135deg, #10a37f 0%, #0d8c6d 100%); color: white; width: 32px; height: 32px; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-scale-balanced"></i>
                        </div>
                        <h1 style="font-size: 1.1rem; font-weight: 600; color: #ececf1;">LegalSwami</h1>
                    </div>
                    
                    <div class="header-actions" style="display: flex; gap: 8px; align-items: center;">
                        <button class="header-btn" id="chatBackToHome" style="background: #40414f; color: #ececf1; border: 1px solid #565869; border-radius: 6px; padding: 0.5rem 0.75rem; cursor: pointer; font-size: 0.85rem; transition: all 0.2s; display: flex; align-items: center; gap: 6px; min-height: 36px;">
                            <i class="fas fa-arrow-left"></i>
                            <span>Back to Home</span>
                        </button>
                        <button class="header-btn" id="chatClearChat" style="background: #40414f; color: #ececf1; border: 1px solid #565869; border-radius: 6px; padding: 0.5rem 0.75rem; cursor: pointer; font-size: 0.85rem; transition: all 0.2s; display: flex; align-items: center; gap: 6px; min-height: 36px;">
                            <i class="fas fa-broom"></i>
                            <span>Clear Chat</span>
                        </button>
                        <button class="header-btn" id="chatDownloadBtn" style="background: #40414f; color: #ececf1; border: 1px solid #565869; border-radius: 6px; padding: 0.5rem 0.75rem; cursor: pointer; font-size: 0.85rem; transition: all 0.2s; display: flex; align-items: center; gap: 6px; min-height: 36px;">
                            <i class="fas fa-download"></i>
                            <span>Download</span>
                        </button>
                        <div class="status-indicator" style="display: flex; align-items: center; gap: 6px; padding: 0.4rem 0.75rem; background: rgba(16, 163, 127, 0.1); border: 1px solid rgba(16, 163, 127, 0.3); border-radius: 6px; font-size: 0.85rem;">
                            <div class="status-dot" style="width: 8px; height: 8px; background-color: #10b981; border-radius: 50%; animation: pulse 2s infinite;"></div>
                            <span>AI Assistant Ready</span>
                        </div>
                    </div>
                </header>
                
                <div class="main-content" style="display: flex; flex: 1; overflow: hidden; position: relative;">
                    <!-- ChatGPT-like Sidebar -->
                    <aside class="sidebar" id="chatSidebar" style="width: 260px; background: #40414f; border-right: 1px solid #565869; display: flex; flex-direction: column; transition: transform 0.2s ease; z-index: 50; position: absolute; top: 0; left: 0; bottom: 0; overflow: hidden; transform: translateX(-100%);">
                        <button class="sidebar-close" id="chatSidebarClose" style="position: absolute; top: 1rem; right: 1rem; background: #444654; color: #ececf1; border: 1px solid #565869; border-radius: 6px; padding: 0.5rem; cursor: pointer; z-index: 100; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px;">
                            <i class="fas fa-times"></i>
                        </button>
                        
                        <div class="sidebar-tabs" style="display: flex; border-bottom: 1px solid #565869; background: #40414f; position: sticky; top: 0; z-index: 20;">
                            <button class="sidebar-tab active" data-tab="legal-topics" style="flex: 1; padding: 0.875rem 0.5rem; background: transparent; border: none; color: #8e8ea0; font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: all 0.2s; text-align: center; position: relative;">
                                <i class="fas fa-book"></i>
                                <span>Legal Topics</span>
                            </button>
                            <button class="sidebar-tab" data-tab="chat-history" style="flex: 1; padding: 0.875rem 0.5rem; background: transparent; border: none; color: #8e8ea0; font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: all 0.2s; text-align: center; position: relative;">
                                <i class="fas fa-history"></i>
                                <span>Chat History</span>
                            </button>
                        </div>
                        
                        <!-- Legal Topics Tab Content -->
                        <div class="tab-content active" id="legal-topics-content" style="flex: 1; overflow-y: auto; display: block;">
                            <div class="sidebar-header" style="padding: 0.875rem 1rem; border-bottom: 1px solid #565869; position: sticky; top: 0; background: #40414f; z-index: 10;">
                                <h2 style="font-size: 0.85rem; font-weight: 600; color: #8e8ea0; text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-book"></i> Legal Topics
                                </h2>
                            </div>
                            
                            <div class="sidebar-section" style="padding: 0.875rem 1rem;">
                                <h3 style="font-size: 0.85rem; margin-bottom: 0.75rem; color: #8e8ea0; display: flex; align-items: center; gap: 8px; font-weight: 600;">
                                    <i class="fas fa-gavel"></i> Common Legal Areas
                                </h3>
                                <div class="topic-list" style="display: flex; flex-direction: column; gap: 4px;">
                                    <button class="topic-item" data-topic="contract" style="padding: 0.75rem; background: transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s; border: none; display: flex; align-items: center; gap: 8px; color: #ececf1; min-height: 40px; text-align: left; width: 100%; font-size: 0.875rem; font-weight: 500;">
                                        <i class="fas fa-file-contract"></i>
                                        <span>Contract Law</span>
                                    </button>
                                    <button class="topic-item" data-topic="employment" style="padding: 0.75rem; background: transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s; border: none; display: flex; align-items: center; gap: 8px; color: #ececf1; min-height: 40px; text-align: left; width: 100%; font-size: 0.875rem; font-weight: 500;">
                                        <i class="fas fa-briefcase"></i>
                                        <span>Employment Law</span>
                                    </button>
                                    <button class="topic-item" data-topic="family" style="padding: 0.75rem; background: transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s; border: none; display: flex; align-items: center; gap: 8px; color: #ececf1; min-height: 40px; text-align: left; width: 100%; font-size: 0.875rem; font-weight: 500;">
                                        <i class="fas fa-heart"></i>
                                        <span>Family Law</span>
                                    </button>
                                    <button class="topic-item" data-topic="property" style="padding: 0.75rem; background: transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s; border: none; display: flex; align-items: center; gap: 8px; color: #ececf1; min-height: 40px; text-align: left; width: 100%; font-size: 0.875rem; font-weight: 500;">
                                        <i class="fas fa-house"></i>
                                        <span>Property Law</span>
                                    </button>
                                    <button class="topic-item" data-topic="criminal" style="padding: 0.75rem; background: transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s; border: none; display: flex; align-items: center; gap: 8px; color: #ececf1; min-height: 40px; text-align: left; width: 100%; font-size: 0.875rem; font-weight: 500;">
                                        <i class="fas fa-gavel"></i>
                                        <span>Criminal Law</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="sidebar-section" style="padding: 0.875rem 1rem;">
                                <h3 style="font-size: 0.85rem; margin-bottom: 0.75rem; color: #8e8ea0; display: flex; align-items: center; gap: 8px; font-weight: 600;">
                                    <i class="fas fa-bolt"></i> Quick Actions
                                </h3>
                                <div class="quick-actions" style="display: flex; flex-direction: column; gap: 4px;">
                                    <button class="action-item" data-action="nda" style="padding: 0.75rem; background: transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s; border: none; display: flex; align-items: center; gap: 8px; color: #ececf1; min-height: 40px; text-align: left; width: 100%; font-size: 0.875rem; font-weight: 500;">
                                        <i class="fas fa-file-signature"></i>
                                        <span>NDA Template</span>
                                    </button>
                                    <button class="action-item" data-action="rental" style="padding: 0.75rem; background: transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s; border: none; display: flex; align-items: center; gap: 8px; color: #ececf1; min-height: 40px; text-align: left; width: 100%; font-size: 0.875rem; font-weight: 500;">
                                        <i class="fas fa-home"></i>
                                        <span>Rental Agreement</span>
                                    </button>
                                    <button class="action-item" data-action="will" style="padding: 0.75rem; background: transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s; border: none; display: flex; align-items: center; gap: 8px; color: #ececf1; min-height: 40px; text-align: left; width: 100%; font-size: 0.875rem; font-weight: 500;">
                                        <i class="fas fa-file-contract"></i>
                                        <span>Will Template</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Chat History Tab Content -->
                        <div class="tab-content" id="chat-history-content" style="flex: 1; overflow-y: auto; display: none;">
                            <div class="history-header" style="padding: 0.875rem 1rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #565869; position: sticky; top: 0; background: #40414f; z-index: 10;">
                                <h2 style="font-size: 0.85rem; font-weight: 600; color: #8e8ea0; text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-history"></i> Chat History
                                </h2>
                                <button class="new-chat-btn" id="newChatBtn" style="background: #444654; color: #ececf1; border: 1px solid #565869; border-radius: 6px; padding: 0.5rem 0.75rem; cursor: pointer; font-size: 0.85rem; font-weight: 500; transition: all 0.2s; display: flex; align-items: center; gap: 6px;">
                                    <i class="fas fa-plus"></i>
                                    <span>New Chat</span>
                                </button>
                            </div>
                            
                            <div class="history-list" id="chatHistoryList" style="padding: 0.5rem;">
                                <div class="empty-history" style="text-align: center; padding: 2.5rem 1rem; color: #8e8ea0;">
                                    <i class="fas fa-comments" style="font-size: 1.75rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                                    <p style="font-size: 0.875rem;">No chat history yet</p>
                                    <p style="font-size: 0.8125rem; margin-top: 0.5rem;">Start a conversation to see it here</p>
                                </div>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Sidebar Overlay -->
                    <div class="sidebar-overlay" id="chatSidebarOverlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 45;"></div>
                    
                    <!-- ChatGPT-like Chat Messages Area -->
                    <main class="chat-container" id="chatMainContainer" style="flex: 1; display: flex; flex-direction: column; background: #343541; width: 100%; height: 100%; min-height: 0; overflow: hidden;">
                        <!-- Scroll to Bottom Button -->
                        <button class="scroll-to-bottom-btn" id="scrollToBottomBtn" style="position: fixed; bottom: 90px; right: 20px; width: 40px; height: 40px; background: #40414f; border: 1px solid #565869; border-radius: 50%; color: #ececf1; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; z-index: 900; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); opacity: 0; transform: translateY(20px);">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        
                        <div class="chat-messages" id="chatGPTMessages" style="flex: 1; overflow-y: auto; padding: 1.25rem 1rem; display: flex; flex-direction: column; gap: 1.25rem; scroll-behavior: smooth; min-height: 0; width: 100%;">
                            <!-- Welcome Message -->
                            <div class="welcome-message" style="text-align: center; max-width: 600px; margin: 1.5rem auto; padding: 1.25rem; background: linear-gradient(135deg, rgba(16, 163, 127, 0.1) 0%, rgba(30, 64, 175, 0.1) 100%); border: 1px solid #565869; border-radius: 12px; width: 90%;">
                                <h2 style="font-size: 1.5rem; margin-bottom: 0.75rem; background: linear-gradient(135deg, #10a37f 0%, #7e57c2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; word-wrap: break-word; font-weight: 600;">
                                    Welcome to LegalSwami! ⚖️
                                </h2>
                                <p style="color: #8e8ea0; font-size: 0.9375rem; margin-bottom: 1rem; line-height: 1.5; word-wrap: break-word;">
                                    I'm your AI legal assistant. I can help you with legal questions, document generation, and legal research.
                                </p>
                                
                                <div class="welcome-features" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.875rem; margin-top: 1.25rem;">
                                    <div class="feature" style="background: #40414f; padding: 0.875rem; border-radius: 8px; border: 1px solid #565869; display: flex; flex-direction: column; align-items: center; text-align: center; word-wrap: break-word;">
                                        <i class="fas fa-comments" style="font-size: 1.375rem; color: #10a37f; margin-bottom: 0.5rem;"></i>
                                        <h4 style="font-size: 0.875rem; margin-bottom: 0.25rem; color: #ececf1; font-weight: 600;">Legal Advice</h4>
                                        <p style="font-size: 0.8125rem; color: #8e8ea0;">Get instant answers to your legal questions</p>
                                    </div>
                                    <div class="feature" style="background: #40414f; padding: 0.875rem; border-radius: 8px; border: 1px solid #565869; display: flex; flex-direction: column; align-items: center; text-align: center; word-wrap: break-word;">
                                        <i class="fas fa-file-contract" style="font-size: 1.375rem; color: #10a37f; margin-bottom: 0.5rem;"></i>
                                        <h4 style="font-size: 0.875rem; margin-bottom: 0.25rem; color: #ececf1; font-weight: 600;">Document Generation</h4>
                                        <p style="font-size: 0.8125rem; color: #8e8ea0;">Generate legal documents instantly</p>
                                    </div>
                                    <div class="feature" style="background: #40414f; padding: 0.875rem; border-radius: 8px; border: 1px solid #565869; display: flex; flex-direction: column; align-items: center; text-align: center; word-wrap: break-word;">
                                        <i class="fas fa-search" style="font-size: 1.375rem; color: #10a37f; margin-bottom: 0.5rem;"></i>
                                        <h4 style="font-size: 0.875rem; margin-bottom: 0.25rem; color: #ececf1; font-weight: 600;">Legal Research</h4>
                                        <p style="font-size: 0.8125rem; color: #8e8ea0;">Research laws and regulations</p>
                                    </div>
                                    <div class="feature" style="background: #40414f; padding: 0.875rem; border-radius: 8px; border: 1px solid #565869; display: flex; flex-direction: column; align-items: center; text-align: center; word-wrap: break-word;">
                                        <i class="fas fa-gavel" style="font-size: 1.375rem; color: #10a37f; margin-bottom: 0.5rem;"></i>
                                        <h4 style="font-size: 0.875rem; margin-bottom: 0.25rem; color: #ececf1; font-weight: 600;">Case Law Search</h4>
                                        <p style="font-size: 0.8125rem; color: #8e8ea0;">Find relevant case laws</p>
                                    </div>
                                </div>
                                
                                <div class="language-selector" style="margin-top: 1.5rem;">
                                    <h5 style="color: #10a37f; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 8px; font-size: 0.875rem;">
                                        <i class="fas fa-language"></i> Select Language:
                                    </h5>
                                    <div class="language-buttons" style="display: flex; gap: 8px; justify-content: center;">
                                        <button class="lang-btn" data-lang="en" style="background: #40414f; color: #ececf1; border: 1px solid #565869; border-radius: 6px; padding: 0.5rem 1rem; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">English</button>
                                        <button class="lang-btn" data-lang="hi" style="background: #40414f; color: #ececf1; border: 1px solid #565869; border-radius: 6px; padding: 0.5rem 1rem; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">हिंदी</button>
                                        <button class="lang-btn" data-lang="mr" style="background: #40414f; color: #ececf1; border: 1px solid #565869; border-radius: 6px; padding: 0.5rem 1rem; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">मराठी</button>
                                        <button class="lang-btn" data-lang="gu" style="background: #40414f; color: #ececf1; border: 1px solid #565869; border-radius: 6px; padding: 0.5rem 1rem; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">ગુજરાતી</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Scroll Position Indicator -->
                        <div class="scroll-position-indicator" id="scrollPositionIndicator" style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); background: #40414f; color: #8e8ea0; padding: 4px 12px; border-radius: 8px; font-size: 0.75rem; border: 1px solid #565869; display: none; z-index: 10;">
                            Scroll to see more messages
                        </div>
                        
                        <!-- ChatGPT-like Input Area -->
                        <div class="input-container" style="padding: 0.875rem; background: #343541; border-top: 1px solid #565869; position: sticky; bottom: 0; z-index: 10; transition: all 0.2s ease; width: 100%; flex-shrink: 0;">
                            <div class="input-area" style="max-width: 800px; margin: 0 auto; position: relative; width: 100%;">
                                <!-- Attachments Preview -->
                                <div class="attachments-preview" id="chatAttachmentsPreview" style="display: none; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; padding: 6px; background: #444654; border-radius: 8px; border: 1px solid #565869; max-height: 100px; overflow-y: auto;"></div>
                                
                                <div class="voice-input-status" id="chatVoiceInputStatus" style="position: absolute; left: 12px; bottom: 8px; background: rgba(239, 68, 68, 0.1); color: #ef4444; padding: 4px 8px; border-radius: 8px; font-size: 0.75rem; display: none; align-items: center; gap: 4px; animation: fadeIn 0.2s ease;">
                                    <div class="voice-animation" style="display: flex; align-items: center; gap: 3px; height: 20px;">
                                        <div class="voice-bar" style="width: 3px; background: #10a37f; border-radius: 3px; animation: voicePulse 0.8s ease-in-out infinite;"></div>
                                        <div class="voice-bar" style="width: 3px; background: #10a37f; border-radius: 3px; animation: voicePulse 0.8s ease-in-out infinite; animation-delay: 0.2s;"></div>
                                        <div class="voice-bar" style="width: 3px; background: #10a37f; border-radius: 3px; animation: voicePulse 0.8s ease-in-out infinite; animation-delay: 0.3s;"></div>
                                        <div class="voice-bar" style="width: 3px; background: #10a37f; border-radius: 3px; animation: voicePulse 0.8s ease-in-out infinite; animation-delay: 0.4s;"></div>
                                        <div class="voice-bar" style="width: 3px; background: #10a37f; border-radius: 3px; animation: voicePulse 0.8s ease-in-out infinite; animation-delay: 0.5s;"></div>
                                    </div>
                                    <span>Listening... Speak now</span>
                                </div>
                                
                                <textarea 
                                    id="chatMessageInput" 
                                    placeholder="Ask any legal question... (Press Enter for new line, Ctrl+Enter to send)"
                                    rows="1"
                                    style="width: 100%; padding: 0.875rem 6.5rem 0.875rem 1rem; background: #40414f; border: 1px solid #565869; border-radius: 12px; color: #ececf1; font-size: 0.9375rem; resize: none; min-height: 52px; max-height: 150px; transition: all 0.2s; line-height: 1.5; font-family: inherit; outline: none;"
                                ></textarea>
                                
                                <div class="input-buttons" style="position: absolute; right: 0.75rem; bottom: 0.75rem; display: flex; gap: 6px; align-items: center;">
                                    <!-- Attachment Button -->
                                    <button class="attachment-btn" id="chatAttachmentBtn" style="background: transparent; border: none; color: #8e8ea0; cursor: pointer; padding: 0.5rem; border-radius: 8px; transition: all 0.2s; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px;" title="Attach files">
                                        <i class="fas fa-paperclip"></i>
                                    </button>
                                    
                                    <!-- Voice Input Button -->
                                    <button class="input-microphone-btn" id="chatInputMicrophoneBtn" style="background: transparent; border: none; color: #8e8ea0; cursor: pointer; padding: 0.5rem; border-radius: 8px; transition: all 0.2s; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px;" title="Voice input">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                    
                                    <!-- Send/Stop Button -->
                                    <button class="send-button" id="chatSendButton" style="background: linear-gradient(135deg, #10a37f 0%, #0d8c6d 100%); color: white; border: none; border-radius: 8px; padding: 0.5rem 0.875rem; cursor: pointer; font-weight: 500; transition: all 0.2s; display: flex; align-items: center; gap: 6px; min-height: 40px; font-size: 0.875rem;">
                                        <i class="fas fa-paper-plane"></i> <span>Send</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
                
                <!-- Download Modal -->
                <div class="modal-overlay" id="chatDownloadModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); z-index: 2000; align-items: center; justify-content: center; padding: 16px;">
                    <div class="modal" style="background: #40414f; border-radius: 12px; border: 1px solid #565869; width: 100%; max-width: 480px; max-height: 90vh; overflow: hidden; animation: modalSlideIn 0.2s ease-out;">
                        <div class="modal-header" style="padding: 1.25rem; border-bottom: 1px solid #565869; display: flex; justify-content: space-between; align-items: center;">
                            <h2 style="font-size: 1.125rem; font-weight: 600; color: #ececf1;"><i class="fas fa-download"></i> Download Chat</h2>
                            <button class="modal-close" id="closeChatDownloadModal" style="background: transparent; border: none; color: #8e8ea0; cursor: pointer; font-size: 1.125rem; padding: 4px; border-radius: 6px; transition: all 0.2s;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-content" style="padding: 1.25rem;">
                            <p style="color: #ececf1; margin-bottom: 1rem;">Select the format you want to download your chat in:</p>
                            
                            <div class="download-options" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.875rem; margin: 1.25rem 0;">
                                <div class="download-option" data-format="doc" style="background: #444654; border: 1px solid #565869; border-radius: 8px; padding: 1.25rem 0.875rem; text-align: center; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <i class="fas fa-file-word" style="font-size: 1.75rem; color: #10a37f;"></i>
                                    <h3 style="font-size: 0.9375rem; font-weight: 600; color: #ececf1;">Word Document</h3>
                                    <p style="font-size: 0.8125rem; color: #8e8ea0;">.doc format</p>
                                </div>
                                <div class="download-option" data-format="pdf" style="background: #444654; border: 1px solid #565869; border-radius: 8px; padding: 1.25rem 0.875rem; text-align: center; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <i class="fas fa-file-pdf" style="font-size: 1.75rem; color: #10a37f;"></i>
                                    <h3 style="font-size: 0.9375rem; font-weight: 600; color: #ececf1;">PDF Document</h3>
                                    <p style="font-size: 0.8125rem; color: #8e8ea0;">.pdf format</p>
                                </div>
                                <div class="download-option" data-format="txt" style="background: #444654; border: 1px solid #565869; border-radius: 8px; padding: 1.25rem 0.875rem; text-align: center; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <i class="fas fa-file-alt" style="font-size: 1.75rem; color: #10a37f;"></i>
                                    <h3 style="font-size: 0.9375rem; font-weight: 600; color: #ececf1;">Text File</h3>
                                    <p style="font-size: 0.8125rem; color: #8e8ea0;">.txt format</p>
                                </div>
                            </div>
                            
                            <div class="progress-indicator" id="chatProgressIndicator" style="display: none; flex-direction: column; align-items: center; gap: 0.875rem; padding: 1.5rem;">
                                <div class="progress-spinner" style="width: 36px; height: 36px; border: 3px solid #565869; border-top: 3px solid #10a37f; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                                <p style="color: #ececf1;">Preparing your document...</p>
                            </div>
                        </div>
                        <div class="modal-footer" style="padding: 1.25rem; border-top: 1px solid #565869; text-align: center;">
                            <p style="font-size: 0.8125rem; color: #8e8ea0;">The document will include the complete chat conversation with timestamps.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Toast Notification -->
                <div class="toast" id="chatToast" style="position: fixed; bottom: 20px; right: 20px; background: #40414f; color: #ececf1; padding: 0.875rem 1rem; border-radius: 8px; border: 1px solid #565869; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); display: flex; align-items: center; gap: 8px; transform: translateY(100px); opacity: 0; transition: all 0.2s ease; z-index: 1000; max-width: 300px;">
                    <i class="fas fa-check-circle"></i>
                    <span id="chatToastMessage">Message sent successfully</span>
                </div>
            </div>
        </div>

        <!-- Legal Tools Modal -->
        <div id="legalToolsModal" class="modal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button id="closeLegalTools" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
                
                <div class="modal-header">
                    <div class="modal-icon legal-seal">
                        <i class="fas fa-tools"></i>
                    </div>
                    <h3>Legal Tools & Calculators</h3>
                    <p>Access various legal utilities</p>
                </div>
                
                <div class="modal-body">
                    <div class="tools-grid">
                        <button class="tool-card" onclick="openCalculator('court-fee')">
                            <i class="fas fa-calculator"></i>
                            <h4>Court Fee Calculator</h4>
                            <p>Calculate court fees for different cases</p>
                        </button>
                        
                        <button class="tool-card" onclick="openCalculator('stamp-duty')">
                            <i class="fas fa-file-invoice-dollar"></i>
                            <h4>Stamp Duty Calculator</h4>
                            <p>Calculate stamp duty for documents</p>
                        </button>
                        
                        <button class="tool-card" onclick="openCalculator('compensation')">
                            <i class="fas fa-money-check-alt"></i>
                            <h4>Compensation Calculator</h4>
                            <p>Calculate compensation amounts</p>
                        </button>
                        
                        <button class="tool-card" onclick="openLegalActSearch()">
                            <i class="fas fa-search"></i>
                            <h4>Act & Statute Search</h4>
                            <p>Search legal acts and statutes</p>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modern Login Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button id="closeLoginModal" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
                
                <div class="modal-header">
                    <div class="modal-icon legal-seal">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <h3>Welcome to LegalSwami</h3>
                    <p>Secure login to access all features</p>
                </div>
                
                <div class="modal-body">
                    <!-- Google Sign-In Container -->
                    <div id="googleSignInContainer"></div>
                    
                    <!-- Custom Google Button -->
                    <button id="customGoogleBtn" class="google-signin-btn">
                        <i class="fab fa-google"></i>
                        Continue with Google
                    </button>
                    
                    <div class="divider">
                        <span>or</span>
                    </div>
                    
                    <!-- Demo Login Button -->
                    <button id="demoLoginBtn" class="demo-login-btn">
                        <i class="fas fa-user"></i> Try Demo Version
                    </button>
                    
                    <div class="login-info">
                        <p><i class="fas fa-lock"></i> Your data is encrypted and secure</p>
                        <p><i class="fas fa-shield-alt"></i> We never share your personal information</p>
                        <p><i class="fas fa-bolt"></i> No credit card required</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="premium-footer">
            <div class="container">
                <div class="footer-content">
                    <!-- Company Info -->
                    <div class="footer-section">
                        <div class="footer-logo">
                            <div class="logo-icon legal-seal">
                                <i class="fas fa-gavel"></i>
                            </div>
                            <div class="logo-text">
                                <h3 class="logo-title shimmer-text">LegalSwami</h3>
                                <p class="logo-subtitle">AI Legal Assistant</p>
                            </div>
                        </div>
                        <p class="footer-description">
                            Making legal assistance accessible to everyone with AI-powered technology.
                        </p>
                        <div class="social-links">
                            <a href="#" class="social-link">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-linkedin"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-github"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-youtube"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Quick Links -->
                    <div class="footer-section">
                        <h4 class="footer-heading">Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="#home">Home</a></li>
                            <li><a href="#features">Features</a></li>
                            <li><a href="#documents">Documents</a></li>
                            <li><a href="#legalDatabase">Legal Database</a></li>
                            <li><a href="#lawyerDirectory">Find Lawyers</a></li>
                            <li><a href="#legalGuides">Legal Guides</a></li>
                            <li><a href="#testimonials">Testimonials</a></li>
                            <li><a href="#pricing">Pricing</a></li>
                        </ul>
                    </div>
                    
                    <!-- Legal -->
                    <div class="footer-section">
                        <h4 class="footer-heading">Legal</h4>
                        <ul class="footer-links">
                            <li><a href="#" id="termsLink">Terms of Service</a></li>
                            <li><a href="#" id="privacyLink">Privacy Policy</a></li>
                            <li><a href="#" id="disclaimerLink">Legal Disclaimer</a></li>
                            <li><a href="#" id="cookieLink">Cookie Policy</a></li>
                        </ul>
                    </div>
                    
                    <!-- Contact -->
                    <div class="footer-section">
                        <h4 class="footer-heading">Contact Us</h4>
                        <ul class="footer-contact">
                            <li>
                                <i class="fas fa-envelope"></i>
                                <a href="mailto:support@legalswami.com">support@legalswami.com</a>
                            </li>
                            <li>
                                <i class="fas fa-phone"></i>
                                <a href="tel:+919876543210">+91 9876543210</a>
                            </li>
                            <li>
                                <i class="fas fa-map-marker-alt"></i>
                                <span>Mumbai, India</span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p class="copyright">
                        &copy; 2024 LegalSwami. All rights reserved.
                    </p>
                    <div class="disclaimer">
                        <i class="fas fa-exclamation-triangle"></i>
                        LegalSwami provides AI-powered legal assistance. It is not a substitute for professional legal advice.
                    </div>
                </div>
            </div>
        </footer>

        <!-- Back to Top -->
        <button id="backToTop" class="back-to-top">
            <i class="fas fa-chevron-up"></i>
        </button>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Main App Script -->
    <script>
        // Global variables
        let currentChatId = null;
        let isProcessing = false;
        let googleGISInitialized = false;
        let isMobileMenuOpen = false;
        let isChatOpen = false;
        let isLoginModalOpen = false;
        let selectedLanguage = 'en';
        
        // Check if device is mobile
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        const isTablet = window.innerWidth <= 1024 && window.innerWidth > 480;
        
        // Legal Acts Database
        const legalActs = [
            { id: 1, name: "Indian Penal Code (IPC)", year: 1860, category: "criminal" },
            { id: 2, name: "Code of Criminal Procedure (CrPC)", year: 1973, category: "criminal" },
            { id: 3, name: "Code of Civil Procedure (CPC)", year: 1908, category: "civil" },
            { id: 4, name: "Indian Evidence Act", year: 1872, category: "evidence" },
            { id: 5, name: "Consumer Protection Act", year: 2019, category: "consumer" },
            { id: 6, name: "Transfer of Property Act", year: 1882, category: "property" },
            { id: 7, name: "Contract Act", year: 1872, category: "civil" },
            { id: 8, name: "Constitution of India", year: 1950, category: "constitutional" }
        ];

        // Lawyers Database
        const lawyers = [
            { id: 1, name: "Adv. Rajesh Kumar", specialization: "criminal", experience: 15, location: "Delhi", rating: 4.8, fee: "₹2000/consultation" },
            { id: 2, name: "Adv. Priya Sharma", specialization: "family", experience: 10, location: "Mumbai", rating: 4.7, fee: "₹2500/consultation" },
            { id: 3, name: "Adv. Amit Patel", specialization: "corporate", experience: 12, location: "Bangalore", rating: 4.9, fee: "₹3000/consultation" },
            { id: 4, name: "Adv. Sneha Desai", specialization: "property", experience: 8, location: "Pune", rating: 4.6, fee: "₹1800/consultation" },
            { id: 5, name: "Adv. Rohit Verma", specialization: "civil", experience: 20, location: "Delhi", rating: 4.9, fee: "₹3500/consultation" },
            { id: 6, name: "Adv. Anjali Singh", specialization: "consumer", experience: 7, location: "Chennai", rating: 4.5, fee: "₹1500/consultation" }
        ];

        // ChatGPT-like chat variables
        let chatHistory = [];
        let conversationHistory = [];
        let isListening = false;
        let recognition = null;
        let isStreamingActive = false;
        let stopStreamingRequested = false;
        let attachedFiles = [];
        let currentStreamingMessageId = null;
        let currentStreamingContent = '';
        let streamingTextChunks = [];
        let streamingTextIndex = 0;
        
        // DOM Content Loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 LegalSwami Premium Frontend Initialized');
            console.log('📱 Device Type:', isMobile ? 'Mobile' : isTablet ? 'Tablet' : 'Desktop');
            
            // Apply mobile-specific optimizations
            if (isMobile) {
                applyMobileOptimizations();
            }
            
            // Hide loading screen
            setTimeout(function() {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(function() {
                        loadingScreen.style.display = 'none';
                        console.log('✅ Loading screen hidden');
                    }, 300);
                }
            }, 1500);
            
            // Initialize backend connection
            initializeAppWithBackend();
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize Google Authentication
            setTimeout(initializeSimpleGoogleAuth, 2000);
            
            // Check for existing user
            checkExistingUser();
            
            // Setup scroll effects
            setupScrollEffects();
            
            // Setup mobile menu
            setupMobileMenu();
            
            // Setup device-specific optimizations
            setupDeviceSpecificOptimizations();
            
            // Load lawyers
            loadLawyers();
            
            // Setup language buttons
            setupLanguageButtons();
            
            // Setup ChatGPT-like chat
            setupChatGPTLikeChat();
            
            console.log('✅ All initialization complete');
        });
        
        // Setup ChatGPT-like chat
        function setupChatGPTLikeChat() {
            // Initialize chat history
            loadChatHistory();
            
            // Setup sidebar toggle
            const sidebarToggle = document.getElementById('chatSidebarToggle');
            const sidebar = document.getElementById('chatSidebar');
            const sidebarClose = document.getElementById('chatSidebarClose');
            const sidebarOverlay = document.getElementById('chatSidebarOverlay');
            
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.style.transform = 'translateX(0)';
                    sidebarOverlay.style.display = 'block';
                });
            }
            
            if (sidebarClose) {
                sidebarClose.addEventListener('click', function() {
                    sidebar.style.transform = 'translateX(-100%)';
                    sidebarOverlay.style.display = 'none';
                });
            }
            
            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', function() {
                    sidebar.style.transform = 'translateX(-100%)';
                    this.style.display = 'none';
                });
            }
            
            // Setup sidebar tabs
            const sidebarTabs = document.querySelectorAll('.sidebar-tab');
            sidebarTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Update active tab
                    sidebarTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                        content.style.display = 'none';
                    });
                    
                    const content = document.getElementById(`${tabId}-content`);
                    if (content) {
                        content.classList.add('active');
                        content.style.display = 'block';
                    }
                    
                    // If switching to history tab, refresh the list
                    if (tabId === 'chat-history') {
                        loadChatHistoryList();
                    }
                });
            });
            
            // Setup topic items
            const topicItems = document.querySelectorAll('.topic-item');
            topicItems.forEach(item => {
                item.addEventListener('click', function() {
                    const topic = this.dataset.topic;
                    const topicName = this.querySelector('span').textContent;
                    
                    let question = '';
                    switch(topic) {
                        case 'contract':
                            question = 'What are the essential elements of a valid contract under Indian law? ⚖️';
                            break;
                        case 'employment':
                            question = 'What are the rights of employees regarding workplace harassment in India? 💼';
                            break;
                        case 'family':
                            question = 'What are the grounds for divorce under Hindu Marriage Act? 👨‍👩‍👧';
                            break;
                        case 'property':
                            question = 'What documents are required for property registration in India? 🏠';
                            break;
                        case 'criminal':
                            question = 'What is the difference between bailable and non-bailable offenses? ⚖️';
                            break;
                        default:
                            question = `Tell me about ${topicName.toLowerCase()} in Indian law. ⚖️`;
                    }
                    
                    document.getElementById('chatMessageInput').value = question;
                    document.getElementById('chatMessageInput').focus();
                    
                    // Adjust textarea height
                    const textarea = document.getElementById('chatMessageInput');
                    textarea.style.height = 'auto';
                    textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
                    
                    // Enable send button
                    document.getElementById('chatSendButton').disabled = false;
                    
                    // Close sidebar on mobile
                    if (window.innerWidth < 1024) {
                        sidebar.style.transform = 'translateX(-100%)';
                        sidebarOverlay.style.display = 'none';
                    }
                });
            });
            
            // Setup action items
            const actionItems = document.querySelectorAll('.action-item');
            actionItems.forEach(item => {
                item.addEventListener('click', function() {
                    const action = this.dataset.action;
                    
                    let question = '';
                    switch(action) {
                        case 'nda':
                            question = 'Create a comprehensive non-disclosure agreement for Indian business use 🤝';
                            break;
                        case 'rental':
                            question = 'Create a rental/tenancy agreement for residential property in India 🏠';
                            break;
                        case 'will':
                            question = 'Draft a will template according to Indian succession laws 📝';
                            break;
                    }
                    
                    document.getElementById('chatMessageInput').value = question;
                    document.getElementById('chatMessageInput').focus();
                    
                    // Adjust textarea height
                    const textarea = document.getElementById('chatMessageInput');
                    textarea.style.height = 'auto';
                    textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
                    
                    // Enable send button
                    document.getElementById('chatSendButton').disabled = false;
                    
                    // Close sidebar on mobile
                    if (window.innerWidth < 1024) {
                        sidebar.style.transform = 'translateX(-100%)';
                        sidebarOverlay.style.display = 'none';
                    }
                });
            });
            
            // Setup textarea auto-resize
            const messageInput = document.getElementById('chatMessageInput');
            if (messageInput) {
                messageInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 150) + 'px';
                    
                    // Update send button state
                    document.getElementById('chatSendButton').disabled = this.value.trim() === '' && attachedFiles.length === 0;
                });
                
                messageInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && e.ctrlKey) {
                        e.preventDefault();
                        sendChatGPTMessage();
                    }
                });
            }
            
            // Setup send button
            const sendButton = document.getElementById('chatSendButton');
            if (sendButton) {
                sendButton.addEventListener('click', sendChatGPTMessage);
            }
            
            // Setup back to home button
            const backToHomeBtn = document.getElementById('chatBackToHome');
            if (backToHomeBtn) {
                backToHomeBtn.addEventListener('click', goBackToHome);
            }
            
            // Setup clear chat button
            const clearChatBtn = document.getElementById('chatClearChat');
            if (clearChatBtn) {
                clearChatBtn.addEventListener('click', clearChatGPTChat);
            }
            
            // Setup download button
            const downloadBtn = document.getElementById('chatDownloadBtn');
            const downloadModal = document.getElementById('chatDownloadModal');
            const closeDownloadModal = document.getElementById('closeChatDownloadModal');
            
            if (downloadBtn) {
                downloadBtn.addEventListener('click', function() {
                    downloadModal.style.display = 'flex';
                });
            }
            
            if (closeDownloadModal) {
                closeDownloadModal.addEventListener('click', function() {
                    downloadModal.style.display = 'none';
                });
            }
            
            // Setup download options
            const downloadOptions = document.querySelectorAll('.download-option');
            downloadOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const format = this.dataset.format;
                    downloadChatGPTConversation(format);
                });
            });
            
            // Setup voice input
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.lang = 'en-IN,hi-IN,mr-IN';
                
                recognition.onstart = function() {
                    isListening = true;
                    document.getElementById('chatInputMicrophoneBtn').classList.add('listening');
                    document.getElementById('chatVoiceInputStatus').style.display = 'flex';
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    if (event.results[0].isFinal) {
                        document.getElementById('chatMessageInput').value = transcript;
                        const textarea = document.getElementById('chatMessageInput');
                        textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
                        document.getElementById('chatSendButton').disabled = false;
                    }
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    isListening = false;
                    document.getElementById('chatInputMicrophoneBtn').classList.remove('listening');
                    document.getElementById('chatVoiceInputStatus').style.display = 'none';
                };
                
                recognition.onend = function() {
                    isListening = false;
                    document.getElementById('chatInputMicrophoneBtn').classList.remove('listening');
                    document.getElementById('chatVoiceInputStatus').style.display = 'none';
                };
                
                const voiceBtn = document.getElementById('chatInputMicrophoneBtn');
                if (voiceBtn) {
                    voiceBtn.addEventListener('click', function() {
                        if (isListening) {
                            recognition.stop();
                        } else {
                            recognition.start();
                        }
                    });
                }
            } else {
                const voiceBtn = document.getElementById('chatInputMicrophoneBtn');
                if (voiceBtn) {
                    voiceBtn.style.display = 'none';
                }
            }
            
            // Setup scroll to bottom button
            const scrollToBottomBtn = document.getElementById('scrollToBottomBtn');
            if (scrollToBottomBtn) {
                scrollToBottomBtn.addEventListener('click', function() {
                    const chatMessages = document.getElementById('chatGPTMessages');
                    chatMessages.scrollTo({
                        top: chatMessages.scrollHeight,
                        behavior: 'smooth'
                    });
                });
            }
            
            // Monitor scroll position
            const chatMessages = document.getElementById('chatGPTMessages');
            if (chatMessages) {
                chatMessages.addEventListener('scroll', checkChatScrollPosition);
                setTimeout(checkChatScrollPosition, 500);
            }
        }
        
        // Check scroll position for chat
        function checkChatScrollPosition() {
            const chatMessages = document.getElementById('chatGPTMessages');
            const scrollBtn = document.getElementById('scrollToBottomBtn');
            const indicator = document.getElementById('scrollPositionIndicator');
            
            if (!chatMessages) return;
            
            const isAtBottom = chatMessages.scrollHeight - chatMessages.clientHeight <= chatMessages.scrollTop + 50;
            
            if (!isAtBottom) {
                scrollBtn.style.opacity = '1';
                scrollBtn.style.transform = 'translateY(0)';
            } else {
                scrollBtn.style.opacity = '0';
                scrollBtn.style.transform = 'translateY(20px)';
            }
        }
        
        // Send ChatGPT-like message
        async function sendChatGPTMessage() {
            const messageInput = document.getElementById('chatMessageInput');
            const message = messageInput.value.trim();
            
            if (!message && attachedFiles.length === 0) {
                showChatToast('Please enter a message or attach a file 📝', 'warning');
                return;
            }
            
            if (isStreamingActive) {
                stopStreaming();
                return;
            }
            
            // Add user message to chat
            addChatGPTMessage(message, true);
            messageInput.value = '';
            messageInput.style.height = '52px';
            
            // Update send button to stop button
            const sendButton = document.getElementById('chatSendButton');
            sendButton.disabled = false;
            sendButton.innerHTML = '<i class="fas fa-stop"></i> <span>Stop</span>';
            sendButton.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
            isStreamingActive = true;
            stopStreamingRequested = false;
            
            try {
                // Store message in conversation history
                const userMessage = {
                    role: 'user',
                    content: message,
                    language: selectedLanguage,
                    timestamp: new Date().toISOString()
                };
                
                conversationHistory.push(userMessage);
                
                // Call your backend API
                const userId = window.legalSwamiAPI ? window.legalSwamiAPI.user?.id : 'guest_' + Date.now();
                const backendUrl = 'https://legal-swami-backend.onrender.com';
                
                const response = await fetch(backendUrl + '/api/v1/chat/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-user-id': userId,
                        'x-request-id': 'req_' + Date.now(),
                        'x-language': selectedLanguage
                    },
                    body: JSON.stringify({
                        message: message,
                        generateDocument: false,
                        language: selectedLanguage
                    })
                });
                
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status);
                }
                
                const data = await response.json();
                
                // Create streaming message
                const aiMessageId = createStreamingChatGPTMessage();
                
                // Start streaming the response
                startStreamingChatGPTResponse(aiMessageId, data.response);
                
            } catch (error) {
                console.error('Error sending message:', error);
                addChatGPTMessage("I apologize for the inconvenience. I'm currently experiencing technical difficulties. Please try again in a moment. ⚠️", false);
                
                // Reset send button
                const sendButton = document.getElementById('chatSendButton');
                sendButton.disabled = messageInput.value.trim() === '' && attachedFiles.length === 0;
                sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> <span>Send</span>';
                sendButton.style.background = 'linear-gradient(135deg, #10a37f 0%, #0d8c6d 100%)';
                isStreamingActive = false;
                
                showChatToast('Failed to send message. Please try again. ❌', 'error');
            }
        }
        
        // Add ChatGPT-like message to chat
        function addChatGPTMessage(content, isUser) {
            const chatMessages = document.getElementById('chatGPTMessages');
            
            // Remove welcome message if it exists and this is a user message
            if (isUser) {
                const welcomeMessage = document.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.style.display = 'flex';
            messageDiv.style.gap = '0.75rem';
            messageDiv.style.maxWidth = '100%';
            messageDiv.style.padding = '0 0.75rem';
            messageDiv.style.animation = 'fadeIn 0.2s ease-out';
            
            if (isUser) {
                messageDiv.style.background = '#40414f';
                messageDiv.style.borderRadius = '8px';
                messageDiv.style.padding = '1rem';
                messageDiv.style.maxWidth = '100%';
            }
            
            // Avatar
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.style.width = '32px';
            avatar.style.height = '32px';
            avatar.style.borderRadius = '4px';
            avatar.style.display = 'flex';
            avatar.style.alignItems = 'center';
            avatar.style.justifyContent = 'center';
            avatar.style.fontSize = '0.85rem';
            avatar.style.flexShrink = '0';
            avatar.style.marginTop = '4px';
            
            if (isUser) {
                avatar.style.background = 'linear-gradient(135deg, #10a37f 0%, #0d8c6d 100%)';
                avatar.innerHTML = '<i class="fas fa-user"></i>';
            } else {
                avatar.style.background = 'linear-gradient(135deg, #7e57c2 0%, #5e35b1 100%)';
                avatar.innerHTML = '<i class="fas fa-scale-balanced"></i>';
            }
            
            // Message content
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.style.flex = '1';
            messageContent.style.position = 'relative';
            messageContent.style.width = '100%';
            messageContent.style.minWidth = '0';
            
            const messageText = document.createElement('div');
            messageText.className = 'message-text';
            messageText.style.padding = '0';
            messageText.style.borderRadius = '0';
            messageText.style.fontSize = '0.9375rem';
            messageText.style.lineHeight = '1.6';
            messageText.style.wordWrap = 'break-word';
            messageText.style.overflowWrap = 'break-word';
            messageText.style.overflow = 'hidden';
            messageText.style.color = '#ececf1';
            
            if (isUser) {
                messageText.style.color = 'white';
            }
            
            messageText.innerHTML = content.replace(/\n/g, '<br>');
            
            messageContent.appendChild(messageText);
            
            // Add action buttons for AI messages
            if (!isUser) {
                const messageActions = document.createElement('div');
                messageActions.className = 'message-actions';
                messageActions.style.display = 'flex';
                messageActions.style.gap = '8px';
                messageActions.style.marginTop = '0.75rem';
                messageActions.style.flexWrap = 'wrap';
                messageActions.style.opacity = '0';
                messageActions.style.transition = 'opacity 0.2s ease';
                
                messageActions.innerHTML = `
                    <button class="action-btn copy" title="Copy response" style="background: #444654; color: #8e8ea0; border: 1px solid #565869; border-radius: 6px; padding: 0.375rem 0.75rem; cursor: pointer; font-size: 0.8125rem; transition: all 0.2s; display: flex; align-items: center; gap: 6px; min-height: 32px; font-weight: 500; white-space: nowrap;">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                    <button class="action-btn like" title="Mark as helpful" style="background: #444654; color: #8e8ea0; border: 1px solid #565869; border-radius: 6px; padding: 0.375rem 0.75rem; cursor: pointer; font-size: 0.8125rem; transition: all 0.2s; display: flex; align-items: center; gap: 6px; min-height: 32px; font-weight: 500; white-space: nowrap;">
                        <i class="far fa-thumbs-up"></i> Helpful
                    </button>
                `;
                
                messageContent.appendChild(messageActions);
                
                // Add hover effect to show actions
                messageDiv.addEventListener('mouseenter', function() {
                    messageActions.style.opacity = '1';
                });
                
                messageDiv.addEventListener('mouseleave', function() {
                    messageActions.style.opacity = '0';
                });
                
                // Add copy functionality
                const copyBtn = messageActions.querySelector('.copy');
                copyBtn.addEventListener('click', function() {
                    navigator.clipboard.writeText(content).then(function() {
                        showChatToast('Response copied to clipboard! 📋', 'success');
                    });
                });
                
                // Add like functionality
                const likeBtn = messageActions.querySelector('.like');
                likeBtn.addEventListener('click', function() {
                    this.innerHTML = '<i class="fas fa-thumbs-up"></i> Thank you!';
                    this.style.background = '#10b981';
                    this.style.borderColor = '#10b981';
                    this.style.color = 'white';
                    this.disabled = true;
                    showChatToast('Thank you for your feedback! 👍', 'success');
                });
            }
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to show new message
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
                checkChatScrollPosition();
            }, 100);
        }
        
        // Create streaming ChatGPT message
        function createStreamingChatGPTMessage() {
            const chatMessages = document.getElementById('chatGPTMessages');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai-message';
            messageDiv.style.display = 'flex';
            messageDiv.style.gap = '0.75rem';
            messageDiv.style.padding = '0 0.75rem';
            const messageId = 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            messageDiv.id = messageId;
            
            // Avatar
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.style.width = '32px';
            avatar.style.height = '32px';
            avatar.style.borderRadius = '4px';
            avatar.style.display = 'flex';
            avatar.style.alignItems = 'center';
            avatar.style.justifyContent = 'center';
            avatar.style.fontSize = '0.85rem';
            avatar.style.flexShrink = '0';
            avatar.style.marginTop = '4px';
            avatar.style.background = 'linear-gradient(135deg, #7e57c2 0%, #5e35b1 100%)';
            avatar.innerHTML = '<i class="fas fa-scale-balanced"></i>';
            
            // Message content
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.style.flex = '1';
            messageContent.style.position = 'relative';
            messageContent.style.width = '100%';
            messageContent.style.minWidth = '0';
            
            const messageText = document.createElement('div');
            messageText.className = 'message-text streaming-content';
            messageText.style.padding = '0';
            messageText.style.borderRadius = '0';
            messageText.style.fontSize = '0.9375rem';
            messageText.style.lineHeight = '1.6';
            messageText.style.wordWrap = 'break-word';
            messageText.style.overflowWrap = 'break-word';
            messageText.style.overflow = 'hidden';
            messageText.style.color = '#ececf1';
            messageText.innerHTML = '<span class="streaming-cursor" style="display: inline-block; width: 8px; height: 20px; background-color: #10a37f; margin-left: 4px; vertical-align: middle; animation: cursorBlink 1s infinite;"></span>';
            
            messageContent.appendChild(messageText);
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            chatMessages.appendChild(messageDiv);
            
            // Set as current streaming message
            currentStreamingMessageId = messageId;
            currentStreamingContent = '';
            streamingTextChunks = [];
            streamingTextIndex = 0;
            
            // Scroll to show new message
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
                checkChatScrollPosition();
            }, 100);
            
            return messageId;
        }
        
        // Start streaming ChatGPT response
        function startStreamingChatGPTResponse(messageId, response) {
            const messageDiv = document.getElementById(messageId);
            if (!messageDiv) return;
            
            let textToStream = response;
            streamingTextChunks = splitTextIntoChunks(textToStream);
            streamingTextIndex = 0;
            
            streamNextChatGPTChunk(messageId);
        }
        
        // Split text into chunks for streaming
        function splitTextIntoChunks(text) {
            const chunks = [];
            const regex = /[\s.,;!?।।॥]+|\S+/g;
            let match;
            
            while ((match = regex.exec(text)) !== null) {
                chunks.push(match[0]);
            }
            
            return chunks;
        }
        
        // Stream next chunk
        function streamNextChatGPTChunk(messageId) {
            if (stopStreamingRequested || streamingTextIndex >= streamingTextChunks.length) {
                if (stopStreamingRequested) {
                    console.log('Streaming stopped by user');
                } else {
                    finalizeStreamingChatGPTMessage(messageId);
                }
                return;
            }
            
            const chunk = streamingTextChunks[streamingTextIndex];
            streamingTextIndex++;
            
            updateStreamingChatGPTMessage(messageId, chunk);
            
            let delay = 50; // Adjust speed of streaming
            
            if (chunk.match(/[.,;!?।।॥]/)) {
                delay += 100;
            }
            
            setTimeout(() => {
                if (!stopStreamingRequested) {
                    streamNextChatGPTChunk(messageId);
                }
            }, delay);
        }
        
        // Update streaming message
        function updateStreamingChatGPTMessage(messageId, newContent) {
            const messageDiv = document.getElementById(messageId);
            if (!messageDiv) return;
            
            const messageText = messageDiv.querySelector('.message-text');
            
            currentStreamingContent += newContent;
            
            // Format the content
            let formattedContent = currentStreamingContent
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');
            
            // Add cursor
            messageText.innerHTML = formattedContent + '<span class="streaming-cursor" style="display: inline-block; width: 8px; height: 20px; background-color: #10a37f; margin-left: 4px; vertical-align: middle; animation: cursorBlink 1s infinite;"></span>';
            
            checkChatScrollPosition();
        }
        
        // Finalize streaming message
        function finalizeStreamingChatGPTMessage(messageId) {
            const messageDiv = document.getElementById(messageId);
            if (!messageDiv) return;
            
            const messageText = messageDiv.querySelector('.message-text');
            
            // Remove cursor
            const cursor = messageText.querySelector('.streaming-cursor');
            if (cursor) cursor.remove();
            
            // Format final content
            let formattedContent = currentStreamingContent
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');
            
            messageText.innerHTML = formattedContent;
            
            // Add action buttons
            const messageActions = document.createElement('div');
            messageActions.className = 'message-actions';
            messageActions.style.display = 'flex';
            messageActions.style.gap = '8px';
            messageActions.style.marginTop = '0.75rem';
            messageActions.style.flexWrap = 'wrap';
            messageActions.style.opacity = '0';
            messageActions.style.transition = 'opacity 0.2s ease';
            
            messageActions.innerHTML = `
                <button class="action-btn copy" title="Copy response" style="background: #444654; color: #8e8ea0; border: 1px solid #565869; border-radius: 6px; padding: 0.375rem 0.75rem; cursor: pointer; font-size: 0.8125rem; transition: all 0.2s; display: flex; align-items: center; gap: 6px; min-height: 32px; font-weight: 500; white-space: nowrap;">
                    <i class="fas fa-copy"></i> Copy
                </button>
                <button class="action-btn like" title="Mark as helpful" style="background: #444654; color: #8e8ea0; border: 1px solid #565869; border-radius: 6px; padding: 0.375rem 0.75rem; cursor: pointer; font-size: 0.8125rem; transition: all 0.2s; display: flex; align-items: center; gap: 6px; min-height: 32px; font-weight: 500; white-space: nowrap;">
                    <i class="far fa-thumbs-up"></i> Helpful
                </button>
            `;
            
            messageText.parentElement.appendChild(messageActions);
            
            // Add hover effect to show actions
            messageDiv.addEventListener('mouseenter', function() {
                messageActions.style.opacity = '1';
            });
            
            messageDiv.addEventListener('mouseleave', function() {
                messageActions.style.opacity = '0';
            });
            
            // Add copy functionality
            const copyBtn = messageActions.querySelector('.copy');
            copyBtn.addEventListener('click', function() {
                navigator.clipboard.writeText(currentStreamingContent).then(function() {
                    showChatToast('Response copied to clipboard! 📋', 'success');
                });
            });
            
            // Add like functionality
            const likeBtn = messageActions.querySelector('.like');
            likeBtn.addEventListener('click', function() {
                this.innerHTML = '<i class="fas fa-thumbs-up"></i> Thank you!';
                this.style.background = '#10b981';
                this.style.borderColor = '#10b981';
                this.style.color = 'white';
                this.disabled = true;
                showChatToast('Thank you for your feedback! 👍', 'success');
            });
            
            // Store in conversation history
            const aiMessage = {
                role: 'assistant',
                content: currentStreamingContent,
                language: selectedLanguage,
                timestamp: new Date().toISOString()
            };
            
            conversationHistory.push(aiMessage);
            
            // Save chat history
            saveChatHistory();
            
            // Reset streaming variables
            currentStreamingMessageId = null;
            currentStreamingContent = '';
            streamingTextChunks = [];
            streamingTextIndex = 0;
            isStreamingActive = false;
            stopStreamingRequested = false;
            
            // Reset send button
            const sendButton = document.getElementById('chatSendButton');
            sendButton.disabled = document.getElementById('chatMessageInput').value.trim() === '';
            sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> <span>Send</span>';
            sendButton.style.background = 'linear-gradient(135deg, #10a37f 0%, #0d8c6d 100%)';
        }
        
        // Stop streaming
        function stopStreaming() {
            stopStreamingRequested = true;
            isStreamingActive = false;
            
            // Reset send button
            const sendButton = document.getElementById('chatSendButton');
            sendButton.disabled = document.getElementById('chatMessageInput').value.trim() === '';
            sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> <span>Send</span>';
            sendButton.style.background = 'linear-gradient(135deg, #10a37f 0%, #0d8c6d 100%)';
            
            // Finalize current streaming message
            if (currentStreamingMessageId) {
                finalizeStreamingChatGPTMessage(currentStreamingMessageId);
            }
            
            showChatToast('Response stopped ⏹️', 'info');
        }
        
        // Clear ChatGPT chat
        function clearChatGPTChat() {
            if (conversationHistory.length === 0) {
                showChatToast('Chat is already empty 🗑️', 'warning');
                return;
            }
            
            if (confirm('Are you sure you want to clear the chat?')) {
                const chatMessages = document.getElementById('chatGPTMessages');
                chatMessages.innerHTML = '';
                conversationHistory = [];
                
                // Add welcome message
                const welcomeMessage = document.createElement('div');
                welcomeMessage.className = 'welcome-message';
                welcomeMessage.style.textAlign = 'center';
                welcomeMessage.style.maxWidth = '600px';
                welcomeMessage.style.margin = '1.5rem auto';
                welcomeMessage.style.padding = '1.25rem';
                welcomeMessage.style.background = 'linear-gradient(135deg, rgba(16, 163, 127, 0.1) 0%, rgba(30, 64, 175, 0.1) 100%)';
                welcomeMessage.style.border = '1px solid #565869';
                welcomeMessage.style.borderRadius = '12px';
                welcomeMessage.style.width = '90%';
                
                welcomeMessage.innerHTML = `
                    <h2 style="font-size: 1.5rem; margin-bottom: 0.75rem; background: linear-gradient(135deg, #10a37f 0%, #7e57c2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; word-wrap: break-word; font-weight: 600;">
                        Welcome to LegalSwami! ⚖️
                    </h2>
                    <p style="color: #8e8ea0; font-size: 0.9375rem; margin-bottom: 1rem; line-height: 1.5; word-wrap: break-word;">
                        I'm your AI legal assistant. I can help you with legal questions, document generation, and legal research.
                    </p>
                    
                    <div class="welcome-features" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.875rem; margin-top: 1.25rem;">
                        <div class="feature" style="background: #40414f; padding: 0.875rem; border-radius: 8px; border: 1px solid #565869; display: flex; flex-direction: column; align-items: center; text-align: center; word-wrap: break-word;">
                            <i class="fas fa-comments" style="font-size: 1.375rem; color: #10a37f; margin-bottom: 0.5rem;"></i>
                            <h4 style="font-size: 0.875rem; margin-bottom: 0.25rem; color: #ececf1; font-weight: 600;">Legal Advice</h4>
                            <p style="font-size: 0.8125rem; color: #8e8ea0;">Get instant answers to your legal questions</p>
                        </div>
                        <div class="feature" style="background: #40414f; padding: 0.875rem; border-radius: 8px; border: 1px solid #565869; display: flex; flex-direction: column; align-items: center; text-align: center; word-wrap: break-word;">
                            <i class="fas fa-file-contract" style="font-size: 1.375rem; color: #10a37f; margin-bottom: 0.5rem;"></i>
                            <h4 style="font-size: 0.875rem; margin-bottom: 0.25rem; color: #ececf1; font-weight: 600;">Document Generation</h4>
                            <p style="font-size: 0.8125rem; color: #8e8ea0;">Generate legal documents instantly</p>
                        </div>
                        <div class="feature" style="background: #40414f; padding: 0.875rem; border-radius: 8px; border: 1px solid #565869; display: flex; flex-direction: column; align-items: center; text-align: center; word-wrap: break-word;">
                            <i class="fas fa-search" style="font-size: 1.375rem; color: #10a37f; margin-bottom: 0.5rem;"></i>
                            <h4 style="font-size: 0.875rem; margin-bottom: 0.25rem; color: #ececf1; font-weight: 600;">Legal Research</h4>
                            <p style="font-size: 0.8125rem; color: #8e8ea0;">Research laws and regulations</p>
                        </div>
                        <div class="feature" style="background: #40414f; padding: 0.875rem; border-radius: 8px; border: 1px solid #565869; display: flex; flex-direction: column; align-items: center; text-align: center; word-wrap: break-word;">
                            <i class="fas fa-gavel" style="font-size: 1.375rem; color: #10a37f; margin-bottom: 0.5rem;"></i>
                            <h4 style="font-size: 0.875rem; margin-bottom: 0.25rem; color: #ececf1; font-weight: 600;">Case Law Search</h4>
                            <p style="font-size: 0.8125rem; color: #8e8ea0;">Find relevant case laws</p>
                        </div>
                    </div>
                    
                    <div class="language-selector" style="margin-top: 1.5rem;">
                        <h5 style="color: #10a37f; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 8px; font-size: 0.875rem;">
                            <i class="fas fa-language"></i> Select Language:
                        </h5>
                        <div class="language-buttons" style="display: flex; gap: 8px; justify-content: center;">
                            <button class="lang-btn" data-lang="en" style="background: #40414f; color: #ececf1; border: 1px solid #565869; border-radius: 6px; padding: 0.5rem 1rem; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">English</button>
                            <button class="lang-btn" data-lang="hi" style="background: #40414f; color: #ececf1; border: 1px solid #565869; border-radius: 6px; padding: 0.5rem 1rem; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">हिंदी</button>
                            <button class="lang-btn" data-lang="mr" style="background: #40414f; color: #ececf1; border: 1px solid #565869; border-radius: 6px; padding: 0.5rem 1rem; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">मराठी</button>
                            <button class="lang-btn" data-lang="gu" style="background: #40414f; color: #ececf1; border: 1px solid #565869; border-radius: 6px; padding: 0.5rem 1rem; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">ગુજરાતી</button>
                        </div>
                    </div>
                `;
                
                chatMessages.appendChild(welcomeMessage);
                
                // Setup language buttons in welcome message
                const langButtons = welcomeMessage.querySelectorAll('.lang-btn');
                langButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const lang = this.getAttribute('data-lang');
                        selectedLanguage = lang;
                        langButtons.forEach(b => b.style.background = '#40414f');
                        this.style.background = '#10a37f';
                        showChatToast(`Language changed to ${getLanguageName(lang)}`, 'info');
                    });
                });
                
                showChatToast('Chat cleared 🗑️', 'success');
            }
        }
        
        // Download ChatGPT conversation
        function downloadChatGPTConversation(format) {
            const indicator = document.getElementById('chatProgressIndicator');
            indicator.style.display = 'flex';
            
            setTimeout(() => {
                let content = 'LegalSwami Chat Conversation\n';
                content += `Date: ${new Date().toLocaleString()}\n`;
                content += '='.repeat(50) + '\n\n';
                
                conversationHistory.forEach((msg, index) => {
                    const role = msg.role === 'user' ? 'You' : 'LegalSwami AI';
                    const time = msg.timestamp ? new Date(msg.timestamp).toLocaleTimeString() : new Date().toLocaleTimeString();
                    content += `${role} (${time}):\n`;
                    content += msg.content + '\n\n';
                    content += '-'.repeat(30) + '\n\n';
                });
                
                const fileName = `LegalSwami-Chat-${formatDateForFilename(new Date())}`;
                
                switch(format) {
                    case 'pdf':
                        downloadAsPDF(content, fileName);
                        break;
                    case 'doc':
                        downloadAsDOC(content, fileName);
                        break;
                    case 'txt':
                        downloadAsTXT(content, fileName);
                        break;
                }
                
                indicator.style.display = 'none';
                document.getElementById('chatDownloadModal').style.display = 'none';
            }, 500);
        }
        
        // Format date for filename
        function formatDateForFilename(date) {
            return date.toISOString()
                .replace(/[:\-]/g, '')
                .replace('T', '_')
                .split('.')[0];
        }
        
        // Download as PDF
        function downloadAsPDF(content, filename) {
            // For now, fall back to text download since we don't have jsPDF in scope
            downloadAsTXT(content, filename);
            showChatToast('PDF download not available. Text file downloaded instead.', 'info');
        }
        
        // Download as DOC
        function downloadAsDOC(content, filename) {
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${filename}</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 40px; }
                        h1 { color: #10a37f; }
                        .timestamp { color: #666; font-size: 0.9em; }
                        .user { color: #10a37f; font-weight: bold; }
                        .ai { color: #7e57c2; font-weight: bold; }
                        .disclaimer { 
                            background-color: #f8f9fa; 
                            border-left: 4px solid #f59e0b;
                            padding: 10px;
                            margin-top: 20px;
                            font-size: 0.9em;
                        }
                    </style>
                </head>
                <body>
                    <h1>${filename} ⚖️</h1>
                    <p class="timestamp">Generated on: ${new Date().toLocaleString()}</p>
                    <hr>
                    <pre style="white-space: pre-wrap; font-family: inherit;">${content}</pre>
                    <div class="disclaimer">
                        <strong>Disclaimer:</strong> This document is generated by LegalSwami AI Assistant for informational purposes only and does not constitute legal advice. ⚖️
                    </div>
                </body>
                </html>
            `;
            
            const blob = new Blob([htmlContent], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}.doc`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showChatToast('Word document downloaded 📥', 'success');
        }
        
        // Download as TXT
        function downloadAsTXT(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showChatToast('Text file downloaded 📥', 'success');
        }
        
        // Show chat toast
        function showChatToast(message, type = 'success') {
            const toast = document.getElementById('chatToast');
            const toastMessage = document.getElementById('chatToastMessage');
            
            if (!toast || !toastMessage) return;
            
            toastMessage.textContent = message;
            toast.className = 'toast show';
            toast.style.borderLeft = '4px solid ' + 
                (type === 'success' ? '#10b981' : 
                 type === 'error' ? '#ef4444' : 
                 type === 'warning' ? '#f59e0b' : '#10a37f');
            
            // Set icon based on type
            const icon = toast.querySelector('i');
            if (icon) {
                icon.className = 
                    type === 'success' ? 'fas fa-check-circle' :
                    type === 'error' ? 'fas fa-exclamation-circle' :
                    type === 'warning' ? 'fas fa-exclamation-triangle' : 'fas fa-info-circle';
            }
            
            toast.style.transform = 'translateY(0)';
            toast.style.opacity = '1';
            
            setTimeout(() => {
                toast.style.transform = 'translateY(100px)';
                toast.style.opacity = '0';
            }, 3000);
        }
        
        // Load chat history
        function loadChatHistory() {
            try {
                const savedHistory = localStorage.getItem('legalSwamiChatHistory');
                if (savedHistory) {
                    chatHistory = JSON.parse(savedHistory);
                }
            } catch (error) {
                console.error('Error loading chat history:', error);
                chatHistory = [];
            }
        }
        
        // Save chat history
        function saveChatHistory() {
            try {
                // Add current conversation to history if not empty
                if (conversationHistory.length > 0) {
                    const chatTitle = conversationHistory[0]?.content?.substring(0, 30) || 'New Chat';
                    const chatPreview = conversationHistory[conversationHistory.length - 1]?.content?.substring(0, 50) || '';
                    
                    const chatData = {
                        id: 'chat_' + Date.now(),
                        title: chatTitle,
                        preview: chatPreview,
                        date: new Date().toISOString(),
                        messages: [...conversationHistory]
                    };
                    
                    chatHistory.unshift(chatData);
                    
                    // Keep only last 20 chats
                    if (chatHistory.length > 20) {
                        chatHistory = chatHistory.slice(0, 20);
                    }
                    
                    localStorage.setItem('legalSwamiChatHistory', JSON.stringify(chatHistory));
                    
                    // Update history list
                    loadChatHistoryList();
                }
            } catch (error) {
                console.error('Error saving chat history:', error);
            }
        }
        
        // Load chat history list
        function loadChatHistoryList() {
            const historyList = document.getElementById('chatHistoryList');
            if (!historyList) return;
            
            if (chatHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-history" style="text-align: center; padding: 2.5rem 1rem; color: #8e8ea0;">
                        <i class="fas fa-comments" style="font-size: 1.75rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p style="font-size: 0.875rem;">No chat history yet</p>
                        <p style="font-size: 0.8125rem; margin-top: 0.5rem;">Start a conversation to see it here</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            chatHistory.forEach(chat => {
                const date = new Date(chat.date);
                const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                html += `
                    <div class="history-item" data-chat-id="${chat.id}" style="padding: 0.75rem; background: transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s; border: none; display: flex; flex-direction: column; gap: 4px; color: #ececf1; margin-bottom: 4px; position: relative; text-align: left; width: 100%;">
                        <div class="history-title" style="font-size: 0.875rem; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 60px;">${chat.title}</div>
                        <div class="history-preview" style="font-size: 0.8rem; color: #8e8ea0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 60px;">${chat.preview}</div>
                        <div class="history-date" style="font-size: 0.75rem; color: #8e8ea0;">${formattedDate}</div>
                    </div>
                `;
            });
            
            historyList.innerHTML = html;
            
            // Add click handlers to load chat history
            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', function() {
                    const chatId = this.dataset.chatId;
                    loadChatFromHistory(chatId);
                });
            });
        }
        
        // Load chat from history
        function loadChatFromHistory(chatId) {
            const chat = chatHistory.find(c => c.id === chatId);
            if (!chat) return;
            
            conversationHistory = [...chat.messages];
            
            const chatMessages = document.getElementById('chatGPTMessages');
            chatMessages.innerHTML = '';
            
            chat.messages.forEach(msg => {
                addChatGPTMessage(msg.content, msg.role === 'user');
            });
            
            // Close sidebar on mobile
            if (window.innerWidth < 1024) {
                document.getElementById('chatSidebar').style.transform = 'translateX(-100%)';
                document.getElementById('chatSidebarOverlay').style.display = 'none';
            }
            
            showChatToast('Chat loaded from history 📚', 'success');
        }
        
        // Start ChatGPT-like chat
        function startChatGPTLikeChat() {
            const chatInterface = document.getElementById('chatInterface');
            if (chatInterface) {
                chatInterface.style.display = 'flex';
                isChatOpen = true;
                
                // Hide main content
                document.querySelector('.main-container').style.display = 'none';
                
                // Focus input after a delay
                setTimeout(function() {
                    const messageInput = document.getElementById('chatMessageInput');
                    if (messageInput) {
                        messageInput.focus();
                    }
                }, 500);
                
                console.log('✅ ChatGPT-like chat interface shown');
            }
        }
        
        // Go back to home from chat
        function goBackToHome() {
            const chatInterface = document.getElementById('chatInterface');
            if (chatInterface) {
                chatInterface.style.display = 'none';
                isChatOpen = false;
                
                // Show main content
                document.querySelector('.main-container').style.display = 'block';
                
                console.log('✅ Returned to home from chat');
            }
        }
        
        // The rest of your existing functions remain the same...
        // Setup Language Buttons
        function setupLanguageButtons() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    selectedLanguage = lang;
                    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update chat placeholder based on language
                    const messageInput = document.getElementById('messageInput');
                    if (messageInput) {
                        if (lang === 'hi') {
                            messageInput.placeholder = "अपना कानूनी प्रश्न यहां टाइप करें...";
                        } else if (lang === 'mr') {
                            messageInput.placeholder = "तुमचा कायदेशीर प्रश्न येथे टाइप करा...";
                        } else if (lang === 'gu') {
                            messageInput.placeholder = "તમારો કાનૂની પ્રશ્ન અહીં ટાઈપ કરો...";
                        } else {
                            messageInput.placeholder = "Type your legal question here...";
                        }
                    }
                    
                    showToast(`Language changed to ${getLanguageName(lang)}`, 'info');
                });
            });
        }
        
        function getLanguageName(code) {
            const languages = {
                'en': 'English',
                'hi': 'Hindi',
                'mr': 'Marathi',
                'gu': 'Gujarati'
            };
            return languages[code] || 'English';
        }
        
        // Apply mobile optimizations
        function applyMobileOptimizations() {
            console.log('📱 Applying mobile optimizations...');
            
            // Larger touch targets
            const touchElements = document.querySelectorAll('button, .nav-link, .quick-btn, .chat-action-btn');
            touchElements.forEach(el => {
                el.style.minHeight = '44px';
                el.style.minWidth = '44px';
            });
            
            // Prevent zoom on input focus
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    if (isMobile) {
                        setTimeout(() => {
                            this.style.fontSize = '16px';
                        }, 100);
                    }
                });
            });
            
            // Better mobile scrolling
            document.body.style.overflowX = 'hidden';
            document.body.style.touchAction = 'manipulation';
            
            console.log('✅ Mobile optimizations applied');
        }
        
        // Setup device specific optimizations
        function setupDeviceSpecificOptimizations() {
            // Tablet specific optimizations
            if (isTablet) {
                console.log('📱 Tablet optimizations enabled');
                
                // Adjust font sizes for tablet
                document.documentElement.style.fontSize = '15px';
                
                // Adjust grid layouts
                const grids = document.querySelectorAll('.features-grid, .documents-grid');
                grids.forEach(grid => {
                    if (window.innerWidth <= 1024) {
                        grid.style.gridTemplateColumns = 'repeat(2, 1fr)';
                    }
                });
            }
            
            // Mobile specific optimizations
            if (isMobile) {
                // Add swipe support for mobile menu
                let startX, startY;
                
                document.addEventListener('touchstart', function(e) {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                });
                
                document.addEventListener('touchend', function(e) {
                    if (!startX || !startY) return;
                    
                    const endX = e.changedTouches[0].clientX;
                    const endY = e.changedTouches[0].clientY;
                    
                    const diffX = startX - endX;
                    const diffY = startY - endY;
                    
                    // Horizontal swipe (for chat interface)
                    if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                        if (diffX > 0 && isChatOpen) {
                            // Swipe left - go back to home
                            const backBtn = document.getElementById('backToHome');
                            if (backBtn) {
                                backBtn.click();
                            }
                        }
                    }
                });
            }
        }
        
        // SETUP SCROLL EFFECTS
        function setupScrollEffects() {
            const header = document.querySelector('.premium-navbar');
            const navLinks = document.querySelectorAll('.nav-link');
            const backToTopBtn = document.getElementById('backToTop');
            
            window.addEventListener('scroll', function() {
                // Header shadow on scroll
                if (header && window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else if (header) {
                    header.classList.remove('scrolled');
                }
                
                // Back to top button
                if (backToTopBtn) {
                    if (window.scrollY > 300) {
                        backToTopBtn.classList.add('visible');
                    } else {
                        backToTopBtn.classList.remove('visible');
                    }
                }
                
                // Update active nav link based on scroll position
                if (!isChatOpen) {
                    const sections = document.querySelectorAll('section[id]');
                    let currentSection = '';
                    
                    sections.forEach(function(section) {
                        const sectionTop = section.offsetTop - 100;
                        const sectionHeight = section.clientHeight;
                        if (scrollY >= sectionTop && scrollY < sectionTop + sectionHeight) {
                            currentSection = section.getAttribute('id') || 'home';
                        }
                    });
                    
                    navLinks.forEach(function(link) {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === '#' + currentSection) {
                            link.classList.add('active');
                        }
                    });
                    
                    // Update mobile links
                    const mobileLinks = document.querySelectorAll('.mobile-link');
                    mobileLinks.forEach(function(link) {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === '#' + currentSection) {
                            link.classList.add('active');
                        }
                    });
                }
            });
            
            // Back to top functionality
            if (backToTopBtn) {
                backToTopBtn.addEventListener('click', function() {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }
        }
        
        // SETUP MOBILE MENU
        function setupMobileMenu() {
            const mobileToggle = document.getElementById('mobileToggle');
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileClose = document.getElementById('mobileClose');
            const mobileLinks = document.querySelectorAll('.mobile-link');
            const mobileStartChat = document.getElementById('mobileStartChat');
            
            if (mobileToggle) {
                mobileToggle.addEventListener('click', function() {
                    isMobileMenuOpen = !isMobileMenuOpen;
                    if (mobileMenu) {
                        if (isMobileMenuOpen) {
                            mobileMenu.style.display = 'block';
                            setTimeout(function() {
                                mobileMenu.style.opacity = '1';
                            }, 10);
                            // Prevent background scrolling
                            document.body.style.overflow = 'hidden';
                        } else {
                            mobileMenu.style.opacity = '0';
                            setTimeout(function() {
                                mobileMenu.style.display = 'none';
                            }, 300);
                            // Restore scrolling
                            document.body.style.overflow = '';
                        }
                        this.innerHTML = isMobileMenuOpen ? 
                            '<i class="fas fa-times"></i>' : 
                            '<i class="fas fa-bars"></i>';
                    }
                });
            }
            
            if (mobileClose) {
                mobileClose.addEventListener('click', function() {
                    isMobileMenuOpen = false;
                    if (mobileMenu) {
                        mobileMenu.style.opacity = '0';
                        setTimeout(function() {
                            mobileMenu.style.display = 'none';
                        }, 300);
                        // Restore scrolling
                        document.body.style.overflow = '';
                        if (mobileToggle) {
                            mobileToggle.innerHTML = '<i class="fas fa-bars"></i>';
                        }
                    }
                });
            }
            
            // Close menu when clicking a link
            mobileLinks.forEach(function(link) {
                link.addEventListener('click', function(e) {
                    if (this.getAttribute('href') !== '#chat') {
                        e.preventDefault();
                        const targetId = this.getAttribute('href').substring(1);
                        const targetSection = document.getElementById(targetId);
                        if (targetSection) {
                            targetSection.scrollIntoView({ behavior: 'smooth' });
                        }
                    }
                    
                    isMobileMenuOpen = false;
                    if (mobileMenu) {
                        mobileMenu.style.opacity = '0';
                        setTimeout(function() {
                            mobileMenu.style.display = 'none';
                        }, 300);
                        // Restore scrolling
                        document.body.style.overflow = '';
                        if (mobileToggle) {
                            mobileToggle.innerHTML = '<i class="fas fa-bars"></i>';
                        }
                    }
                });
            });
            
            // Mobile start chat button
            if (mobileStartChat) {
                mobileStartChat.addEventListener('click', function(e) {
                    e.preventDefault();
                    startChat();
                    if (mobileMenu) {
                        mobileMenu.style.opacity = '0';
                        setTimeout(function() {
                            mobileMenu.style.display = 'none';
                        }, 300);
                        isMobileMenuOpen = false;
                        // Restore scrolling
                        document.body.style.overflow = '';
                        if (mobileToggle) {
                            mobileToggle.innerHTML = '<i class="fas fa-bars"></i>';
                        }
                    }
                });
            }
            
            // Close menu when clicking outside
            if (mobileMenu) {
                mobileMenu.addEventListener('click', function(e) {
                    if (e.target === this) {
                        isMobileMenuOpen = false;
                        this.style.opacity = '0';
                        setTimeout(function() {
                            this.style.display = 'none';
                        }, 300);
                        // Restore scrolling
                        document.body.style.overflow = '';
                        if (mobileToggle) {
                            mobileToggle.innerHTML = '<i class="fas fa-bars"></i>';
                        }
                    }
                });
            }
        }
        
        // Load Lawyers
        function loadLawyers(specialization = 'all') {
            const lawyersGrid = document.getElementById('lawyersGrid');
            if (!lawyersGrid) return;
            
            let filteredLawyers = lawyers;
            if (specialization !== 'all') {
                filteredLawyers = lawyers.filter(lawyer => lawyer.specialization === specialization);
            }
            
            lawyersGrid.innerHTML = '';
            
            filteredLawyers.forEach(lawyer => {
                const lawyerCard = document.createElement('div');
                lawyerCard.className = 'lawyer-card premium-card';
                
                lawyerCard.innerHTML = `
                    <div class="lawyer-avatar">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="lawyer-info">
                        <h3 class="lawyer-name">${lawyer.name}</h3>
                        <div class="lawyer-specialization">
                            <i class="fas fa-briefcase"></i>
                            <span>${lawyer.specialization.charAt(0).toUpperCase() + lawyer.specialization.slice(1)} Law</span>
                        </div>
                        <div class="lawyer-details">
                            <div class="detail">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${lawyer.location}</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-history"></i>
                                <span>${lawyer.experience} years</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-star"></i>
                                <span>${lawyer.rating}/5</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-rupee-sign"></i>
                                <span>${lawyer.fee}</span>
                            </div>
                        </div>
                        <button class="btn-contact" onclick="contactLawyer(${lawyer.id})">
                            <i class="fas fa-phone"></i>
                            Contact Lawyer
                        </button>
                    </div>
                `;
                
                lawyersGrid.appendChild(lawyerCard);
            });
            
            // Setup filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const spec = this.getAttribute('data-specialization');
                    loadLawyers(spec);
                });
            });
        }
        
        // Contact Lawyer
        function contactLawyer(lawyerId) {
            const lawyer = lawyers.find(l => l.id === lawyerId);
            if (lawyer) {
                showToast(`Connecting you with ${lawyer.name}...`, 'info');
                // In a real app, this would initiate a call or chat
                setTimeout(() => {
                    alert(`Contact Information:\n\nName: ${lawyer.name}\nSpecialization: ${lawyer.specialization}\nLocation: ${lawyer.location}\nFee: ${lawyer.fee}\n\nPlease note: This is a demo. In the real app, you would be able to call or message the lawyer directly.`);
                }, 1000);
            }
        }
        
        // Search Lawyers
        function searchLawyers() {
            const searchInput = document.getElementById('lawyerSearch');
            if (!searchInput) return;
            
            const query = searchInput.value.toLowerCase().trim();
            if (!query) {
                loadLawyers('all');
                return;
            }
            
            const filteredLawyers = lawyers.filter(lawyer => 
                lawyer.name.toLowerCase().includes(query) ||
                lawyer.specialization.toLowerCase().includes(query) ||
                lawyer.location.toLowerCase().includes(query)
            );
            
            const lawyersGrid = document.getElementById('lawyersGrid');
            if (!lawyersGrid) return;
            
            lawyersGrid.innerHTML = '';
            
            if (filteredLawyers.length === 0) {
                lawyersGrid.innerHTML = '<div class="no-results">No lawyers found matching your search criteria.</div>';
                return;
            }
            
            filteredLawyers.forEach(lawyer => {
                const lawyerCard = document.createElement('div');
                lawyerCard.className = 'lawyer-card premium-card';
                
                lawyerCard.innerHTML = `
                    <div class="lawyer-avatar">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="lawyer-info">
                        <h3 class="lawyer-name">${lawyer.name}</h3>
                        <div class="lawyer-specialization">
                            <i class="fas fa-briefcase"></i>
                            <span>${lawyer.specialization.charAt(0).toUpperCase() + lawyer.specialization.slice(1)} Law</span>
                        </div>
                        <div class="lawyer-details">
                            <div class="detail">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${lawyer.location}</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-history"></i>
                                <span>${lawyer.experience} years</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-star"></i>
                                <span>${lawyer.rating}/5</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-rupee-sign"></i>
                                <span>${lawyer.fee}</span>
                            </div>
                        </div>
                        <button class="btn-contact" onclick="contactLawyer(${lawyer.id})">
                            <i class="fas fa-phone"></i>
                            Contact Lawyer
                        </button>
                    </div>
                `;
                
                lawyersGrid.appendChild(lawyerCard);
            });
        }
        
        // Legal Act Search
        function searchActs() {
            showToast('Opening Legal Acts Search...', 'info');
            // In a real app, this would open a search interface
            alert('Legal Acts Search\n\nSearch through Indian legal acts and statutes:\n\n1. Indian Penal Code (IPC)\n2. Code of Criminal Procedure (CrPC)\n3. Code of Civil Procedure (CPC)\n4. Indian Evidence Act\n5. Consumer Protection Act\n6. Transfer of Property Act\n7. Contract Act\n8. Constitution of India\n\nThis feature would allow detailed search and browsing in the complete version.');
        }
        
        // Case Law Search
        function searchCaseLaws() {
            showToast('Searching Case Laws...', 'info');
            // In a real app, this would search a case law database
            alert('Case Law Search\n\nSearch through:\n- Supreme Court Judgments\n- High Court Judgments\n- Landmark Cases\n- Recent Judgments\n\nThis feature would connect to a legal database in the complete version.');
        }
        
        // Open Legal Calculator
        function openLegalCalculator(type = 'court-fee') {
            const modal = document.getElementById('legalToolsModal');
            if (modal) {
                modal.style.display = 'none';
            }
            
            let calculatorHTML = '';
            let title = '';
            
            switch(type) {
                case 'court-fee':
                    title = 'Court Fee Calculator';
                    calculatorHTML = `
                        <div class="calculator">
                            <h4>Calculate Court Fees</h4>
                            <div class="input-group">
                                <label>Case Type:</label>
                                <select id="caseType">
                                    <option value="civil">Civil Case</option>
                                    <option value="criminal">Criminal Case</option>
                                    <option value="family">Family Dispute</option>
                                    <option value="property">Property Case</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Case Value (₹):</label>
                                <input type="number" id="caseValue" placeholder="Enter case value" min="0" value="100000">
                            </div>
                            <div class="input-group">
                                <label>State:</label>
                                <select id="state">
                                    <option value="delhi">Delhi</option>
                                    <option value="mumbai">Maharashtra</option>
                                    <option value="bangalore">Karnataka</option>
                                    <option value="chennai">Tamil Nadu</option>
                                </select>
                            </div>
                            <button class="btn-calculate" onclick="calculateCourtFee()">Calculate</button>
                            <div class="result" id="feeResult"></div>
                        </div>
                    `;
                    break;
                    
                case 'stamp-duty':
                    title = 'Stamp Duty Calculator';
                    calculatorHTML = `
                        <div class="calculator">
                            <h4>Calculate Stamp Duty</h4>
                            <div class="input-group">
                                <label>Document Type:</label>
                                <select id="docType">
                                    <option value="sale">Sale Deed</option>
                                    <option value="rent">Rent Agreement</option>
                                    <option value="gift">Gift Deed</option>
                                    <option value="mortgage">Mortgage Deed</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Property Value (₹):</label>
                                <input type="number" id="propertyValue" placeholder="Enter property value" min="0" value="5000000">
                            </div>
                            <div class="input-group">
                                <label>State:</label>
                                <select id="stateStamp">
                                    <option value="delhi">Delhi</option>
                                    <option value="mumbai">Maharashtra</option>
                                    <option value="bangalore">Karnataka</option>
                                    <option value="chennai">Tamil Nadu</option>
                                </select>
                            </div>
                            <button class="btn-calculate" onclick="calculateStampDuty()">Calculate</button>
                            <div class="result" id="stampResult"></div>
                        </div>
                    `;
                    break;
                    
                case 'compensation':
                    title = 'Compensation Calculator';
                    calculatorHTML = `
                        <div class="calculator">
                            <h4>Calculate Compensation</h4>
                            <div class="input-group">
                                <label>Type of Claim:</label>
                                <select id="claimType">
                                    <option value="accident">Road Accident</option>
                                    <option value="medical">Medical Negligence</option>
                                    <option value="employment">Employment Dispute</option>
                                    <option value="consumer">Consumer Complaint</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Monthly Income (₹):</label>
                                <input type="number" id="monthlyIncome" placeholder="Enter monthly income" min="0" value="30000">
                            </div>
                            <div class="input-group">
                                <label>Age:</label>
                                <input type="number" id="age" placeholder="Enter age" min="18" max="70" value="35">
                            </div>
                            <div class="input-group">
                                <label>Disability (%):</label>
                                <input type="number" id="disability" placeholder="Enter disability percentage" min="0" max="100" value="40">
                            </div>
                            <button class="btn-calculate" onclick="calculateCompensation()">Calculate</button>
                            <div class="result" id="compResult"></div>
                        </div>
                    `;
                    break;
            }
            
            showCalculatorModal(title, calculatorHTML);
        }
        
        // Show Calculator Modal
        function showCalculatorModal(title, content) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'calculatorModal';
            modal.innerHTML = `
                <div class="modal-overlay" onclick="closeModal('calculatorModal')"></div>
                <div class="modal-content">
                    <button class="modal-close" onclick="closeModal('calculatorModal')">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="modal-header">
                        <div class="modal-icon legal-seal">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <h3>${title}</h3>
                    </div>
                    <div class="modal-body">
                        ${content}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
            document.body.classList.add('modal-open');
        }
        
        // Close Modal
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                document.body.classList.remove('modal-open');
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }
        
        // Calculate Court Fee
        function calculateCourtFee() {
            const caseType = document.getElementById('caseType').value;
            const caseValue = parseInt(document.getElementById('caseValue').value) || 0;
            const state = document.getElementById('state').value;
            
            let fee = 0;
            
            // Simplified calculation (in real app, this would be more complex)
            if (caseValue <= 100000) {
                fee = caseValue * 0.05; // 5%
            } else if (caseValue <= 500000) {
                fee = 5000 + (caseValue - 100000) * 0.04; // 4%
            } else if (caseValue <= 1000000) {
                fee = 21000 + (caseValue - 500000) * 0.03; // 3%
            } else {
                fee = 36000 + (caseValue - 1000000) * 0.02; // 2%
            }
            
            // Minimum fee
            fee = Math.max(fee, 100);
            
            const resultDiv = document.getElementById('feeResult');
            if (resultDiv) {
                resultDiv.innerHTML = `
                    <div class="result-card">
                        <h5>Calculated Court Fee:</h5>
                        <div class="result-amount">₹${fee.toFixed(2)}</div>
                        <div class="result-details">
                            <p><i class="fas fa-info-circle"></i> Based on case value: ₹${caseValue.toLocaleString()}</p>
                            <p><i class="fas fa-map-marker-alt"></i> State: ${state.toUpperCase()}</p>
                            <p><i class="fas fa-gavel"></i> Case Type: ${caseType.toUpperCase()}</p>
                        </div>
                        <p class="result-note"><i class="fas fa-exclamation-triangle"></i> Note: This is an estimate. Actual fees may vary based on specific circumstances.</p>
                    </div>
                `;
            }
        }
        
        // Calculate Stamp Duty
        function calculateStampDuty() {
            const docType = document.getElementById('docType').value;
            const propertyValue = parseInt(document.getElementById('propertyValue').value) || 0;
            const state = document.getElementById('stateStamp').value;
            
            let dutyRate = 0;
            
            // Simplified rates by state and document type
            if (state === 'delhi') {
                dutyRate = 0.06; // 6%
            } else if (state === 'mumbai') {
                dutyRate = 0.05; // 5%
            } else if (state === 'bangalore') {
                dutyRate = 0.055; // 5.5%
            } else {
                dutyRate = 0.07; // 7%
            }
            
            // Adjust based on document type
            if (docType === 'rent') {
                dutyRate = 0.01; // 1% for rent agreements
            } else if (docType === 'gift') {
                dutyRate = dutyRate * 0.5; // 50% of normal rate for gifts
            }
            
            const duty = propertyValue * dutyRate;
            const registrationFee = Math.min(propertyValue * 0.01, 30000); // 1% max 30,000
            const total = duty + registrationFee;
            
            const resultDiv = document.getElementById('stampResult');
            if (resultDiv) {
                resultDiv.innerHTML = `
                    <div class="result-card">
                        <h5>Calculated Stamp Duty:</h5>
                        <div class="result-amount">₹${total.toFixed(2)}</div>
                        <div class="result-breakdown">
                            <p><i class="fas fa-file-invoice-dollar"></i> Stamp Duty: ₹${duty.toFixed(2)} (${(dutyRate*100).toFixed(1)}%)</p>
                            <p><i class="fas fa-file-signature"></i> Registration Fee: ₹${registrationFee.toFixed(2)}</p>
                            <p><i class="fas fa-tag"></i> Document Type: ${docType.toUpperCase()}</p>
                            <p><i class="fas fa-map-marker-alt"></i> State: ${state.toUpperCase()}</p>
                        </div>
                        <p class="result-note"><i class="fas fa-exclamation-triangle"></i> Note: Additional charges may apply for franking and other services.</p>
                    </div>
                `;
            }
        }
        
        // Calculate Compensation
        function calculateCompensation() {
            const claimType = document.getElementById('claimType').value;
            const monthlyIncome = parseInt(document.getElementById('monthlyIncome').value) || 0;
            const age = parseInt(document.getElementById('age').value) || 35;
            const disability = parseInt(document.getElementById('disability').value) || 0;
            
            let compensation = 0;
            let multiplier = 0;
            
            // Calculate multiplier based on age
            if (age <= 25) {
                multiplier = 18;
            } else if (age <= 30) {
                multiplier = 17;
            } else if (age <= 35) {
                multiplier = 16;
            } else if (age <= 40) {
                multiplier = 15;
            } else if (age <= 45) {
                multiplier = 14;
            } else if (age <= 50) {
                multiplier = 13;
            } else if (age <= 55) {
                multiplier = 11;
            } else if (age <= 60) {
                multiplier = 9;
            } else {
                multiplier = 8;
            }
            
            // Base compensation calculation
            compensation = monthlyIncome * 12 * multiplier;
            
            // Adjust for disability
            if (disability > 0) {
                compensation = compensation * (disability / 100);
            }
            
            // Add pain and suffering
            let painSuffering = 0;
            if (claimType === 'accident') {
                painSuffering = compensation * 0.3; // 30% for pain and suffering
            } else if (claimType === 'medical') {
                painSuffering = compensation * 0.5; // 50% for medical negligence
            }
            
            compensation += painSuffering;
            
            // Minimum compensation
            compensation = Math.max(compensation, 100000);
            
            const resultDiv = document.getElementById('compResult');
            if (resultDiv) {
                resultDiv.innerHTML = `
                    <div class="result-card">
                        <h5>Estimated Compensation:</h5>
                        <div class="result-amount">₹${compensation.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                        <div class="result-breakdown">
                            <p><i class="fas fa-briefcase"></i> Monthly Income: ₹${monthlyIncome.toLocaleString()}</p>
                            <p><i class="fas fa-user"></i> Age: ${age} years (Multiplier: ${multiplier})</p>
                            <p><i class="fas fa-wheelchair"></i> Disability: ${disability}%</p>
                            <p><i class="fas fa-stethoscope"></i> Claim Type: ${claimType.toUpperCase()}</p>
                        </div>
                        <p class="result-note"><i class="fas fa-exclamation-triangle"></i> Note: This is an estimate. Actual compensation depends on court judgment and specific circumstances.</p>
                    </div>
                `;
            }
        }
        
        // Generate Document
        function generateDocument(type) {
            showToast(`Generating ${type.replace('-', ' ')} document...`, 'info');
            
            // In a real app, this would open a form to fill details
            setTimeout(() => {
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.id = 'documentModal';
                modal.innerHTML = `
                    <div class="modal-overlay" onclick="closeModal('documentModal')"></div>
                    <div class="modal-content">
                        <button class="modal-close" onclick="closeModal('documentModal')">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="modal-header">
                            <div class="modal-icon legal-seal">
                                <i class="fas fa-file-contract"></i>
                            </div>
                            <h3>Generate ${type.replace('-', ' ').toUpperCase()}</h3>
                            <p>Fill in the details below</p>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Parties Information</label>
                                <input type="text" id="party1" placeholder="First Party Name" class="form-input">
                                <input type="text" id="party2" placeholder="Second Party Name" class="form-input">
                            </div>
                            <div class="form-group">
                                <label>Date</label>
                                <input type="date" id="agreementDate" class="form-input" value="${new Date().toISOString().split('T')[0]}">
                            </div>
                            <div class="form-group">
                                <label>Additional Details</label>
                                <textarea id="additionalDetails" placeholder="Any specific terms or conditions..." class="form-textarea" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Document Format</label>
                                <select id="docFormat" class="form-select">
                                    <option value="PDF">PDF Document</option>
                                    <option value="DOC">Word Document</option>
                                    <option value="TXT">Text File</option>
                                </select>
                            </div>
                            <button class="btn-generate-final" onclick="finalizeDocument('${type}')">
                                <i class="fas fa-magic"></i>
                                Generate Document
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                modal.style.display = 'flex';
                document.body.classList.add('modal-open');
            }, 500);
        }
        
        // Finalize Document Generation
        function finalizeDocument(type) {
            const party1 = document.getElementById('party1')?.value || 'Party A';
            const party2 = document.getElementById('party2')?.value || 'Party B';
            const date = document.getElementById('agreementDate')?.value || new Date().toISOString().split('T')[0];
            const format = document.getElementById('docFormat')?.value || 'PDF';
            
            showToast(`Generating ${format} document...`, 'success');
            
            setTimeout(() => {
                closeModal('documentModal');
                showToast(`${type.replace('-', ' ')} document generated successfully!`, 'success');
                
                // In a real app, this would download the document
                const blob = new Blob([`LEGAL DOCUMENT\n\nType: ${type}\nParties: ${party1} and ${party2}\nDate: ${date}\n\nThis is a sample generated document. In the complete version, this would be a fully formatted legal document.`], 
                    { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${type}_${date}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 1500);
        }
        
        // Open Legal Guide
        function openGuide(guideType) {
            const guides = {
                'file-case': {
                    title: 'How to File a Case in India',
                    steps: [
                        '1. Consult a Lawyer: Get professional legal advice',
                        '2. Prepare Documents: Collect all relevant documents',
                        '3. Draft Plaint/Petition: Prepare the legal document',
                        '4. Pay Court Fees: Calculate and pay required fees',
                        '5. File in Appropriate Court: Submit to correct jurisdiction',
                        '6. Get Case Number: Receive unique case identifier',
                        '7. Serve Notice: Notify the opposite party',
                        '8. Attend Hearings: Participate in court proceedings'
                    ]
                },
                'registration': {
                    title: 'Document Registration Process',
                    steps: [
                        '1. Prepare Original Document',
                        '2. Pay Stamp Duty (based on property value)',
                        '3. Get Witnesses (minimum 2 required)',
                        '4. Visit Sub-Registrar Office',
                        '5. Submit Documents for Verification',
                        '6. Pay Registration Fees',
                        '7. Biometric Verification',
                        '8. Receive Registered Document'
                    ]
                },
                'consumer-complaint': {
                    title: 'Consumer Complaint Process',
                    steps: [
                        '1. Collect Evidence (bills, receipts, correspondence)',
                        '2. Send Legal Notice to opposite party',
                        '3. Wait for Reply (30 days)',
                        '4. File Complaint in Consumer Forum',
                        '5. Pay Required Fees',
                        '6. Attend Mediation/Conciliation',
                        '7. Participate in Hearings',
                        '8. Receive Order/Compensation'
                    ]
                }
            };
            
            const guide = guides[guideType];
            if (!guide) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'guideModal';
            modal.innerHTML = `
                <div class="modal-overlay" onclick="closeModal('guideModal')"></div>
                <div class="modal-content">
                    <button class="modal-close" onclick="closeModal('guideModal')">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="modal-header">
                        <div class="modal-icon legal-seal">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <h3>${guide.title}</h3>
                        <p>Step-by-step guide</p>
                    </div>
                    <div class="modal-body">
                        <div class="guide-content">
                            <div class="guide-steps">
                                ${guide.steps.map(step => `<div class="guide-step">${step}</div>`).join('')}
                            </div>
                            <div class="guide-tips">
                                <h4><i class="fas fa-lightbulb"></i> Important Tips:</h4>
                                <ul>
                                    <li>Always keep copies of all documents</li>
                                    <li>Meet all deadlines strictly</li>
                                    <li>Consult a lawyer for complex matters</li>
                                    <li>Maintain proper communication records</li>
                                </ul>
                            </div>
                            <button class="btn-download-guide" onclick="downloadGuide('${guideType}')">
                                <i class="fas fa-download"></i>
                                Download This Guide
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
            document.body.classList.add('modal-open');
        }
        
        // Download Guide
        function downloadGuide(guideType) {
            const guideContent = {
                'file-case': 'How to File a Case in India - Complete Guide.pdf',
                'registration': 'Document Registration Process Guide.pdf',
                'consumer-complaint': 'Consumer Complaint Process Guide.pdf'
            };
            
            const filename = guideContent[guideType] || 'Legal_Guide.pdf';
            showToast(`Downloading ${filename}...`, 'success');
            
            // In a real app, this would download the actual guide
            const blob = new Blob(['This would be the complete guide document in PDF format.'], 
                { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // SIMPLE GOOGLE AUTH
        function initializeSimpleGoogleAuth() {
            console.log('🔐 Initializing Google Authentication...');
            
            if (typeof google === 'undefined') {
                console.warn('⚠️ Google Identity Services not loaded yet, will retry...');
                setTimeout(initializeSimpleGoogleAuth, 1000);
                return;
            }
            
            try {
                google.accounts.id.initialize({
                    client_id: '166511615962-bohur5q8d4i5hud6icr4185kcte9enk8.apps.googleusercontent.com',
                    callback: handleGoogleCredentialResponse,
                    auto_select: false,
                    cancel_on_tap_outside: true,
                    context: 'signin',
                    itp_support: false,
                    ux_mode: isMobile ? 'popup' : 'popup'
                });
                
                googleGISInitialized = true;
                console.log('✅ Google Authentication initialized');
                
            } catch (error) {
                console.error('❌ Google Authentication initialization failed:', error);
            }
        }
        
        // RENDER GOOGLE SIGN-IN BUTTON
        function renderGoogleSignInButton() {
            try {
                const container = document.getElementById('googleSignInContainer');
                if (!container || !googleGISInitialized) {
                    console.log('⚠️ Google Sign-In container not found or GIS not initialized');
                    const customBtn = document.getElementById('customGoogleBtn');
                    if (customBtn) customBtn.style.display = 'flex';
                    return;
                }
                
                // Clear the container first
                container.innerHTML = '';
                
                // Render Google Sign-In button with mobile optimization
                const buttonSize = isMobile ? 'large' : 'large';
                const buttonWidth = isMobile ? '100%' : '400';
                
                google.accounts.id.renderButton(
                    container,
                    {
                        theme: 'outline',
                        size: buttonSize,
                        text: 'signin_with',
                        shape: 'rectangular',
                        logo_alignment: 'left',
                        width: buttonWidth,
                        locale: 'en_US'
                    }
                );
                
                console.log('✅ Google Sign-In button rendered');
                const customBtn = document.getElementById('customGoogleBtn');
                if (customBtn) customBtn.style.display = 'none';
                
            } catch (error) {
                console.error('❌ Failed to render Google Sign-In button:', error);
                const customBtn = document.getElementById('customGoogleBtn');
                if (customBtn) customBtn.style.display = 'flex';
            }
        }
        
        // HANDLE GOOGLE CREDENTIAL RESPONSE
        function handleGoogleCredentialResponse(response) {
            console.log('🔐 Google credential received');
            
            try {
                const payload = JSON.parse(atob(response.credential.split('.')[1]));
                
                const userData = {
                    id: 'google_' + payload.sub,
                    name: payload.name,
                    email: payload.email,
                    picture: payload.picture,
                    provider: 'google',
                    token: response.credential
                };
                
                console.log('✅ Google user authenticated:', userData.email);
                
                localStorage.setItem('legal_swami_user', JSON.stringify(userData));
                localStorage.setItem('legal_swami_token', response.credential);
                
                if (window.legalSwamiAPI) {
                    window.legalSwamiAPI.user = userData;
                    window.legalSwamiAPI.token = response.credential;
                }
                
                updateUserUI();
                hideLoginModal();
                
                showToast('Successfully logged in with Google!', 'success');
                
            } catch (error) {
                console.error('❌ Failed to process Google credential:', error);
                showToast('Login failed. Please try again.', 'error');
            }
        }
        
        // CHECK FOR EXISTING USER
        function checkExistingUser() {
            console.log('👤 Checking for existing user...');
            
            const userStr = localStorage.getItem('legal_swami_user');
            if (userStr) {
                try {
                    const user = JSON.parse(userStr);
                    console.log('✅ Found existing user:', user.name);
                    
                    if (window.legalSwamiAPI) {
                        window.legalSwamiAPI.user = user;
                        window.legalSwamiAPI.token = localStorage.getItem('legal_swami_token');
                    }
                    
                    updateUserUI();
                    return;
                } catch (e) {
                    console.error('Error parsing user data:', e);
                    localStorage.removeItem('legal_swami_user');
                    localStorage.removeItem('legal_swami_token');
                }
            }
            
            updateUserUI();
        }
        
        // UPDATE USER UI
        function updateUserUI() {
            console.log('👤 Updating user UI...');
            
            const userProfile = document.getElementById('userProfile');
            const headerLoginBtn = document.getElementById('headerLoginBtn');
            
            if (!userProfile || !headerLoginBtn) {
                console.warn('⚠️ User UI elements not found');
                return;
            }
            
            let user = null;
            const userStr = localStorage.getItem('legal_swami_user');
            
            if (userStr) {
                try {
                    user = JSON.parse(userStr);
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
            
            if (user && user.id) {
                console.log('✅ User logged in:', user.name);
                
                headerLoginBtn.style.display = 'none';
                userProfile.style.display = 'flex';
                
                const userName = document.getElementById('userName');
                const userEmail = document.getElementById('userEmail');
                const userAvatar = document.getElementById('userAvatar');
                
                if (userName) userName.textContent = user.name || 'User';
                if (userEmail) userEmail.textContent = user.email || '';
                
                if (userAvatar) {
                    userAvatar.innerHTML = '';
                    if (user.picture) {
                        const img = document.createElement('img');
                        img.src = user.picture;
                        img.alt = user.name;
                        img.style.width = '100%';
                        img.style.height = '100%';
                        img.style.borderRadius = '8px';
                        img.style.objectFit = 'cover';
                        userAvatar.appendChild(img);
                    } else {
                        const initials = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                        const span = document.createElement('span');
                        span.textContent = initials;
                        span.style.fontSize = '14px';
                        span.style.fontWeight = '600';
                        userAvatar.appendChild(span);
                    }
                }
                
            } else {
                console.log('👤 No user logged in, showing login button');
                
                headerLoginBtn.style.display = 'flex';
                userProfile.style.display = 'none';
                
                if (!localStorage.getItem('legalSwamiGuestId')) {
                    localStorage.setItem('legalSwamiGuestId', 'guest_' + Date.now());
                }
            }
        }
        
        // SETUP ALL EVENT LISTENERS
        function setupEventListeners() {
            console.log('🔧 Setting up event listeners');
            
            // Header login button
            const headerLoginBtn = document.getElementById('headerLoginBtn');
            if (headerLoginBtn) {
                console.log('✅ Found header login button');
                headerLoginBtn.addEventListener('click', showLoginModal);
            } else {
                console.error('❌ Header login button not found!');
            }
            
            // Logout button
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
            
            // Start chat buttons
            const startChatBtn = document.getElementById('startChatBtn');
            if (startChatBtn) {
                startChatBtn.addEventListener('click', startChat);
            }
            
            const heroAssistantBtn = document.getElementById('heroAssistantBtn');
            if (heroAssistantBtn) {
                heroAssistantBtn.addEventListener('click', startChat);
            }
            
            const ctaStartChat = document.getElementById('ctaStartChat');
            if (ctaStartChat) {
                ctaStartChat.addEventListener('click', startChat);
            }
            
            // Mobile start chat button
            const mobileStartChat = document.getElementById('mobileStartChat');
            if (mobileStartChat) {
                mobileStartChat.addEventListener('click', function(e) {
                    e.preventDefault();
                    startChat();
                });
            }
            
            // Watch demo button
            const watchDemo = document.getElementById('watchDemo');
            if (watchDemo) {
                watchDemo.addEventListener('click', showDemo);
            }
            
            // Pricing buttons
            const freePlanBtn = document.getElementById('freePlanBtn');
            if (freePlanBtn) {
                freePlanBtn.addEventListener('click', startChat);
            }
            
            const proPlanBtn = document.getElementById('proPlanBtn');
            if (proPlanBtn) {
                proPlanBtn.addEventListener('click', showLoginModal);
            }
            
            const businessPlanBtn = document.getElementById('businessPlanBtn');
            if (businessPlanBtn) {
                businessPlanBtn.addEventListener('click', function() {
                    showToast('Contact sales feature coming soon!', 'info');
                });
            }
            
            // Login modal buttons
            const closeLoginModal = document.getElementById('closeLoginModal');
            if (closeLoginModal) {
                closeLoginModal.addEventListener('click', hideLoginModal);
            }
            
            const demoLoginBtn = document.getElementById('demoLoginBtn');
            if (demoLoginBtn) {
                demoLoginBtn.addEventListener('click', handleDemoLogin);
            }
            
            const customGoogleBtn = document.getElementById('customGoogleBtn');
            if (customGoogleBtn) {
                customGoogleBtn.addEventListener('click', handleCustomGoogleLogin);
            }
            
            // Modal overlay click to close
            const loginModal = document.getElementById('loginModal');
            if (loginModal) {
                loginModal.addEventListener('click', function(e) {
                    if (e.target === this || e.target.classList.contains('modal-overlay')) {
                        hideLoginModal();
                    }
                });
            }
            
            // Legal Tools Modal
            const legalToolsBtn = document.getElementById('legalTools');
            if (legalToolsBtn) {
                legalToolsBtn.addEventListener('click', function() {
                    const modal = document.getElementById('legalToolsModal');
                    if (modal) {
                        modal.style.display = 'flex';
                        document.body.classList.add('modal-open');
                    }
                });
            }
            
            const closeLegalTools = document.getElementById('closeLegalTools');
            if (closeLegalTools) {
                closeLegalTools.addEventListener('click', function() {
                    const modal = document.getElementById('legalToolsModal');
                    if (modal) {
                        modal.style.display = 'none';
                        document.body.classList.remove('modal-open');
                    }
                });
            }
            
            const legalToolsModal = document.getElementById('legalToolsModal');
            if (legalToolsModal) {
                legalToolsModal.addEventListener('click', function(e) {
                    if (e.target === this || e.target.classList.contains('modal-overlay')) {
                        this.style.display = 'none';
                        document.body.classList.remove('modal-open');
                    }
                });
            }
            
            // Chat interface
            const backToHome = document.getElementById('backToHome');
            if (backToHome) {
                backToHome.addEventListener('click', goBackToHome);
            }
            
            const clearChat = document.getElementById('clearChat');
            if (clearChat) {
                clearChat.addEventListener('click', clearChatHandler);
            }
            
            const exportChat = document.getElementById('exportChat');
            if (exportChat) {
                exportChat.addEventListener('click', exportChatHandler);
            }
            
            const historyToggle = document.getElementById('historyToggle');
            if (historyToggle) {
                historyToggle.addEventListener('click', toggleHistory);
            }
            
            const closeHistory = document.getElementById('closeHistory');
            if (closeHistory) {
                closeHistory.addEventListener('click', toggleHistory);
            }
            
            const sendMessage = document.getElementById('sendMessage');
            if (sendMessage) {
                sendMessage.addEventListener('click', sendMessageHandler);
            }
            
            const attachFile = document.getElementById('attachFile');
            if (attachFile) {
                attachFile.addEventListener('click', attachFileHandler);
            }
            
            const voiceInput = document.getElementById('voiceInput');
            if (voiceInput) {
                voiceInput.addEventListener('click', startVoiceInput);
            }
            
            // Message input handling
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.addEventListener('keydown', handleInputKeydown);
                messageInput.addEventListener('input', autoResizeTextarea);
                
                // Prevent zoom on focus for mobile
                if (isMobile) {
                    messageInput.addEventListener('focus', function() {
                        setTimeout(() => {
                            this.style.fontSize = '16px';
                        }, 100);
                    });
                }
            }
            
            // Quick questions
            document.querySelectorAll('.quick-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    const question = this.getAttribute('data-question');
                    const messageInput = document.getElementById('messageInput');
                    if (messageInput) {
                        messageInput.value = question;
                        sendMessageHandler();
                    }
                });
            });
            
            // Document generation checkbox
            const generateDocument = document.getElementById('generateDocument');
            if (generateDocument) {
                generateDocument.addEventListener('change', function() {
                    const documentType = document.getElementById('documentType');
                    if (documentType) {
                        documentType.disabled = !this.checked;
                    }
                });
            }
            
            // Legal links
            const termsLink = document.getElementById('termsLink');
            if (termsLink) {
                termsLink.addEventListener('click', showTerms);
            }
            
            const privacyLink = document.getElementById('privacyLink');
            if (privacyLink) {
                privacyLink.addEventListener('click', showPrivacy);
            }
            
            const disclaimerLink = document.getElementById('disclaimerLink');
            if (disclaimerLink) {
                disclaimerLink.addEventListener('click', showDisclaimer);
            }
            
            const cookieLink = document.getElementById('cookieLink');
            if (cookieLink) {
                cookieLink.addEventListener('click', showCookiePolicy);
            }
            
            // Schedule demo button
            const scheduleDemo = document.getElementById('ctaScheduleDemo');
            if (scheduleDemo) {
                scheduleDemo.addEventListener('click', function() {
                    showToast('Demo scheduling feature coming soon!', 'info');
                });
            }
            
            console.log('✅ All event listeners set up');
        }
        
        // INITIALIZE CHAT
        function initializeChat() {
            // Hide typing indicator initially
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.style.display = 'none';
            }
            
            // Hide chat messages container initially
            const chatMessagesContainer = document.getElementById('chatMessagesContainer');
            if (chatMessagesContainer) {
                chatMessagesContainer.style.display = 'none';
            }
            
            // Mobile chat optimizations
            if (isMobile) {
                // Larger input for mobile
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                    messageInput.style.minHeight = '44px';
                    messageInput.style.fontSize = '16px';
                }
                
                // Better mobile chat layout
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    chatMessages.style.padding = '10px';
                }
            }
        }
        
        // AUTO RESIZE TEXTAREA
        function autoResizeTextarea() {
            const textarea = this;
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
            
            // Limit height on mobile
            if (isMobile && textarea.scrollHeight > 200) {
                textarea.style.height = '200px';
                textarea.style.overflowY = 'auto';
            }
        }
        
        // HANDLE INPUT KEYDOWN
        function handleInputKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessageHandler();
            }
            
            // Mobile specific: hide keyboard on escape
            if (event.key === 'Escape' && isMobile) {
                this.blur();
            }
        }
        
        // SHOW LOGIN MODAL
        function showLoginModal() {
            console.log('🔐 Showing login modal...');
            
            const modal = document.getElementById('loginModal');
            if (!modal) {
                console.error('❌ Login modal not found!');
                return;
            }
            
            isLoginModalOpen = true;
            modal.style.display = 'flex';
            document.body.classList.add('modal-open');
            
            // Prevent background scrolling on mobile
            if (isMobile) {
                document.body.style.overflow = 'hidden';
            }
            
            // Render Google Sign-In button
            setTimeout(function() {
                renderGoogleSignInButton();
            }, 100);
            
            console.log('✅ Login modal shown');
        }
        
        // HIDE LOGIN MODAL
        function hideLoginModal() {
            console.log('🔐 Hiding login modal...');
            
            const modal = document.getElementById('loginModal');
            if (!modal) {
                console.error('❌ Login modal not found!');
                return;
            }
            
            isLoginModalOpen = false;
            modal.style.display = 'none';
            document.body.classList.remove('modal-open');
            
            // Restore scrolling on mobile
            if (isMobile) {
                document.body.style.overflow = '';
            }
            
            console.log('✅ Login modal hidden');
        }
        
        // HANDLE CUSTOM GOOGLE LOGIN
        function handleCustomGoogleLogin() {
            console.log('🔐 Custom Google login triggered');
            
            if (!googleGISInitialized) {
                showToast('Google Sign-In is not available. Please use demo login.', 'warning');
                return;
            }
            
            try {
                google.accounts.id.prompt();
            } catch (error) {
                console.error('❌ Google login failed:', error);
                showToast('Google Sign-In failed. Using demo login instead.', 'warning');
                handleDemoLogin();
            }
        }
        
        // HANDLE DEMO LOGIN
        function handleDemoLogin() {
            console.log('👤 Demo login triggered');
            
            const demoUsers = [
                {
                    id: 'demo_lawyer_1',
                    name: 'Advocate Rajesh Kumar',
                    email: 'demo.lawyer@example.com',
                    role: 'lawyer',
                    specialization: 'Corporate Law'
                },
                {
                    id: 'demo_client_1',
                    name: 'Priya Sharma',
                    email: 'demo.client@example.com',
                    role: 'client',
                    caseType: 'Property Dispute'
                },
                {
                    id: 'demo_student_1',
                    name: 'Amit Patel',
                    email: 'demo.student@example.com',
                    role: 'student',
                    institution: 'NLSIU Bangalore'
                }
            ];
            
            const randomUser = demoUsers[Math.floor(Math.random() * demoUsers.length)];
            
            const userData = {
                id: randomUser.id,
                name: randomUser.name,
                email: randomUser.email,
                role: randomUser.role,
                picture: 'https://ui-avatars.com/api/?name=' + encodeURIComponent(randomUser.name) + '&background=1a56db&color=fff&size=128',
                provider: 'demo',
                isDemo: true
            };
            
            localStorage.setItem('legal_swami_user', JSON.stringify(userData));
            localStorage.setItem('legal_swami_token', 'demo_token_' + Date.now());
            
            if (window.legalSwamiAPI) {
                window.legalSwamiAPI.user = userData;
                window.legalSwamiAPI.token = 'demo_token';
            }
            
            updateUserUI();
            hideLoginModal();
            showToast('Welcome ' + userData.name + '! (Demo Mode)', 'success');
        }
        
        // HANDLE LOGOUT
        function handleLogout() {
            console.log('🚪 Logging out...');
            
            const userStr = localStorage.getItem('legal_swami_user');
            if (userStr) {
                try {
                    const user = JSON.parse(userStr);
                    if (user.provider === 'google') {
                        try {
                            google.accounts.id.revoke(user.email, function(done) {
                                console.log('✅ Google access revoked');
                            });
                        } catch (e) {
                            console.warn('Could not revoke Google access:', e);
                        }
                    }
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
            
            localStorage.removeItem('legal_swami_token');
            localStorage.removeItem('legal_swami_user');
            
            if (window.legalSwamiAPI) {
                window.legalSwamiAPI.token = null;
                window.legalSwamiAPI.user = null;
            }
            
            updateUserUI();
            showToast('Logged out successfully', 'success');
            
            // Go back to home if in chat interface
            if (isChatOpen) {
                goBackToHome();
            }
        }
        
        // INITIALIZE APP WITH BACKEND
        async function initializeAppWithBackend() {
            console.log('🔌 Initializing app with backend...');
            
            try {
                const backendUrl = 'https://legal-swami-backend.onrender.com';
                
                if (!window.legalSwamiAPI) {
                    window.legalSwamiAPI = {
                        token: localStorage.getItem('legal_swami_token'),
                        user: null,
                        sendMessage: async function(message, attachments, chatId) {
                            console.log('📤 Sending message to backend:', message.substring(0, 50));
                            
                            const userId = this.user ? this.user.id : 'guest_' + Date.now();
                            
                            const response = await fetch(backendUrl + '/api/v1/chat/send', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'x-user-id': userId,
                                    'x-request-id': 'req_' + Date.now()
                                },
                                body: JSON.stringify({
                                    message: message,
                                    generateDocument: document.getElementById('generateDocument') ? document.getElementById('generateDocument').checked : false,
                                    language: selectedLanguage
                                })
                            });
                            
                            if (!response.ok) {
                                throw new Error('HTTP ' + response.status + ': ' + await response.text());
                            }
                            
                            return await response.json();
                        },
                        getChatHistory: async function(page, size) {
                            page = page || 0;
                            size = size || 10;
                            const userId = this.user ? this.user.id : 'guest';
                            
                            const response = await fetch(
                                backendUrl + '/api/v1/chat/history?userId=' + userId + '&page=' + page + '&size=' + size,
                                {
                                    headers: {
                                        'x-user-id': userId,
                                        'x-request-id': 'req_' + Date.now()
                                    }
                                }
                            );
                            
                            if (!response.ok) {
                                throw new Error('HTTP ' + response.status);
                            }
                            
                            return await response.json();
                        }
                    };
                }
                
                // Test backend health
                try {
                    const healthResponse = await fetch(backendUrl + '/api/v1/public/health');
                    if (healthResponse.ok) {
                        const healthData = await healthResponse.json();
                        console.log('✅ Backend health check passed:', healthData);
                        showToast('Backend connected successfully!', 'success');
                    } else {
                        console.warn('⚠️ Backend health check failed:', healthResponse.status);
                    }
                } catch (error) {
                    console.warn('⚠️ Backend health check failed:', error.message);
                }
                
                updateUserUI();
                
            } catch (error) {
                console.error('❌ Initialization failed:', error);
                showToast('Note: Some features may be limited', 'warning');
            }
        }
        
        // START CHAT
        function startChat() {
            console.log('💬 Starting chat...');
            
            const user = window.legalSwamiAPI ? window.legalSwamiAPI.user : null;
            const token = localStorage.getItem('legal_swami_token');
            const guestId = localStorage.getItem('legalSwamiGuestId');
            
            if (!user && !guestId && !token) {
                showLoginModal();
                showToast('Please login to start chatting', 'warning');
                return;
            }
            
            const chatInterface = document.getElementById('chatInterface');
            const mainContainer = document.querySelector('.main-container');
            
            if (chatInterface) {
                chatInterface.style.display = 'flex';
                isChatOpen = true;
                
                // Mobile specific chat optimizations
                if (isMobile) {
                    chatInterface.style.position = 'fixed';
                    chatInterface.style.top = '0';
                    chatInterface.style.left = '0';
                    chatInterface.style.right = '0';
                    chatInterface.style.bottom = '0';
                    chatInterface.style.zIndex = '2000';
                    document.body.style.overflow = 'hidden';
                    
                    // Focus input after a delay
                    setTimeout(function() {
                        const messageInput = document.getElementById('messageInput');
                        if (messageInput) {
                            messageInput.focus();
                        }
                    }, 500);
                }
                
                console.log('✅ Chat interface shown');
            }
            
            if (mainContainer && !isMobile) {
                mainContainer.style.background = '#0f172a';
            }
            
            if (!isMobile) {
                document.body.style.overflow = 'hidden';
            }
            
            // Hide welcome screen, show messages
            const chatWelcome = document.getElementById('chatWelcome');
            const chatMessagesContainer = document.getElementById('chatMessagesContainer');
            
            if (chatWelcome) {
                chatWelcome.style.display = 'none';
            }
            
            if (chatMessagesContainer) {
                chatMessagesContainer.style.display = 'flex';
            }
            
            setTimeout(function() {
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                    messageInput.focus();
                    console.log('✅ Message input focused');
                }
            }, 300);
        }
        
        // GO BACK TO HOME
        function goBackToHome() {
            const chatInterface = document.getElementById('chatInterface');
            const mainContainer = document.querySelector('.main-container');
            
            if (chatInterface) {
                chatInterface.style.display = 'none';
                isChatOpen = false;
                console.log('✅ Chat interface hidden');
            }
            
            if (mainContainer) {
                mainContainer.style.background = '';
            }
            
            // Restore scrolling
            document.body.style.overflow = '';
            
            // Show welcome screen again
            const chatWelcome = document.getElementById('chatWelcome');
            const chatMessagesContainer = document.getElementById('chatMessagesContainer');
            
            if (chatWelcome) {
                chatWelcome.style.display = 'flex';
            }
            
            if (chatMessagesContainer) {
                chatMessagesContainer.style.display = 'none';
            }
            
            // Clear messages
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                chatMessages.innerHTML = '';
            }
            
            // Reset message input
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.value = '';
                messageInput.style.height = 'auto';
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            console.log('🏠 Returned to home');
        }
        
        // CLEAR CHAT HANDLER
        function clearChatHandler() {
            if (confirm('Are you sure you want to clear the chat? This action cannot be undone.')) {
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    chatMessages.innerHTML = '';
                }
                
                currentChatId = null;
                showToast('Chat cleared successfully', 'success');
                console.log('🗑️ Chat cleared');
            }
        }
        
        // EXPORT CHAT HANDLER
        function exportChatHandler() {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;
            
            const messages = chatMessages.querySelectorAll('.message');
            
            let exportText = '================================\n';
            exportText += 'LEGALSWAMI CHAT EXPORT\n';
            exportText += 'Generated on: ' + new Date().toLocaleString() + '\n';
            exportText += 'Language: ' + getLanguageName(selectedLanguage) + '\n';
            exportText += '================================\n\n';
            
            messages.forEach(function(message) {
                const isAI = message.classList.contains('ai-message');
                const text = message.querySelector('.message-text') ? message.querySelector('.message-text').textContent : '';
                const time = message.querySelector('.message-time') ? message.querySelector('.message-time').textContent : '';
                
                exportText += (isAI ? '🤖 AI Assistant' : '👤 You') + ' (' + time + '):\n';
                exportText += text + '\n\n';
                exportText += '─'.repeat(50) + '\n\n';
            });
            
            exportText += '\n================================\n';
            exportText += 'END OF CHAT\n';
            exportText += '================================\n\n';
            exportText += 'Disclaimer: This chat is for informational purposes only.\n';
            exportText += 'Please consult a qualified attorney for legal advice.\n';
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'LegalSwami_Chat_' + new Date().toISOString().split('T')[0] + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Chat exported successfully!', 'success');
            console.log('📥 Chat exported');
        }
        
        // TOGGLE HISTORY SIDEBAR
        function toggleHistory() {
            const sidebar = document.getElementById('historySidebar');
            if (sidebar) {
                sidebar.classList.toggle('active');
                console.log('📜 History sidebar toggled');
            }
        }
        
        // LOAD CHAT HISTORY
        async function loadChatHistory() {
            try {
                if (!window.legalSwamiAPI) {
                    console.warn('API not initialized');
                    return;
                }
                
                console.log('📜 Loading chat history...');
                const history = await window.legalSwamiAPI.getChatHistory(0, 10);
                updateHistoryList(history);
                console.log('✅ Chat history loaded:', history.length, 'items');
            } catch (error) {
                console.error('Failed to load history:', error);
                showToast('Failed to load chat history', 'error');
            }
        }
        
        // UPDATE HISTORY LIST UI
        function updateHistoryList(history) {
            const historyList = document.getElementById('historyList');
            if (!historyList) return;
            
            historyList.innerHTML = '';
            
            if (!history || history.length === 0) {
                historyList.innerHTML = '<div class="history-empty"><i class="fas fa-history"></i><p>No chat history yet</p><small>Start chatting to see your history here</small></div>';
                return;
            }
            
            history.forEach(function(item) {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = '<div class="history-item-header"><div class="history-item-title">' + 
                    item.message.substring(0, 50) + (item.message.length > 50 ? '...' : '') + 
                    '</div><span class="history-item-time">' + formatTime(item.createdAt) + 
                    '</span></div><div class="history-item-preview">' + 
                    item.message.substring(0, 100) + (item.message.length > 100 ? '...' : '') + 
                    '</div><div class="history-item-actions"><button class="history-action-btn" onclick="loadChatFromHistory(\'' + 
                    item.id + '\')"><i class="fas fa-eye"></i> View</button><button class="history-action-btn" onclick="deleteChatHistory(\'' + 
                    item.id + '\')"><i class="fas fa-trash"></i> Delete</button></div>';
                historyList.appendChild(historyItem);
            });
        }
        
        // LOAD CHAT FROM HISTORY
        async function loadChatFromHistory(chatId) {
            try {
                showToast('Loading chat from history...', 'info');
                toggleHistory();
                console.log('📜 Loading chat:', chatId);
            } catch (error) {
                console.error('Failed to load chat:', error);
                showToast('Failed to load chat', 'error');
            }
        }
        
        // DELETE CHAT HISTORY
        function deleteChatHistory(chatId) {
            if (confirm('Are you sure you want to delete this chat?')) {
                showToast('Chat deleted successfully', 'success');
                console.log('🗑️ Chat deleted:', chatId);
            }
        }
        
        // SEND MESSAGE HANDLER
        async function sendMessageHandler() {
            if (isProcessing) {
                console.warn('⚠️ Message already being processed');
                return;
            }
            
            const input = document.getElementById('messageInput');
            if (!input) return;
            
            const message = input.value.trim();
            
            if (!message) {
                showToast('Please enter a message', 'warning');
                return;
            }
            
            let userId = 'guest';
            if (window.legalSwamiAPI && window.legalSwamiAPI.user) {
                userId = window.legalSwamiAPI.user.id;
            } else {
                userId = localStorage.getItem('legalSwamiGuestId') || 'guest_' + Date.now();
                localStorage.setItem('legalSwamiGuestId', userId);
            }
            
            isProcessing = true;
            
            try {
                console.log('💬 Sending message:', message.substring(0, 100));
                
                addMessageToChat(message, true);
                input.value = '';
                input.style.height = 'auto';
                
                showTypingIndicator(true);
                
                const generateDocument = document.getElementById('generateDocument') ? document.getElementById('generateDocument').checked : false;
                const documentType = document.getElementById('documentType') ? document.getElementById('documentType').value : 'PDF';
                
                const backendUrl = 'https://legal-swami-backend.onrender.com';
                const response = await fetch(backendUrl + '/api/v1/chat/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-user-id': userId,
                        'x-request-id': 'req_' + Date.now(),
                        'x-language': selectedLanguage
                    },
                    body: JSON.stringify({
                        message: message,
                        generateDocument: generateDocument,
                        language: selectedLanguage
                    })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error('HTTP ' + response.status + ': ' + errorText);
                }
                
                const data = await response.json();
                console.log('✅ Received response:', data.id);
                
                addMessageToChat(data.response || 'No response received', false, generateDocument, documentType);
                
                await loadChatHistory();
                
            } catch (error) {
                console.error('❌ Failed to send message:', error);
                addMessageToChat('Sorry, I encountered an error while processing your request. Please try again in a moment. If the problem persists, please check your internet connection.', false);
                showToast('Failed to send message: ' + error.message, 'error');
            } finally {
                isProcessing = false;
                showTypingIndicator(false);
                
                // Scroll to bottom on mobile
                if (isMobile) {
                    const chatMessages = document.getElementById('chatMessages');
                    if (chatMessages) {
                        setTimeout(() => {
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                        }, 100);
                    }
                }
            }
        }
        
        // ADD MESSAGE TO CHAT UI
        function addMessageToChat(content, isUser, isDocument, documentType) {
            isUser = isUser || false;
            isDocument = isDocument || false;
            documentType = documentType || 'PDF';
            
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;
            
            const messageDiv = document.createElement('div');
            
            messageDiv.className = 'message ' + (isUser ? 'user-message' : 'ai-message');
            if (isDocument) {
                messageDiv.classList.add('document-message');
            }
            
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            let messageContent = content;
            if (isDocument) {
                messageContent = '<div class="document-header"><div class="document-icon"><i class="fas fa-file-' + 
                    documentType.toLowerCase() + '"></i></div><div class="document-info"><h5>' + 
                    documentType + ' Document Generated</h5><p>Generated on ' + new Date().toLocaleDateString() + 
                    '</p></div></div><div class="message-text">' + content + 
                    '</div><div class="document-actions"><button class="btn-download"><i class="fas fa-download"></i>Download ' + 
                    documentType + '</button><button class="btn-preview"><i class="fas fa-eye"></i>Preview</button></div>';
            } else {
                messageContent = '<div class="message-header"><div class="message-sender">' + 
                    (isUser ? '👤 You' : '🤖 AI Assistant') + 
                    (!isUser ? '<span class="message-sender-badge">AI</span>' : '') + 
                    '</div><div class="message-time">' + time + 
                    '</div></div><div class="message-text">' + formatMessageText(content) + 
                    '</div><div class="message-actions"><button class="message-action-btn" title="Copy"><i class="fas fa-copy"></i></button><button class="message-action-btn" title="Share"><i class="fas fa-share"></i></button><button class="message-action-btn" title="Save"><i class="fas fa-bookmark"></i></button></div>';
            }
            
            messageDiv.innerHTML = '<div class="message-avatar">' + 
                (isUser ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>') + 
                '</div><div class="message-content">' + messageContent + '</div>';
            
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
            
            console.log('💬 Message added to chat:', isUser ? 'User' : 'AI');
            
            // Add copy functionality
            const copyBtn = messageDiv.querySelector('.message-action-btn');
            if (copyBtn) {
                copyBtn.addEventListener('click', function() {
                    const text = messageDiv.querySelector('.message-text').textContent;
                    navigator.clipboard.writeText(text).then(function() {
                        showToast('Message copied to clipboard!', 'success');
                    });
                });
            }
        }
        
        // FORMAT MESSAGE TEXT
        function formatMessageText(text) {
            text = text.replace(/\n/g, '<br>');
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
            text = text.replace(/^\s*[-•*]\s+(.*)$/gm, '<li>$1</li>');
            text = text.replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>');
            return text;
        }
        
        // SHOW TYPING INDICATOR
        function showTypingIndicator(show) {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.style.display = show ? 'flex' : 'none';
                
                if (show) {
                    const chatMessages = document.getElementById('chatMessages');
                    if (chatMessages) {
                        setTimeout(() => {
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                        }, 100);
                    }
                }
            }
        }
        
        // ATTACH FILE HANDLER
        function attachFileHandler() {
            showToast('File attachment feature coming soon in version 2.1!', 'info');
            console.log('📎 File attachment clicked');
        }
        
        // START VOICE INPUT
        function startVoiceInput() {
            showToast('Voice input feature coming soon in version 2.2!', 'info');
            console.log('🎤 Voice input clicked');
        }
        
        // SHOW DEMO
        function showDemo() {
            window.open('https://www.youtube.com/watch?v=dQw4w9WgXcQ', '_blank');
            console.log('🎬 Demo opened');
        }
        
        // SHOW TERMS
        function showTerms(e) {
            e.preventDefault();
            const terms = 'LEGALSWAMI TERMS OF SERVICE\n\n1. ACCEPTANCE OF TERMS\nBy accessing and using LegalSwami, you agree to be bound by these Terms of Service.\n\n2. SERVICE DESCRIPTION\nLegalSwami is an AI-powered legal assistant providing informational guidance only.\n\n3. NOT LEGAL ADVICE\nThe service does not constitute legal advice. Consult a qualified attorney for legal matters.\n\n4. USER RESPONSIBILITIES\nYou are responsible for the accuracy of information provided to the service.\n\n5. PRIVACY\nYour data is protected as outlined in our Privacy Policy.\n\n6. LIMITATION OF LIABILITY\nLegalSwami is not liable for any damages arising from use of the service.\n\n7. MODIFICATIONS\nWe reserve the right to modify these terms at any time.\n\nLast Updated: ' + new Date().toLocaleDateString();
            
            alert(terms);
            console.log('📄 Terms of Service shown');
        }
        
        // SHOW PRIVACY POLICY
        function showPrivacy(e) {
            e.preventDefault();
            const privacy = 'LEGALSWAMI PRIVACY POLICY\n\n1. INFORMATION COLLECTION\nWe collect minimal information necessary to provide our services.\n\n2. DATA USAGE\nYour data is used solely to improve service quality and user experience.\n\n3. DATA PROTECTION\nWe implement industry-standard security measures to protect your information.\n\n4. THIRD-PARTY SHARING\nWe do not sell or share your personal data with third parties.\n\n5. COOKIES\nWe use cookies to enhance user experience and analyze service usage.\n\n6. USER RIGHTS\nYou have the right to access, modify, or delete your personal data.\n\n7. CHILDREN\'S PRIVACY\nOur service is not intended for users under 18 years of age.\n\n8. CHANGES TO POLICY\nWe may update this policy periodically.\n\nFor questions: privacy@legalswami.com';
            
            alert(privacy);
            console.log('🔒 Privacy Policy shown');
        }
        
        // SHOW DISCLAIMER
        function showDisclaimer(e) {
            e.preventDefault();
            const disclaimer = '⚖️ IMPORTANT LEGAL DISCLAIMER ⚖️\n\nLEGALSWAMI AI ASSISTANT - DISCLAIMER\n\n1. NATURE OF SERVICE\nLegalSwami is an artificial intelligence assistant designed to provide general legal information and guidance. It is NOT a licensed attorney.\n\n2. NOT LEGAL ADVICE\nThe information provided by LegalSwami does not constitute legal advice and should not be relied upon as such.\n\n3. NO ATTORNEY-CLIENT RELATIONSHIP\nUsing LegalSwami does not create an attorney-client relationship.\n\n4. CONSULT A LAWYER\nFor legal advice specific to your situation, please consult a qualified licensed attorney.\n\n5. ACCURACY OF INFORMATION\nWhile we strive for accuracy, we cannot guarantee the completeness or currentness of information provided.\n\n6. USE AT YOUR OWN RISK\nYou assume all risk for any actions taken based on information from LegalSwami.\n\n7. OFFICIAL DOCUMENTS\nFor official legal documents, court filings, or binding agreements, always consult a licensed attorney.\n\n8. EMERGENCY SITUATIONS\nFor urgent legal matters, contact a lawyer immediately.\n\nBy using LegalSwami, you acknowledge and agree to these terms.';
            
            alert(disclaimer);
            console.log('⚠️ Legal Disclaimer shown');
        }
        
        // SHOW COOKIE POLICY
        function showCookiePolicy(e) {
            e.preventDefault();
            alert('COOKIE POLICY\n\nWe use essential cookies for functionality and analytics cookies to improve our service. By continuing to use LegalSwami, you consent to our use of cookies.');
            console.log('🍪 Cookie Policy shown');
        }
        
        // FORMAT TIME
        function formatTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
            return date.toLocaleDateString();
        }
        
        // SHOW TOAST NOTIFICATION
        function showToast(message, type) {
            type = type || 'info';
            const container = document.getElementById('toastContainer');
            if (!container) return;
            
            const toast = document.createElement('div');
            toast.className = 'toast toast-' + type;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            toast.innerHTML = '<i class="' + (icons[type] || icons.info) + '"></i><span>' + message + '</span>';
            
            container.appendChild(toast);
            
            // Position toast based on device
            if (isMobile) {
                toast.style.bottom = '70px'; // Above mobile keyboard/buttons
                toast.style.maxWidth = '90%';
            }
            
            setTimeout(function() {
                toast.classList.add('fade-out');
                setTimeout(function() {
                    if (toast.parentNode === container) {
                        container.removeChild(toast);
                    }
                }, 300);
            }, 3000);
            
            console.log('📢 Toast (' + type + '):', message);
        }
        
        // MAKE FUNCTIONS AVAILABLE GLOBALLY
        window.loadChatFromHistory = loadChatFromHistory;
        window.deleteChatHistory = deleteChatHistory;
        window.searchActs = searchActs;
        window.searchCaseLaws = searchCaseLaws;
        window.openLegalCalculator = openLegalCalculator;
        window.searchLawyers = searchLawyers;
        window.contactLawyer = contactLawyer;
        window.generateDocument = generateDocument;
        window.openGuide = openGuide;
        window.downloadGuide = downloadGuide;
        window.finalizeDocument = finalizeDocument;
        window.openLegalActSearch = searchActs;
        window.calculateCourtFee = calculateCourtFee;
        window.calculateStampDuty = calculateStampDuty;
        window.calculateCompensation = calculateCompensation;
        window.closeModal = closeModal;
        
        console.log('✅ LegalSwami Premium App Initialization Complete!');
    </script>
</body>
</html>
