<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LegalSwami | AI-Powered Legal Assistant & Document Generator</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Google Client ID -->
    <meta name="google-client-id" 
          content="166511615962-bohur5q8d4i5hud6icr4185kcte9enk8.apps.googleusercontent.com">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚖️</text></svg>">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#0f172a">
    
    <!-- Apple Mobile Web App Capable -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="LegalSwami - AI Legal Assistant">
    <meta property="og:description" content="Get instant legal advice, generate documents, and understand laws with AI">
    <meta property="og:image" content="https://legalswami.com/og-image.jpg">
    <meta property="og:url" content="https://legalswami.com">
    
    <style>
        /* ChatGPT-like Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--dark-bg);
            width: 100%;
            height: 100%;
            min-height: 0;
            overflow: hidden;
            display: none; /* CHAT BOX HIDDEN BY DEFAULT */
        }
        
        .chat-container.active {
            display: flex;
        }
        
        .light-mode .chat-container {
            background: var(--light-bg);
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.25rem 1rem;
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            min-height: 0;
            width: 100%;
        }
        
        .message {
            display: flex;
            gap: 0.75rem;
            max-width: 100%;
            padding: 0 0.75rem;
            animation: fadeIn 0.2s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: var(--dark-surface);
            border-radius: 8px;
            padding: 1rem;
            max-width: 100%;
        }
        
        .light-mode .user-message {
            background: var(--light-surface);
        }
        
        .ai-message {
            background: transparent;
        }
        
        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            flex-shrink: 0;
            margin-top: 4px;
        }
        
        .user-message .avatar {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }
        
        .ai-message .avatar {
            background: linear-gradient(135deg, var(--secondary) 0%, #5e35b1 100%);
        }
        
        .message-content {
            flex: 1;
            position: relative;
            width: 100%;
            min-width: 0;
        }
        
        .message-text {
            padding: 0;
            border-radius: 0;
            font-size: 0.9375rem;
            line-height: 1.6;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow: hidden;
            color: var(--dark-text);
        }
        
        .light-mode .message-text {
            color: var(--light-text);
        }
        
        .user-message .message-text {
            color: white;
        }
        
        /* ChatGPT-like Input Area */
        .input-container {
            padding: 0.875rem;
            background: var(--dark-bg);
            border-top: 1px solid var(--dark-border);
            position: sticky;
            bottom: 0;
            z-index: 10;
            transition: all 0.2s ease;
            width: 100%;
            flex-shrink: 0;
        }
        
        .light-mode .input-container {
            background: var(--light-bg);
            border-top-color: var(--light-border);
        }
        
        .input-area {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            width: 100%;
        }
        
        .input-area textarea {
            width: 100%;
            padding: 0.875rem 6.5rem 0.875rem 1rem;
            background: var(--dark-surface);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            color: var(--dark-text);
            font-size: 0.9375rem;
            resize: none;
            min-height: 52px;
            max-height: 150px;
            transition: all 0.2s;
            line-height: 1.5;
            font-family: inherit;
            outline: none;
        }
        
        .light-mode .input-area textarea {
            background: var(--light-surface);
            border-color: var(--light-border);
            color: var(--light-text);
        }
        
        .input-area textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(16, 163, 127, 0.1);
        }
        
        .input-buttons {
            position: absolute;
            right: 0.75rem;
            bottom: 0.75rem;
            display: flex;
            gap: 6px;
            align-items: center;
        }
        
        .send-button {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 0.875rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            min-height: 40px;
            font-size: 0.875rem;
        }
        
        .send-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 163, 127, 0.3);
        }
        
        .send-button:disabled {
            background: var(--dark-border);
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .light-mode .send-button:disabled {
            background: var(--light-border);
        }
        
        /* Login Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            position: relative;
            background: var(--dark-bg);
            border-radius: 16px;
            width: 90%;
            max-width: 450px;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 1001;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--dark-border);
        }
        
        .light-mode .modal-content {
            background: var(--light-bg);
            border-color: var(--light-border);
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: var(--dark-text);
            font-size: 1.25rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: var(--dark-surface);
            color: var(--error);
        }
        
        .light-mode .modal-close {
            color: var(--light-text);
        }
        
        .light-mode .modal-close:hover {
            background: var(--light-surface);
        }
        
        .modal-header {
            padding: 2rem 2rem 1rem;
            text-align: center;
        }
        
        .modal-body {
            padding: 1rem 2rem 2rem;
        }
        
        /* Google Sign-in Button */
        #googleSignInContainer {
            display: flex;
            justify-content: center;
            margin: 1rem 0;
        }
        
        .google-signin-btn {
            width: 100%;
            padding: 0.875rem 1.5rem;
            background: white;
            color: #5f6368;
            border: 1px solid #dadce0;
            border-radius: 8px;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.2s;
            margin: 1rem 0;
        }
        
        .google-signin-btn:hover {
            background: #f8f9fa;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .google-signin-btn i {
            color: #4285f4;
            font-size: 1.125rem;
        }
        
        .demo-login-btn {
            width: 100%;
            padding: 0.875rem 1.5rem;
            background: var(--dark-surface);
            color: var(--dark-text);
            border: 1px solid var(--dark-border);
            border-radius: 8px;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.2s;
            margin: 1rem 0;
        }
        
        .light-mode .demo-login-btn {
            background: var(--light-surface);
            color: var(--light-text);
            border-color: var(--light-border);
        }
        
        .demo-login-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 1.5rem 0;
            color: var(--dark-text-secondary);
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid var(--dark-border);
        }
        
        .divider span {
            padding: 0 1rem;
            font-size: 0.875rem;
        }
        
        .light-mode .divider {
            color: var(--light-text-secondary);
        }
        
        .light-mode .divider::before,
        .light-mode .divider::after {
            border-color: var(--light-border);
        }
        
        .login-info {
            background: var(--dark-surface);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1.5rem;
            font-size: 0.8125rem;
        }
        
        .light-mode .login-info {
            background: var(--light-surface);
        }
        
        .login-info p {
            margin: 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .login-info i {
            color: var(--primary);
        }
        
        /* App Container - Hidden by default */
        #appContainer {
            display: none;
        }
        
        #appContainer.active {
            display: flex;
        }
        
        /* Start Chat Button Styles */
        #startChatBtn, #heroAssistantBtn, #ctaStartChat, #mobileStartChat {
            cursor: pointer;
        }
        
        /* Scroll to bottom button */
        .scroll-to-bottom-btn {
            position: fixed;
            right: 20px;
            bottom: 100px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(16, 163, 127, 0.3);
        }
        
        .scroll-to-bottom-btn.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .scroll-to-bottom-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 163, 127, 0.4);
        }
        
        /* Progress indicator */
        .progress-indicator {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }
        
        .progress-indicator.active {
            display: flex;
        }
        
        .progress-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--dark-border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Language hint */
        .language-hint {
            position: absolute;
            top: -30px;
            left: 12px;
            background: var(--dark-surface);
            color: var(--dark-text-secondary);
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 4px;
            display: none;
            z-index: 1;
            white-space: nowrap;
        }
        
        .light-mode .language-hint {
            background: var(--light-surface);
            color: var(--light-text-secondary);
        }
        
        /* User dropdown */
        .user-dropdown {
            position: absolute;
            top: 60px;
            right: 20px;
            background: var(--dark-bg);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            width: 280px;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .user-dropdown.active {
            display: block;
        }
        
        .light-mode .user-dropdown {
            background: var(--light-bg);
            border-color: var(--light-border);
        }
        
        .dropdown-header {
            padding: 1rem;
            border-bottom: 1px solid var(--dark-border);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .light-mode .dropdown-header {
            border-color: var(--light-border);
        }
        
        .dropdown-items {
            padding: 0.5rem 0;
        }
        
        .dropdown-item {
            width: 100%;
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            color: var(--dark-text);
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .light-mode .dropdown-item {
            color: var(--light-text);
        }
        
        .dropdown-item:hover {
            background: var(--dark-surface);
        }
        
        .light-mode .dropdown-item:hover {
            background: var(--light-surface);
        }
        
        .dropdown-item.logout {
            color: var(--error);
        }
        
        .dropdown-footer {
            border-top: 1px solid var(--dark-border);
            margin-top: 0.5rem;
            padding-top: 0.5rem;
        }
        
        .light-mode .dropdown-footer {
            border-color: var(--light-border);
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--dark-bg);
            color: var(--dark-text);
            padding: 12px 20px;
            border-radius: 8px;
            border: 1px solid var(--dark-border);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 350px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            border-left: 4px solid var(--success);
        }
        
        .toast.error {
            border-left: 4px solid var(--error);
        }
        
        .toast.warning {
            border-left: 4px solid var(--warning);
        }
        
        .toast.info {
            border-left: 4px solid var(--primary);
        }
        
        .light-mode .toast {
            background: var(--light-bg);
            color: var(--light-text);
            border-color: var(--light-border);
        }
        
        /* Download notification */
        .download-notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--dark-bg);
            color: var(--dark-text);
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--dark-border);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 10000;
            transform: translateX(-100%);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 350px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            cursor: pointer;
        }
        
        .download-notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .light-mode .download-notification {
            background: var(--light-bg);
            color: var(--light-text);
            border-color: var(--light-border);
        }
        
        .download-notification-content {
            flex: 1;
        }
        
        .download-notification-title {
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .download-notification-message {
            font-size: 0.8125rem;
            color: var(--dark-text-secondary);
            margin-top: 2px;
        }
        
        .light-mode .download-notification-message {
            color: var(--light-text-secondary);
        }
        
        .download-notification-close {
            background: transparent;
            border: none;
            color: var(--dark-text-secondary);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
        }
        
        .download-notification-close:hover {
            background: var(--dark-surface);
            color: var(--dark-text);
        }
        
        .light-mode .download-notification-close:hover {
            background: var(--light-surface);
            color: var(--light-text);
        }
        
        /* Voice input status */
        .voice-input-status {
            position: absolute;
            top: -40px;
            left: 0;
            right: 0;
            background: var(--dark-surface);
            color: var(--dark-text);
            padding: 8px 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            display: none;
            z-index: 1;
            font-size: 0.875rem;
        }
        
        .voice-input-status.active {
            display: flex;
        }
        
        .light-mode .voice-input-status {
            background: var(--light-surface);
            color: var(--light-text);
        }
        
        .voice-animation {
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        .voice-bar {
            width: 2px;
            height: 10px;
            background: var(--primary);
            border-radius: 1px;
            animation: voicePulse 1s infinite;
        }
        
        .voice-bar:nth-child(2) {
            animation-delay: 0.1s;
            height: 14px;
        }
        
        .voice-bar:nth-child(3) {
            animation-delay: 0.2s;
            height: 18px;
        }
        
        .voice-bar:nth-child(4) {
            animation-delay: 0.3s;
            height: 14px;
        }
        
        .voice-bar:nth-child(5) {
            animation-delay: 0.4s;
            height: 10px;
        }
        
        @keyframes voicePulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                max-width: 95%;
            }
            
            .modal-header {
                padding: 1.5rem 1.5rem 1rem;
            }
            
            .modal-body {
                padding: 1rem 1.5rem 1.5rem;
            }
            
            .user-dropdown {
                width: calc(100vw - 40px);
                right: 20px;
            }
            
            .toast {
                left: 20px;
                right: 20px;
                max-width: calc(100vw - 40px);
            }
            
            .download-notification {
                left: 20px;
                right: 20px;
                max-width: calc(100vw - 40px);
            }
        }
        
        /* Fix for mobile view */
        @media (max-width: 480px) {
            .hide-on-mobile {
                display: none !important;
            }
            
            .input-buttons {
                gap: 4px;
            }
            
            .send-button {
                padding: 0.5rem;
                min-width: 44px;
            }
            
            .voice-search-btn, .attachment-btn, .emoji-picker-btn, .input-microphone-btn {
                width: 36px;
                height: 36px;
                padding: 0;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .scroll-to-bottom-btn {
                width: 40px;
                height: 40px;
                right: 10px;
                bottom: 80px;
            }
        }
        
        /* Main content visibility */
        .main-container {
            min-height: 100vh;
        }
        
        /* Button loading state */
        .btn-loading {
            position: relative;
            color: transparent !important;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin: -8px 0 0 -8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
    </style>
    
</head>
<body>
    <!-- Premium Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner legal-seal">
                <i class="fas fa-gavel"></i>
            </div>
            <h2 class="shimmer-text mt-4">LegalSwami</h2>
            <p class="text-light">Initializing AI Legal Assistant...</p>
            <div class="progress-bar mt-4">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Premium Navigation Bar -->
        <nav class="premium-navbar">
            <div class="nav-container">
                <!-- Logo with Animation -->
                <div class="nav-logo">
                    <div class="logo-icon legal-seal">
                        <i class="fas fa-gavel gavel-animation"></i>
                    </div>
                    <div class="logo-text">
                        <h1 class="logo-title shimmer-text">LegalSwami</h1>
                        <p class="logo-subtitle">AI Legal Assistant</p>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="nav-menu">
                    <a href="#home" class="nav-link active" data-scroll="home">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="#features" class="nav-link" data-scroll="features">
                        <i class="fas fa-star"></i>
                        <span>Features</span>
                    </a>
                    <a href="#documents" class="nav-link" data-scroll="documents">
                        <i class="fas fa-file-contract"></i>
                        <span>Documents</span>
                    </a>
                    <a href="#legalDatabase" class="nav-link" data-scroll="legalDatabase">
                        <i class="fas fa-database"></i>
                        <span>Legal Database</span>
                    </a>
                    <a href="#lawyerDirectory" class="nav-link" data-scroll="lawyerDirectory">
                        <i class="fas fa-user-tie"></i>
                        <span>Find Lawyers</span>
                    </a>
                    <a href="#pricing" class="nav-link" data-scroll="pricing">
                        <i class="fas fa-tag"></i>
                        <span>Pricing</span>
                    </a>
                </div>

                <!-- User Actions -->
                <div class="nav-actions">
                    <button id="headerLoginBtn" class="btn-login">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Login</span>
                    </button>
                    
                    <div id="userProfile" class="user-profile" style="display: none;">
                        <div class="profile-avatar">
                            <div id="userAvatar"></div>
                        </div>
                        <div class="profile-info">
                            <span id="userName" class="profile-name"></span>
                            <span id="userEmail" class="profile-email"></span>
                        </div>
                        <button id="logoutBtn" class="btn-logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>

                <!-- Mobile Menu Toggle -->
                <button class="mobile-toggle" id="mobileToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </nav>

        <!-- Mobile Menu -->
        <div class="mobile-menu-overlay" id="mobileMenu" style="display: none;">
            <div class="mobile-menu-container">
                <div class="mobile-menu-header">
                    <div class="logo-icon legal-seal">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <button class="mobile-close" id="mobileClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mobile-menu-links">
                    <a href="#home" class="mobile-link active">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="#features" class="mobile-link">
                        <i class="fas fa-star"></i>
                        <span>Features</span>
                    </a>
                    <a href="#documents" class="mobile-link">
                        <i class="fas fa-file-contract"></i>
                        <span>Documents</span>
                    </a>
                    <a href="#legalDatabase" class="mobile-link">
                        <i class="fas fa-database"></i>
                        <span>Legal Database</span>
                    </a>
                    <a href="#lawyerDirectory" class="mobile-link">
                        <i class="fas fa-user-tie"></i>
                        <span>Find Lawyers</span>
                    </a>
                    <a href="#legalGuides" class="mobile-link">
                        <i class="fas fa-book"></i>
                        <span>Legal Guides</span>
                    </a>
                    <a href="#pricing" class="mobile-link">
                        <i class="fas fa-tag"></i>
                        <span>Pricing</span>
                    </a>
                    <a href="#" class="mobile-link" id="mobileStartChat">
                        <i class="fas fa-comments"></i>
                        <span>Start Chat</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Hero Section -->
        <section id="home" class="hero-section">
            <div class="hero-container container">
                <!-- Animated Background Elements -->
                <div class="hero-bg-elements">
                    <div class="floating-element floating-icon-1">
                        <i class="fas fa-balance-scale floating"></i>
                    </div>
                    <div class="floating-element floating-icon-2">
                        <i class="fas fa-gavel floating"></i>
                    </div>
                    <div class="floating-element floating-icon-3">
                        <i class="fas fa-scale-balanced floating"></i>
                    </div>
                </div>
                
                <div class="hero-content">
                    <div class="hero-badge">
                        <span class="badge-text">
                            <i class="fas fa-bolt"></i>
                            AI-POWERED LEGAL ASSISTANT
                        </span>
                    </div>
                    
                    <h1 class="hero-title text-reveal">
                        Get <span class="shimmer-text">Instant Legal Help</span><br>
                        From Your AI Assistant
                    </h1>
                    
                    <p class="hero-subtitle">
                        LegalSwami provides 24/7 AI-powered legal guidance, document generation, 
                        and legal research assistance. Get instant answers to your legal questions 
                        in simple, understandable language.
                    </p>
                    
                    <div class="hero-stats">
                        <div class="stat-item">
                            <div class="stat-number shimmer-text">10,000+</div>
                            <div class="stat-label">Legal Documents Generated</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number shimmer-text">50,000+</div>
                            <div class="stat-label">Legal Questions Answered</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number shimmer-text">99.8%</div>
                            <div class="stat-label">User Satisfaction Rate</div>
                        </div>
                    </div>
                    
                    <div class="hero-actions">
                        <button id="startChatBtn" class="btn-hero-primary btn-premium">
                            <i class="fas fa-comments"></i>
                            <span>Start Free Chat Now</span>
                            <div class="btn-sparkle">
                                <i class="fas fa-sparkle"></i>
                            </div>
                        </button>
                        
                        <button id="watchDemo" class="btn-hero-secondary">
                            <i class="fas fa-play-circle"></i>
                            <span>Watch Demo Video</span>
                        </button>
                    </div>
                    
                    <div class="hero-trust">
                        <div class="trust-label">Trusted by</div>
                        <div class="trust-badges">
                            <div class="trust-badge">
                                <i class="fas fa-university"></i>
                                <span>Law Firms</span>
                            </div>
                            <div class="trust-badge">
                                <i class="fas fa-graduation-cap"></i>
                                <span>Law Students</span>
                            </div>
                            <div class="trust-badge">
                                <i class="fas fa-briefcase"></i>
                                <span>Businesses</span>
                            </div>
                            <div class="trust-badge">
                                <i class="fas fa-users"></i>
                                <span>Individuals</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="hero-illustration">
                    <div class="ai-assistant-card premium-card pulse-glow">
                        <div class="assistant-avatar legal-seal">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h3 class="assistant-title">AI Legal Assistant</h3>
                        <p class="assistant-subtitle">Available 24/7</p>
                        
                        <div class="assistant-features">
                            <div class="feature">
                                <i class="fas fa-check-circle"></i>
                                <span>Instant Responses</span>
                            </div>
                            <div class="feature">
                                <i class="fas fa-check-circle"></i>
                                <span>Multi-Language</span>
                            </div>
                            <div class="feature">
                                <i class="fas fa-check-circle"></i>
                                <span>Document Generation</span>
                            </div>
                        </div>
                        
                        <button class="btn-assistant" id="heroAssistantBtn">
                            <i class="fas fa-comment-alt"></i>
                            Ask Legal Question
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Scroll Indicator -->
            <div class="scroll-indicator">
                <div class="mouse">
                    <div class="wheel"></div>
                </div>
                <div class="arrow">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="features-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="shimmer-text">Powerful Features</span> for All Your Legal Needs
                    </h2>
                    <p class="section-subtitle">
                        Everything you need in one comprehensive legal assistant
                    </p>
                </div>
                
                <div class="features-grid">
                    <!-- Feature 1 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-comments"></i>
                        </div>
                        <h3 class="feature-title">AI Chat Assistant</h3>
                        <p class="feature-description">
                            Ask legal questions in natural language and get instant, accurate responses powered by advanced AI.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">24/7 Available</span>
                            <span class="tag">Multi-Language</span>
                        </div>
                    </div>
                    
                    <!-- Feature 2 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <h3 class="feature-title">Smart Document Generation</h3>
                        <p class="feature-description">
                            Generate legal documents instantly in PDF, DOC, and TXT formats with customizable templates.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">100+ Templates</span>
                            <span class="tag">Customizable</span>
                        </div>
                    </div>
                    
                    <!-- Feature 3 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3 class="feature-title">Bank-Level Security</h3>
                        <p class="feature-description">
                            End-to-end encryption and secure authentication to protect your sensitive legal data.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">AES-256</span>
                            <span class="tag">GDPR Compliant</span>
                        </div>
                    </div>
                    
                    <!-- Feature 4 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-history"></i>
                        </div>
                        <h3 class="feature-title">Complete Chat History</h3>
                        <p class="feature-description">
                            Access your complete chat history anytime. Export conversations as documents for record keeping.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">Unlimited History</span>
                            <span class="tag">Export Options</span>
                        </div>
                    </div>
                    
                    <!-- Feature 5 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3 class="feature-title">Mobile Responsive</h3>
                        <p class="feature-description">
                            Access LegalSwami from any device - desktop, tablet, or mobile phone with native-like experience.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">PWA Support</span>
                            <span class="tag">Offline Mode</span>
                        </div>
                    </div>
                    
                    <!-- Feature 6 -->
                    <div class="feature-card premium-card">
                        <div class="feature-icon legal-seal">
                            <i class="fas fa-language"></i>
                        </div>
                        <h3 class="feature-title">Multi-Language Support</h3>
                        <p class="feature-description">
                            Get legal advice in multiple languages including Hindi, English, Marathi, Gujarati, and more.
                        </p>
                        <div class="feature-tags">
                            <span class="tag">10+ Languages</span>
                            <span class="tag">Real-time Translation</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Legal Database Section -->
        <section id="legalDatabase" class="database-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="shimmer-text">Legal Database</span> & Research Tools
                    </h2>
                    <p class="section-subtitle">
                        Access comprehensive legal resources and research materials
                    </p>
                </div>
                
                <div class="database-grid">
                    <!-- Legal Acts Database -->
                    <div class="database-card premium-card">
                        <div class="database-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <h3 class="database-title">Acts & Statutes</h3>
                        <ul class="database-list">
                            <li><i class="fas fa-search"></i> IPC (Indian Penal Code)</li>
                            <li><i class="fas fa-search"></i> CrPC (Criminal Procedure Code)</li>
                            <li><i class="fas fa-search"></i> CPC (Civil Procedure Code)</li>
                            <li><i class="fas fa-search"></i> Constitution of India</li>
                            <li><i class="fas fa-search"></i> Consumer Protection Act</li>
                        </ul>
                        <button class="btn-database" onclick="searchActs()">
                            <i class="fas fa-search"></i>
                            Search Acts
                        </button>
                    </div>
                    
                    <!-- Case Laws Database -->
                    <div class="database-card premium-card">
                        <div class="database-icon">
                            <i class="fas fa-gavel"></i>
                        </div>
                        <h3 class="database-title">Case Laws Database</h3>
                        <ul class="database-list">
                            <li><i class="fas fa-balance-scale"></i> Supreme Court Judgments</li>
                            <li><i class="fas fa-balance-scale"></i> High Court Judgments</li>
                            <li><i class="fas fa-balance-scale"></i> Landmark Cases</li>
                            <li><i class="fas fa-balance-scale"></i> Recent Judgments</li>
                            <li><i class="fas fa-balance-scale"></i> Case Citations</li>
                        </ul>
                        <button class="btn-database" onclick="searchCaseLaws()">
                            <i class="fas fa-gavel"></i>
                            Search Case Laws
                        </button>
                    </div>
                    
                    <!-- Legal Calculator -->
                    <div class="database-card premium-card">
                        <div class="database-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <h3 class="database-title">Legal Calculators</h3>
                        <ul class="database-list">
                            <li><i class="fas fa-calculator"></i> Court Fee Calculator</li>
                            <li><i class="fas fa-calculator"></i> Stamp Duty Calculator</li>
                            <li><i class="fas fa-calculator"></i> Compensation Calculator</li>
                            <li><i class="fas fa-calculator"></i> Interest Calculator</li>
                            <li><i class="fas fa-calculator"></i> Tax Calculator</li>
                        </ul>
                        <button class="btn-database" onclick="openLegalCalculator()">
                            <i class="fas fa-calculator"></i>
                            Open Calculator
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Document Types Section -->
        <section id="documents" class="documents-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Generate <span class="shimmer-text">Legal Documents</span> Instantly
                    </h2>
                    <p class="section-subtitle">
                        Professional legal documents at your fingertips
                    </p>
                </div>
                
                <div class="documents-grid">
                    <!-- Document Category 1 -->
                    <div class="document-category premium-card">
                        <div class="category-icon">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <h3 class="category-title">Agreements & Contracts</h3>
                        <ul class="document-list">
                            <li><i class="fas fa-check-circle"></i> Rental Agreement</li>
                            <li><i class="fas fa-check-circle"></i> Non-Disclosure Agreement</li>
                            <li><i class="fas fa-check-circle"></i> Employment Contract</li>
                            <li><i class="fas fa-check-circle"></i> Service Agreement</li>
                            <li><i class="fas fa-check-circle"></i> Partnership Agreement</li>
                        </ul>
                        <button class="btn-generate" onclick="generateDocument('rental-agreement')">
                            <i class="fas fa-magic"></i>
                            Generate Now
                        </button>
                    </div>
                    
                    <!-- Document Category 2 -->
                    <div class="document-category premium-card">
                        <div class="category-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <h3 class="category-title">Legal Notices & Letters</h3>
                        <ul class="document-list">
                            <li><i class="fas fa-check-circle"></i> Legal Notice</li>
                            <li><i class="fas fa-check-circle"></i> Cease & Desist Notice</li>
                            <li><i class="fas fa-check-circle"></i> Demand Letter</li>
                            <li><i class="fas fa-check-circle"></i> Notice to Quit</li>
                            <li><i class="fas fa-check-circle"></i> Consumer Complaint</li>
                        </ul>
                        <button class="btn-generate" onclick="generateDocument('legal-notice')">
                            <i class="fas fa-magic"></i>
                            Generate Now
                        </button>
                    </div>
                    
                    <!-- Document Category 3 -->
                    <div class="document-category premium-card">
                        <div class="category-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <h3 class="category-title">Personal & Family</h3>
                        <ul class="document-list">
                            <li><i class="fas fa-check-circle"></i> Will & Testament</li>
                            <li><i class="fas fa-check-circle"></i> Power of Attorney</li>
                            <li><i class="fas fa-check-circle"></i> Affidavit</li>
                            <li><i class="fas fa-check-circle"></i> Gift Deed</li>
                            <li><i class="fas fa-check-circle"></i> Divorce Papers</li>
                        </ul>
                        <button class="btn-generate" onclick="generateDocument('will-testament')">
                            <i class="fas fa-magic"></i>
                            Generate Now
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lawyer Directory Section -->
        <section id="lawyerDirectory" class="lawyer-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Find <span class="shimmer-text">Qualified Lawyers</span>
                    </h2>
                    <p class="section-subtitle">
                        Connect with experienced legal professionals
                    </p>
                </div>
                
                <div class="lawyer-search">
                    <div class="search-container">
                        <i class="fas fa-search"></i>
                        <input type="text" id="lawyerSearch" placeholder="Search by specialization, location, or name...">
                        <button class="btn-search" onclick="searchLawyers()">
                            <i class="fas fa-search"></i>
                            Search
                        </button>
                    </div>
                    
                    <div class="specialization-filters">
                        <button class="filter-btn active" data-specialization="all">All</button>
                        <button class="filter-btn" data-specialization="criminal">Criminal</button>
                        <button class="filter-btn" data-specialization="civil">Civil</button>
                        <button class="filter-btn" data-specialization="corporate">Corporate</button>
                        <button class="filter-btn" data-specialization="family">Family</button>
                        <button class="filter-btn" data-specialization="property">Property</button>
                    </div>
                </div>
                
                <div class="lawyers-grid" id="lawyersGrid">
                    <!-- Lawyers will be dynamically loaded here -->
                </div>
            </div>
        </section>

        <!-- Legal Procedure Guides Section -->
        <section id="legalGuides" class="guides-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="shimmer-text">Step-by-Step</span> Legal Guides
                    </h2>
                    <p class="section-subtitle">
                        Understand legal procedures with easy-to-follow guides
                    </p>
                </div>
                
                <div class="guides-grid">
                    <div class="guide-card premium-card">
                        <div class="guide-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <h3 class="guide-title">How to File a Case</h3>
                        <p class="guide-description">
                            Complete step-by-step guide for filing different types of cases in Indian courts.
                        </p>
                        <div class="guide-steps">
                            <span class="step">1. Document Preparation</span>
                            <span class="step">2. Court Selection</span>
                            <span class="step">3. Fee Payment</span>
                            <span class="step">4. Case Number</span>
                        </div>
                        <button class="btn-guide" onclick="openGuide('file-case')">
                            <i class="fas fa-book-open"></i>
                            View Guide
                        </button>
                    </div>
                    
                    <div class="guide-card premium-card">
                        <div class="guide-icon">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <h3 class="guide-title">Document Registration Process</h3>
                        <p class="guide-description">
                            Learn how to register legal documents with proper procedures and fees.
                        </p>
                        <div class="guide-steps">
                            <span class="step">1. Stamp Duty</span>
                            <span class="step">2. Witness Arrangement</span>
                            <span class="step">3. Registration Office</span>
                            <span class="step">4. Final Registration</span>
                        </div>
                        <button class="btn-guide" onclick="openGuide('registration')">
                            <i class="fas fa-book-open"></i>
                            View Guide
                        </button>
                    </div>
                    
                    <div class="guide-card premium-card">
                        <div class="guide-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <h3 class="guide-title">Consumer Complaint Process</h3>
                        <p class="guide-description">
                            Guide to filing consumer complaints with proper documentation and procedures.
                        </p>
                        <div class="guide-steps">
                            <span class="step">1. Complaint Drafting</span>
                            <span class="step">2. Evidence Collection</span>
                            <span class="step">3. Forum Selection</span>
                            <span class="step">4. Hearing Process</span>
                        </div>
                        <button class="btn-guide" onclick="openGuide('consumer-complaint')">
                            <i class="fas fa-book-open"></i>
                            View Guide
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section id="testimonials" class="testimonials-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Trusted by <span class="shimmer-text">Thousands</span> of Users
                    </h2>
                    <p class="section-subtitle">
                        See what our users have to say about LegalSwami
                    </p>
                </div>
                
                <div class="testimonials-carousel">
                    <!-- Testimonial 1 -->
                    <div class="testimonial-card premium-card">
                        <div class="testimonial-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p class="testimonial-text">
                            "LegalSwami helped me draft a professional rental agreement in minutes. The AI understood exactly what I needed and generated a perfect document. Saved me ₹5000 in lawyer fees!"
                        </p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Rahul Sharma">
                            </div>
                            <div class="author-info">
                                <h4 class="author-name">Rahul Sharma</h4>
                                <p class="author-title">Small Business Owner</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Testimonial 2 -->
                    <div class="testimonial-card premium-card">
                        <div class="testimonial-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                        </div>
                        <p class="testimonial-text">
                            "As a law student, LegalSwami is a game-changer! It helps me understand complex legal concepts and provides excellent research assistance. Like having a personal tutor 24/7."
                        </p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Priya Patel">
                            </div>
                            <div class="author-info">
                                <h4 class="author-name">Priya Patel</h4>
                                <p class="author-title">Law Student, NLU Delhi</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Testimonial 3 -->
                    <div class="testimonial-card premium-card">
                        <div class="testimonial-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p class="testimonial-text">
                            "The document generation feature saved our startup thousands! We needed multiple NDAs and service agreements. LegalSwami generated perfect documents in minutes. Incredible tool!"
                        </p>
                        <div class="testimonial-author">
                            <div class="author-avatar">
                                <img src="https://randomuser.me/api/portraits/men/67.jpg" alt="Ankit Verma">
                            </div>
                            <div class="author-info">
                                <h4 class="author-name">Ankit Verma</h4>
                                <p class="author-title">Tech Entrepreneur</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Pricing Section -->
        <section id="pricing" class="pricing-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        Simple, <span class="shimmer-text">Transparent</span> Pricing
                    </h2>
                    <p class="section-subtitle">
                        Choose the perfect plan for your legal needs
                    </p>
                </div>
                
                <div class="pricing-cards">
                    <!-- Free Plan -->
                    <div class="pricing-card premium-card">
                        <div class="pricing-badge">FREE</div>
                        <h3 class="pricing-title">Basic</h3>
                        <div class="pricing-price">
                            <span class="currency">₹</span>
                            <span class="amount">0</span>
                            <span class="period">/month</span>
                        </div>
                        <p class="pricing-description">Perfect for trying out LegalSwami</p>
                        
                        <ul class="pricing-features">
                            <li><i class="fas fa-check-circle"></i> 10 AI Chat Messages/Day</li>
                            <li><i class="fas fa-check-circle"></i> 3 Document Generations/Month</li>
                            <li><i class="fas fa-check-circle"></i> Basic Legal Questions</li>
                            <li><i class="fas fa-times-circle"></i> No Priority Support</li>
                            <li><i class="fas fa-times-circle"></i> No Document History</li>
                        </ul>
                        
                        <button class="btn-pricing" id="freePlanBtn">
                            Get Started Free
                        </button>
                    </div>
                    
                    <!-- Pro Plan -->
                    <div class="pricing-card premium-card premium-plan">
                        <div class="pricing-badge popular">POPULAR</div>
                        <h3 class="pricing-title">Professional</h3>
                        <div class="pricing-price">
                            <span class="currency">₹</span>
                            <span class="amount">499</span>
                            <span class="period">/month</span>
                        </div>
                        <p class="pricing-description">Perfect for professionals & businesses</p>
                        
                        <ul class="pricing-features">
                            <li><i class="fas fa-check-circle"></i> Unlimited AI Chat Messages</li>
                            <li><i class="fas fa-check-circle"></i> 50 Document Generations/Month</li>
                            <li><i class="fas fa-check-circle"></i> All Document Templates</li>
                            <li><i class="fas fa-check-circle"></i> Priority Support</li>
                            <li><i class="fas fa-check-circle"></i> Complete Chat History</li>
                        </ul>
                        
                        <button class="btn-pricing btn-premium" id="proPlanBtn">
                            <i class="fas fa-crown"></i>
                            Get Professional
                        </button>
                    </div>
                    
                    <!-- Business Plan -->
                    <div class="pricing-card premium-card">
                        <div class="pricing-badge">BUSINESS</div>
                        <h3 class="pricing-title">Enterprise</h3>
                        <div class="pricing-price">
                            <span class="currency">₹</span>
                            <span class="amount">1,499</span>
                            <span class="period">/month</span>
                        </div>
                        <p class="pricing-description">For law firms & large organizations</p>
                        
                        <ul class="pricing-features">
                            <li><i class="fas fa-check-circle"></i> Everything in Professional</li>
                            <li><i class="fas fa-check-circle"></i> Unlimited Document Generation</li>
                            <li><i class="fas fa-check-circle"></i> Team Collaboration</li>
                            <li><i class="fas fa-check-circle"></i> Custom Templates</li>
                            <li><i class="fas fa-check-circle"></i> Dedicated Account Manager</li>
                        </ul>
                        
                        <button class="btn-pricing" id="businessPlanBtn">
                            Contact Sales
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="cta-section">
            <div class="container">
                <div class="cta-content">
                    <h2 class="cta-title">
                        Ready to Experience <br>
                        AI-Powered Legal Assistance?
                    </h2>
                    <p class="cta-description">
                        Join thousands of satisfied users who trust LegalSwami for their legal needs. 
                        No credit card required to get started.
                    </p>
                    
                    <div class="cta-actions">
                        <button id="ctaStartChat" class="btn-cta-primary btn-premium">
                            <i class="fas fa-rocket"></i>
                            Start Free Chat Now
                        </button>
                        
                        <button id="ctaScheduleDemo" class="btn-cta-secondary">
                            <i class="fas fa-calendar"></i>
                            Schedule Demo
                        </button>
                    </div>
                    
                    <div class="cta-guarantee">
                        <div class="guarantee-item">
                            <i class="fas fa-shield-alt"></i>
                            <span>100% Secure & Private</span>
                        </div>
                        <div class="guarantee-item">
                            <i class="fas fa-clock"></i>
                            <span>Available 24/7</span>
                        </div>
                        <div class="guarantee-item">
                            <i class="fas fa-headset"></i>
                            <span>Priority Support</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CHATGPT-LIKE CHAT INTERFACE - INITIALLY HIDDEN -->
        <div class="container" id="appContainer">
            <header>
                <div class="logo">
                    <button class="sidebar-toggle" id="sidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="logo-icon">
                        <i class="fas fa-scale-balanced"></i>
                    </div>
                    <h1>LegalSwami</h1>
                </div>
                
                <div class="header-actions">
                    <div class="status-indicator">
                        <div class="status-dot"></div>
                        <span class="hide-on-mobile">AI Assistant Ready</span>
                    </div>
                    
                    <!-- Search Counter Display -->
                    <div class="search-counter" id="searchCounter">
                        <i class="fas fa-search"></i>
                        <span class="hide-on-mobile">Free searches: 500/500</span>
                    </div>
                    
                    <!-- Login Button -->
                    <button class="login-btn" id="headerLoginBtn2">
                        <i class="fas fa-sign-in-alt"></i>
                        <span class="hide-on-mobile">Login</span>
                    </button>
                    
                    <button class="header-btn voice-search-btn" id="voiceSearchBtn" title="Voice Search">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="header-btn theme-toggle" id="themeToggle" title="Toggle Theme">
                        <i class="fas fa-sun"></i>
                    </button>
                    <button class="header-btn" id="clearChatBtn">
                        <i class="fas fa-broom"></i>
                        <span class="hide-on-mobile">Clear Chat</span>
                    </button>
                    <button class="header-btn" id="downloadCurrentBtn">
                        <i class="fas fa-download"></i>
                        <span class="hide-on-mobile">Download Chat</span>
                    </button>
                    <button class="header-btn" id="suggestionsBtn">
                        <i class="fas fa-lightbulb"></i>
                        <span class="hide-on-mobile">Suggestions</span>
                    </button>
                    
                    <!-- User Profile -->
                    <div class="user-profile" id="userProfile2" style="display: none;">
                        <div class="user-avatar" id="userAvatar2">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-info">
                            <div class="user-name" id="userName2">Guest User</div>
                            <div class="user-email" id="userEmail2">Local Browser Mode</div>
                        </div>
                        <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                    </div>
                </div>
            </header>
            
            <!-- User Dropdown Menu -->
            <div class="user-dropdown" id="userDropdown">
                <div class="dropdown-header">
                    <div class="user-avatar" id="dropdownAvatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="dropdownName">Guest User</div>
                        <div class="user-email" id="dropdownEmail">Local Browser Mode</div>
                    </div>
                </div>
                
                <div class="dropdown-items">
                    <button class="dropdown-item" id="profileBtn">
                        <i class="fas fa-user-circle"></i>
                        <span>My Profile</span>
                    </button>
                    <button class="dropdown-item" id="settingsBtn">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </button>
                    <button class="dropdown-item" id="historyBtn">
                        <i class="fas fa-history"></i>
                        <span>Chat History</span>
                    </button>
                    <button class="dropdown-item" id="helpBtn">
                        <i class="fas fa-question-circle"></i>
                        <span>Help & Support</span>
                    </button>
                    <div class="dropdown-footer">
                        <button class="dropdown-item logout" id="logoutBtn2">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Clear Local Data</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="main-content">
                <!-- Down Arrow Button (Scroll to Bottom) -->
                <button class="scroll-to-bottom-btn" id="scrollToBottomBtn" title="Scroll to bottom">
                    <i class="fas fa-chevron-down"></i>
                </button>
                
                <div class="sidebar-overlay" id="sidebarOverlay"></div>
                
                <aside class="sidebar" id="sidebar">
                    <!-- Sidebar Close Button -->
                    <button class="sidebar-close" id="sidebarClose">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <!-- Sidebar Tabs -->
                    <div class="sidebar-tabs">
                        <button class="sidebar-tab active" data-tab="legal-topics">
                            <i class="fas fa-book"></i>
                            <span class="hide-on-mobile">Legal Topics</span>
                        </button>
                        <button class="sidebar-tab" data-tab="chat-history">
                            <i class="fas fa-history"></i>
                            <span class="hide-on-mobile">Chat History</span>
                        </button>
                    </div>
                    
                    <!-- Legal Topics Tab Content -->
                    <div class="tab-content active" id="legal-topics-content">
                        <div class="sidebar-header">
                            <h2><i class="fas fa-book"></i> Legal Topics</h2>
                        </div>
                        
                        <div class="sidebar-section">
                            <h3><i class="fas fa-gavel"></i> Common Legal Areas</h3>
                            <div class="topic-list">
                                <button class="topic-item" data-topic="contract">
                                    <i class="fas fa-file-contract"></i>
                                    <span>Contract Law</span>
                                </button>
                                <button class="topic-item" data-topic="employment">
                                    <i class="fas fa-briefcase"></i>
                                    <span>Employment Law</span>
                                </button>
                                <button class="topic-item" data-topic="intellectual">
                                    <i class="fas fa-lightbulb"></i>
                                    <span>Intellectual Property</span>
                                </button>
                                <button class="topic-item" data-topic="realestate">
                                    <i class="fas fa-house"></i>
                                    <span>Real Estate Law</span>
                                </button>
                                <button class="topic-item" data-topic="family">
                                    <i class="fas fa-heart"></i>
                                    <span>Family Law</span>
                                </button>
                                <button class="topic-item" data-topic="criminal">
                                    <i class="fas fa-gavel"></i>
                                    <span>Criminal Law</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Active Topics Tabs Section -->
                        <div class="sidebar-section" id="activeTopicsSection" style="display: none;">
                            <h3><i class="fas fa-folder-open"></i> Active Topics</h3>
                            <div class="topic-list" id="activeTopicsList">
                                <!-- Active topics will be added here dynamically -->
                            </div>
                        </div>
                        
                        <div class="sidebar-section">
                            <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                            <div class="quick-actions">
                                <button class="action-item" data-action="document-drafts">
                                    <i class="fas fa-file-alt"></i>
                                    <span>Document Drafts</span>
                                </button>
                                <button class="action-item" data-action="legal-research">
                                    <i class="fas fa-search"></i>
                                    <span>Legal Research</span>
                                </button>
                                <button class="action-item" data-action="case-analysis">
                                    <i class="fas fa-chart-bar"></i>
                                    <span>Case Analysis</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat History Tab Content -->
                    <div class="tab-content" id="chat-history-content">
                        <div class="history-header">
                            <h2><i class="fas fa-history"></i> Chat History</h2>
                            <button class="new-chat-btn" id="newChatBtn">
                                <i class="fas fa-plus"></i>
                                <span class="hide-on-mobile">New Chat</span>
                            </button>
                        </div>
                        
                        <div class="history-list" id="historyList">
                            <!-- History items will be loaded here -->
                            <div class="empty-history">
                                <i class="fas fa-comments"></i>
                                <p>No chat history yet</p>
                                <p style="font-size: 0.8125rem; margin-top: 0.5rem;">Start a conversation to see it here</p>
                            </div>
                        </div>
                    </div>
                </aside>
                
                <main class="chat-container" id="chatContainer">
                    <div class="chat-messages" id="chatMessages">
                        <!-- Welcome Message will be added dynamically -->
                    </div>
                    
                    <!-- Scroll Position Indicator -->
                    <div class="scroll-position-indicator" id="scrollPositionIndicator">
                        Scroll to see more messages
                    </div>
                    
                    <div class="input-container">
                        <div class="input-area">
                            <!-- Attachments Preview -->
                            <div class="attachments-preview" id="attachmentsPreview" style="display: none;"></div>
                            
                            <div class="voice-input-status" id="voiceInputStatus">
                                <div class="voice-animation">
                                    <div class="voice-bar"></div>
                                    <div class="voice-bar"></div>
                                    <div class="voice-bar"></div>
                                    <div class="voice-bar"></div>
                                    <div class="voice-bar"></div>
                                </div>
                                <span>Listening... Speak now</span>
                            </div>
                            
                            <textarea 
                                id="userInput" 
                                placeholder="Ask any legal question or attach files (images, PDF, TXT)... (Press Enter for new line, Ctrl+Enter to send)"
                                rows="1"
                            ></textarea>
                            
                            <div class="voice-input-text" id="voiceInputText"></div>
                            
                            <div class="input-buttons">
                                <!-- Emoji Picker Button -->
                                <button class="emoji-picker-btn" id="emojiPickerBtn" title="Insert emoji">
                                    <i class="far fa-smile"></i>
                                </button>
                                
                                <!-- Attachment Button -->
                                <button class="attachment-btn" id="attachmentBtn" title="Attach files (images, PDF, TXT)">
                                    <i class="fas fa-paperclip"></i>
                                </button>
                                
                                <!-- Voice Input Button -->
                                <button class="input-microphone-btn" id="inputMicrophoneBtn" title="Voice input">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                
                                <!-- Send/Stop Button -->
                                <button class="send-button" id="sendButton">
                                    <i class="fas fa-paper-plane"></i> <span class="hide-on-mobile">Send</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Legal Tools Modal -->
        <div id="legalToolsModal" class="modal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button id="closeLegalTools" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
                
                <div class="modal-header">
                    <div class="modal-icon legal-seal">
                        <i class="fas fa-tools"></i>
                    </div>
                    <h3>Legal Tools & Calculators</h3>
                    <p>Access various legal utilities</p>
                </div>
                
                <div class="modal-body">
                    <div class="tools-grid">
                        <button class="tool-card" onclick="openCalculator('court-fee')">
                            <i class="fas fa-calculator"></i>
                            <h4>Court Fee Calculator</h4>
                            <p>Calculate court fees for different cases</p>
                        </button>
                        
                        <button class="tool-card" onclick="openCalculator('stamp-duty')">
                            <i class="fas fa-file-invoice-dollar"></i>
                            <h4>Stamp Duty Calculator</h4>
                            <p>Calculate stamp duty for documents</p>
                        </button>
                        
                        <button class="tool-card" onclick="openCalculator('compensation')">
                            <i class="fas fa-money-check-alt"></i>
                            <h4>Compensation Calculator</h4>
                            <p>Calculate compensation amounts</p>
                        </button>
                        
                        <button class="tool-card" onclick="openLegalActSearch()">
                            <i class="fas fa-search"></i>
                            <h4>Act & Statute Search</h4>
                            <p>Search legal acts and statutes</p>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modern Login Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button id="closeLoginModal" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
                
                <div class="modal-header">
                    <div class="modal-icon legal-seal">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <h3>Welcome to LegalSwami</h3>
                    <p>Secure login to access all features</p>
                </div>
                
                <div class="modal-body">
                    <!-- Google Sign-In Container -->
                    <div id="googleSignInContainer"></div>
                    
                    <!-- Custom Google Button -->
                    <button id="customGoogleBtn" class="google-signin-btn">
                        <i class="fab fa-google"></i>
                        Continue with Google
                    </button>
                    
                    <div class="divider">
                        <span>or</span>
                    </div>
                    
                    <!-- Demo Login Button -->
                    <button id="demoLoginBtn" class="demo-login-btn">
                        <i class="fas fa-user"></i> Try Demo Version
                    </button>
                    
                    <div class="login-info">
                        <p><i class="fas fa-lock"></i> Your data is encrypted and secure</p>
                        <p><i class="fas fa-shield-alt"></i> We never share your personal information</p>
                        <p><i class="fas fa-bolt"></i> No credit card required</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="premium-footer">
            <div class="container">
                <div class="footer-content">
                    <!-- Company Info -->
                    <div class="footer-section">
                        <div class="footer-logo">
                            <div class="logo-icon legal-seal">
                                <i class="fas fa-gavel"></i>
                            </div>
                            <div class="logo-text">
                                <h3 class="logo-title shimmer-text">LegalSwami</h3>
                                <p class="logo-subtitle">AI Legal Assistant</p>
                            </div>
                        </div>
                        <p class="footer-description">
                            Making legal assistance accessible to everyone with AI-powered technology.
                        </p>
                        <div class="social-links">
                            <a href="#" class="social-link">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-linkedin"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-github"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-youtube"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Quick Links -->
                    <div class="footer-section">
                        <h4 class="footer-heading">Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="#home">Home</a></li>
                            <li><a href="#features">Features</a></li>
                            <li><a href="#documents">Documents</a></li>
                            <li><a href="#legalDatabase">Legal Database</a></li>
                            <li><a href="#lawyerDirectory">Find Lawyers</a></li>
                            <li><a href="#legalGuides">Legal Guides</a></li>
                            <li><a href="#testimonials">Testimonials</a></li>
                            <li><a href="#pricing">Pricing</a></li>
                        </ul>
                    </div>
                    
                    <!-- Legal -->
                    <div class="footer-section">
                        <h4 class="footer-heading">Legal</h4>
                        <ul class="footer-links">
                            <li><a href="#" id="termsLink">Terms of Service</a></li>
                            <li><a href="#" id="privacyLink">Privacy Policy</a></li>
                            <li><a href="#" id="disclaimerLink">Legal Disclaimer</a></li>
                            <li><a href="#" id="cookieLink">Cookie Policy</a></li>
                        </ul>
                    </div>
                    
                    <!-- Contact -->
                    <div class="footer-section">
                        <h4 class="footer-heading">Contact Us</h4>
                        <ul class="footer-contact">
                            <li>
                                <i class="fas fa-envelope"></i>
                                <a href="mailto:support@legalswami.com">support@legalswami.com</a>
                            </li>
                            <li>
                                <i class="fas fa-phone"></i>
                                <a href="tel:+919876543210">+91 9876543210</a>
                            </li>
                            <li>
                                <i class="fas fa-map-marker-alt"></i>
                                <span>Mumbai, India</span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <p class="copyright">
                        &copy; 2024 LegalSwami. All rights reserved.
                    </p>
                    <div class="disclaimer">
                        <i class="fas fa-exclamation-triangle"></i>
                        LegalSwami provides AI-powered legal assistance. It is not a substitute for professional legal advice.
                    </div>
                </div>
            </div>
        </footer>

        <!-- Back to Top -->
        <button id="backToTop" class="back-to-top">
            <i class="fas fa-chevron-up"></i>
        </button>
    </div>

    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Main App Script -->
    <script>
    // Core variables
    let chatHistory = [];
    let currentChatId = null;
    let conversationHistory = [];
    let messageContentForDownload = "";
    let isListening = false;
    let recognition = null;
    let isInputMicrophoneActive = false;
    let isLightMode = false;
    let currentStreamingMessageId = null;
    let currentStreamingContent = '';
    let currentStreamingBuffer = '';
    let streamingTextChunks = [];
    let streamingTextIndex = 0;
    let streamingWordDelay = 20;
    let streamingPunctuationDelay = 100;
    let attachedFiles = [];
    let selectedFiles = [];
    let activeLegalTopics = [];
    let isStreamingPaused = false;
    let isStreamingActive = false;
    let stopStreamingRequested = false;
    let currentUser = null;
    let isLoggedIn = false;
    let userToken = null;
    let searchCount = 0;
    const MAX_FREE_SEARCHES = 500;
    let scrollPosition = 0;
    let lastDownloadedFileUrl = null;
    let lastDownloadedFileName = '';
    let isProcessing = false;
    let googleGISInitialized = false;
    let isMobileMenuOpen = false;
    let isChatOpen = false;
    let isLoginModalOpen = false;
    let selectedLanguage = 'en';
    
    // Check device type
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    const isTablet = window.innerWidth <= 1024 && window.innerWidth > 480;
    
    const WELCOME_MESSAGE_HTML = `
        <div class="welcome-message">
            <h2>Welcome to LegalSwami</h2>
            <p>Your AI-powered legal assistant for accurate, comprehensive legal information and guidance.</p>
            <p style="color: var(--primary); margin-top: 10px; font-size: 0.875rem;">
                <i class="fas fa-language"></i> Supports multiple Indian languages including Marathi, Hindi, and more!
            </p>
            <div style="margin-top: 1.5rem;">
                <h3 style="color: var(--primary); margin-bottom: 0.875rem; font-size: 1rem;">Ready-to-Use Legal Documents:</h3>
                <div class="draft-templates">
                    <div class="draft-template" data-template="nda">
                        <i class="fas fa-file-signature"></i>
                        <h4>Non-Disclosure Agreement</h4>
                        <p>Confidentiality agreement template</p>
                    </div>
                    <div class="draft-template" data-template="employment">
                        <i class="fas fa-briefcase"></i>
                        <h4>Employment Contract</h4>
                        <p>Employee agreement template</p>
                    </div>
                    <div class="draft-template" data-template="rental">
                        <i class="fas fa-house"></i>
                        <h4>Rental Agreement</h4>
                        <p>Tenancy agreement template</p>
                    </div>
                    <div class="draft-template" data-template="loan">
                        <i class="fas fa-money-bill-wave"></i>
                        <h4>Loan Agreement</h4>
                        <p>Money lending agreement</p>
                    </div>
                </div>
            </div>
            <div class="section-divider"></div>
            <div class="welcome-features">
                <div class="feature">
                    <i class="fas fa-bolt"></i>
                    <h4>Instant Responses</h4>
                    <p>Get immediate legal insights powered by advanced AI</p>
                </div>
                <div class="feature">
                    <i class="fas fa-shield-alt"></i>
                    <h4>Confidential & Secure</h4>
                    <p>Your conversations are private and encrypted</p>
                </div>
                <div class="feature">
                    <i class="fas fa-language"></i>
                    <h4>Multi-Language</h4>
                    <p>Responds in same language as your query</p>
                </div>
                <div class="feature">
                    <i class="fas fa-microphone"></i>
                    <h4>Voice Search</h4>
                    <p>Speak your queries in natural language</p>
                </div>
                <div class="feature">
                    <i class="fas fa-file-upload"></i>
                    <h4>File Analysis</h4>
                    <p>Upload and analyze documents, images</p>
                </div>
            </div>
        </div>
    `;

    // DOM Content Loaded
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 LegalSwami Premium Frontend Initialized');
        
        // Hide loading screen
        setTimeout(function() {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.style.opacity = '0';
                setTimeout(function() {
                    loadingScreen.style.display = 'none';
                    console.log('✅ Loading screen hidden');
                }, 300);
            }
        }, 1500);
        
        // Initialize backend connection
        initializeAppWithBackend();
        
        // Setup event listeners
        setupEventListeners();
        
        // Initialize Google Authentication
        setTimeout(initializeSimpleGoogleAuth, 2000);
        
        // Check for existing user
        checkExistingUser();
        
        // Setup mobile optimizations
        if (isMobile) {
            applyMobileOptimizations();
        }
        
        // Setup scroll effects
        setupScrollEffects();
        
        // Setup mobile menu
        setupMobileMenu();
        
        console.log('✅ All initialization complete');
    });

    // Setup all event listeners
    function setupEventListeners() {
        // Login buttons
        const loginButtons = [
            document.getElementById('headerLoginBtn'),
            document.getElementById('headerLoginBtn2'),
            document.getElementById('startChatBtn'),
            document.getElementById('heroAssistantBtn'),
            document.getElementById('ctaStartChat'),
            document.getElementById('mobileStartChat'),
            document.getElementById('freePlanBtn')
        ];
        
        loginButtons.forEach(btn => {
            if (btn) {
                btn.addEventListener('click', showLoginModal);
            }
        });
        
        // Demo login button
        const demoLoginBtn = document.getElementById('demoLoginBtn');
        if (demoLoginBtn) {
            demoLoginBtn.addEventListener('click', handleDemoLogin);
        }
        
        // Custom Google login button
        const customGoogleBtn = document.getElementById('customGoogleBtn');
        if (customGoogleBtn) {
            customGoogleBtn.addEventListener('click', handleCustomGoogleLogin);
        }
        
        // Close login modal
        const closeLoginModal = document.getElementById('closeLoginModal');
        if (closeLoginModal) {
            closeLoginModal.addEventListener('click', function() {
                document.getElementById('loginModal').classList.remove('active');
            });
        }
        
        // Logout buttons
        const logoutButtons = [
            document.getElementById('logoutBtn'),
            document.getElementById('logoutBtn2')
        ];
        
        logoutButtons.forEach(btn => {
            if (btn) {
                btn.addEventListener('click', handleLogout);
            }
        });
        
        // Mobile menu
        const mobileToggle = document.getElementById('mobileToggle');
        const mobileClose = document.getElementById('mobileClose');
        
        if (mobileToggle) {
            mobileToggle.addEventListener('click', function() {
                const mobileMenu = document.getElementById('mobileMenu');
                isMobileMenuOpen = !isMobileMenuOpen;
                if (isMobileMenuOpen) {
                    mobileMenu.style.display = 'block';
                    setTimeout(function() {
                        mobileMenu.style.opacity = '1';
                    }, 10);
                    document.body.style.overflow = 'hidden';
                } else {
                    mobileMenu.style.opacity = '0';
                    setTimeout(function() {
                        mobileMenu.style.display = 'none';
                    }, 300);
                    document.body.style.overflow = '';
                }
                this.innerHTML = isMobileMenuOpen ? 
                    '<i class="fas fa-times"></i>' : 
                    '<i class="fas fa-bars"></i>';
            });
        }
        
        if (mobileClose) {
            mobileClose.addEventListener('click', function() {
                isMobileMenuOpen = false;
                const mobileMenu = document.getElementById('mobileMenu');
                mobileMenu.style.opacity = '0';
                setTimeout(function() {
                    mobileMenu.style.display = 'none';
                }, 300);
                document.body.style.overflow = '';
                if (mobileToggle) {
                    mobileToggle.innerHTML = '<i class="fas fa-bars"></i>';
                }
            });
        }
        
        // Back to top button
        const backToTopBtn = document.getElementById('backToTop');
        if (backToTopBtn) {
            backToTopBtn.addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    }

    // Show login modal
    function showLoginModal() {
        const modal = document.getElementById('loginModal');
        if (modal) {
            modal.classList.add('active');
            isLoginModalOpen = true;
            
            // Render Google Sign-In button
            setTimeout(function() {
                renderGoogleSignInButton();
            }, 100);
        }
    }

    // Initialize backend connection
    async function initializeAppWithBackend() {
        console.log('🔌 Initializing app with backend...');
        
        try {
            const backendUrl = 'https://legal-swami-backend.onrender.com';
            
            // Test backend health
            try {
                const healthResponse = await fetch(backendUrl + '/api/v1/public/health');
                if (healthResponse.ok) {
                    const healthData = await healthResponse.json();
                    console.log('✅ Backend health check passed:', healthData);
                    showToast('Backend connected successfully!', 'success');
                } else {
                    console.warn('⚠️ Backend health check failed:', healthResponse.status);
                }
            } catch (error) {
                console.warn('⚠️ Backend health check failed:', error.message);
            }
            
        } catch (error) {
            console.error('❌ Initialization failed:', error);
            showToast('Note: Some features may be limited', 'warning');
        }
    }

    // Initialize Google Authentication
    function initializeSimpleGoogleAuth() {
        console.log('🔐 Initializing Google Authentication...');
        
        if (typeof google === 'undefined') {
            console.warn('⚠️ Google Identity Services not loaded yet, will retry...');
            setTimeout(initializeSimpleGoogleAuth, 1000);
            return;
        }
        
        try {
            google.accounts.id.initialize({
                client_id: '166511615962-bohur5q8d4i5hud6icr4185kcte9enk8.apps.googleusercontent.com',
                callback: handleGoogleCredentialResponse,
                auto_select: false,
                cancel_on_tap_outside: true,
                context: 'signin',
                itp_support: false,
                ux_mode: isMobile ? 'popup' : 'popup'
            });
            
            googleGISInitialized = true;
            console.log('✅ Google Authentication initialized');
            
        } catch (error) {
            console.error('❌ Google Authentication initialization failed:', error);
        }
    }

    // Render Google Sign-In Button
    function renderGoogleSignInButton() {
        try {
            const container = document.getElementById('googleSignInContainer');
            if (!container || !googleGISInitialized) {
                console.log('⚠️ Google Sign-In container not found or GIS not initialized');
                const customBtn = document.getElementById('customGoogleBtn');
                if (customBtn) customBtn.style.display = 'flex';
                return;
            }
            
            // Clear the container first
            container.innerHTML = '';
            
            // Render Google Sign-In button with mobile optimization
            const buttonSize = isMobile ? 'large' : 'large';
            const buttonWidth = isMobile ? '100%' : '400';
            
            google.accounts.id.renderButton(
                container,
                {
                    theme: 'outline',
                    size: buttonSize,
                    text: 'signin_with',
                    shape: 'rectangular',
                    logo_alignment: 'left',
                    width: buttonWidth,
                    locale: 'en_US'
                }
            );
            
            console.log('✅ Google Sign-In button rendered');
            const customBtn = document.getElementById('customGoogleBtn');
            if (customBtn) customBtn.style.display = 'none';
            
        } catch (error) {
            console.error('❌ Failed to render Google Sign-In button:', error);
            const customBtn = document.getElementById('customGoogleBtn');
            if (customBtn) customBtn.style.display = 'flex';
        }
    }

    // Handle Google Credential Response
    function handleGoogleCredentialResponse(response) {
        console.log('🔐 Google credential received');
        
        try {
            const payload = JSON.parse(atob(response.credential.split('.')[1]));
            
            const userData = {
                id: 'google_' + payload.sub,
                name: payload.name,
                email: payload.email,
                picture: payload.picture,
                provider: 'google',
                token: response.credential
            };
            
            console.log('✅ Google user authenticated:', userData.email);
            
            localStorage.setItem('legalSwamiUser', JSON.stringify(userData));
            localStorage.setItem('legalSwamiToken', response.credential);
            
            currentUser = userData;
            isLoggedIn = true;
            userToken = response.credential;
            
            updateUserUI();
            document.getElementById('loginModal').classList.remove('active');
            
            // Show chat interface
            document.getElementById('appContainer').classList.add('active');
            
            // Initialize chat app
            initializeChatApp();
            
            showToast('Successfully logged in with Google!', 'success');
            
        } catch (error) {
            console.error('❌ Failed to process Google credential:', error);
            showToast('Login failed. Please try again.', 'error');
        }
    }

    // Handle Custom Google Login
    function handleCustomGoogleLogin() {
        console.log('🔐 Custom Google login triggered');
        
        if (!googleGISInitialized) {
            showToast('Google Sign-In is not available. Please use demo login.', 'warning');
            return;
        }
        
        try {
            google.accounts.id.prompt();
        } catch (error) {
            console.error('❌ Google login failed:', error);
            showToast('Google Sign-In failed. Using demo login instead.', 'warning');
            handleDemoLogin();
        }
    }

    // Handle Demo Login
    function handleDemoLogin() {
        console.log('👤 Demo login triggered');
        
        const demoUsers = [
            {
                id: 'demo_lawyer_1',
                name: 'Advocate Rajesh Kumar',
                email: 'demo.lawyer@example.com',
                role: 'lawyer',
                specialization: 'Corporate Law'
            },
            {
                id: 'demo_client_1',
                name: 'Priya Sharma',
                email: 'demo.client@example.com',
                role: 'client',
                caseType: 'Property Dispute'
            },
            {
                id: 'demo_student_1',
                name: 'Amit Patel',
                email: 'demo.student@example.com',
                role: 'student',
                institution: 'NLSIU Bangalore'
            }
        ];
        
        const randomUser = demoUsers[Math.floor(Math.random() * demoUsers.length)];
        
        const userData = {
            id: randomUser.id,
            name: randomUser.name,
            email: randomUser.email,
            role: randomUser.role,
            picture: 'https://ui-avatars.com/api/?name=' + encodeURIComponent(randomUser.name) + '&background=1a56db&color=fff&size=128',
            provider: 'demo',
            isDemo: true
        };
        
        localStorage.setItem('legalSwamiUser', JSON.stringify(userData));
        localStorage.setItem('legalSwamiToken', 'demo_token_' + Date.now());
        
        currentUser = userData;
        isLoggedIn = true;
        userToken = 'demo_token';
        
        updateUserUI();
        document.getElementById('loginModal').classList.remove('active');
        
        // Show chat interface
        document.getElementById('appContainer').classList.add('active');
        
        // Initialize chat app
        initializeChatApp();
        
        showToast('Welcome ' + userData.name + '! (Demo Mode)', 'success');
    }

    // Initialize Chat App
    function initializeChatApp() {
        console.log("Initializing chat app...");
        
        // Initialize search counter
        initializeSearchCounter();
        
        // Load user's chat history
        loadUserChatHistory();
        
        // Create new chat if none exists
        if (!currentChatId || conversationHistory.length === 0) {
            createNewChat();
        } else {
            loadCurrentChatMessages();
        }
        
        // Setup chat event listeners
        setupChatEventListeners();
        
        // Focus input on load
        const userInput = document.getElementById('userInput');
        if (userInput) {
            userInput.focus();
        }
        
        console.log("Chat app initialized successfully");
    }

    // Setup chat event listeners
    function setupChatEventListeners() {
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebarClose = document.getElementById('sidebarClose');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const clearChatBtn = document.getElementById('clearChatBtn');
        const downloadCurrentBtn = document.getElementById('downloadCurrentBtn');
        const suggestionsBtn = document.getElementById('suggestionsBtn');
        const voiceSearchBtn = document.getElementById('voiceSearchBtn');
        const inputMicrophoneBtn = document.getElementById('inputMicrophoneBtn');
        const themeToggle = document.getElementById('themeToggle');
        const topicItems = document.querySelectorAll('.topic-item');
        const actionItems = document.querySelectorAll('.action-item');
        const sidebarTabs = document.querySelectorAll('.sidebar-tab');
        const newChatBtn = document.getElementById('newChatBtn');
        const attachmentBtn = document.getElementById('attachmentBtn');
        
        // Send button click
        sendButton.addEventListener('click', function() {
            if (isStreamingActive) {
                stopStreaming();
            } else {
                sendMessage();
            }
        });
        
        // User input keydown
        userInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                e.preventDefault();
                if (isStreamingActive) {
                    stopStreaming();
                } else {
                    sendMessage();
                }
            }
            if (e.key === 'Enter' && !e.ctrlKey) {
                setTimeout(() => {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 150) + 'px';
                }, 10);
            }
        });
        
        // User input input
        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 150) + 'px';
            if (isStreamingActive) {
                sendButton.disabled = false;
                sendButton.classList.add('stop-button');
                sendButton.innerHTML = '<i class="fas fa-stop"></i> <span class="hide-on-mobile">Stop</span>';
            } else {
                sendButton.disabled = this.value.trim() === '' && attachedFiles.length === 0;
                sendButton.classList.remove('stop-button');
                sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> <span class="hide-on-mobile">Send</span>';
            }
        });
        
        // Voice search functionality
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-IN,hi-IN,mr-IN,ta-IN,te-IN';
            
            recognition.onstart = function() {
                isListening = true;
                if (isInputMicrophoneActive) {
                    inputMicrophoneBtn.classList.add('listening');
                } else {
                    voiceSearchBtn.classList.add('listening');
                }
                document.getElementById('voiceInputStatus').classList.add('active');
                showToast('Listening... Speak now 🎤', 'info');
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                const voiceInputText = document.getElementById('voiceInputText');
                if (event.results[0].isFinal) {
                    userInput.value = transcript;
                    userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
                    voiceInputText.style.display = 'none';
                    sendButton.disabled = false;
                    if (transcript.split(' ').length <= 10) {
                        setTimeout(() => {
                            sendMessage();
                        }, 1000);
                    }
                } else {
                    voiceInputText.textContent = transcript;
                    voiceInputText.style.display = 'block';
                }
            };
            
            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                isListening = false;
                isInputMicrophoneActive = false;
                inputMicrophoneBtn.classList.remove('listening');
                voiceSearchBtn.classList.remove('listening');
                document.getElementById('voiceInputStatus').classList.remove('active');
                if (event.error === 'not-allowed') {
                    showToast('Microphone access denied. Please allow microphone access. 🎤', 'error');
                } else {
                    showToast('Voice recognition failed. Please try again. ❌', 'error');
                }
            };
            
            recognition.onend = function() {
                isListening = false;
                isInputMicrophoneActive = false;
                inputMicrophoneBtn.classList.remove('listening');
                voiceSearchBtn.classList.remove('listening');
                document.getElementById('voiceInputStatus').classList.remove('active');
                document.getElementById('voiceInputText').style.display = 'none';
            };
            
            voiceSearchBtn.addEventListener('click', toggleVoiceRecognition);
            inputMicrophoneBtn.addEventListener('click', toggleInputVoiceRecognition);
        } else {
            voiceSearchBtn.style.display = 'none';
            inputMicrophoneBtn.style.display = 'none';
            showToast('Voice search not supported in your browser 🎤', 'warning');
        }
        
        // Theme toggle
        themeToggle.addEventListener('click', toggleTheme);
        
        // Sidebar toggle buttons
        sidebarToggle.addEventListener('click', function() {
            sidebar.classList.add('active');
            sidebarOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
        
        sidebarClose.addEventListener('click', function() {
            sidebar.classList.remove('active');
            sidebarOverlay.classList.remove('active');
            document.body.style.overflow = '';
        });
        
        sidebarOverlay.addEventListener('click', function() {
            sidebar.classList.remove('active');
            this.classList.remove('active');
            document.body.style.overflow = '';
        });
        
        // Sidebar tab switching
        sidebarTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.dataset.tab;
                sidebarTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabId}-content`).classList.add('active');
                if (tabId === 'chat-history') {
                    loadHistoryList();
                }
            });
        });
        
        // New chat button
        newChatBtn.addEventListener('click', createNewChat);
        
        // Clear chat button
        clearChatBtn.addEventListener('click', clearCurrentChat);
        
        // Download current chat button
        downloadCurrentBtn.addEventListener('click', () => {
            if (conversationHistory.length === 0) {
                showToast('No chat content to download 📄', 'warning');
                return;
            }
            openDownloadModal();
        });
        
        // Suggestions button
        suggestionsBtn.addEventListener('click', showSuggestions);
        
        // Topic click handlers
        topicItems.forEach(item => {
            item.addEventListener('click', function() {
                const topic = this.dataset.topic;
                const topicName = this.querySelector('span').textContent;
                const questions = {
                    'contract': 'What are the essential elements of a valid contract under Indian law? ⚖️',
                    'employment': 'What are the rights of employees regarding workplace harassment in India? 💼',
                    'intellectual': 'How does copyright protection work for software in India? 🧠',
                    'realestate': 'What documents are required for property registration in India? 🏠',
                    'family': 'What are the grounds for divorce under Hindu Marriage Act? 👨‍👩‍👧',
                    'criminal': 'What is the difference between bailable and non-bailable offenses? ⚖️'
                };
                userInput.value = questions[topic] || `Tell me about ${topicName.toLowerCase()} in Indian law. ⚖️`;
                userInput.focus();
                userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
                sendButton.disabled = false;
                showToast(`${topicName} tab opened 📂`, 'success');
                
                if (window.innerWidth < 1024) {
                    sidebar.classList.remove('active');
                    sidebarOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        });
        
        // Action click handlers
        actionItems.forEach(item => {
            item.addEventListener('click', function() {
                const action = this.dataset.action;
                if (action === 'document-drafts') {
                    userInput.value = 'Create a non-disclosure agreement draft for me 📝';
                    userInput.focus();
                } else if (action === 'legal-research') {
                    userInput.value = 'Can you help me research case laws related to breach of contract? 🔍';
                    userInput.focus();
                } else if (action === 'case-analysis') {
                    userInput.value = 'Can you analyze the legal principles in landmark privacy law cases? 📊';
                    userInput.focus();
                }
                userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
                sendButton.disabled = false;
                if (window.innerWidth < 1024) {
                    sidebar.classList.remove('active');
                    sidebarOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        });
        
        // File upload functionality
        attachmentBtn.addEventListener('click', openFileUploadModal);
        
        // Scroll to bottom button
        const scrollToBottomBtn = document.getElementById('scrollToBottomBtn');
        if (scrollToBottomBtn) {
            scrollToBottomBtn.addEventListener('click', scrollToBottom);
        }
        
        // Monitor scroll position
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
            chatMessages.addEventListener('scroll', checkScrollPosition);
            setTimeout(checkScrollPosition, 500);
            const observer = new MutationObserver(checkScrollPosition);
            observer.observe(chatMessages, { childList: true, subtree: true });
        }
        
        // Adjust chat layout
        setTimeout(adjustChatLayout, 100);
    }

    // Check for existing user
    function checkExistingUser() {
        console.log('👤 Checking for existing user...');
        
        const userStr = localStorage.getItem('legalSwamiUser');
        if (userStr) {
            try {
                const user = JSON.parse(userStr);
                console.log('✅ Found existing user:', user.name);
                
                currentUser = user;
                isLoggedIn = true;
                userToken = localStorage.getItem('legalSwamiToken');
                
                updateUserUI();
                return;
            } catch (e) {
                console.error('Error parsing user data:', e);
                localStorage.removeItem('legalSwamiUser');
                localStorage.removeItem('legalSwamiToken');
            }
        }
        
        updateUserUI();
    }

    // Update User UI
    function updateUserUI() {
        if (isLoggedIn && currentUser) {
            // Hide login buttons, show user profile
            document.getElementById('headerLoginBtn').style.display = 'none';
            document.getElementById('userProfile').style.display = 'flex';
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            
            // Update avatar
            const avatar = document.getElementById('userAvatar');
            if (currentUser.picture) {
                avatar.innerHTML = `<img src="${currentUser.picture}" alt="${currentUser.name}">`;
            } else {
                avatar.innerHTML = '<i class="fas fa-user"></i>';
            }
            
            // Update app header
            document.getElementById('headerLoginBtn2').style.display = 'none';
            document.getElementById('userProfile2').style.display = 'flex';
            document.getElementById('userName2').textContent = currentUser.name;
            document.getElementById('userEmail2').textContent = currentUser.email;
            
            const avatar2 = document.getElementById('userAvatar2');
            if (currentUser.picture) {
                avatar2.innerHTML = `<img src="${currentUser.picture}" alt="${currentUser.name}">`;
            } else {
                avatar2.innerHTML = '<i class="fas fa-user"></i>';
            }
            
            // Update dropdown
            document.getElementById('dropdownName').textContent = currentUser.name;
            document.getElementById('dropdownEmail').textContent = currentUser.email;
            const dropdownAvatar = document.getElementById('dropdownAvatar');
            if (currentUser.picture) {
                dropdownAvatar.innerHTML = `<img src="${currentUser.picture}" alt="${currentUser.name}">`;
            } else {
                dropdownAvatar.innerHTML = '<i class="fas fa-user"></i>';
            }
            
            document.getElementById('logoutBtn2').innerHTML = `
                <i class="fas fa-sign-out-alt"></i>
                <span>${currentUser.isDemo ? 'End Demo Session' : 'Logout'}</span>
            `;
        } else {
            // Show login buttons, hide user profile
            document.getElementById('headerLoginBtn').style.display = 'flex';
            document.getElementById('userProfile').style.display = 'none';
            document.getElementById('headerLoginBtn2').style.display = 'flex';
            document.getElementById('userProfile2').style.display = 'none';
        }
        updateSearchCounterDisplay();
    }

    // Handle Logout
    function handleLogout() {
        if (confirm('Are you sure you want to logout?')) {
            localStorage.removeItem('legalSwamiUser');
            localStorage.removeItem('legalSwamiToken');
            currentUser = null;
            userToken = null;
            isLoggedIn = false;
            
            // Hide chat interface
            document.getElementById('appContainer').classList.remove('active');
            
            updateUserUI();
            showToast('Logged out successfully', 'success');
        }
    }

    // Send message function
    async function sendMessage() {
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const message = userInput.value.trim();
        
        if (!message && attachedFiles.length === 0) {
            showToast('Please enter a message or attach a file 📝', 'warning');
            return;
        }
        
        if (!isLoggedIn && searchCount >= MAX_FREE_SEARCHES) {
            showToast(`You've used ${MAX_FREE_SEARCHES} free searches today. Please login for unlimited access. ⏰`, 'warning');
            return;
        }
        
        if (isListening && recognition) {
            recognition.stop();
        }
        
        // Add user message to chat
        const messageId = addMessageToChat(message, true, false, false, attachedFiles);
        userInput.value = '';
        userInput.style.height = '52px';
        sendButton.disabled = false;
        sendButton.classList.add('stop-button');
        sendButton.innerHTML = '<i class="fas fa-stop"></i> <span class="hide-on-mobile">Stop</span>';
        isStreamingActive = true;
        stopStreamingRequested = false;
        clearAttachments();
        
        try {
            // Prepare message data
            const userMessage = {
                role: 'user',
                content: message,
                language: selectedLanguage,
                attachments: [...attachedFiles],
                timestamp: new Date().toISOString()
            };
            
            conversationHistory.push(userMessage);
            
            // Update search count for free users
            if (!isLoggedIn) {
                searchCount++;
                saveSearchCounter();
                updateSearchCounterDisplay();
                
                const remaining = MAX_FREE_SEARCHES - searchCount;
                if (remaining === 50) {
                    showToast(`You have ${remaining} free searches remaining. ⚠️`, 'warning');
                } else if (remaining === 10) {
                    showToast(`Only ${remaining} free searches left! ⚠️`, 'warning');
                } else if (remaining === 0) {
                    showToast(`Daily limit reached! You've used ${MAX_FREE_SEARCHES} searches today. ⏰`, 'warning');
                }
            }
            
            // Simulate AI response (replace with actual API call)
            setTimeout(() => {
                if (stopStreamingRequested) return;
                
                const responses = [
                    "Based on Indian law, I can provide you with information about legal procedures. For specific legal advice, please consult a qualified lawyer.",
                    "I understand you're asking about legal matters. Here's some general information that might help you.",
                    "This appears to be a legal document request. I can help draft basic templates, but remember to consult a lawyer for official documents.",
                    "I've analyzed your query about legal procedures. Here are the key points you should know.",
                    "As an AI legal assistant, I can provide guidance on legal matters. For your specific case, here's what you need to know."
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                const aiMessageId = createStreamingMessage();
                startStreamingResponse(aiMessageId, randomResponse, isDocumentRequest(message));
            }, 1000);
            
        } catch (error) {
            console.error('Error:', error);
            const errorMessage = "I apologize for the inconvenience. I'm currently experiencing technical difficulties. Please try again in a moment. ⚠️";
            addMessageToChat(errorMessage, false);
            showToast('Service temporarily unavailable ⚠️', 'warning');
        } finally {
            sendButton.disabled = userInput.value.trim() === '' && attachedFiles.length === 0;
            sendButton.classList.remove('stop-button');
            sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> <span class="hide-on-mobile">Send</span>';
            isStreamingActive = false;
            document.getElementById('userInput').focus();
            setTimeout(adjustChatLayout, 100);
            saveCurrentChat();
        }
    }

    // Create new chat
    function createNewChat() {
        currentChatId = 'chat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        conversationHistory = [];
        const chatMessages = document.getElementById('chatMessages');
        const welcomeContainer = document.createElement('div');
        welcomeContainer.innerHTML = WELCOME_MESSAGE_HTML;
        chatMessages.innerHTML = '';
        chatMessages.appendChild(welcomeContainer);
        clearAttachments();
        loadHistoryList();
        showToast('New chat started 💬', 'success');
    }

    // Clear current chat
    function clearCurrentChat() {
        if (conversationHistory.length === 0 && attachedFiles.length === 0) {
            showToast('Chat is already empty 🗑️', 'warning');
            return;
        }
        if (confirm('Are you sure you want to clear the current chat?')) {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';
            conversationHistory = [];
            clearAttachments();
            createNewChat();
            showToast('Current chat cleared 🗑️', 'success');
        }
    }

    // Load user's chat history
    function loadUserChatHistory() {
        const userId = currentUser ? currentUser.id : 'guest';
        const storageKey = `legalSwamiChatHistory_${userId}`;
        try {
            const savedHistory = localStorage.getItem(storageKey);
            if (savedHistory) {
                chatHistory = JSON.parse(savedHistory);
            }
            const savedChatId = localStorage.getItem(`legalSwamiCurrentChatId_${userId}`);
            if (savedChatId) {
                currentChatId = savedChatId;
                const currentChat = chatHistory.find(chat => chat.id === currentChatId);
                if (currentChat) {
                    conversationHistory = [...currentChat.messages];
                }
            }
        } catch (error) {
            console.error('Error loading chat history:', error);
            chatHistory = [];
        }
    }

    // Save current chat
    function saveCurrentChat() {
        if (!currentChatId || conversationHistory.length === 0) return;
        const userId = currentUser ? currentUser.id : 'guest';
        const storageKey = `legalSwamiChatHistory_${userId}`;
        
        let title = 'New Chat';
        let preview = 'No messages yet';
        if (conversationHistory.length > 0) {
            const firstUserMessage = conversationHistory.find(msg => msg.role === 'user');
            if (firstUserMessage) {
                title = firstUserMessage.content.substring(0, 30);
                if (firstUserMessage.content.length > 30) {
                    title += '...';
                }
            }
            const lastMessage = conversationHistory[conversationHistory.length - 1];
            if (lastMessage) {
                preview = lastMessage.content.substring(0, 50);
                if (lastMessage.content.length > 50) {
                    preview += '...';
                }
            }
        }
        
        const chatData = {
            id: currentChatId,
            title: title,
            preview: preview,
            date: new Date().toISOString(),
            messages: [...conversationHistory],
            userId: userId
        };
        
        const chatIndex = chatHistory.findIndex(chat => chat.id === currentChatId);
        if (chatIndex !== -1) {
            chatHistory[chatIndex] = chatData;
        } else {
            chatHistory.unshift(chatData);
        }
        
        try {
            localStorage.setItem(storageKey, JSON.stringify(chatHistory));
            localStorage.setItem(`legalSwamiCurrentChatId_${userId}`, currentChatId);
        } catch (error) {
            console.error('Error saving chat history:', error);
        }
    }

    // Initialize search counter
    function initializeSearchCounter() {
        try {
            const savedCount = localStorage.getItem('legalSwamiSearchCount');
            if (savedCount) {
                searchCount = parseInt(savedCount);
            }
            const savedDate = localStorage.getItem('legalSwamiSearchDate');
            if (savedDate) {
                const lastDate = new Date(savedDate);
                const today = new Date();
                if (lastDate.getDate() !== today.getDate() || 
                    lastDate.getMonth() !== today.getMonth() || 
                    lastDate.getFullYear() !== today.getFullYear()) {
                    searchCount = 0;
                    saveSearchCounter();
                }
            }
            updateSearchCounterDisplay();
        } catch (error) {
            console.error('Error loading search counter:', error);
        }
    }

    // Save search counter
    function saveSearchCounter() {
        try {
            localStorage.setItem('legalSwamiSearchCount', searchCount.toString());
            localStorage.setItem('legalSwamiSearchDate', new Date().toISOString());
        } catch (error) {
            console.error('Error saving search counter:', error);
        }
    }

    // Update search counter display
    function updateSearchCounterDisplay() {
        const searchCounterElement = document.getElementById('searchCounter');
        if (searchCounterElement) {
            const maxSearches = MAX_FREE_SEARCHES;
            const remaining = maxSearches - searchCount;
            searchCounterElement.innerHTML = `<i class="fas fa-search"></i><span class="hide-on-mobile">Free searches: ${remaining}/${maxSearches}</span>`;
            if (remaining <= 50) {
                searchCounterElement.style.color = 'var(--warning)';
            } else if (remaining <= 10) {
                searchCounterElement.style.color = 'var(--error)';
            } else {
                searchCounterElement.style.color = 'var(--dark-text-secondary)';
            }
        }
    }

    // Toggle voice recognition
    function toggleVoiceRecognition() {
        if (!recognition) return;
        if (isListening && !isInputMicrophoneActive) {
            recognition.stop();
        } else {
            isInputMicrophoneActive = false;
            recognition.start();
        }
    }

    // Toggle input voice recognition
    function toggleInputVoiceRecognition() {
        if (!recognition) return;
        if (isListening && isInputMicrophoneActive) {
            recognition.stop();
        } else {
            isInputMicrophoneActive = true;
            recognition.start();
        }
    }

    // Toggle theme
    function toggleTheme() {
        const themeIcon = document.querySelector('.theme-toggle i');
        if (isLightMode) {
            document.body.classList.remove('light-mode');
            themeIcon.className = 'fas fa-sun';
            localStorage.setItem('legalSwamiTheme', 'dark');
            isLightMode = false;
        } else {
            document.body.classList.add('light-mode');
            themeIcon.className = 'fas fa-moon';
            localStorage.setItem('legalSwamiTheme', 'light');
            isLightMode = true;
        }
    }

    // Load theme preference
    function loadThemePreference() {
        const savedTheme = localStorage.getItem('legalSwamiTheme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-mode');
            const themeIcon = document.querySelector('.theme-toggle i');
            if (themeIcon) {
                themeIcon.className = 'fas fa-moon';
            }
            isLightMode = true;
        }
    }

    // Show suggestions
    function showSuggestions() {
        const suggestions = [
            "Create a non-disclosure agreement draft 📝",
            "I need an employment contract template 💼",
            "Generate a rental agreement for me 🏠",
            "Draft a loan agreement document 💰",
            "What are the essential elements of a valid contract? ⚖️"
        ];
        
        addMessageToChat(
            `<h3>Suggested Questions:</h3>
            <ul>
                ${suggestions.map(q => `<li style="cursor: pointer; padding: 6px; border-radius: 6px; transition: background 0.3s;" 
                    onmouseover="this.style.background='var(--dark-surface-light)'" 
                    onmouseout="this.style.background='transparent'"
                    onclick="document.getElementById('userInput').value = '${q}'; document.getElementById('userInput').focus(); document.getElementById('userInput').style.height = Math.min(document.getElementById('userInput').scrollHeight, 180) + 'px'; document.getElementById('sendButton').disabled = false;">
                    ${q}
                </li>`).join('')}
            </ul>
            <p>Click any question to add it to the input field. 👆</p>`,
            false
        );
    }

    // Check if user is asking for document
    function isDocumentRequest(message) {
        if (!message) return false;
        const docKeywords = [
            'draft', 'template', 'format', 'document', 'agreement', 
            'contract', 'nda', 'non disclosure', 'employment', 
            'rental', 'loan', 'will', 'testament', 'legal document'
        ];
        const lowerMessage = message.toLowerCase();
        return docKeywords.some(keyword => lowerMessage.includes(keyword));
    }

    // Add message to chat
    function addMessageToChat(content, isUser, fromHistory = false, isDocument = false, attachments = []) {
        const chatMessages = document.getElementById('chatMessages');
        
        // Remove welcome message if this is a new user message
        if (!fromHistory && isUser) {
            const welcomeMessage = document.querySelector('.welcome-message');
            if (welcomeMessage) {
                welcomeMessage.remove();
            }
        }
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
        const messageId = 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        messageDiv.id = messageId;
        
        const avatar = document.createElement('div');
        avatar.className = 'avatar';
        if (isUser) {
            if (currentUser && currentUser.picture) {
                avatar.innerHTML = `<img src="${currentUser.picture}" alt="${currentUser.name}" style="width: 100%; height: 100%; border-radius: 8px;">`;
            } else {
                avatar.innerHTML = '<i class="fas fa-user"></i>';
            }
        } else {
            avatar.innerHTML = '<i class="fas fa-scale-balanced"></i>';
            avatar.style.background = 'linear-gradient(135deg, var(--secondary) 0%, #5e35b1 100%)';
        }
        
        const messageContent = document.createElement('div');
        messageContent.className = 'message-content';
        
        const messageText = document.createElement('div');
        messageText.className = 'message-text';
        
        if (isUser) {
            messageText.innerHTML = content.replace(/\n/g, '<br>');
        } else {
            if (isDocument) {
                messageText.innerHTML = formatDocumentResponse(content);
            } else {
                messageText.innerHTML = formatLegalResponse(content);
            }
        }
        
        messageContent.appendChild(messageText);
        messageDiv.appendChild(avatar);
        messageDiv.appendChild(messageContent);
        chatMessages.appendChild(messageDiv);
        
        checkScrollPosition();
        return messageId;
    }

    // Format document response
    function formatDocumentResponse(text) {
        return text.replace(/\n/g, '<br>');
    }

    // Format legal response
    function formatLegalResponse(text) {
        return text.replace(/\n/g, '<br>');
    }

    // Create streaming message
    function createStreamingMessage() {
        const chatMessages = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message ai-message';
        const messageId = 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        messageDiv.id = messageId;
        
        const avatar = document.createElement('div');
        avatar.className = 'avatar';
        avatar.innerHTML = '<i class="fas fa-scale-balanced"></i>';
        avatar.style.background = 'linear-gradient(135deg, var(--secondary) 0%, #5e35b1 100%)';
        
        const messageContent = document.createElement('div');
        messageContent.className = 'message-content';
        
        const messageText = document.createElement('div');
        messageText.className = 'message-text streaming-content';
        messageText.innerHTML = '<span class="streaming-cursor"></span>';
        
        messageContent.appendChild(messageText);
        messageDiv.appendChild(avatar);
        messageDiv.appendChild(messageContent);
        chatMessages.appendChild(messageDiv);
        
        currentStreamingMessageId = messageId;
        currentStreamingContent = '';
        currentStreamingBuffer = '';
        streamingTextChunks = [];
        streamingTextIndex = 0;
        
        checkScrollPosition();
        return messageId;
    }

    // Start streaming response
    function startStreamingResponse(messageId, response, isDocument = false) {
        const messageDiv = document.getElementById(messageId);
        if (!messageDiv) return;
        
        let textToStream = response;
        streamingTextChunks = splitTextIntoChunks(textToStream);
        streamingTextIndex = 0;
        streamNextChunk(messageId, isDocument);
    }

    // Split text into chunks
    function splitTextIntoChunks(text) {
        const chunks = [];
        const regex = /[\s.,;!?]+|\S+/g;
        let match;
        while ((match = regex.exec(text)) !== null) {
            chunks.push(match[0]);
        }
        return chunks;
    }

    // Stream next chunk
    function streamNextChunk(messageId, isDocument = false) {
        if (stopStreamingRequested || streamingTextIndex >= streamingTextChunks.length) {
            if (stopStreamingRequested) {
                console.log('Streaming stopped by user');
            } else {
                finalizeStreamingMessage(messageId, isDocument);
            }
            return;
        }
        
        const chunk = streamingTextChunks[streamingTextIndex];
        streamingTextIndex++;
        updateStreamingMessage(messageId, chunk, isDocument);
        
        let delay = streamingWordDelay;
        if (chunk.match(/[.,;!?]/)) {
            delay += streamingPunctuationDelay;
        }
        if (chunk.match(/[.!?]/)) {
            delay += 150;
        }
        
        setTimeout(() => {
            if (!isStreamingPaused && !stopStreamingRequested) {
                streamNextChunk(messageId, isDocument);
            }
        }, delay);
    }

    // Update streaming message
    function updateStreamingMessage(messageId, newContent, isDocument = false) {
        const messageDiv = document.getElementById(messageId);
        if (!messageDiv) return;
        
        const messageText = messageDiv.querySelector('.message-text');
        currentStreamingBuffer += newContent;
        currentStreamingContent += newContent;
        
        if (isDocument) {
            messageText.innerHTML = formatDocumentResponse(currentStreamingContent) + '<span class="streaming-cursor"></span>';
        } else {
            messageText.innerHTML = currentStreamingBuffer.replace(/\n/g, '<br>') + '<span class="streaming-cursor"></span>';
        }
        
        checkScrollPosition();
    }

    // Finalize streaming message
    function finalizeStreamingMessage(messageId, isDocument = false) {
        const messageDiv = document.getElementById(messageId);
        if (!messageDiv) return;
        
        const messageText = messageDiv.querySelector('.message-text');
        const cursor = messageText.querySelector('.streaming-cursor');
        if (cursor) cursor.remove();
        
        if (isDocument) {
            messageText.innerHTML = formatDocumentResponse(currentStreamingContent);
        } else {
            messageText.innerHTML = formatLegalResponse(currentStreamingContent);
        }
        
        // Add AI message to conversation history
        const aiMessage = {
            role: 'assistant',
            content: currentStreamingContent,
            language: selectedLanguage,
            isDocument: isDocument,
            timestamp: new Date().toISOString()
        };
        
        conversationHistory.push(aiMessage);
        
        currentStreamingMessageId = null;
        currentStreamingContent = '';
        currentStreamingBuffer = '';
        streamingTextChunks = [];
        streamingTextIndex = 0;
        isStreamingPaused = false;
        isStreamingActive = false;
        stopStreamingRequested = false;
        
        const sendButton = document.getElementById('sendButton');
        sendButton.disabled = document.getElementById('userInput').value.trim() === '' && attachedFiles.length === 0;
        sendButton.classList.remove('stop-button');
        sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> <span class="hide-on-mobile">Send</span>';
        
        saveCurrentChat();
    }

    // Stop streaming
    function stopStreaming() {
        stopStreamingRequested = true;
        isStreamingActive = false;
        isStreamingPaused = false;
        
        const sendButton = document.getElementById('sendButton');
        sendButton.disabled = document.getElementById('userInput').value.trim() === '' && attachedFiles.length === 0;
        sendButton.classList.remove('stop-button');
        sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> <span class="hide-on-mobile">Send</span>';
        
        if (currentStreamingMessageId) {
            finalizeStreamingMessage(currentStreamingMessageId, isDocumentRequest(currentStreamingContent));
        }
        
        showToast('Response stopped ⏹️', 'info');
    }

    // Load current chat messages
    function loadCurrentChatMessages() {
        const chatMessages = document.getElementById('chatMessages');
        chatMessages.innerHTML = '';
        
        if (conversationHistory.length === 0) {
            const welcomeContainer = document.createElement('div');
            welcomeContainer.innerHTML = WELCOME_MESSAGE_HTML;
            chatMessages.appendChild(welcomeContainer);
            return;
        }
        
        conversationHistory.forEach(msg => {
            const isDocument = msg.isDocument || false;
            addMessageToChat(msg.content, msg.role === 'user', true, isDocument, msg.attachments || []);
        });
    }

    // Load history list
    function loadHistoryList() {
        const historyList = document.getElementById('historyList');
        if (!historyList) return;
        
        if (chatHistory.length === 0) {
            historyList.innerHTML = `
                <div class="empty-history">
                    <i class="fas fa-comments"></i>
                    <p>No chat history yet</p>
                    <p style="font-size: 0.75rem; margin-top: 0.4rem;">Start a conversation to see it here</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        chatHistory.forEach(chat => {
            const isActive = chat.id === currentChatId;
            const date = new Date(chat.date);
            const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            html += `
                <div class="history-item ${isActive ? 'active' : ''}" data-chat-id="${chat.id}">
                    <div class="history-title">${chat.title}</div>
                    <div class="history-preview">${chat.preview}</div>
                    <div class="history-date">${formattedDate}</div>
                </div>
            `;
        });
        
        historyList.innerHTML = html;
        
        // Add click event listeners to history items
        document.querySelectorAll('.history-item').forEach(item => {
            item.addEventListener('click', function() {
                const chatId = this.dataset.chatId;
                loadChatFromHistory(chatId);
            });
        });
    }

    // Load chat from history
    function loadChatFromHistory(chatId) {
        const chat = chatHistory.find(c => c.id === chatId);
        if (!chat) return;
        
        currentChatId = chatId;
        conversationHistory = [...chat.messages];
        
        const chatMessages = document.getElementById('chatMessages');
        chatMessages.innerHTML = '';
        
        chat.messages.forEach(msg => {
            const isDocument = msg.isDocument || false;
            addMessageToChat(msg.content, msg.role === 'user', true, isDocument, msg.attachments || []);
        });
        
        loadHistoryList();
        
        if (window.innerWidth < 1024) {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('sidebarOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }
        
        showToast('Chat loaded from history 📚', 'success');
    }

    // Check scroll position
    function checkScrollPosition() {
        const chatMessages = document.getElementById('chatMessages');
        const scrollBtn = document.getElementById('scrollToBottomBtn');
        
        if (!chatMessages) return;
        
        const isAtBottom = chatMessages.scrollHeight - chatMessages.clientHeight <= chatMessages.scrollTop + 50;
        
        if (!isAtBottom) {
            scrollBtn.classList.add('visible');
        } else {
            scrollBtn.classList.remove('visible');
        }
        
        scrollPosition = chatMessages.scrollTop;
    }

    // Scroll to bottom
    function scrollToBottom() {
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
            chatMessages.scrollTo({
                top: chatMessages.scrollHeight,
                behavior: 'smooth'
            });
            document.getElementById('scrollToBottomBtn').classList.remove('visible');
        }
    }

    // Adjust chat layout
    function adjustChatLayout() {
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
        }
    }

    // Clear attachments
    function clearAttachments() {
        attachedFiles = [];
        const preview = document.getElementById('attachmentsPreview');
        if (preview) {
            preview.innerHTML = '';
            preview.style.display = 'none';
        }
    }

    // Open file upload modal
    function openFileUploadModal() {
        // Implement file upload modal
        showToast('File upload feature coming soon! 📎', 'info');
    }

    // Open download modal
    function openDownloadModal() {
        // Implement download modal
        showToast('Download feature coming soon! 📥', 'info');
    }

    // Apply mobile optimizations
    function applyMobileOptimizations() {
        console.log('📱 Applying mobile optimizations...');
        
        // Larger touch targets
        const touchElements = document.querySelectorAll('button, .nav-link, .quick-btn');
        touchElements.forEach(el => {
            el.style.minHeight = '44px';
            el.style.minWidth = '44px';
        });
        
        // Prevent zoom on input focus
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                if (isMobile) {
                    setTimeout(() => {
                        this.style.fontSize = '16px';
                    }, 100);
                }
            });
        });
        
        console.log('✅ Mobile optimizations applied');
    }

    // Setup scroll effects
    function setupScrollEffects() {
        const header = document.querySelector('.premium-navbar');
        const backToTopBtn = document.getElementById('backToTop');
        
        if (header) {
            window.addEventListener('scroll', function() {
                // Header shadow on scroll
                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
                
                // Back to top button
                if (backToTopBtn) {
                    if (window.scrollY > 300) {
                        backToTopBtn.classList.add('visible');
                    } else {
                        backToTopBtn.classList.remove('visible');
                    }
                }
            });
        }
    }

    // Setup mobile menu
    function setupMobileMenu() {
        const mobileMenu = document.getElementById('mobileMenu');
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            if (isMobileMenuOpen && mobileMenu && !mobileMenu.contains(event.target) && 
                event.target.id !== 'mobileToggle' && !event.target.closest('#mobileToggle')) {
                isMobileMenuOpen = false;
                mobileMenu.style.opacity = '0';
                setTimeout(function() {
                    mobileMenu.style.display = 'none';
                }, 300);
                document.body.style.overflow = '';
                
                const mobileToggle = document.getElementById('mobileToggle');
                if (mobileToggle) {
                    mobileToggle.innerHTML = '<i class="fas fa-bars"></i>';
                }
            }
        });
    }

    // Show toast notification
    function showToast(message, type = 'success') {
        // Create toast container if it doesn't exist
        let toastContainer = document.getElementById('toastContainer');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.id = 'toastContainer';
            toastContainer.className = 'toast-container';
            document.body.appendChild(toastContainer);
        }
        
        // Create toast element
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
            <span>${message}</span>
        `;
        
        // Add toast to container
        toastContainer.appendChild(toast);
        
        // Show toast
        setTimeout(() => {
            toast.classList.add('show');
        }, 10);
        
        // Remove toast after delay
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => {
                toast.remove();
            }, 300);
        }, 3000);
    }

    // Placeholder functions for unimplemented features
    function searchActs() { showToast('Search feature coming soon! 🔍', 'info'); }
    function searchCaseLaws() { showToast('Case law search coming soon! ⚖️', 'info'); }
    function openLegalCalculator() { showToast('Legal calculator coming soon! 🧮', 'info'); }
    function generateDocument(type) { showToast(`Document generation for ${type} coming soon! 📝`, 'info'); }
    function searchLawyers() { showToast('Lawyer search coming soon! 👨‍⚖️', 'info'); }
    function openGuide(guide) { showToast(`Guide for ${guide} coming soon! 📚`, 'info'); }
    </script>
</body>
</html>
