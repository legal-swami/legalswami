<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LegalSwami - Your AI Legal Assistant</title>
        
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Slab:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- ‚úÖ GOOGLE CLIENT ID CONFIGURATION -->
    <meta name="google-client-id" 
          content="166511615962-bohur5q8d4i5hud6icr4185kcte9enk8.apps.googleusercontent.com">
    
    <!-- ‚úÖ SIMPLE FAVICON FIX -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öñÔ∏è</text></svg>">
    
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --accent-color: #3b82f6;
            --light-color: #f8fafc;
            --dark-color: #1e293b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --text-primary: #334155;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 12px;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
        }
        
        /* Loading Screen Styles */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loading-content {
            text-align: center;
            color: white;
        }
        
        .loading-spinner {
            font-size: 60px;
            margin-bottom: 20px;
        }
        
        .loading-spinner .fa-spin {
            animation: fa-spin 2s infinite linear;
        }
        
        @keyframes fa-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ‚úÖ MODAL STYLES - UPDATED */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .modal.show {
            display: flex;
            opacity: 1;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 450px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        
        .modal.show .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 24px;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 24px;
        }
        
        .btn-icon {
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .btn-icon:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .modal-body {
            padding: 32px;
            text-align: center;
        }
        
        .login-illustration {
            font-size: 60px;
            color: #2563eb;
            margin-bottom: 20px;
        }
        
        .modal-body h4 {
            font-size: 20px;
            margin-bottom: 8px;
            color: #1e293b;
        }
        
        .modal-body p {
            color: #64748b;
            margin-bottom: 24px;
            font-size: 15px;
        }
        
        /* Google Sign-In Button Styles */
        .google-signin-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            padding: 14px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            color: #334155;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 24px 0;
        }
        
        .google-signin-btn:hover {
            background: #f8fafc;
            border-color: #ea4335;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .google-signin-btn i {
            font-size: 18px;
            color: #ea4335;
        }
        
        /* Demo Button Styles */
        .demo-login-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #7c3aed, #2563eb);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 12px 0;
        }
        
        .demo-login-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .login-info {
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            text-align: left;
        }
        
        .login-info p {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            color: #64748b;
            font-size: 14px;
        }
        
        .login-info i {
            color: #10b981;
        }
        
        /* Header Login Button */
        .btn-login {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: white;
            border: 2px solid #2563eb;
            border-radius: 8px;
            color: #2563eb;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-login:hover {
            background: #2563eb;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
        }
        
        /* User Profile Styles */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.9);
            border-radius: 12px;
            border: 2px solid #e2e8f0;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            color: #1e293b;
            font-size: 14px;
        }
        
        .user-email {
            font-size: 12px;
            color: #64748b;
        }
        
        .btn-logout {
            background: transparent;
            border: none;
            color: #64748b;
            font-size: 16px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .btn-logout:hover {
            background: #f8fafc;
            color: #ef4444;
        }
        
        /* Toast Styles */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10001;
        }
        
        .toast {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 10px;
            border-left: 4px solid;
            animation: toastSlideIn 0.3s ease;
        }
        
        .toast-success {
            border-left-color: #10b981;
        }
        
        .toast-error {
            border-left-color: #ef4444;
        }
        
        .toast-warning {
            border-left-color: #f59e0b;
        }
        
        .toast-info {
            border-left-color: #3b82f6;
        }
        
        .toast.fade-out {
            animation: toastSlideOut 0.3s ease;
            opacity: 0;
        }
        
        @keyframes toastSlideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes toastSlideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        /* Main Container */
        .main-container {
            min-height: 100vh;
        }
        
        /* Header Styles */
        .main-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        
        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 28px;
            color: #2563eb;
        }
        
        .logo h1 {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
        }
        
        .logo span {
            color: #2563eb;
        }
        
        .tagline {
            font-size: 12px;
            color: #64748b;
            margin-left: 10px;
            padding-left: 10px;
            border-left: 1px solid #e2e8f0;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #64748b;
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .nav-link:hover {
            color: #2563eb;
        }
        
        .user-section {
            display: flex;
            align-items: center;
        }
        
        /* Hero Section */
        .hero-section {
            padding: 80px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .hero-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 60px;
        }
        
        .hero-text {
            flex: 1;
        }
        
        .hero-title {
            font-size: 48px;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
            line-height: 1.2;
        }
        
        .hero-title .highlight {
            color: #fbbf24;
        }
        
        .hero-subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.9);
            margin-bottom: 40px;
            line-height: 1.6;
        }
        
        .hero-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
        }
        
        .btn-primary {
            padding: 15px 30px;
            background: linear-gradient(135deg, #7c3aed, #2563eb);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.3);
        }
        
        .btn-secondary {
            padding: 15px 30px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .hero-stats {
            display: flex;
            gap: 30px;
        }
        
        .stat {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-weight: 500;
        }
        
        .stat i {
            font-size: 20px;
            color: #fbbf24;
        }
        
        .hero-image {
            flex: 1;
            display: flex;
            justify-content: center;
        }
        
        .ai-illustration {
            position: relative;
            width: 300px;
            height: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .ai-illustration i {
            font-size: 120px;
            color: white;
        }
        
        .pulse-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(1.2);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner">
                <i class="fas fa-balance-scale fa-spin"></i>
            </div>
            <h2>Initializing LegalSwami</h2>
            <p>Loading AI legal assistant...</p>
        </div>
    </div>

    <!-- ‚úÖ LOGIN MODAL (REMOVED STYLE ATTRIBUTE) -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Welcome to LegalSwami</h3>
                <button id="closeLoginModal" class="btn-icon">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="login-illustration">
                    <i class="fas fa-balance-scale"></i>
                </div>
                
                <h4>Login to Continue</h4>
                <p>Secure login to access all features</p>
                
                <!-- ‚úÖ GOOGLE SIGN-IN BUTTON -->
                <div id="googleSignInContainer" style="width: 100%; margin: 24px 0; display: none;">
                    <!-- Google button will be rendered here -->
                </div>
                
                <!-- ‚úÖ CUSTOM GOOGLE BUTTON -->
                <button id="customGoogleBtn" class="google-signin-btn">
                    <i class="fab fa-google"></i>
                    Sign in with Google
                </button>
                
                <!-- ‚úÖ DEMO LOGIN BUTTON -->
                <button id="demoLoginBtn" class="demo-login-btn">
                    <i class="fas fa-user"></i> Try Demo Login
                </button>
                
                <div class="login-info">
                    <p><i class="fas fa-lock"></i> Your data is encrypted and secure</p>
                    <p><i class="fas fa-shield-alt"></i> We never share your personal information</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header -->
        <header class="main-header">
            <div class="header-container">
                <!-- Logo -->
                <div class="logo-section">
                    <div class="logo">
                        <i class="fas fa-balance-scale"></i>
                        <h1>Legal<span>Swami</span></h1>
                    </div>
                    <p class="tagline">Your AI Legal Assistant</p>
                </div>

                <!-- Navigation -->
                <nav class="nav-links">
                    <a href="#features" class="nav-link">
                        <i class="fas fa-star"></i> Features
                    </a>
                    <a href="#how-it-works" class="nav-link">
                        <i class="fas fa-play-circle"></i> How it Works
                    </a>
                    <a href="#testimonials" class="nav-link">
                        <i class="fas fa-comments"></i> Testimonials
                    </a>
                    <a href="#faq" class="nav-link">
                        <i class="fas fa-question-circle"></i> FAQ
                    </a>
                </nav>

                <!-- User Section -->
                <div class="user-section">
                    <!-- Login Button -->
                    <button id="headerLoginBtn" class="btn-login">
                        <i class="fas fa-sign-in-alt"></i> Login with Google
                    </button>

                    <!-- User Profile -->
                    <div id="userProfile" class="user-profile" style="display: none;">
                        <div class="user-avatar" id="userAvatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-info">
                            <span id="userName" class="user-name"></span>
                            <span id="userEmail" class="user-email"></span>
                        </div>
                        <button id="logoutBtn" class="btn-logout" title="Logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-content">
                <div class="hero-text">
                    <h1 class="hero-title">
                        Get <span class="highlight">Legal Advice</span> Instantly with AI
                    </h1>
                    <p class="hero-subtitle">
                        LegalSwami is your 24/7 AI legal assistant. Ask legal questions, 
                        generate documents, and get instant guidance on various legal matters.
                    </p>
                    
                    <div class="hero-buttons">
                        <button id="startChatBtn" class="btn-primary">
                            <i class="fas fa-comments"></i> Start Free Chat
                        </button>
                        <button id="learnMoreBtn" class="btn-secondary">
                            <i class="fas fa-play-circle"></i> See Demo
                        </button>
                    </div>

                    <div class="hero-stats">
                        <div class="stat">
                            <i class="fas fa-bolt"></i>
                            <span>Instant Responses</span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-shield-alt"></i>
                            <span>100% Secure</span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-clock"></i>
                            <span>24/7 Available</span>
                        </div>
                    </div>
                </div>

                <div class="hero-image">
                    <div class="ai-illustration">
                        <i class="fas fa-robot"></i>
                        <div class="pulse-effect"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="features-section">
            <div class="section-header">
                <h2>Powerful Features</h2>
                <p>Everything you need for your legal queries</p>
            </div>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-comment-dots"></i>
                    </div>
                    <h3>AI Chat Assistant</h3>
                    <p>Ask legal questions in natural language and get instant, accurate responses powered by advanced AI.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-file-contract"></i>
                    </div>
                    <h3>Document Generation</h3>
                    <p>Generate legal documents (PDF, DOC, TXT) instantly with customizable templates.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <h3>Chat History</h3>
                    <p>Access your complete chat history anytime. Never lose important legal conversations.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Secure & Private</h3>
                    <p>End-to-end encryption and secure authentication to protect your sensitive legal data.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3>Mobile Responsive</h3>
                    <p>Access LegalSwami from any device - desktop, tablet, or mobile phone.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-language"></i>
                    </div>
                    <h3>Multi-Language</h3>
                    <p>Get legal advice in multiple languages including Hindi, English, and more.</p>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section id="how-it-works" class="how-it-works">
            <div class="section-header">
                <h2>How It Works</h2>
                <p>Get started in 3 simple steps</p>
            </div>

            <div class="steps-container">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Sign In</h3>
                        <p>Login securely with your Google account in one click.</p>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Ask Your Question</h3>
                        <p>Type your legal question in plain English or Hindi.</p>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Get Instant Help</h3>
                        <p>Receive AI-powered legal guidance and generate documents if needed.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Chat Interface -->
        <div id="chatInterface" class="chat-interface" style="display: none;">
            <div class="chat-container">
                <!-- Chat Header -->
                <div class="chat-header">
                    <div class="chat-header-left">
                        <button id="backToHome" class="btn-icon">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div class="chat-title">
                            <i class="fas fa-robot"></i>
                            <h3>LegalSwami Assistant</h3>
                        </div>
                    </div>
                    <div class="chat-header-right">
                        <button id="clearChat" class="btn-icon" title="Clear Chat">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                        <button id="exportChat" class="btn-icon" title="Export Chat">
                            <i class="fas fa-download"></i>
                        </button>
                        <button id="historyToggle" class="btn-icon" title="Chat History">
                            <i class="fas fa-history"></i>
                        </button>
                    </div>
                </div>

                <!-- Main Chat Area -->
                <div class="chat-main">
                    <!-- Chat History Sidebar -->
                    <div id="historySidebar" class="history-sidebar">
                        <div class="history-header">
                            <h4><i class="fas fa-history"></i> Chat History</h4>
                            <button id="closeHistory" class="btn-icon">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="history-list" id="historyList">
                            <!-- History items will be loaded here -->
                        </div>
                    </div>

                    <!-- Chat Messages Area -->
                    <div class="chat-messages-container">
                        <div class="chat-messages" id="chatMessages">
                            <!-- Welcome Message -->
                            <div class="message ai-message">
                                <div class="message-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="message-content">
                                    <div class="message-text">
                                        <h4>Welcome to LegalSwami! üë®‚Äç‚öñÔ∏è</h4>
                                        <p>I'm your AI legal assistant. I can help you with:</p>
                                        <ul>
                                            <li>Legal advice and guidance</li>
                                            <li>Document review and analysis</li>
                                            <li>Legal document generation</li>
                                            <li>Explanation of laws and regulations</li>
                                            <li>Legal research assistance</li>
                                        </ul>
                                        <p><strong>Note:</strong> I'm an AI assistant, not a substitute for a licensed attorney. For critical legal matters, please consult a qualified lawyer.</p>
                                    </div>
                                    <div class="message-time">Just now</div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Questions -->
                        <div class="quick-questions">
                            <p>Try asking:</p>
                            <div class="quick-buttons">
                                <button class="quick-btn" data-question="What are the requirements for a valid contract?">
                                    Contract Requirements
                                </button>
                                <button class="quick-btn" data-question="How to draft a rental agreement?">
                                    Rental Agreement
                                </button>
                                <button class="quick-btn" data-question="What is consumer protection law?">
                                    Consumer Rights
                                </button>
                                <button class="quick-btn" data-question="How to file a legal notice?">
                                    Legal Notice
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Input Area -->
                <div class="chat-input-area">
                    <div class="input-container">
                        <div class="input-actions">
                            <button id="attachFile" class="btn-icon" title="Attach File">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <button id="voiceInput" class="btn-icon" title="Voice Input">
                                <i class="fas fa-microphone"></i>
                            </button>
                        </div>
                        
                        <textarea 
                            id="messageInput" 
                            placeholder="Type your legal question here... (Press Shift+Enter for new line, Enter to send)"
                            rows="1"
                            onkeydown="handleInputKeydown(event)"
                        ></textarea>
                        
                        <div class="input-actions">
                            <button id="sendMessage" class="btn-send" title="Send Message">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="input-options">
                        <div class="file-attachments" id="fileAttachments">
                            <!-- Attached files will appear here -->
                        </div>
                        
                        <div class="document-options">
                            <label class="checkbox-label">
                                <input type="checkbox" id="generateDocument">
                                <span>Generate as Document</span>
                            </label>
                            
                            <select id="documentType" disabled>
                                <option value="PDF">PDF</option>
                                <option value="DOC">Word Document</option>
                                <option value="TXT">Text File</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="typing-indicator" id="typingIndicator" style="display: none;">
                        <div class="typing-dots">
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                        <span>LegalSwami is thinking...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Testimonials -->
        <section id="testimonials" class="testimonials-section">
            <div class="section-header">
                <h2>What Users Say</h2>
                <p>Trusted by thousands of users</p>
            </div>

            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <div class="testimonial-content">
                        <p>"LegalSwami helped me draft a rental agreement within minutes. Saved me hundreds of dollars!"</p>
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="author-info">
                            <h4>Rahul Sharma</h4>
                            <span>Small Business Owner</span>
                        </div>
                    </div>
                </div>

                <div class="testimonial-card">
                    <div class="testimonial-content">
                        <p>"As a law student, this is an incredible tool for quick legal research and understanding complex concepts."</p>
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="author-info">
                            <h4>Priya Patel</h4>
                            <span>Law Student</span>
                        </div>
                    </div>
                </div>

                <div class="testimonial-card">
                    <div class="testimonial-content">
                        <p>"The document generation feature is amazing. Got my legal notice ready in 2 minutes!"</p>
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="author-info">
                            <h4>Ankit Verma</h4>
                            <span>Entrepreneur</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section id="faq" class="faq-section">
            <div class="section-header">
                <h2>Frequently Asked Questions</h2>
                <p>Get answers to common questions</p>
            </div>

            <div class="faq-container">
                <div class="faq-item">
                    <div class="faq-question">
                        <h4>Is LegalSwami a replacement for a lawyer?</h4>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>No, LegalSwami is an AI assistant designed to provide legal information and guidance. For critical legal matters, you should always consult a qualified attorney.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <h4>Is my data secure?</h4>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Yes, we use end-to-end encryption and secure authentication. Your conversations are private and we never share your data with third parties.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <h4>Can I generate legal documents?</h4>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Yes! You can generate various legal documents including agreements, notices, and letters in PDF, DOC, and TXT formats.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <h4>Is there a cost to use LegalSwami?</h4>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Currently, LegalSwami is free to use. We may introduce premium features in the future with clear communication to our users.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="main-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-balance-scale"></i>
                        <h3>Legal<span>Swami</span></h3>
                    </div>
                    <p>Your AI-powered legal assistant available 24/7.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                        <a href="#"><i class="fab fa-github"></i></a>
                    </div>
                </div>

                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#features">Features</a></li>
                        <li><a href="#how-it-works">How it Works</a></li>
                        <li><a href="#testimonials">Testimonials</a></li>
                        <li><a href="#faq">FAQ</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="#" id="termsLink">Terms of Service</a></li>
                        <li><a href="#" id="privacyLink">Privacy Policy</a></li>
                        <li><a href="#" id="disclaimerLink">Legal Disclaimer</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4>Contact</h4>
                    <ul>
                        <li><i class="fas fa-envelope"></i> support@legalswami.com</li>
                        <li><i class="fas fa-phone"></i> +91 9876543210</li>
                        <li><i class="fas fa-map-marker-alt"></i> India</li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2024 LegalSwami. All rights reserved.</p>
                <p class="disclaimer">
                    <i class="fas fa-exclamation-triangle"></i>
                    LegalSwami is an AI assistant, not a licensed attorney. Use information at your own discretion.
                </p>
            </div>
        </footer>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- ‚úÖ GOOGLE IDENTITY SERVICES -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Main App Script -->
    <script>
        // Global variables
        let currentChatId = null;
        let isProcessing = false;
        let googleGISInitialized = false;
        
        // ‚úÖ FIXED SHOW LOGIN MODAL FUNCTION
        function showLoginModal() {
            const modal = document.getElementById('loginModal');
            modal.classList.add('show');
            modal.style.display = 'flex';
            
            // Force reflow to enable transition
            modal.offsetHeight;
            
            // Render Google button when modal is shown
            setTimeout(() => {
                renderGoogleSignInButton();
            }, 100);
            
            console.log('üîê Login modal shown');
        }
        
        // ‚úÖ FIXED HIDE LOGIN MODAL FUNCTION
        function hideLoginModal() {
            const modal = document.getElementById('loginModal');
            modal.classList.remove('show');
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300); // Match transition duration
            
            console.log('üîê Login modal hidden');
        }
        
        // DOM Content Loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ LegalSwami Frontend Initialized');
            
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                console.log('‚úÖ Loading screen hidden');
            }, 1000);
            
            // Initialize backend connection
            initializeAppWithBackend();
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize Google Authentication
            setTimeout(initializeSimpleGoogleAuth, 1500);
            
            // Check for existing user
            checkExistingUser();
            
            // Test modal show
            setTimeout(() => {
                console.log('üîç Testing modal visibility...');
                const modal = document.getElementById('loginModal');
                console.log('Modal display style:', modal.style.display);
                console.log('Modal class:', modal.className);
            }, 2000);
        });
        
        // ‚úÖ SIMPLE GOOGLE AUTH
        function initializeSimpleGoogleAuth() {
            console.log('üîê Initializing Google Authentication...');
            
            // Wait for Google Identity Services to load
            if (typeof google === 'undefined') {
                console.warn('‚ö†Ô∏è Google Identity Services not loaded yet, will retry...');
                setTimeout(initializeSimpleGoogleAuth, 1000);
                return;
            }
            
            try {
                // Initialize Google Identity Services
                google.accounts.id.initialize({
                    client_id: '166511615962-bohur5q8d4i5hud6icr4185kcte9enk8.apps.googleusercontent.com',
                    callback: handleGoogleCredentialResponse,
                    auto_select: false,
                    cancel_on_tap_outside: true,
                    context: 'signin',
                    itp_support: false
                });
                
                googleGISInitialized = true;
                console.log('‚úÖ Google Authentication initialized');
                
            } catch (error) {
                console.error('‚ùå Google Authentication initialization failed:', error);
            }
        }
        
        // ‚úÖ RENDER GOOGLE SIGN-IN BUTTON
        function renderGoogleSignInButton() {
            try {
                const container = document.getElementById('googleSignInContainer');
                const customBtn = document.getElementById('customGoogleBtn');
                
                if (!container || !googleGISInitialized) {
                    console.warn('‚ö†Ô∏è Cannot render Google button');
                    customBtn.style.display = 'flex';
                    return;
                }
                
                // Clear container
                container.innerHTML = '';
                
                // Render Google button
                google.accounts.id.renderButton(
                    container,
                    {
                        theme: 'outline',
                        size: 'large',
                        text: 'signin_with',
                        shape: 'rectangular',
                        logo_alignment: 'left',
                        width: 400,
                        locale: 'en_US'
                    }
                );
                
                container.style.display = 'block';
                customBtn.style.display = 'none';
                
                console.log('‚úÖ Google Sign-In button rendered');
                
            } catch (error) {
                console.error('‚ùå Failed to render Google Sign-In button:', error);
                // Show custom button as fallback
                document.getElementById('customGoogleBtn').style.display = 'flex';
            }
        }
        
        // ‚úÖ HANDLE GOOGLE CREDENTIAL RESPONSE
        function handleGoogleCredentialResponse(response) {
            console.log('üîê Google credential received');
            
            try {
                // Decode the JWT token
                const payload = JSON.parse(atob(response.credential.split('.')[1]));
                
                const userData = {
                    id: 'google_' + payload.sub,
                    name: payload.name,
                    email: payload.email,
                    picture: payload.picture,
                    provider: 'google',
                    token: response.credential
                };
                
                console.log('‚úÖ Google user authenticated:', userData.email);
                
                // Store user data
                localStorage.setItem('legal_swami_user', JSON.stringify(userData));
                localStorage.setItem('legal_swami_token', response.credential);
                
                // Update API if exists
                if (window.legalSwamiAPI) {
                    window.legalSwamiAPI.user = userData;
                    window.legalSwamiAPI.token = response.credential;
                }
                
                // Update UI
                updateUserUI();
                hideLoginModal();
                
                showToast('Successfully logged in with Google!', 'success');
                
            } catch (error) {
                console.error('‚ùå Failed to process Google credential:', error);
                showToast('Login failed. Please try again.', 'error');
            }
        }
        
        // ‚úÖ CHECK FOR EXISTING USER
        function checkExistingUser() {
            console.log('üë§ Checking for existing user...');
            
            const userStr = localStorage.getItem('legal_swami_user');
            if (userStr) {
                try {
                    const user = JSON.parse(userStr);
                    console.log('‚úÖ Found existing user:', user.name);
                    
                    // Update API if exists
                    if (window.legalSwamiAPI) {
                        window.legalSwamiAPI.user = user;
                        window.legalSwamiAPI.token = localStorage.getItem('legal_swami_token');
                    }
                    
                    updateUserUI();
                    return;
                } catch (e) {
                    console.error('Error parsing user data:', e);
                    localStorage.removeItem('legal_swami_user');
                    localStorage.removeItem('legal_swami_token');
                }
            }
            
            // No existing user, show guest UI
            updateUserUI();
        }
        
        // ‚úÖ UPDATE USER UI
        function updateUserUI() {
            console.log('üë§ Updating user UI...');
            
            const userProfile = document.getElementById('userProfile');
            const headerLoginBtn = document.getElementById('headerLoginBtn');
            
            // Get user data
            let user = null;
            const userStr = localStorage.getItem('legal_swami_user');
            
            if (userStr) {
                try {
                    user = JSON.parse(userStr);
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
            
            if (user && user.id) {
                console.log('‚úÖ User logged in:', user.name);
                
                // User is logged in
                headerLoginBtn.style.display = 'none';
                userProfile.style.display = 'flex';
                
                document.getElementById('userName').textContent = user.name || 'User';
                document.getElementById('userEmail').textContent = user.email || '';
                
                const avatar = document.getElementById('userAvatar');
                if (user.picture) {
                    avatar.innerHTML = `<img src="${user.picture}" alt="${user.name}" style="width: 100%; height: 100%; border-radius: 8px; object-fit: cover;">`;
                } else {
                    const initials = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                    avatar.innerHTML = `<span style="font-size: 14px; font-weight: bold;">${initials}</span>`;
                }
                
            } else {
                console.log('üë§ No user logged in, showing login button');
                
                // User is not logged in
                headerLoginBtn.style.display = 'flex';
                userProfile.style.display = 'none';
                
                // Setup guest ID if not exists
                if (!localStorage.getItem('legalSwamiGuestId')) {
                    localStorage.setItem('legalSwamiGuestId', 'guest_' + Date.now());
                }
            }
        }
        
        // ‚úÖ SETUP ALL EVENT LISTENERS
        function setupEventListeners() {
            console.log('üîß Setting up event listeners');
            
            // Header buttons
            document.getElementById('headerLoginBtn').addEventListener('click', showLoginModal);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.getElementById('startChatBtn').addEventListener('click', startChat);
            document.getElementById('learnMoreBtn').addEventListener('click', showDemo);
            
            // Login modal buttons
            document.getElementById('demoLoginBtn').addEventListener('click', handleDemoLogin);
            document.getElementById('closeLoginModal').addEventListener('click', hideLoginModal);
            document.getElementById('customGoogleBtn').addEventListener('click', handleCustomGoogleLogin);
            
            // Chat interface
            document.getElementById('backToHome').addEventListener('click', goBackToHome);
            document.getElementById('clearChat').addEventListener('click', clearChat);
            document.getElementById('exportChat').addEventListener('click', exportChat);
            document.getElementById('historyToggle').addEventListener('click', toggleHistory);
            document.getElementById('closeHistory').addEventListener('click', toggleHistory);
            document.getElementById('sendMessage').addEventListener('click', sendMessageHandler);
            document.getElementById('attachFile').addEventListener('click', attachFile);
            document.getElementById('voiceInput').addEventListener('click', startVoiceInput);
            
            // Quick questions
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const question = this.getAttribute('data-question');
                    document.getElementById('messageInput').value = question;
                    sendMessageHandler();
                });
            });
            
            // Document generation checkbox
            document.getElementById('generateDocument').addEventListener('change', function() {
                document.getElementById('documentType').disabled = !this.checked;
            });
            
            // FAQ accordion
            document.querySelectorAll('.faq-question').forEach(question => {
                question.addEventListener('click', () => {
                    const answer = question.nextElementSibling;
                    const icon = question.querySelector('i');
                    
                    if (answer.style.display === 'block') {
                        answer.style.display = 'none';
                        icon.className = 'fas fa-chevron-down';
                    } else {
                        answer.style.display = 'block';
                        icon.className = 'fas fa-chevron-up';
                    }
                });
            });
            
            // Legal links
            document.getElementById('termsLink').addEventListener('click', showTerms);
            document.getElementById('privacyLink').addEventListener('click', showPrivacy);
            document.getElementById('disclaimerLink').addEventListener('click', showDisclaimer);
            
            // Close modal when clicking outside
            document.getElementById('loginModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideLoginModal();
                }
            });
            
            console.log('‚úÖ All event listeners set up');
        }
        
        // ‚úÖ HANDLE CUSTOM GOOGLE LOGIN
        function handleCustomGoogleLogin() {
            console.log('üîê Custom Google login triggered');
            
            if (!googleGISInitialized) {
                showToast('Google Sign-In is not available. Please use demo login.', 'warning');
                return;
            }
            
            // Trigger Google Sign-In prompt
            try {
                google.accounts.id.prompt();
            } catch (error) {
                console.error('‚ùå Google login failed:', error);
                showToast('Google Sign-In failed. Using demo login instead.', 'warning');
                handleDemoLogin();
            }
        }
        
        // ‚úÖ HANDLE DEMO LOGIN
        function handleDemoLogin() {
            console.log('üë§ Demo login triggered');
            
            const demoUsers = [
                {
                    id: 'demo_lawyer_1',
                    name: 'Demo Lawyer',
                    email: 'demo.lawyer@example.com',
                    role: 'lawyer',
                    specialization: 'Corporate Law'
                },
                {
                    id: 'demo_client_1',
                    name: 'Demo Client',
                    email: 'demo.client@example.com',
                    role: 'client',
                    caseType: 'Divorce'
                },
                {
                    id: 'demo_judge_1',
                    name: 'Demo Judge',
                    email: 'demo.judge@example.com',
                    role: 'judge',
                    court: 'Supreme Court'
                }
            ];
            
            // Select random demo user
            const randomUser = demoUsers[Math.floor(Math.random() * demoUsers.length)];
            
            // Create demo user data
            const userData = {
                ...randomUser,
                picture: `https://ui-avatars.com/api/?name=${encodeURIComponent(randomUser.name)}&background=7c3aed&color=fff&size=128`,
                provider: 'demo',
                isDemo: true
            };
            
            // Store demo user data
            localStorage.setItem('legal_swami_user', JSON.stringify(userData));
            localStorage.setItem('legal_swami_token', 'demo_token_' + Date.now());
            
            // Update API if exists
            if (window.legalSwamiAPI) {
                window.legalSwamiAPI.user = userData;
                window.legalSwamiAPI.token = 'demo_token';
            }
            
            // Update UI
            updateUserUI();
            hideLoginModal();
            showToast(`Welcome ${userData.name}! (Demo Mode)`, 'success');
        }
        
        // ‚úÖ HANDLE LOGOUT
        function handleLogout() {
            console.log('üö™ Logging out...');
            
            // Try to revoke Google token if exists
            const userStr = localStorage.getItem('legal_swami_user');
            if (userStr) {
                try {
                    const user = JSON.parse(userStr);
                    if (user.provider === 'google') {
                        try {
                            google.accounts.id.revoke(user.email, (done) => {
                                console.log('‚úÖ Google access revoked');
                            });
                        } catch (e) {
                            console.warn('Could not revoke Google access:', e);
                        }
                    }
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
            
            // Clear local data
            localStorage.removeItem('legal_swami_token');
            localStorage.removeItem('legal_swami_user');
            
            // Clear API data if exists
            if (window.legalSwamiAPI) {
                window.legalSwamiAPI.token = null;
                window.legalSwamiAPI.user = null;
            }
            
            // Update UI
            updateUserUI();
            showToast('Logged out successfully', 'success');
            
            // Go back to home if in chat interface
            if (document.getElementById('chatInterface').style.display !== 'none') {
                goBackToHome();
            }
        }
        
        // ‚úÖ INITIALIZE APP WITH BACKEND
        async function initializeAppWithBackend() {
            console.log('üîå Initializing app with backend...');
            
            try {
                const backendUrl = 'https://legal-swami-backend.onrender.com';
                
                // Create API object if not exists
                if (!window.legalSwamiAPI) {
                    window.legalSwamiAPI = {
                        token: localStorage.getItem('legal_swami_token'),
                        user: null,
                        sendMessage: async function(message, attachments, chatId) {
                            console.log('üì§ Sending message to backend:', message.substring(0, 50));
                            
                            const userId = this.user ? this.user.id : 'guest_' + Date.now();
                            
                            const response = await fetch(`${backendUrl}/api/v1/chat/send`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'x-user-id': userId,
                                    'x-request-id': 'req_' + Date.now()
                                },
                                body: JSON.stringify({
                                    message: message,
                                    generateDocument: document.getElementById('generateDocument').checked
                                })
                            });
                            
                            if (!response.ok) {
                                throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                            }
                            
                            return await response.json();
                        },
                        getChatHistory: async function(page = 0, size = 10) {
                            const userId = this.user ? this.user.id : 'guest';
                            
                            const response = await fetch(
                                `${backendUrl}/api/v1/chat/history?userId=${userId}&page=${page}&size=${size}`,
                                {
                                    headers: {
                                        'x-user-id': userId,
                                        'x-request-id': 'req_' + Date.now()
                                    }
                                }
                            );
                            
                            if (!response.ok) {
                                throw new Error(`HTTP ${response.status}`);
                            }
                            
                            return await response.json();
                        }
                    };
                }
                
                // Test backend health
                const healthResponse = await fetch(`${backendUrl}/api/v1/public/health`);
                if (healthResponse.ok) {
                    const healthData = await healthResponse.json();
                    console.log('‚úÖ Backend health check passed:', healthData);
                    showToast('Backend connected successfully!', 'success');
                } else {
                    console.warn('‚ö†Ô∏è Backend health check failed:', healthResponse.status);
                }
                
                updateUserUI();
                
            } catch (error) {
                console.error('‚ùå Initialization failed:', error);
                showToast('Note: Some features may be limited', 'warning');
            }
        }
        
        // ‚úÖ START CHAT
        function startChat() {
            console.log('üí¨ Starting chat...');
            
            const user = window.legalSwamiAPI ? window.legalSwamiAPI.user : null;
            const token = localStorage.getItem('legal_swami_token');
            const guestId = localStorage.getItem('legalSwamiGuestId');
            
            if (!user && !guestId && !token) {
                showLoginModal();
                showToast('Please login to start chatting', 'warning');
                return;
            }
            
            document.getElementById('chatInterface').style.display = 'block';
            document.querySelector('.main-container').style.background = '#f8fafc';
            
            setTimeout(() => {
                document.getElementById('messageInput').focus();
                console.log('‚úÖ Chat interface ready');
            }, 100);
        }
        
        // ‚úÖ GO BACK TO HOME
        function goBackToHome() {
            document.getElementById('chatInterface').style.display = 'none';
            document.querySelector('.main-container').style.background = '';
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            console.log('üè† Returned to home');
        }
        
        // ‚úÖ CLEAR CHAT
        function clearChat() {
            if (confirm('Are you sure you want to clear the chat?')) {
                const chatMessages = document.getElementById('chatMessages');
                const messages = chatMessages.querySelectorAll('.message');
                
                messages.forEach((message, index) => {
                    if (index > 0) {
                        message.remove();
                    }
                });
                
                currentChatId = null;
                showToast('Chat cleared', 'success');
                console.log('üóëÔ∏è Chat cleared');
            }
        }
        
        // ‚úÖ EXPORT CHAT
        function exportChat() {
            const chatMessages = document.getElementById('chatMessages');
            const messages = chatMessages.querySelectorAll('.message');
            
            let exportText = 'LegalSwami Chat Export\n';
            exportText += 'Generated on: ' + new Date().toLocaleString() + '\n\n';
            
            messages.forEach(message => {
                const isAI = message.classList.contains('ai-message');
                const text = message.querySelector('.message-text')?.textContent || '';
                const time = message.querySelector('.message-time')?.textContent || '';
                
                exportText += `${isAI ? 'AI' : 'You'} (${time}):\n${text}\n\n`;
            });
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `legalswami-chat-${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Chat exported successfully', 'success');
            console.log('üì• Chat exported');
        }
        
        // ‚úÖ TOGGLE HISTORY SIDEBAR
        function toggleHistory() {
            const sidebar = document.getElementById('historySidebar');
            if (sidebar.style.display === 'flex') {
                sidebar.style.display = 'none';
                console.log('üìú History sidebar hidden');
            } else {
                sidebar.style.display = 'flex';
                loadChatHistory();
                console.log('üìú History sidebar shown');
            }
        }
        
        // ‚úÖ LOAD CHAT HISTORY
        async function loadChatHistory() {
            try {
                if (!window.legalSwamiAPI) {
                    console.warn('API not initialized');
                    return;
                }
                
                console.log('üìú Loading chat history...');
                const history = await window.legalSwamiAPI.getChatHistory(0, 10);
                updateHistoryList(history);
                console.log('‚úÖ Chat history loaded:', history.length, 'items');
            } catch (error) {
                console.error('Failed to load history:', error);
                showToast('Failed to load chat history', 'error');
            }
        }
        
        // ‚úÖ UPDATE HISTORY LIST UI
        function updateHistoryList(history) {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            if (!history || history.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-history">
                        <i class="fas fa-history"></i>
                        <p>No chat history yet</p>
                    </div>
                `;
                return;
            }
            
            history.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-item-content">
                        <p class="history-question">${item.message.substring(0, 50)}${item.message.length > 50 ? '...' : ''}</p>
                        <span class="history-time">${formatTime(item.createdAt)}</span>
                    </div>
                    <button class="btn-icon" onclick="loadChatFromHistory('${item.id}')">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                `;
                historyList.appendChild(historyItem);
            });
        }
        
        // ‚úÖ LOAD CHAT FROM HISTORY
        async function loadChatFromHistory(chatId) {
            try {
                showToast('Loading chat from history...', 'info');
                toggleHistory();
                console.log('üìú Loading chat:', chatId);
            } catch (error) {
                console.error('Failed to load chat:', error);
                showToast('Failed to load chat', 'error');
            }
        }
        
        // ‚úÖ HANDLE INPUT KEYDOWN
        function handleInputKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessageHandler();
            }
            
            const textarea = event.target;
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }
        
        // ‚úÖ SEND MESSAGE HANDLER
        async function sendMessageHandler() {
            if (isProcessing) {
                console.warn('‚ö†Ô∏è Message already being processed');
                return;
            }
            
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) {
                showToast('Please enter a message', 'warning');
                return;
            }
            
            let userId = 'guest';
            if (window.legalSwamiAPI && window.legalSwamiAPI.user) {
                userId = window.legalSwamiAPI.user.id;
            } else {
                userId = localStorage.getItem('legalSwamiGuestId') || 'guest_' + Date.now();
                localStorage.setItem('legalSwamiGuestId', userId);
            }
            
            isProcessing = true;
            
            try {
                console.log('üí¨ Sending message:', message.substring(0, 100));
                
                addMessageToChat(message, true);
                input.value = '';
                input.style.height = 'auto';
                
                showTypingIndicator(true);
                
                const generateDocument = document.getElementById('generateDocument').checked;
                const documentType = document.getElementById('documentType').value;
                
                const backendUrl = 'https://legal-swami-backend.onrender.com';
                const response = await fetch(`${backendUrl}/api/v1/chat/send`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-user-id': userId,
                        'x-request-id': 'req_' + Date.now()
                    },
                    body: JSON.stringify({
                        message: message,
                        generateDocument: generateDocument
                    })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ Received response:', data.id);
                
                addMessageToChat(data.response || 'No response received', false, generateDocument, documentType);
                
                await loadChatHistory();
                
            } catch (error) {
                console.error('‚ùå Failed to send message:', error);
                addMessageToChat('Sorry, I encountered an error. Please try again.', false);
                showToast('Failed to send message: ' + error.message, 'error');
            } finally {
                isProcessing = false;
                showTypingIndicator(false);
            }
        }
        
        // ‚úÖ ADD MESSAGE TO CHAT UI
        function addMessageToChat(content, isUser = false, isDocument = false, documentType = null) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
            
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            let messageContent = content;
            if (isDocument) {
                messageContent = `üìÑ **${documentType} Document Generated:**\n\n${content}`;
            }
            
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    ${isUser ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>'}
                </div>
                <div class="message-content">
                    <div class="message-text">${formatMessageText(messageContent)}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            console.log('üí¨ Message added to chat:', isUser ? 'User' : 'AI');
        }
        
        // ‚úÖ FORMAT MESSAGE TEXT
        function formatMessageText(text) {
            text = text.replace(/\n/g, '<br>');
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
            text = text.replace(/^\s*[-‚Ä¢*]\s+(.*)$/gm, '<li>$1</li>');
            text = text.replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>');
            return text;
        }
        
        // ‚úÖ SHOW TYPING INDICATOR
        function showTypingIndicator(show) {
            const indicator = document.getElementById('typingIndicator');
            indicator.style.display = show ? 'flex' : 'none';
            
            if (show) {
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }
        
        // ‚úÖ ATTACH FILE
        function attachFile() {
            showToast('File attachment feature coming soon!', 'info');
            console.log('üìé File attachment clicked');
        }
        
        // ‚úÖ START VOICE INPUT
        function startVoiceInput() {
            showToast('Voice input feature coming soon!', 'info');
            console.log('üé§ Voice input clicked');
        }
        
        // ‚úÖ SHOW DEMO
        function showDemo() {
            showToast('Demo feature coming soon!', 'info');
            console.log('üé¨ Demo clicked');
        }
        
        // ‚úÖ SHOW TERMS
        function showTerms(e) {
            e.preventDefault();
            alert('Terms of Service\n\nBy using LegalSwami, you agree to our terms...');
        }
        
        // ‚úÖ SHOW PRIVACY POLICY
        function showPrivacy(e) {
            e.preventDefault();
            alert('Privacy Policy\n\nWe value your privacy...');
        }
        
        // ‚úÖ SHOW DISCLAIMER
        function showDisclaimer(e) {
            e.preventDefault();
            alert('Legal Disclaimer\n\nLegalSwami is an AI assistant, not a licensed attorney...');
        }
        
        // ‚úÖ FORMAT TIME
        function formatTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
            return date.toLocaleDateString();
        }
        
        // ‚úÖ SHOW TOAST NOTIFICATION
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            toast.innerHTML = `
                <i class="${icons[type]}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('fade-out');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
            
            console.log(`üì¢ Toast (${type}):`, message);
        }
        
        // ‚úÖ MAKE FUNCTIONS AVAILABLE GLOBALLY
        window.handleInputKeydown = handleInputKeydown;
        window.loadChatFromHistory = loadChatFromHistory;
        
        console.log('‚úÖ LegalSwami App Initialization Complete!');
    </script>
</body>
</html>
